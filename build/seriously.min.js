'use strict';var URL,require,WeakMap,module,exports,define;(function(b,a){"function"===typeof define&&define.amd?define("seriously",function(){var c=a(b);b.Seriously||(b.Seriously=c);return c}):"object"===typeof exports?module.exports=a(b):"function"!==typeof b.Seriously&&(b.Seriously=a(b))})(this,function(b){function a(a,b){var c,d;if("string"===typeof a)c=v.querySelector(a);else if(!a)return!1;a.tagName&&(c=a);if(!c)return a;d=c.tagName.toLowerCase();return b&&0>b.indexOf(d)?a:c}function c(a,b){var m,d;a.prototype&&b.prototype&&a.prototype!==b.prototype&&
c(a.prototype,b.prototype);for(m in b)b.hasOwnProperty(m)&&(d=Object.getOwnPropertyDescriptor(b,m),d.get||d.set?Object.defineProperty(a,m,{configurable:!0,enumerable:!0,get:d.get,set:d.set}):a[m]=b[m]);return a}function d(a){var b;if(!y)return P;if("function"===typeof y[a])b=y[a];else if("function"===typeof y.log)b=y.log;else return P;return b.bind?b.bind(y):function(){b.apply(y,arguments)}}function e(a,b,c,d,g){function f(a,b,c){c%=1;0>c&&(c+=1);return c<1/6?a+(b-a)*c*6:0.5>c?b:c<2/3?a+(b-a)*(2/
3-c)*6:a}b=0.5>c?c*(b+1):c+b-c*b;c=2*c-b;g||(g=[]);g[0]=f(c,b,a+1/3);g[1]=f(c,b,a);g[2]=f(c,b,a-1/3);g[3]=d;return g}function h(a){var b,c,d,g="#",f=1>a[3]?4:3;for(b=0;b<f;b++)c=Math.min(255,Math.round(255*a[b]||0)),d=c.toString(16),16>c&&(d="0"+d),g+=d;return g}function k(a){return Array.isArray(a)||a&&a.BYTES_PER_ELEMENT&&"length"in a}function n(a){function c(){u.length&&u.shift()()}if("function"!==typeof a)throw Error("setTimeoutZero argument is not a function");u.push(a);"file:"===b.location.protocol?
setTimeout(c,0):b.postMessage("seriously-timeout-message",b.location)}function r(a,c){var d;try{d=b.WebGLDebugUtils&&c&&c.debugContext?b.WebGLDebugUtils.makeDebugContext(a.getContext("webgl",c)):a.getContext("webgl",c)}catch(g){}if(!d)try{d=a.getContext("experimental-webgl",c)}catch(f){}return d}function p(){var a;w&&w.getError()===w.CONTEXT_LOST_WEBGL&&(w=void 0);if(w||!b.WebGLRenderingContext||M)return w;a=v.createElement("canvas");(w=r(a))?a.addEventListener("webglcontextlost",function m(b){b.preventDefault();
w&&w.canvas===this&&(w=void 0,a.removeEventListener("webglcontextlost",m,!1))},!1):f.logger.warn("Unable to access WebGL.");return w}function g(a){function b(a,c){var t,m;k(a)?(t=a[0],m=a[1]||t):t=a;"string"===typeof t?t=t.toLowerCase():"number"===typeof t?t=String(t):t||(t="");g[t]=m;c||(d.firstValue=t)}function c(a){return a}var d,g,l;for(l in a.inputs)if(a.inputs.hasOwnProperty(l)){if(0<=a.reserved.indexOf(l)||Object.prototype[l])throw Error("Reserved input name: "+l);d=a.inputs[l];d.name=l;isNaN(d.min)&&
(d.min=-Infinity);isNaN(d.max)&&(d.max=Infinity);isNaN(d.minCount)&&(d.minCount=-Infinity);isNaN(d.maxCount)&&(d.maxCount=Infinity);isNaN(d.step)&&(d.step=0);"enum"===d.type&&d.options&&k(d.options)&&d.options.length&&(g={},d.options.forEach(b),d.options=g);"vector"===d.type?2>d.dimensions?d.dimensions=2:4<d.dimensions?d.dimensions=4:!d.dimensions||isNaN(d.dimensions)?d.dimensions=4:d.dimensions=Math.round(d.dimensions):d.dimensions=1;d.shaderDirty=!!d.shaderDirty;"function"!==typeof d.validate&&
(d.validate=f.inputValidators[d.type]||c);a.defaultImageInput||"image"!==d.type||(a.defaultImageInput=l)}}function l(a,b,c,d){var g,l;this.type=a.UNSIGNED_BYTE;g=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,g);d&&d.texture?(this.texture=d.texture,a.bindTexture(a.TEXTURE_2D,this.texture),this.ownTexture=!1):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.ownTexture=!0);try{this.type===a.FLOAT?(l=new Float32Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.FLOAT,l)):(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null),this.type=a.UNSIGNED_BYTE)}catch(f){this.type=a.UNSIGNED_BYTE,l=new Uint8Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,
a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,l)}d=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,d);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b,c);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,d);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);l=a.checkFramebufferStatus(a.FRAMEBUFFER);if(l===a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");if(l===a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
if(l===a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");if(l===a.FRAMEBUFFER_UNSUPPORTED)throw Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");if(l!==a.FRAMEBUFFER_COMPLETE)throw Error("Incomplete framebuffer: "+l);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);this.gl=a;this.frameBuffer=g;this.renderBuffer=d;this.width=b;this.height=c}function q(a,b,c){function d(b,
c){var m,g;m=c?a.createShader(a.FRAGMENT_SHADER):a.createShader(a.VERTEX_SHADER);a.shaderSource(m,b);a.compileShader(m);if(!a.getShaderParameter(m,a.COMPILE_STATUS)){b=b.split(/[\n\r]/);for(g=0;g<b.length;g++)b[g]=g+1+":\t"+b[g];b.unshift("Error compiling "+(c?"fragment":"vertex")+" shader:");f.logger.error(b.join("\n"));throw Error("Shader error: "+a.getShaderInfoLog(m));}return m}function g(b,c){if(b.type===a.SAMPLER_2D)return function(d){b.glTexture=a["TEXTURE"+d];a.uniform1i(c,d)};if(b.type===
a.BOOL||b.type===a.INT)return 1<b.size?function(b){a.uniform1iv(c,b)}:function(b){a.uniform1i(c,b)};if(b.type===a.FLOAT)return 1<b.size?function(b){a.uniform1fv(c,b)}:function(b){a.uniform1f(c,b)};if(b.type===a.FLOAT_VEC2)return function(b){a.uniform2f(c,b[0],b[1])};if(b.type===a.FLOAT_VEC3)return function(b){a.uniform3f(c,b[0],b[1],b[2])};if(b.type===a.FLOAT_VEC4)return function(b){a.uniform4f(c,b[0],b[1],b[2],b[3])};if(b.type===a.FLOAT_MAT3)return function(b){a.uniformMatrix3fv(c,!1,b)};if(b.type===
a.FLOAT_MAT4)return function(b){a.uniformMatrix4fv(c,!1,b)};throw Error("Unknown shader uniform type: "+b.type);}function l(b){return function(){return a.getUniform(e,b)}}var e,k,q,h="";k=d(b);q=d(c,!0);e=a.createProgram();a.attachShader(e,k);(b=a.getShaderInfoLog(k))&&(h+="Vertex shader error: "+b+"\n");a.attachShader(e,q);(b=a.getShaderInfoLog(q))&&(h+="Fragment shader error: "+b+"\n");a.linkProgram(e);if(!a.getProgramParameter(e,a.LINK_STATUS))throw h+=a.getProgramInfoLog(e),a.deleteProgram(e),
a.deleteShader(k),a.deleteShader(q),Error("Could not initialise shader: "+h);a.useProgram(e);this.uniforms={};b=a.getProgramParameter(e,a.ACTIVE_UNIFORMS);for(h=0;h<b;++h)c={info:a.getActiveUniform(e,h)},c.name=c.info.name,c.loc=a.getUniformLocation(e,c.name),c.set=g(c.info,c.loc),c.get=l(c.loc),this.uniforms[c.name]=c,this[c.name]||(this[c.name]=c);this.attributes={};this.location={};b=a.getProgramParameter(e,a.ACTIVE_ATTRIBUTES);for(h=0;h<b;++h)c={info:a.getActiveAttrib(e,h)},c.name=c.info.name,
c.location=a.getAttribLocation(e,c.name),this.attributes[c.name]=c,this.location[c.name]=c.location;this.gl=a;this.program=e;this.destroy=function(){var b;a&&(a.deleteProgram(e),a.deleteShader(k),a.deleteShader(q));for(b in this)this.hasOwnProperty(b)&&delete this[b];q=k=e=null}}function f(d){function e(a,b){var c,d,m;if(!b)return!1;c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,a.vertices,b.STATIC_DRAW);c.size=3;d=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
d);b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.indices,b.STATIC_DRAW);m=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,m);b.bufferData(b.ARRAY_BUFFER,a.coords,b.STATIC_DRAW);m.size=2;return{vertex:c,index:d,texCoord:m,length:a.indices.length,mode:a.mode||b.TRIANGLES}}function m(a){var b={};b.vertices=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]);b.indices=new Uint16Array([0,1,2,0,2,3]);b.coords=new Float32Array([0,0,1,0,1,1,0,1]);return e(b,a)}function k(a){var b;if(!s)if(a.canvas.addEventListener("webglcontextlost",
u,!1),a.canvas.addEventListener("webglcontextrestored",p,!1),a.isContextLost())f.logger.warn("Unable to attach lost WebGL context. Will try again when context is restored.");else{s=a;S=a.canvas;V=m(s);X=new q(s,Y,ka);for(a=0;a<la.length;a++)b=la[a],b.gl=s,b.initialize(),b.buildShader();for(a=0;a<Z.length;a++)b=Z[a],b.initialize();for(a=0;a<W.length;a++)b=W[a],b.model||(b.model=V,b.shader=X)}}function p(){var a,b;if(O&&!s)if(a=O.target,a instanceof WebGLFramebuffer)f.logger.error("Unable to restore target built on WebGLFramebuffer");
else if(a=r(a,{alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:O.debugContext}))if(a.isContextLost())f.logger.error("Unable to restore WebGL Context");else{k(a);O.frameBuffer=O.renderToTexture?new l(s,O.width,O.height,!1):{frameBuffer:null};for(a=0;a<fa.length;a++)b=fa[a],b.setDirty(),b.emit("webglcontextrestored");f.logger.log("WebGL context restored")}}function u(a){var b,c;a&&(f.logger.warn("WebGL context lost"),a.preventDefault());$&&(sa($),$=0);S&&S.removeEventListener("webglcontextlost",
u,!1);for(b=0;b<la.length;b++)c=la[b],c.gl=null,c.initialized=!1,c.baseShader=null,c.model=null,c.frameBuffer=null,c.texture=null,c.shader&&c.shader.destroy&&c.shader.destroy(),c.shaderDirty=!0,c.shader=null,c.effect.lostContext&&c.effect.lostContext.call(c),a&&c.emit("webglcontextlost");for(b=0;b<Z.length;b++)c=Z[b],c.texture=null,c.initialized=!1,c.allowRefresh=!1,a&&c.emit("webglcontextlost");for(b=0;b<F.length;b++)c=F[b],c.frameBuffer=null,c.texture=null,a&&c.emit("webglcontextlost");for(b=0;b<
W.length;b++)c=W[b],c.model=!1,c.frameBuffer=null,a&&c.emit("webglcontextlost");X&&X.destroy&&X.destroy();s&&(s.deleteBuffer(V.vertex),s.deleteBuffer(V.texCoord),s.deleteBuffer(V.index));V&&(delete V.vertex,delete V.texCoord,delete V.index);S=s=X=V=null}function y(a){var b,c=!1;$=0;if(ma.length)for(c=!0,b=0;b<ma.length;b++)ma[b].call(C,a);if(Z&&Z.length)for(c=!0,b=0;b<Z.length;b++)if(a=Z[b],a.dirty||a.checkDirty&&a.checkDirty())a.dirty=!1,a.setDirty();for(b=0;b<W.length;b++)a=W[b],a.auto&&a.dirty&&
a.render();if(na.length)for(c=!0,b=0;b<na.length;b++)na[b].call(C);c&&!$&&($=ta(y))}function ha(a,b,c,d,m,t){var g=0,l,e,f=m&&m.gl||s,k;if(f){m?(e=t&&t.width||m.width||f.canvas.width,m=t&&t.height||m.height||f.canvas.height):(e=t&&t.width||f.canvas.width,m=t&&t.height||f.canvas.height);a.use();f.viewport(0,0,e,m);f.bindFramebuffer(f.FRAMEBUFFER,d);f.enableVertexAttribArray(a.location.position);f.enableVertexAttribArray(a.location.texCoord);b.texCoord&&(f.bindBuffer(f.ARRAY_BUFFER,b.texCoord),f.vertexAttribPointer(a.location.texCoord,
b.texCoord.size,f.FLOAT,!1,0,0));f.bindBuffer(f.ARRAY_BUFFER,b.vertex);f.vertexAttribPointer(a.location.position,b.vertex.size,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b.index);t&&t.depth?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST);t?void 0===t.blend||t.blend?(s.enable(s.BLEND),d=void 0===t.srcRGB?s.ONE:t.srcRGB,m=t.dstRGB||s.ZERO,e=void 0===t.srcAlpha?d:t.srcAlpha,k=void 0===t.dstAlpha?m:t.dstAlpha,s.blendFuncSeparate(d,m,e,k),s.blendEquation(t.blendEquation||s.FUNC_ADD)):s.disable(s.BLEND):
(s.enable(s.BLEND),s.blendFunc(s.ONE,s.ZERO),s.blendEquation(s.FUNC_ADD));for(l in c)c.hasOwnProperty(l)&&(d=c[l],e=a.uniforms[l])&&(d instanceof WebGLTexture?(f.activeTexture(f.TEXTURE0+g),f.bindTexture(f.TEXTURE_2D,d),e.set(g),g++):d instanceof aa||d instanceof Q||d instanceof R?d.texture&&(f.activeTexture(f.TEXTURE0+g),f.bindTexture(f.TEXTURE_2D,d.texture),e.set(g),g++):void 0!==d&&null!==d&&e.set(d));if(!t||void 0===t.clear||t.clear)f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);
f.drawElements(b.mode,b.length,f.UNSIGNED_SHORT,0);s.enable(s.DEPTH_TEST)}}function w(b,c,d){var m,t;if("string"!==typeof b||!c&&0!==c)d&&"object"===typeof d||(d=c),c=b;"string"===typeof b&&A[b]||(b=null);if(c instanceof aa||c instanceof Q||c instanceof R)m=c;else if(c instanceof pa||c instanceof qa||c instanceof ra){if(m=oa[c.id],!m)throw Error("Cannot connect a foreign node");}else{"string"===typeof c&&isNaN(c)&&(c=a(c,["canvas","img","video"]));for(t=0;t<Z.length;t++)if(m=Z[t],(!b||b===m.hook)&&
m.compare&&m.compare(c,d))return m;m=new aa(b,c,d)}return m}function B(a,b){var c,d,m;if(!(a instanceof Q||a instanceof R))return!1;if(a===b)return!0;m=a.sources;for(c in m)if(m.hasOwnProperty(c)&&(d=m[c],d===b||B(d,b)))return!0;return!1}if(b===this||!(this instanceof f)||void 0!==this.id)return new f(d);var M=++U,C=this,fa=[],oa={},ia=0,Z=[],W=[],F=[],la=[],ga={},ma=[],na=[],N={},S,s,O,V,ja={},X,I,aa,Q,R,ba,pa,qa,ra,ua,xa=!1,ya=!1,$;I=function(){this.ready=!1;this.height=this.width=1;this.gl=s;this.uniforms=
{resolution:[this.width,this.height],transform:null};this.dirty=!0;this.isDestroyed=!1;this.seriously=C;this.listeners={};this.id=ia;ia++};I.prototype.setReady=function(){var a;if(!this.ready&&(this.ready=!0,this.emit("ready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setReady()};I.prototype.setUnready=function(){var a;if(this.ready&&(this.ready=!1,this.emit("unready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setUnready()};I.prototype.setDirty=function(){var a;
if(!this.dirty&&(this.emit("dirty"),this.dirty=!0,this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setDirty()};I.prototype.initFrameBuffer=function(a){s&&(this.frameBuffer=new l(s,this.width,this.height,a))};I.prototype.readPixels=function(a,b,c,d,m){var t=this.gl||s;if(!s)throw Error("Cannot read pixels until a canvas is connected");this.frameBuffer||(this.initFrameBuffer(),this.setDirty());this.render();if(void 0===m)m=new Uint8Array(c*d*4);else if(!m instanceof Uint8Array)throw Error("Incompatible array type");
t.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer.frameBuffer);t.readPixels(a,b,c,d,s.RGBA,s.UNSIGNED_BYTE,m);return m};I.prototype.resize=function(){var a,b;this.source?(a=this.source.width,b=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,b=this.sources.source.height):this.inputs&&this.inputs.width?(a=this.inputs.width,b=this.inputs.height||a):this.inputs&&this.inputs.height?a=b=this.inputs.height:b=a=1;a=Math.floor(a);b=Math.floor(b);if(this.width!==a||this.height!==
b)this.width=a,this.height=b,this.emit("resize"),this.setDirty();this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b);this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(a,b)};I.prototype.on=function(a,b){var c,d=-1;a&&"function"===typeof b&&((c=this.listeners[a])?d=c.indexOf(b):c=this.listeners[a]=[],0>d&&c.push(b))};I.prototype.off=function(a,b){var c,d=-1;a&&"function"===typeof b&&(c=this.listeners[a])&&(d=c.indexOf(b),0<=d&&c.splice(d,
1))};I.prototype.emit=function(a){var b=this.listeners[a];if(b&&b.length)for(a=0;a<b.length;a++)n(b[a])};I.prototype.destroy=function(){var a,b;delete this.gl;delete this.seriously;for(b in this.listeners)this.listeners.hasOwnProperty(b)&&delete this.listeners[b];for(a in this.uniforms)this.uniforms.hasOwnProperty(a)&&delete this.uniforms[a];this.targets&&delete this.targets;this.frameBuffer&&this.frameBuffer.destroy&&(this.frameBuffer.destroy(),delete this.frameBuffer);a=fa.indexOf(this);0<=a&&fa.splice(a,
1);delete oa[this.id];this.isDestroyed=!0};pa=function(b){function d(b,c){var x,m,K;K=e.effect.inputs[b];x=e.inputElements[b];"string"===typeof c&&isNaN(c)&&("enum"===K.type?K.options.hasOwnProperty(c)||(c=a(c,["select"])):"number"===K.type||"boolean"===K.type?c=a(c,["input","select"]):"image"===K.type&&(c=a(c,["canvas","img","video"])));c instanceof HTMLInputElement||c instanceof HTMLSelectElement?(m=c.value,x&&x.element!==c&&(x.element.removeEventListener("change",x.listener,!0),x.element.removeEventListener("input",
x.listener,!0),delete e.inputElements[b],x=null),x||(x={element:c,listener:function(a,b){return function(){var d,x;d="checkbox"===c.type?c.checked:b.value;x=e.setInput(a,d);"color"===K.type&&(x=h(x).substr(0,7));x!==d&&(b.value=x)}}(b,c)},e.inputElements[b]=x,"range"===c.type&&c.addEventListener("input",x.listener,!0),c.addEventListener("change",x.listener,!0)),x&&"checkbox"===c.type&&(m=c.checked)):(x&&(x.element.removeEventListener("change",x.listener,!0),x.element.removeEventListener("input",x.listener,
!0),delete e.inputElements[b]),m=c);e.setInput(b,m);return e.inputs[b]}function m(a){return function(b){return(b=d(a,b))&&b.pub}}function t(a){return function(){var b=e.inputs[a];return b&&b.pub}}function f(a){return function(b){return d(a,b)}}function g(a){return function(){return e.inputs[a]}}var l,e=b;for(l in e.effect.inputs)if(e.effect.inputs.hasOwnProperty(l))if(void 0===this[l])"image"===e.effect.inputs[l].type?Object.defineProperty(this,l,{configurable:!0,enumerable:!0,get:t(l),set:m(l)}):
Object.defineProperty(this,l,{configurable:!0,enumerable:!0,get:g(l),set:f(l)});else throw Error("Cannot overwrite Seriously."+l);Object.defineProperties(this,{effect:{enumerable:!0,configurable:!0,get:function(){return e.hook}},title:{enumerable:!0,configurable:!0,get:function(){return e.effect.title||e.hook}},width:{enumerable:!0,configurable:!0,get:function(){return e.width}},height:{enumerable:!0,configurable:!0,get:function(){return e.height}},id:{enumerable:!0,configurable:!0,get:function(){return e.id}}});
this.render=function(){e.render();return this};this.readPixels=function(a,b,c,d,x){return e.readPixels(a,b,c,d,x)};this.on=function(a,b){e.on(a,b)};this.off=function(a,b){e.off(a,b)};this.inputs=function(a){var b,d;b=e.effect.inputs;if(a){b=b[a];if(!b)return null;a={type:b.type,defaultValue:b.defaultValue,title:b.title||a};"number"===b.type?(a.min=b.min,a.max=b.max,a.step=b.step):"enum"===b.type?a.options=c({},b.options):"vector"===b.type&&(a.dimensions=b.dimensions);b.description&&(a.description=
b.description);return a}a={};for(d in b)b.hasOwnProperty(d)&&(a[d]=this.inputs(d));return a};this.alias=function(a,b){e.alias(a,b);return this};this.matte=function(a){e.matte(a)};this.destroy=function(){var a,b;e.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=P)};this.isDestroyed=function(){return e.isDestroyed};this.isReady=function(){return e.ready}};Q=function(a,
b){var d,m,t,e,f={};I.call(this,b);this.gl=s;this.effectRef=G[a];this.sources={};this.targets=[];this.inputElements={};this.shaderDirty=this.dirty=!0;this.hook=a;this.options=b;this.transform=null;this.effect=c({},this.effectRef);this.effectRef.definition&&c(this.effect,this.effectRef.definition.call(this,b));g(this.effect);this.uniforms.transform=E;this.inputs={};e=N[a];for(d in this.effect.inputs)if(this.effect.inputs.hasOwnProperty(d)){m=this.effect.inputs[d];if(void 0===m.defaultValue||null===
m.defaultValue)"number"===m.type?m.defaultValue=Math.min(Math.max(0,m.min),m.max):"color"===m.type?m.defaultValue=[0,0,0,0]:"boolean"===m.type?m.defaultValue=!1:"string"===m.type?m.defaultValue="":"enum"===m.type&&(m.defaultValue=m.firstValue);t=m.validate.call(this,m.defaultValue,m);e&&void 0!==e[d]&&(t=m.validate.call(this,e[d],m,m.defaultValue,t),e[d]=t,"image"===m.type&&(f[d]=t));this.inputs[d]=t;m.uniform&&(this.uniforms[m.uniform]=m.defaultValue)}s&&(this.initialize(),this.effect.commonShader&&
this.buildShader());this.updateReady();this.inPlace=this.effect.inPlace;this.pub=new pa(this);fa.push(this);oa[this.id]=this;la.push(this);D[a].push(this);for(d in f)f.hasOwnProperty(d)&&this.setInput(d,f[d])};Q.prototype=Object.create(I.prototype);Q.prototype.initialize=function(){if(!this.initialized){var a=this;this.baseShader=X;this.model=this.shape?e(this.shape,this.gl):V;"function"===typeof this.effect.initialize?this.effect.initialize.call(this,function(){a.initFrameBuffer(!0)},s):this.initFrameBuffer(!0);
this.frameBuffer&&(this.texture=this.frameBuffer.texture);this.initialized=!0}};Q.prototype.resize=function(){var a;I.prototype.resize.call(this);this.effect.resize&&this.effect.resize.call(this);for(a=0;a<this.targets.length;a++)this.targets[a].resize()};Q.prototype.updateReady=function(){var a,b,c,d=!0;c=this.effect;for(b in c.inputs)if(c.inputs.hasOwnProperty(b)&&(a=this.effect.inputs[b],"image"===a.type&&!(this.sources[b]&&this.sources[b].ready||c.requires&&!c.requires.call(this,b,this.inputs)))){d=
!1;break}if(this.ready!==d&&(this.ready=d,this.emit(d?"ready":"unready"),b=d?"setReady":"setUnready",this.targets))for(a=0;a<this.targets.length;a++)this.targets[a][b]()};Q.prototype.setReady=Q.prototype.updateReady;Q.prototype.setUnready=Q.prototype.updateReady;Q.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};Q.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1)};Q.prototype.removeSource=
function(a){var b,c=a&&a.pub;for(b in this.inputs)!this.inputs.hasOwnProperty(b)||this.inputs[b]!==a&&this.inputs[b]!==c||(this.inputs[b]=null);for(b in this.sources)!this.sources.hasOwnProperty(b)||this.sources[b]!==a&&this.sources[b]!==c||(this.sources[b]=null)};Q.prototype.buildShader=function(){var a,b=this.effect;this.shaderDirty&&(b.commonShader&&ja[this.hook]?(this.shader||ja[this.hook].count++,this.shader=ja[this.hook].shader):b.shader?(this.shader&&!b.commonShader&&this.shader.destroy(),
a=b.shader.call(this,this.inputs,{vertex:Y,fragment:ka},f.util),this.shader=a instanceof q?a:a&&a.vertex&&a.fragment?new q(s,a.vertex,a.fragment):X,b.commonShader&&(ja[this.hook]={count:1,shader:this.shader})):this.shader=X,this.shaderDirty=!1)};Q.prototype.render=function(){function a(b,c,d,x,t,e){ha(b,c,d,x,t||m,e)}var b,c,d=this.effect,m=this,t;if(s){this.initialized||this.initialize();this.shaderDirty&&this.buildShader();if(this.dirty&&this.ready){for(b in this.sources)!this.sources.hasOwnProperty(b)||
d.requires&&!d.requires.call(this,b,this.inputs)||(t="function"===typeof this.inPlace?this.inPlace(b):this.inPlace,this.sources[b].render(!t));this.frameBuffer&&(c=this.frameBuffer.frameBuffer);"function"===typeof d.draw?(d.draw.call(this,this.shader,this.model,this.uniforms,c,a),this.emit("render")):c&&(ha(this.shader,this.model,this.uniforms,c,this),this.emit("render"));this.dirty=!1}return this.texture}};Q.prototype.setInput=function(a,b){var c,d,m;if(this.effect.inputs.hasOwnProperty(a)){c=this.effect.inputs[a];
if("image"===c.type){if(b){if(b=w(b),b!==this.sources[a]){a:if(d=this.sources[a]){for(m in this.sources)if(m!==a&&this.sources.hasOwnProperty(m)&&this.sources[m]===d)break a;d.removeTarget(this)}if(B(b,this))throw Error("Attempt to make cyclical connection.");this.sources[a]=b;b.addTarget(this)}}else delete this.sources[a],b=!1;d=this.sources[a];m=Object.keys(this.sources);!0===this.inPlace&&1===m.length?(m=this.sources[m[0]],this.uniforms.transform=m&&m.cumulativeMatrix||E):this.uniforms.transform=
E}else d=N[this.hook]&&void 0!==N[this.hook][a]?N[this.hook][a]:c.defaultValue,d=b=c.validate.call(this,b,c,d,this.inputs[a]);if(this.inputs[a]===b&&"color"!==c.type&&"vector"!==c.type)return b;this.inputs[a]=b;c.uniform&&(this.uniforms[c.uniform]=d);"image"===c.type?(this.resize(),this.updateReady()):c.updateSources&&this.updateReady();c.shaderDirty&&(this.shaderDirty=!0);this.setDirty();c.update&&c.update.call(this,b);return b}};Q.prototype.alias=function(a,b){var c=this;if(0<=za.indexOf(b))throw Error("'"+
b+"' is a reserved name and cannot be used as an alias.");this.effect.inputs.hasOwnProperty(a)&&(b||(b=a),C.removeAlias(b),ga[b]={node:this,input:a},Object.defineProperty(C,b,{configurable:!0,enumerable:!0,get:function(){return c.inputs[a]},set:function(b){return c.setInput(a,b)}}));return this};Q.prototype.matte=function(a){function b(a){var c,d,m,x,f,e=[],l;if(!a.simple){for(c=0;c<a.edges.length;c++)for(m=a.edges[c],d=c+1;d<a.edges.length;d++){x=a.edges[d];a:{f=m[0];l=m[1];var K=x[0],k=x[1],h=void 0,
q=void 0,p=void 0,q=h=void 0,h=(k.x-K.x)*(f.y-K.y)-(k.y-K.y)*(f.x-K.x),q=(l.x-f.x)*(f.y-K.y)-(l.y-f.y)*(f.x-K.x);if(p=(k.y-K.y)*(l.x-f.x)-(k.x-K.x)*(l.y-f.y))if(h/=p,q/=p,0<h&&1>=h&&0<q&&1>=q){f={x:f.x+h*(l.x-f.x),y:f.y+h*(l.y-f.y)};break a}f=!1}f&&(f.edge1=m,f.edge2=x,e.push(f))}if(e.length){d=[];for(c=0;c<e.length;c++)f=e[c],m=f.edge1,x=f.edge2,l={x:f.x,y:f.y,prev:m[0],next:x[1],id:g.length},a.vertices.push(l),g.push(l),m={x:f.x,y:f.y,prev:x[0],next:m[1],id:g.length},a.vertices.push(m),g.push(l),
l.prev.next=l,l.next.prev=l,m.prev.next=m,m.next.prev=m;do{e={edges:[],vertices:[],simple:!0};d.push(e);m=x=a.vertices[0];do c=a.vertices.indexOf(x),a.vertices.splice(c,1),e.edges.push([x,x.next]),e.vertices.push(x),x=x.next;while(x!==m)}while(a.vertices.length);c=t.indexOf(a);t.splice(c,1);for(c=0;c<d.length;c++)t.push(d[c])}else a.simple=!0}}function c(a){var b,d,m=a.vertices.length,x,t=0;b=m-1;for(d=0;d<m;b=d,d++)b=a.vertices[b],x=a.vertices[d],t+=b.x*x.y-x.x*b.y;return 0<t}function d(a){var b,
c=a.vertices,m,x=[],t=[],l,e,g,K;m=c.length;if(a.clockWise)for(b=0;b<m;b++)x[b]=b;else for(b=0;b<m;b++)x[b]=m-1-b;l=2*m;e=0;for(b=m-1;2<m;){if(0>=l--)return t;g=b;m<=g&&(g=0);b=g+1;m<=b&&(b=0);K=b+1;m<K&&(K=0);var h;a:{var k=h=void 0,q=void 0,p=void 0,n=void 0,k=c[x[g]],q=c[x[b]],p=c[x[K]];if(0>(q.x-k.x)*(p.y-k.y)-(q.y-k.y)*(p.x-k.x))h=!1;else{for(h=0;h<m;h++)if(h!==g&&h!==b&&h!==K){var n=c[x[h]],L=void 0,v=void 0,r=void 0,wa=void 0,s=void 0,z=void 0,u=void 0,G=void 0,y=void 0,va=void 0,ia=void 0,
ha=void 0,L=r=s=void 0,L=p.x-q.x,v=p.y-q.y,r=k.x-p.x,wa=k.y-p.y,s=q.x-k.x,z=q.y-k.y,u=n.x-k.x,G=n.y-k.y,y=n.x-q.x,va=n.y-q.y,ia=n.x-p.x,ha=n.y-p.y,L=L*va-v*y,s=s*G-z*u,r=r*ha-wa*ia;if(0<=L&&0<=r&&0<=s){h=!1;break a}}h=!0}}if(h){l=x[g];g=x[b];K=x[K];a.clockWise?(t.push(c[l]),t.push(c[g]),t.push(c[K])):(t.push(c[K]),t.push(c[g]),t.push(c[l]));e++;K=b;for(l=b+1;l<m;K++,l++)x[K]=x[l];m--;l=2*m}}f.indices=t}var m,t=[],f,g=[],l,k,h,q,n,p={};m=function(a){return a&&a.length&&Array.isArray(a)?!Array.isArray(a[0])||
Array.isArray(a[0])&&!isNaN(a[0][0])?[a]:a:[]}(a);for(l=0;l<m.length;l++){a=m[l];n=null;f={vertices:[],edges:[]};for(k=0;k<a.length;k++)h=a[k],"object"!==typeof h||isNaN(h.x)||isNaN(h.y)?2<=h.length&&!isNaN(h[0])&&!isNaN(h[1])&&(q={x:h[0],y:h[1],id:g.length}):q={x:h.x,y:h.y,id:g.length},q&&(n?(n.next=q,q.prev=n,q.next=f.vertices[0],f.vertices[0].prev=q):(f.head=q,q.next=q,q.prev=q),g.push(q),f.vertices.push(q),n=q);if(2<f.vertices.length)for(3===f.vertices.length&&(f.simple=!0),t.push(f),k=0;k<f.vertices.length;k++)q=
f.vertices[k],f.edges.push([q,q.next])}for(l=t.length-1;0<=l;l--)f=t[l],b(f);for(l=0;l<t.length;l++)f=t[l],f.clockWise=c(f),d(f);p.vertices=[];p.coords=[];for(l=0;l<g.length;l++)h=g[l],p.vertices.push(2*h.x-1),p.vertices.push(-2*h.y+1),p.vertices.push(-1),p.coords.push(h.x),p.coords.push(-1*h.y+1);p.vertices=new Float32Array(p.vertices);p.coords=new Float32Array(p.coords);p.indices=[];for(l=0;l<t.length;l++)for(f=t[l],k=0;k<f.indices.length;k++)h=f.indices[k],p.indices.push(h.id);p.indices=new Uint16Array(p.indices);
this.shape=p;this.gl&&e(p,this.gl)};Q.prototype.destroy=function(){var a,b,c=this.hook;this.effect.destroy&&"function"===typeof this.effect.destroy&&this.effect.destroy.call(this);delete this.effect;ja[c]&&(ja[c].count--,ja[c].count||delete ja[c]);this.shader&&this.shader.destroy&&this.shader!==X&&!ja[c]&&this.shader.destroy();delete this.shader;for(a in this.inputElements)this.inputElements.hasOwnProperty(a)&&(b=this.inputElements[a],b.element.removeEventListener("change",b.listener,!0),b.element.removeEventListener("input",
b.listener,!0));for(a in this.sources)this.sources.hasOwnProperty(a)&&((b=this.sources[a])&&b.removeTarget&&b.removeTarget(this),delete this.sources[a]);for(;this.targets.length;)(b=this.targets.pop())&&b.removeSource&&b.removeSource(this);for(a in this)this.hasOwnProperty(a)&&"id"!==a&&delete this[a];for(a in ga)ga.hasOwnProperty(a)&&(b=ga[a],b.node===this&&C.removeAlias(a));a=la.indexOf(this);0<=a&&la.splice(a,1);a=D[c].indexOf(this);0<=a&&D[c].splice(a,1);I.prototype.destroy.call(this)};qa=function(a){Object.defineProperties(this,
{original:{enumerable:!0,configurable:!0,get:function(){return a.source}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}},width:{enumerable:!0,configurable:!0,get:function(){return a.width}},height:{enumerable:!0,configurable:!0,get:function(){return a.height}}});this.render=function(){a.render()};this.update=function(){a.setDirty()};this.readPixels=function(b,c,d,m,t){return a.readPixels(b,c,d,m,t)};this.on=function(b,c){a.on(b,c)};this.off=function(b,c){a.off(b,c)};this.destroy=function(){var b,
c;a.destroy();for(b in this)this.hasOwnProperty(b)&&"isDestroyed"!==b&&"id"!==b&&(c=Object.getOwnPropertyDescriptor(this,b),c.get||c.set||"function"!==typeof this[b]?delete this[b]:this[b]=P)};this.isDestroyed=function(){return a.isDestroyed};this.isReady=function(){return a.ready}};aa=function(b,d,m){function t(a,b,d,m){var x=A[a];if(x.definition)if(x=x.definition.call(q,b,d,m))x=c(c({},A[a]),x);else return null;return x}function f(a){return q.source===a}var l=m||{},e=void 0===l.flip?!0:l.flip,g=
l.width,h=l.height,k=!1,q=this,p=!1,n,L;I.call(this);if(b&&"string"!==typeof b||!d&&0!==d)m&&"object"===typeof m||(m=d),d=b;"string"===typeof d&&isNaN(d)&&(d=a(d,["canvas","img","video"]));"string"===typeof b&&A[b]&&(L=t(b,d,m,!0))&&(this.hook=b,p=!0,k=L.deferTexture,this.plugin=L,this.compare=L.compare,this.checkDirty=L.checkDirty,L.source&&(d=L.source));if(!L&&d instanceof HTMLElement)"CANVAS"===d.tagName?(this.width=d.width,this.height=d.height,this.render=this.renderImageCanvas,p=!0,this.hook=
"canvas",this.compare=f):"IMG"===d.tagName&&(this.width=d.naturalWidth||1,this.height=d.naturalHeight||1,d.complete&&d.naturalWidth||(k=!0),d.addEventListener("load",function(){if(!q.isDestroyed){if(q.width!==d.naturalWidth||q.height!==d.naturalHeight)q.width=d.naturalWidth,q.height=d.naturalHeight,q.resize();q.setDirty();q.setReady()}},!0),this.render=this.renderImageCanvas,p=!0,this.hook="image",this.compare=f);else if(!L&&d instanceof WebGLTexture){if(s&&!s.isTexture(d))throw Error("Not a valid WebGL texture.");
isNaN(g)?isNaN(h)||(g=h):isNaN(h)&&(h=g);this.width=g;this.height=h;void 0===l.flip&&(e=!1);p=!0;this.texture=d;this.initialized=!0;this.hook="texture";this.compare=f;this.render=function(){}}if(!p&&!L)for(n in A)if(A.hasOwnProperty(n)&&A[n]&&(L=t(n,d,m,!1))){this.hook=n;p=!0;k=L.deferTexture;this.plugin=L;this.compare=L.compare;this.checkDirty=L.checkDirty;L.source&&(d=L.source);break}if(!p)throw Error("Unknown source type");this.source=d;void 0===this.flip&&(this.flip=e);this.targets=[];k||q.setReady();
this.pub=new qa(this);fa.push(this);oa[this.id]=this;Z.push(this);T[this.hook].push(this);Z.length&&!$&&y()};aa.prototype=Object.create(I.prototype);aa.prototype.initialize=function(){var a;s&&!this.texture&&this.ready&&(a=s.createTexture(),s.bindTexture(s.TEXTURE_2D,a),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),
s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_2D,null),this.texture=a,this.allowRefresh=this.initialized=!0,this.setDirty())};aa.prototype.initFrameBuffer=function(a){s&&(this.frameBuffer=new l(s,this.width,this.height,{texture:this.texture,useFloat:a}))};aa.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};aa.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);
0<=a&&this.targets.splice(a,1)};aa.prototype.resize=function(){var a,b;this.uniforms.resolution[0]=this.width;this.uniforms.resolution[1]=this.height;this.framebuffer&&this.framebuffer.resize(this.width,this.height);this.emit("resize");this.setDirty();if(this.targets)for(a=0;a<this.targets.length;a++)b=this.targets[a],b.resize(),b.setTransformDirty&&b.setTransformDirty()};aa.prototype.setReady=function(){var a;if(!this.ready&&(this.ready=!0,this.resize(),this.initialize(),this.emit("ready"),this.targets))for(a=
0;a<this.targets.length;a++)this.targets[a].setReady()};aa.prototype.render=function(){var a=this.source;s&&(a||0===a)&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.plugin&&this.plugin.render&&(this.dirty||this.checkDirty&&this.checkDirty())&&this.plugin.render.call(this,s,ha,V,X)&&(this.dirty=!1,this.emit("render")))};aa.prototype.renderImageCanvas=function(){var a=this.source;if(s&&a&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.dirty)){s.bindTexture(s.TEXTURE_2D,
this.texture);s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,this.flip);s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,a),this.dirty=!1,this.emit("render"),!0}catch(c){c.code===b.DOMException.SECURITY_ERR&&(this.allowRefresh=!1,f.logger.error("Unable to access cross-domain image"))}return!1}};aa.prototype.destroy=function(){var a,b;this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this);for(s&&this.texture&&s.deleteTexture(this.texture);this.targets.length;)(a=
this.targets.pop())&&a.removeSource&&a.removeSource(this);a=Z.indexOf(this);0<=a&&Z.splice(a,1);a=T[this.hook].indexOf(this);0<=a&&T[this.hook].splice(a,1);for(b in this)this.hasOwnProperty(b)&&"id"!==b&&delete this[b];I.prototype.destroy.call(this)};ua=function(a){Object.defineProperties(this,{source:{enumerable:!0,configurable:!0,get:function(){if(a.source)return a.source.pub},set:function(b){a.setSource(b)}},original:{enumerable:!0,configurable:!0,get:function(){return a.target}},width:{enumerable:!0,
configurable:!0,get:function(){return a.width},set:function(b){!isNaN(b)&&0<b&&a.width!==b&&(a.width=b,a.resize(),a.setTransformDirty())}},height:{enumerable:!0,configurable:!0,get:function(){return a.height},set:function(b){!isNaN(b)&&0<b&&a.height!==b&&(a.height=b,a.resize(),a.setTransformDirty())}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}}});this.render=function(){a.render()};this.readPixels=function(b,c,d,m,t){return a.readPixels(b,c,d,m,t)};this.on=function(b,c){a.on(b,c)};
this.off=function(b,c){a.off(b,c)};this.go=function(b){a.go(b)};this.stop=function(){a.stop()};this.getTexture=function(){return a.frameBuffer.texture};this.destroy=function(){var b,c;a.destroy();for(b in this)this.hasOwnProperty(b)&&"isDestroyed"!==b&&"id"!==b&&(c=Object.getOwnPropertyDescriptor(this,b),c.get||c.set||"function"!==typeof this[b]?delete this[b]:this[b]=P)};this.inputs=function(a){return{source:{type:"image"}}};this.isDestroyed=function(){return a.isDestroyed};this.isReady=function(){return a.ready}};
ba=function(a,b,d){function t(a,b,d,m){var f=H[a];if(f.definition){f=f.definition.call(p,b,d,m);if(!f)return null;f=c(c({},H[a]),f);p.hook=G;L=!0;p.plugin=f;p.compare=f.compare;f.gl&&!p.gl&&(p.gl=f.gl,s||k(f.gl));p.gl===s&&(p.model=V,p.shader=X)}return f}var e,g,h,p=this,L=!1,n,v,z,u,G;I.call(this);if(a&&"string"!==typeof a||!b&&0!==b)d&&"object"===typeof d||(d=b),b=a;d=d||{};e=void 0===d.flip?!0:d.flip;g=parseInt(d.width,10);h=parseInt(d.height,10);v=d.debugContext;"string"===typeof a&&H[a]&&t(a,
b,d,!0);this.renderToTexture=d.renderToTexture;if(b instanceof WebGLFramebuffer)if(z=b,d instanceof HTMLCanvasElement)b=d;else if(d instanceof WebGLRenderingContext)b=d.canvas;else if(d.canvas instanceof HTMLCanvasElement)b=d.canvas;else if(d.context instanceof WebGLRenderingContext)b=d.context.canvas;else throw Error("Must provide a canvas with WebGLFramebuffer target");if(b instanceof HTMLElement&&"CANVAS"===b.tagName){g=b.width;h=b.height;if(!s||s.canvas!==b&&d.allowSecondaryWebGL)n=r(b,{alpha:!0,
premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:v});if(n)s&&s!==n?(this.gl=n,this.frameBuffer={frameBuffer:z||null},this.shader=new q(this.gl,Y,ka),this.model=m.call(this,this.gl),this.pixels=null,this.texture=this.gl.createTexture(),this.gl.bindTexture(s.TEXTURE_2D,this.texture),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),
this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.render=this.renderSecondaryWebGL):(O||(O=this),s||k(n),this.render=this.renderWebGL,d.renderToTexture?s&&(this.frameBuffer=new l(s,g,h,!1)):this.frameBuffer={frameBuffer:z||null});else{if(!d.allowSecondaryWebGL&&s&&s.canvas!==b)throw Error("Only one WebGL target canvas allowed. Set allowSecondaryWebGL option to create secondary context.");this.render=P;f.logger.log("Unable to create WebGL context.")}L=!0}if(!L)for(G in H)if(H.hasOwnProperty(G)&&
H[G]&&t(G,b,d,!1))break;if(!L)throw Error("Unknown target type");J&&((u=J.get(b))?f.logger.warn("Target already in use by another instance",b,Object.keys(u).map(function(a){return u[a]})):(u={},J.set(b,u)),u[C.id]=C);this.target=b;this.transform=null;this.transformDirty=!0;this.flip=e;g&&(this.width=g);h&&(this.height=h);this.uniforms.resolution[0]=this.width;this.uniforms.resolution[1]=this.height;this.auto=void 0!==d.auto?d.auto:xa;this.frames=0;this.pub=new ua(this);fa.push(this);oa[this.id]=this;
W.push(this)};ba.prototype=Object.create(I.prototype);ba.prototype.setSource=function(a){a=w(a);a!==this.source&&(this.source&&this.source.removeTarget(this),this.source=a,a.addTarget(this),a&&(this.resize(),a.ready?this.setReady():this.setUnready()),this.setDirty())};ba.prototype.setDirty=function(){this.dirty=!0;this.auto&&!$&&($=ta(y))};ba.prototype.resize=function(){if(this.target instanceof HTMLCanvasElement){if(this.width!==this.target.width||this.height!==this.target.height)this.target.width=
this.width,this.target.height=this.height,this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,this.emit("resize"),this.setTransformDirty()}else this.plugin&&this.plugin.resize&&this.plugin.resize.call(this);!this.source||this.source.width===this.width&&this.source.height===this.height||this.transform||(this.transform=new Float32Array(16))};ba.prototype.setTransformDirty=function(){this.transformDirty=!0;this.setDirty()};ba.prototype.go=function(){this.auto=!0;this.setDirty()};
ba.prototype.stop=function(){this.auto=!1};ba.prototype.render=function(){s&&this.plugin&&this.plugin.render&&this.plugin.render.call(this,ha,X,V)};ba.prototype.renderWebGL=function(){var a,b,c;this.resize();s&&this.dirty&&this.ready&&this.source&&(this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||E:this.transformDirty&&(a=this.transform,da.copy(a,this.source.cumulativeMatrix||
E),b=this.source.width/this.width,c=this.source.height/this.height,a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=c,this.uniforms.transform=a,this.transformDirty=!1),ha(X,V,this.uniforms,this.frameBuffer.frameBuffer,this,ca),this.emit("render"),this.dirty=!1)};ba.prototype.renderSecondaryWebGL=function(){var a,b,c;this.dirty&&this.ready&&this.source&&(this.emit("render"),this.source.render(!0),a=this.source.width,b=this.source.height,this.pixels&&this.pixels.length===a*b*4||(this.pixels=
new Uint8Array(a*b*4)),this.source.readPixels(0,0,a,b,this.pixels),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,a,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pixels),a===this.width&&b===this.height?this.uniforms.transform=E:this.transformDirty&&(a=this.transform,da.copy(a,E),b=this.source.width/this.width,c=this.source.height/this.height,a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=c,this.uniforms.transform=a,this.transformDirty=!1),this.uniforms.source=this.texture,ha(this.shader,
this.model,this.uniforms,null,this,ca),this.dirty=!1)};ba.prototype.removeSource=function(a){if(this.source===a||this.source===a.pub)this.source=null};ba.prototype.destroy=function(){var a;this.source&&this.source.removeTarget&&this.source.removeTarget(this);J&&(a=J.get(this.target),delete a[C.id],Object.keys(a).length||J.delete(this.target));this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this);delete this.source;delete this.target;delete this.pub;delete this.uniforms;delete this.pixels;
delete this.auto;a=W.indexOf(this);0<=a&&W.splice(a,1);I.prototype.destroy.call(this);this===O&&(S.removeEventListener("webglcontextrestored",p,!1),u(),O=null)};ra=function(b){function d(b,c,m){var t;t=f.inputElements[b];"string"===typeof m&&isNaN(m)&&("enum"===c.type?c.options.hasOwnProperty(m)||(m=a(m,["select"])):"number"===c.type||"boolean"===c.type?m=a(m,["input","select"]):"image"===c.type&&(m=a(m,["canvas","img","video"])));m instanceof HTMLInputElement||m instanceof HTMLSelectElement?(c=m.value,
t&&t.element!==m&&(t.element.removeEventListener("change",t.listener,!0),t.element.removeEventListener("input",t.listener,!0),delete f.inputElements[b],t=null),t||(t={element:m,listener:function(a){return function(){var c,d;c="checkbox"===m.type?m.checked:a.value;d=f.setInput(b,c);"color"===m.type&&(d=h(d));d!==c&&(a.value=d)}}(m)},f.inputElements[b]=t,"range"===m.type&&m.addEventListener("input",t.listener,!0),m.addEventListener("change",t.listener,!0)),t&&"checkbox"===m.type&&(c=m.checked)):(t&&
(t.element.removeEventListener("change",t.listener,!0),t.element.removeEventListener("input",t.listener,!0),delete f.inputElements[b]),c=m);f.setInput(b,c)}function m(a,b){Object.defineProperty(l,a,{configurable:!0,enumerable:!0,get:function(){return b.get.call(f)},set:function(c){d(a,b,c)}})}function t(a){return function(){a.apply(f,arguments)&&f.setTransformDirty()}}var f=b,l=this,e;Object.defineProperties(this,{transform:{enumerable:!0,configurable:!0,get:function(){return f.hook}},title:{enumerable:!0,
configurable:!0,get:function(){return f.plugin.title||f.hook}},width:{enumerable:!0,configurable:!0,get:function(){return f.width}},height:{enumerable:!0,configurable:!0,get:function(){return f.height}},id:{enumerable:!0,configurable:!0,get:function(){return f.id}},source:{enumerable:!0,configurable:!0,get:function(){return f.source&&f.source.pub},set:function(a){f.setSource(a)}}});for(e in f.methods)f.methods.hasOwnProperty(e)&&(this[e]=t(f.methods[e].bind(f)));for(e in f.inputs)f.inputs.hasOwnProperty(e)&&
m(e,f.inputs[e]);this.update=function(){f.setDirty()};this.inputs=function(a){var b,d;b=f.plugin.inputs;if(a){b=b[a];if(!b||b.method)return null;a={type:b.type,defaultValue:b.defaultValue,title:b.title||a};"number"===b.type?(a.min=b.min,a.max=b.max,a.step=b.step):"enum"===b.type?a.options=c({},b.options):"vector"===b.type&&(a.dimensions=b.dimensions);b.description&&(a.description=b.description);return a}a={};for(d in b)b.hasOwnProperty(d)&&!b[d].method&&(a[d]=this.inputs(d));return a};this.alias=
function(a,b){f.alias(a,b);return this};this.on=function(a,b){f.on(a,b)};this.off=function(a,b){f.off(a,b)};this.destroy=function(){var a,b;f.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=P)};this.isDestroyed=function(){return f.isDestroyed};this.isReady=function(){return f.ready}};R=function(a,b){var d,m,f,t,l;this.matrix=new Float32Array(16);this.cumulativeMatrix=
new Float32Array(16);this.ready=!1;this.height=this.width=1;this.seriously=C;this.transformRef=ea[a];this.hook=a;this.id=ia;ia++;this.options=b;this.sources=null;this.targets=[];this.inputElements={};this.inputs={};this.methods={};this.listeners={};this.uniforms=this.frameBuffer=this.texture=null;this.transformDirty=this.dirty=!0;this.transformed=this.isDestroyed=this.renderDirty=!1;this.plugin=c({},this.transformRef);this.transformRef.definition&&c(this.plugin,this.transformRef.definition.call(this,
b));for(d in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(d)&&(m=this.plugin.inputs[d],m.method&&"function"===typeof m.method?this.methods[d]=m.method:"function"===typeof m.set&&"function"===typeof m.get&&(this.inputs[d]=m));g(this.plugin);l=N[a];for(d in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(d)&&(m=this.plugin.inputs[d],"function"===typeof m.set&&"function"===typeof m.get&&"function"!==typeof m.method&&(f=m.get.call(this),t=void 0===m.defaultValue?f:m.defaultValue,t=m.validate.call(this,
t,m,f),l&&void 0!==l[d]&&(t=m.validate.call(this,l[d],m,m.defaultValue,t),l[d]=t),t!==f&&m.set.call(this,t)));fa.push(this);oa[this.id]=this;this.pub=new ra(this);F.push(this);z[a].push(this)};R.prototype=Object.create(I.prototype);R.prototype.setDirty=function(){this.renderDirty=!0;I.prototype.setDirty.call(this)};R.prototype.setTransformDirty=function(){var a,b;this.renderDirty=this.dirty=this.transformDirty=!0;for(a=0;a<this.targets.length;a++)b=this.targets[a],b.setTransformDirty?b.setTransformDirty():
b.setDirty()};R.prototype.resize=function(){var a;I.prototype.resize.call(this);this.plugin.resize&&this.plugin.resize.call(this);for(a=0;a<this.targets.length;a++)this.targets[a].resize();this.setTransformDirty()};R.prototype.setSource=function(a){a=w(a);if(a!==this.source){if(B(a,this))throw Error("Attempt to make cyclical connection.");this.source&&this.source.removeTarget(this);this.source=a;a.addTarget(this);a&&a.ready?this.setReady():this.setUnready();this.resize()}};R.prototype.addTarget=function(a){var b;
for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};R.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1);this.targets&&this.targets.length&&this.resize()};R.prototype.setInput=function(a,b){var c,d,m;if(this.plugin.inputs.hasOwnProperty(a))return c=this.plugin.inputs[a],d=N[this.hook]&&void 0!==N[this.hook][a]?N[this.hook][a]:c.defaultValue,m=c.get.call(this),void 0===d&&(d=m),b=c.validate.call(this,b,c,d,m),
c.set.call(this,b)&&this.setTransformDirty(),c.get.call(this)};R.prototype.alias=function(a,b){var c=this,d,m;if(0<=za.indexOf(b))throw Error("'"+b+"' is a reserved name and cannot be used as an alias.");if(this.plugin.inputs.hasOwnProperty(a)){b||(b=a);C.removeAlias(b);if(d=this.inputs[a])m=c.inputs[a],Object.defineProperty(C,b,{configurable:!0,enumerable:!0,get:function(){return m.get.call(c)},set:function(a){m.set.call(c,a)&&c.setTransformDirty()}});else if(d=this.methods[a])m=d,C[b]=function(){m.apply(c,
arguments)&&c.setTransformDirty()};d&&(ga[b]={node:this,input:a})}return this};R.prototype.render=function(a){if(this.source)return this.source.render(),this.transformDirty&&(this.transformed?this.source.cumulativeMatrix?da.multiply(this.cumulativeMatrix,this.matrix,this.source.cumulativeMatrix):da.copy(this.cumulativeMatrix,this.matrix):da.copy(this.cumulativeMatrix,this.source.cumulativeMatrix||E),this.transformDirty=!1),a&&s?(this.renderDirty&&(this.frameBuffer||(this.uniforms={resolution:[this.width,
this.height]},this.frameBuffer=new l(s,this.width,this.height)),this.uniforms.source=this.source.texture,this.uniforms.transform=this.cumulativeMatrix||E,ha(X,V,this.uniforms,this.frameBuffer.frameBuffer,this),this.renderDirty=!1),this.texture=this.frameBuffer.texture):this.texture=this.source?this.source.texture:null,this.dirty=!1,this.texture;this.transformDirty&&(da.copy(this.cumulativeMatrix,this.matrix),this.transformDirty=!1);this.texture=null;this.dirty=!1};R.prototype.readPixels=function(a,
b,c,d,m){var t=this.gl||s;if(!s)throw Error("Cannot read pixels until a canvas is connected");this.render(!0);if(void 0===m)m=new Uint8Array(c*d*4);else if(!m instanceof Uint8Array)throw Error("Incompatible array type");t.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer.frameBuffer);t.readPixels(a,b,c,d,s.RGBA,s.UNSIGNED_BYTE,m);return m};R.prototype.destroy=function(){var a,b,c,d=this.hook;this.plugin.destroy&&"function"===typeof this.plugin.destroy&&this.plugin.destroy.call(this);delete this.effect;
this.frameBuffer&&(this.frameBuffer.destroy(),delete this.frameBuffer,delete this.texture);for(a in this.inputElements)this.inputElements.hasOwnProperty(a)&&(c=this.inputElements[a],c.element.removeEventListener("change",c.listener,!0),c.element.removeEventListener("input",c.listener,!0));for(this.source&&this.source.removeTarget(this);this.targets.length;)(c=this.targets.pop())&&c.removeSource&&c.removeSource(this);for(b in this)this.hasOwnProperty(b)&&"id"!==b&&delete this[b];for(b in ga)ga.hasOwnProperty(b)&&
(c=ga[b],c.node===this&&C.removeAlias(b));a=F.indexOf(this);0<=a&&F.splice(a,1);a=z[d].indexOf(this);0<=a&&z[d].splice(a,1);I.prototype.destroy.call(this)};R.prototype.setReady=I.prototype.setReady;R.prototype.setUnready=I.prototype.setUnready;R.prototype.on=I.prototype.on;R.prototype.off=I.prototype.off;R.prototype.emit=I.prototype.emit;d=d instanceof HTMLCanvasElement?{canvas:d}:d||{};this.effect=function(a,b){if(!G[a])throw Error("Unknown effect: "+a);return(new Q(a,b)).pub};this.source=function(a,
b,c){return w(a,b,c).pub};this.transform=function(a,b){"string"!==typeof a&&(b=a,a=!1);if(a){if(!ea[a])throw Error("Unknown transform: "+a);}else if(a=d&&d.defaultTransform||"2d",!ea[a])throw Error("No transform specified");return(new R(a,b)).pub};this.target=function(a,b,c){var d,m;a&&"string"===typeof a&&!H[a]&&(d=v.querySelector(a));if("string"!==typeof a||!b&&0!==b||d)c&&"object"===typeof c||(c=b),b=d||a,a=null;"string"===typeof b&&isNaN(b)&&(b=v.querySelector(b));for(m=0;m<W.length;m++)if(d=
W[m],(!a||a===d.hook)&&(d.target===b||d.compare&&d.compare(b,c)))return d.pub;d=new ba(a,b,c);return d.pub};this.aliases=function(){return Object.keys(ga)};this.removeAlias=function(a){ga[a]&&(delete this[a],delete ga[a])};this.defaults=function(a,b){var d;if(a)if("object"===typeof a)for(d in a)a.hasOwnProperty(d)&&this.defaults(d,a[d]);else null===b?delete N[a]:"object"===typeof b&&(N[a]=c({},b));else if(null===a)for(d in N)N.hasOwnProperty(d)&&delete N[d]};this.go=function(a,b){var c;"function"===
typeof a&&0>ma.indexOf(a)&&ma.push(a);"function"===typeof b&&0>na.indexOf(b)&&na.push(b);xa=!0;for(c=0;c<W.length;c++)W[c].go();$||!ma.length&&!na.length||y()};this.stop=function(){ma.length=0;na.length=0;sa($);$=0};this.render=function(){var a;for(a=0;a<W.length;a++)W[a].render(d)};this.destroy=function(){for(var a,b;fa.length;)b=fa.shift(),b.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?
delete this[a]:this[a]=P);C=null;Z=[];W=[];la=[];fa=[];ma.length=0;na.length=0;sa($);$=0;ya=!0};this.isDestroyed=function(){return ya};this.incompatible=function(a){var b,c=!1;if(c=f.incompatible(a))return c;if(!a){for(b in D)if(D.hasOwnProperty(b)&&D[b].length&&(a=G[b])&&"function"===typeof a.compatible&&!a.compatible.call(this))return"plugin-"+b;for(b in T)if(T.hasOwnProperty(b)&&T[b].length&&(a=A[b])&&"function"===typeof a.compatible&&!a.compatible.call(this))return"source-"+b}return!1};this.isNode=
function(a){return a&&(a=oa[a.id])&&!a.isDestroyed?!0:!1};this.isSource=function(a){return this.isNode(a)&&a instanceof qa};this.isEffect=function(a){return this.isNode(a)&&a instanceof pa};this.isTransform=function(a){return this.isNode(a)&&a instanceof ra};this.isTarget=function(a){return this.isNode(a)&&a instanceof ua};Object.defineProperties(this,{id:{enumerable:!0,configurable:!0,get:function(){return M}}});this.defaults(d.defaults)}var v=b.document,y=b.console,w,B,M,G={},ea={},A={},H={},u=
[],D={},z={},T={canvas:[],image:[],video:[]},C={},J=b.WeakMap&&new WeakMap,E,U=0,P=function(){},F,S={transparent:[0,0,0,0],black:[0,0,0,1],red:[1,0,0,1],green:[0,128/255,0,1],blue:[0,0,1,1],white:[1,1,1,1],silver:[192/255,192/255,192/255,1],gray:[128/255,128/255,128/255,1],maroon:[128/255,0,0,1],purple:[128/255,0,128/255,1],fuchsia:[1,0,1,1],lime:[0,1,0,1],olive:[128/255,128/255,0,1],yellow:[1,1,0,1],navy:[0,0,128/255,1],teal:[0,128/255,128/255,1],aqua:[0,1,1,1],orange:[1,165/255,0,1]},N=["x","y",
"z","w"],O=["r","g","b","a"],ca={srcRGB:770,dstRGB:771,srcAlpha:1,dstAlpha:771},Y,ka,da={frustum:function(a,b,c,d,f,l,e){e||(e=da.create());var g=b-a,h=d-c,k=l-f;e[0]=2*f/g;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*f/h;e[6]=0;e[7]=0;e[8]=(b+a)/g;e[9]=(d+c)/h;e[10]=-(l+f)/k;e[11]=-1;e[12]=0;e[13]=0;e[14]=-(l*f*2)/k;e[15]=0;return e},perspective:function(a,b,c,d,f){a=c*Math.tan(a*Math.PI/360);b*=a;return da.frustum(-b,b,-a,a,c,d,f)},multiply:function(a,b,c){var d=b[0],f=b[1],e=b[2],l=b[3],g=b[4],h=b[5],k=
b[6],q=b[7],p=b[8],n=b[9],v=b[10],r=b[11],z=b[12],u=b[13],G=b[14];b=b[15];var y=c[0],w=c[1],A=c[2],B=c[3];a[0]=y*d+w*g+A*p+B*z;a[1]=y*f+w*h+A*n+B*u;a[2]=y*e+w*k+A*v+B*G;a[3]=y*l+w*q+A*r+B*b;y=c[4];w=c[5];A=c[6];B=c[7];a[4]=y*d+w*g+A*p+B*z;a[5]=y*f+w*h+A*n+B*u;a[6]=y*e+w*k+A*v+B*G;a[7]=y*l+w*q+A*r+B*b;y=c[8];w=c[9];A=c[10];B=c[11];a[8]=y*d+w*g+A*p+B*z;a[9]=y*f+w*h+A*n+B*u;a[10]=y*e+w*k+A*v+B*G;a[11]=y*l+w*q+A*r+B*b;y=c[12];w=c[13];A=c[14];B=c[15];a[12]=y*d+w*g+A*p+B*z;a[13]=y*f+w*h+A*n+B*u;a[14]=y*
e+w*k+A*v+B*G;a[15]=y*l+w*q+A*r+B*b;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}},ta=function(){var a=0;return b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||
b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(c){var d,f,e;d=(new Date).getTime();f=Math.max(0,16-(d-a));e=b.setTimeout(function(){c(d+f)},f);a=d+f;return e}}(),sa=function(){return b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.mozCancelAnimationFrame||b.oCancelAnimationFrame||b.msCancelAnimationFrame||function(a){b.cancelTimeout(a)}}(),Aa="alias destroy effect id initialize inputs isDestroyed isReady matte off on readPixels render title update".split(" "),Ba="alias destroy id inputs isDestroyed isReady off on source title update".split(" "),
za=["aliases","defaults","destroy","effect","go","id","incompatible","isDestroyed","isEffect",,"isNode","isSource","isTarget","isTransform","removeAlias","render","source","stop","target","transform"];b.addEventListener("message",function(a){a.source===b&&"seriously-timeout-message"===a.data&&(a.stopPropagation(),0<u.length&&u.shift()())},!0);l.prototype.resize=function(a,b){var c=this.gl;if(this.width!==a||this.height!==b)this.width=a,this.height=b,c&&(c.bindTexture(c.TEXTURE_2D,this.texture),c.bindFramebuffer(c.FRAMEBUFFER,
this.frameBuffer),c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this.texture,0),c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null))};l.prototype.destroy=function(){var a=this.gl;a&&(a.deleteFramebuffer(this.frameBuffer),a.deleteRenderbuffer(this.renderBuffer),
this.ownTexture&&a.deleteTexture(this.texture));delete this.frameBuffer;delete this.renderBuffer;delete this.texture;delete this.gl};q.prototype.use=function(){this.gl.useProgram(this.program)};f.incompatible=function(a){var c,d;void 0===M&&((c=v.createElement("canvas"))&&c.getContext?b.WebGLRenderingContext?(d=p())||(M="context"):M="webgl":M="canvas");if(M)return M;if(a){if((c=G[a])&&"function"===typeof c.compatible&&!c.compatible(d))return"plugin-"+a;if((c=A[a])&&"function"===typeof c.compatible&&
!c.compatible(d))return"source-"+a}return!1};f.plugin=function(a,b,d){if(G[a])f.logger.warn("Effect ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d)return d=c({},d),"function"===typeof b&&(d.definition=b),d.reserved=Aa,d.inputs&&g(d),d.title||(d.title=a),G[a]=d,D[a]=[],d};f.removePlugin=function(a){var b,c;if(!a||!G[a])return this;if(b=D[a]){for(;b.length;)c=b.shift(),c.destroy();delete D[a]}delete G[a];return this};f.source=function(a,b,d){if(A[a])f.logger.warn("Source ["+
a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.title||(d.title=a),A[a]=d,T[a]=[],d};f.removeSource=function(a){var b,c;if(!a||!A[a])return this;if(b=T[a]){for(;b.length;)c=b.shift(),c.destroy();delete T[a]}delete A[a];return this};f.transform=function(a,b,d){if(ea[a])f.logger.warn("Transform ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=
b),d.reserved=Ba,d.inputs&&g(d),d.title||(d.title=a),ea[a]=d,z[a]=[],d};f.removeTransform=function(a){var b,c;if(!a||!ea[a])return this;if(b=z[a]){for(;b.length;)c=b.shift(),c.destroy();delete z[a]}delete ea[a];return this};f.target=function(a,b,d){if(H[a])f.logger.warn("Target ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.title||(d.title=a),H[a]=d,C[a]=[],d};f.removeTarget=function(a){var b,c;if(!a||!H[a])return this;
if(b=C[a]){for(;b.length;)c=b.shift(),c.destroy();delete C[a]}delete H[a];return this};f.inputValidators={color:function(a,c,d,l){var g;d=l||[];if("string"===typeof a){if((g=/^(rgb|hsl)a?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*(\d+(\.\d*)?)\s*)?\)/i.exec(a))&&g.length){if(3>g.length)return d[0]=d[1]=d[2]=d[3]=0,d;d[3]=1;for(c=0;3>c;c++)d[c]=parseFloat(g[c+2])/255;isNaN(g[6])||(d[3]=parseFloat(g[6]));return"hsl"===g[1].toLowerCase()?e(d[0],d[1],d[2],d[3],d):d}if((g=/^#(([0-9a-fA-F]{3,8}))/.exec(a))&&
g.length)return g=g[1],3===g.length?(d[0]=parseInt(g[0],16)/15,d[1]=parseInt(g[1],16)/15,d[2]=parseInt(g[2],16)/15,d[3]=1):4===g.length?(d[0]=parseInt(g[0],16)/15,d[1]=parseInt(g[1],16)/15,d[2]=parseInt(g[2],16)/15,d[3]=parseInt(g[3],16)/15):6===g.length?(d[0]=parseInt(g.substr(0,2),16)/255,d[1]=parseInt(g.substr(2,2),16)/255,d[2]=parseInt(g.substr(4,2),16)/255,d[3]=1):8===g.length?(d[0]=parseInt(g.substr(0,2),16)/255,d[1]=parseInt(g.substr(2,2),16)/255,d[2]=parseInt(g.substr(4,2),16)/255,d[3]=parseInt(g.substr(6,
2),16)/255):d[0]=d[1]=d[2]=d[3]=0,d;if(g=S[a.toLowerCase()]){for(c=0;4>c;c++)d[c]=g[c];return d}B||(B=v.createElement("a"));B.style.backgroundColor="";B.style.backgroundColor=a;g=b.getComputedStyle(B);if((g=g.getPropertyValue("background-color")||g.getPropertyValue("backgroundColor")||B.style.backgroundColor)&&g!==a)return f.inputValidators.color(g,c,l);d[0]=d[1]=d[2]=d[3]=0;return d}if(k(a)){d=a;if(3>d.length)return d[0]=d[1]=d[2]=d[3]=0,d;for(c=0;3>c;c++)if(isNaN(d[c]))return d[0]=d[1]=d[2]=d[3]=
0,d;4>d.length&&d.push(1);return d}if("number"===typeof a)return d[0]=d[1]=d[2]=a,d[3]=1,d;if("object"===typeof a){for(c=0;4>c;c++)g=O[c],null===a[g]||isNaN(a[g])?d[c]=3===c?1:0:d[c]=a[g];return d}d[0]=d[1]=d[2]=d[3]=0;return d},number:function(a,b,c){if(isNaN(a))return c||0;a=parseFloat(a);return a<b.min?b.min:a>b.max?b.max:b.step?Math.round(a/b.step)*b.step:a},"enum":function(a,b,c){b=b.options||[];"string"===typeof a?a=a.toLowerCase():"number"===typeof a?a=a.toString():a||(a="");return b.hasOwnProperty(a)?
a:c||""},vector:function(a,b,c,d){var f;b=b.dimensions||4;d=d||[];if(k(a)){for(c=0;c<b;c++)d[c]=a[c]||0;return d}if("object"===typeof a){for(c=0;c<b;c++)f=N[c],void 0===a[f]&&(f=O[c]),d[c]=a[f]||0;return d}a=parseFloat(a)||0;for(c=0;c<b;c++)d[c]=a;return d},"boolean":function(a){return!a||a&&a.toLowerCase&&"false"===a.toLowerCase()?!1:!0},string:function(a){return"string"===typeof a?a:0===a||a?a.toString?a.toString():String(a):""}};f.prototype.effects=f.effects=function(){var a,b,c,d={},f,g;for(a in G)if(G.hasOwnProperty(a)){b=
G[a];c={title:b.title||a,description:b.description||"",inputs:{}};for(g in b.inputs)b.inputs.hasOwnProperty(g)&&(f=b.inputs[g],c.inputs[g]={type:f.type,defaultValue:f.defaultValue,step:f.step,min:f.min,max:f.max,minCount:f.minCount,maxCount:f.maxCount,dimensions:f.dimensions,title:f.title||g,description:f.description||"",options:f.options||[]});d[a]=c}return d};b.Float32Array&&(E=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]));b.Seriously&&"object"===typeof b.Seriously&&function(){for(var a in b.Seriously)b.Seriously.hasOwnProperty(a)&&
"plugin"!==a&&"object"===typeof b.Seriously[a]&&f.plugin(a,b.Seriously[a])}();f.logger={log:d("log"),info:d("info"),warn:d("warn"),error:d("error")};f.util={mat4:da,checkSource:function(c){var d,g;c=a(c,["img","canvas","video"]);if(!c)return!1;d=v.createElement("canvas");if(!d)return f.logger.warn("Browser does not support canvas or Seriously.js"),!1;if(0===c.naturalWidth&&"IMG"===c.tagName)return f.logger.warn("Image not loaded"),!1;if(0===c.readyState&&0===c.videoWidth&&"VIDEO"===c.tagName)return f.logger.warn("Video not loaded"),
!1;if(g=p()){(d=g.createTexture())||f.logger.error("Test WebGL context has been lost");g.bindTexture(g.TEXTURE_2D,d);try{g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,c)}catch(e){return e.code===b.DOMException.SECURITY_ERR?f.logger.log("Unable to access cross-domain image"):f.logger.error("Error storing image to texture: "+e.message),g.deleteTexture(d),!1}g.deleteTexture(d)}else{g=d.getContext("2d");try{g.drawImage(c,0,0),g.getImageData(0,0,1,1)}catch(l){return l.code===b.DOMException.SECURITY_ERR?
f.logger.log("Unable to access cross-domain image"):f.logger.error("Error drawing image to canvas: "+l.message),!1}}return!0},hslToRgb:e,colors:S,setTimeoutZero:n,ShaderProgram:q,FrameBuffer:l,requestAnimationFrame:ta,shader:{makeNoise:"float makeNoise(float u, float v, float timer) {\n\tfloat x = u * v * mod(timer * 1000.0, 100.0);\n\tx = mod(x, 13.0) * mod(x, 127.0);\n\tfloat dx = mod(x, 0.01);\n\treturn clamp(0.1 + dx * 100.0, 0.0, 1.0);\n}\n",random:"#ifndef RANDOM\n#define RANDOM\nfloat random(vec2 n) {\n\treturn 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n#endif\n"}};
f.source("video",function(a,c,d){function g(){a.removeEventListener("loadedmetadata",g,!0);if(!p)if(a.videoWidth){if(h.width!==a.videoWidth||h.height!==a.videoHeight)h.width=a.videoWidth,h.height=a.videoHeight,h.resize();n&&h.setReady()}else n=!0,setTimeout(g,50)}function e(){r=!0}function l(){r=!1;h.setDirty()}var h=this,k,q,p=!1,n=!1,r=!1,z=0;if(a instanceof b.HTMLVideoElement)return a.readyState?g():(n=!0,a.addEventListener("loadedmetadata",g,!0)),a.addEventListener("seeking",e,!1),a.addEventListener("seeked",
l,!1),{deferTexture:n,source:a,render:function ia(c){var d,g;z=a.currentTime;if(!a.videoHeight||!a.videoWidth)return!1;F?(q||(q=v.createElement("canvas").getContext("2d"),k=q.canvas,k.width=h.width,k.height=h.height),d=k,q.drawImage(a,0,0,h.width,h.height)):d=a;c.bindTexture(c.TEXTURE_2D,h.texture);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,h.flip);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,d);if(void 0===F){g=c.getError();if(g===c.INVALID_VALUE)return F=
!0,ia(c);F=!1}return!0}catch(e){e.code===b.DOMException.SECURITY_ERR?(h.allowRefresh=!1,f.logger.error("Unable to access cross-domain image")):f.logger.error("Error rendering video source",e)}return!1},checkDirty:function(){return!r&&a.currentTime!==z},compare:function(a){return h.source===a},destroy:function(){p=!0;a.removeEventListener("seeking",e,!1);a.removeEventListener("seeked",l,!1);a.removeEventListener("loadedmetadata",g,!0)}}},{title:"Video"});f.transform("2d",function(a){function b(){function a(b,
c){v[12]=v[0]*b+v[4]*c+v[12];v[13]=v[1]*b+v[5]*c+v[13];v[14]=v[2]*b+v[6]*c+v[14];v[15]=v[3]*b+v[7]*c+v[15]}var v=c.matrix,r,z,t,u,y,G,w,A,B,s;h||k||q||p||n||1!==e||1!==l?(da.identity(v),a(h+f,k+g),p&&(v[4]=p/c.width),n&&(v[1]=n/c.height),q&&(t=v[0],u=v[1],y=v[2],G=v[3],w=v[4],A=v[5],B=v[6],s=v[7],r=-(d?q*Math.PI/180:q),z=Math.sin(r),r=Math.cos(r),v[0]=t*r+w*z,v[1]=u*r+A*z,v[2]=y*r+B*z,v[3]=G*r+s*z,v[4]=w*r-t*z,v[5]=A*r-u*z,v[6]=B*r-y*z,v[7]=s*r-G*z),1!==e&&(v[0]*=e,v[1]*=e,v[2]*=e,v[3]*=e),1!==l&&
(v[4]*=l,v[5]*=l,v[6]*=l,v[7]*=l),a(-f,-g),c.transformed=!0):c.transformed=!1}var c=this,d=!(a&&a.radians),f=0,g=0,e=1,l=1,h=0,k=0,q=0,p=0,n=0;return{inputs:{reset:{method:function(){g=f=0;l=e=1;n=p=q=k=h=0;return c.transformed?(c.transformed=!1,!0):!1}},translate:{method:function(a,c){isNaN(a)&&(a=h);isNaN(c)&&(c=k);if(a===h&&c===k)return!1;h=a;k=c;b();return!0},type:["number","number"]},translateX:{get:function(){return h},set:function(a){if(a===h)return!1;h=a;b();return!0},type:"number"},translateY:{get:function(){return k},
set:function(a){if(a===k)return!1;k=a;b();return!0},type:"number"},rotation:{get:function(){return q},set:function(a){if(a===q)return!1;q=parseFloat(a);b();return!0},type:"number"},center:{method:function(a,c){isNaN(a)&&(a=f);isNaN(c)&&(c=g);if(a===f&&c===g)return!1;f=a;g=c;b();return!0},type:["number","number"]},centerX:{get:function(){return f},set:function(a){if(a===f)return!1;f=a;b();return!0},type:"number"},centerY:{get:function(){return g},set:function(a){if(a===g)return!1;g=a;b();return!0},
type:"number"},skew:{method:function(a,c){isNaN(a)&&(a=p);isNaN(c)&&(c=n);if(a===p&&c===n)return!1;p=a;n=c;b();return!0},type:["number","number"]},skewX:{get:function(){return p},set:function(a){if(a===p)return!1;p=a;b();return!0},type:"number"},skewY:{get:function(){return n},set:function(a){if(a===n)return!1;n=a;b();return!0},type:"number"},scale:{method:function(a,c){var d,f;d=isNaN(a)?e:a;if(isNaN(c)){if(isNaN(a))return!1;f=d}else f=c;if(d===e&&f===l)return!1;e=d;l=f;b();return!0},type:["number",
"number"]},scaleX:{get:function(){return e},set:function(a){if(a===e)return!1;e=a;b();return!0},type:"number"},scaleY:{get:function(){return l},set:function(a){if(a===l)return!1;l=a;b();return!0},type:"number"}}}},{title:"2D Transform",description:"Translate, Rotate, Scale, Skew"});f.transform("flip",function(){function a(){var d=b.matrix;c?(d[0]=-1,d[5]=1):(d[0]=1,d[5]=-1)}var b=this,c=!0;da.identity(b.matrix);a();b.transformDirty=!0;b.transformed=!0;return{inputs:{direction:{get:function(){return c?
"horizontal":"vertical"},set:function(b){b="vertical"===b?!1:!0;if(b===c)return!1;c=b;a();return!0},type:"string"}}}},{title:"Flip",description:"Flip Horizontal/Vertical"});f.transform("reformat",function(){function a(){var b=d.matrix,c=f||d.width,l=g||d.height,h=d.source,k=h&&h.width||1,h=h&&h.height||1,q,p;"distort"===e||c===k&&l===h?d.transformed=!1:(q=k/h,p=c/l,"none"===e?(c=k/c,l=h/l):"width"===e||"contain"===e&&p<=q?(c=1,l=p/q):"height"===e||"contain"===e&&p>q?(c=q/p,l=1):p>q?(c=1,l=p/q):(c=
q/p,l=1),1===c&&1===l?d.transformed=!1:(da.identity(b),1!==c&&(b[0]*=c,b[1]*=c,b[2]*=c,b[3]*=c),1!==l&&(b[4]*=l,b[5]*=l,b[6]*=l,b[7]*=l),d.transformed=!0))}function b(){return f||d.source&&d.source.width||1}function c(){return g||d.source&&d.source.height||1}var d=this,f,g,e="contain";this.resize=function(){var d=b(),f=c();if(this.width!==d||this.height!==f)for(this.width=d,this.height=f,this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=d,this.uniforms.resolution[1]=f),this.frameBuffer&&
this.frameBuffer.resize&&this.frameBuffer.resize(d,f),d=0;d<this.targets.length;d++)this.targets[d].resize();this.setTransformDirty();a()};return{inputs:{width:{get:b,set:function(a){a=Math.floor(a);if(a===f)return!1;f=a;this.resize();return!1},type:"number"},height:{get:c,set:function(a){a=Math.floor(a);if(a===g)return!1;g=a;this.resize();return!1},type:"number"},mode:{get:function(){return e},set:function(b){if(b===e)return!1;e=b;a();return!0},type:"enum",options:"cover contain distort width height none".split(" ")}}}},
{title:"Reformat",description:"Change output dimensions"});Y="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n";
ka="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nvoid main(void) {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n}";f.util.shader.noiseHelpers="#ifndef NOISE_HELPERS\n#define NOISE_HELPERS\nvec2 mod289(vec2 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat taylorInvSqrt(float r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\n#endif\n";
f.util.shader.snoise2d="#ifndef NOISE2D\n#define NOISE2D\nfloat snoise(vec2 v) {\n\tconst vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n\t\t0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n\t\t-0.577350269189626, // -1.0 + 2.0 * C.x\n\t\t0.024390243902439); // 1.0 / 41.0\n\tvec2 i = floor(v + dot(v, C.yy));\n\tvec2 x0 = v - i + dot(i, C.xx);\n\tvec2 i1;\n\t//i1.x = step(x0.y, x0.x); // x0.x > x0.y ? 1.0 : 0.0\n\t//i1.y = 1.0 - i1.x;\n\ti1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\t// x0 = x0 - 0.0 + 0.0 * C.xx ;\n\t// x1 = x0 - i1 + 1.0 * C.xx ;\n\t// x2 = x0 - 1.0 + 2.0 * C.xx ;\n\tvec4 x12 = x0.xyxy + C.xxzz;\n\tx12.xy -= i1;\n\ti = mod289(i); // Avoid truncation effects in permutation\n\tvec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\n\tvec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);\n\tm = m*m ;\n\tm = m*m ;\n\tvec3 x = 2.0 * fract(p * C.www) - 1.0;\n\tvec3 h = abs(x) - 0.5;\n\tvec3 ox = floor(x + 0.5);\n\tvec3 a0 = x - ox;\n\tm *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\tvec3 g;\n\tg.x = a0.x * x0.x + h.x * x0.y;\n\tg.yz = a0.yz * x12.xz + h.yz * x12.yw;\n\treturn 130.0 * dot(m, g);\n}\n#endif\n";
f.util.shader.snoise3d="#ifndef NOISE3D\n#define NOISE3D\nfloat snoise(vec3 v) {\n\tconst vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i = floor(v + dot(v, C.yyy));\n\tvec3 x0 = v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(g.xyz, l.zxy);\n\tvec3 i2 = max(g.xyz, l.zxy);\n\t// x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t// x1 = x0 - i1 + 1.0 * C.xxx;\n\t// x2 = x0 - i2 + 2.0 * C.xxx;\n\t// x3 = x0 - 1.0 + 3.0 * C.xxx;\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i);\n\tvec4 p = permute(permute(permute(\n\t\t\t\t\t\ti.z + vec4(0.0, i1.z, i2.z, 1.0))\n\t\t\t\t\t\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0))\n\t\t\t\t\t\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3 ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p, 7 * 7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_); // mod(j, N)\n\tvec4 x = x_ * ns.x + ns.yyyy;\n\tvec4 y = y_ * ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4(x.xy, y.xy);\n\tvec4 b1 = vec4(x.zw, y.zw);\n\t//vec4 s0 = vec4(lessThan(b0, 0.0)) * 2.0 - 1.0;\n\t//vec4 s1 = vec4(lessThan(b1, 0.0)) * 2.0 - 1.0;\n\tvec4 s0 = floor(b0) * 2.0 + 1.0;\n\tvec4 s1 = floor(b1) * 2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw * sh.zzww ;\n\tvec3 p0 = vec3(a0.xy, h.x);\n\tvec3 p1 = vec3(a0.zw, h.y);\n\tvec3 p2 = vec3(a1.xy, h.z);\n\tvec3 p3 = vec3(a1.zw, h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot(m*m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n}\n#endif\n";
f.util.shader.snoise4d="#ifndef NOISE4D\n#define NOISE4D\nvec4 grad4(float j, vec4 ip)\n\t{\n\tconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n\tvec4 p, s;\n\n\tp.xyz = floor(fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n\tp.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n\ts = vec4(lessThan(p, vec4(0.0)));\n\tp.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n\treturn p;\n\t}\n\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n\t{\n\tconst vec4 C = vec4(0.138196601125011, // (5 - sqrt(5))/20 G4\n\t\t\t\t\t\t0.276393202250021, // 2 * G4\n\t\t\t\t\t\t0.414589803375032, // 3 * G4\n\t\t\t\t\t\t-0.447213595499958); // -1 + 4 * G4\n\n\tvec4 i = floor(v + dot(v, vec4(F4)));\n\tvec4 x0 = v - i + dot(i, C.xxxx);\n\n\n\tvec4 i0;\n\tvec3 isX = step(x0.yzw, x0.xxx);\n\tvec3 isYZ = step(x0.zww, x0.yyz);\n\ti0.x = isX.x + isX.y + isX.z;\n\ti0.yzw = 1.0 - isX;\n\ti0.y += isYZ.x + isYZ.y;\n\ti0.zw += 1.0 - isYZ.xy;\n\ti0.z += isYZ.z;\n\ti0.w += 1.0 - isYZ.z;\n\n\tvec4 i3 = clamp(i0, 0.0, 1.0);\n\tvec4 i2 = clamp(i0 - 1.0, 0.0, 1.0);\n\tvec4 i1 = clamp(i0 - 2.0, 0.0, 1.0);\n\n\tvec4 x1 = x0 - i1 + C.xxxx;\n\tvec4 x2 = x0 - i2 + C.yyyy;\n\tvec4 x3 = x0 - i3 + C.zzzz;\n\tvec4 x4 = x0 + C.wwww;\n\n\ti = mod289(i);\n\tfloat j0 = permute(permute(permute(permute(i.w) + i.z) + i.y) + i.x);\n\tvec4 j1 = permute(permute(permute(permute (\n\t\t\t\t\ti.w + vec4(i1.w, i2.w, i3.w, 1.0))\n\t\t\t\t\t+ i.z + vec4(i1.z, i2.z, i3.z, 1.0))\n\t\t\t\t\t+ i.y + vec4(i1.y, i2.y, i3.y, 1.0))\n\t\t\t\t\t+ i.x + vec4(i1.x, i2.x, i3.x, 1.0));\n\n\tvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n\tvec4 p0 = grad4(j0, ip);\n\tvec4 p1 = grad4(j1.x, ip);\n\tvec4 p2 = grad4(j1.y, ip);\n\tvec4 p3 = grad4(j1.z, ip);\n\tvec4 p4 = grad4(j1.w, ip);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tp4 *= taylorInvSqrt(dot(p4, p4));\n\n\tvec3 m0 = max(0.6 - vec3(dot(x0, x0), dot(x1, x1), dot(x2, x2)), 0.0);\n\tvec2 m1 = max(0.6 - vec2(dot(x3, x3), dot(x4, x4)), 0.0);\n\tm0 = m0 * m0;\n\tm1 = m1 * m1;\n\treturn 49.0 * (dot(m0*m0, vec3(dot(p0, x0), dot(p1, x1), dot(p2, x2)))\n\t\t\t\t\t\t\t+ dot(m1*m1, vec2(dot(p3, x3), dot(p4, x4)))) ;\n}\n#endif\n";
return f});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){b.source("array",function(a,b,d){var e,h,k;if(b&&(Array.isArray(a)||a&&a.BYTES_PER_ELEMENT&&"length"in a))if(e=b.width,h=b.height,e&&h)if(e*h*4!==a.length){if(d)throw"Array length must be height x width x 4.";}else return this.width=e,this.height=h,void 0===b.flip&&(this.flip=!1),a instanceof Uint8Array||(k=new Uint8Array(a.length)),{render:function(b){var c;
if(this.dirty){if(k)for(c=0;c<k.length;c++)k[c]=a[c];b.bindTexture(b.TEXTURE_2D,this.texture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,this.flip);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,this.width,this.height,0,b.RGBA,b.UNSIGNED_BYTE,k||a);this.lastRenderTime=Date.now()/1E3;return!0}}};else if(d)throw"Height and width must be provided with an Array";},{title:"Array",description:"Array or Uint8Array"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,c=window.URL||window.webkitURL||window.mozURL||window.msURL;b.source("camera",function(d,e,h){function k(){p&&(p.pause(),p.src="",p.load());q&&q.stop&&q.stop();q=null}function n(){l||(p.videoWidth?(r.width=p.videoWidth,r.height=p.videoHeight,r.setReady()):
setTimeout(n,50))}var r=this,p,g,l=!1,q,f=0;if(h){if(!a)throw"Camera source type unavailable. Browser does not support getUserMedia";e={};if(d&&"object"===typeof d)for(g in d)d.hasOwnProperty(g)&&(e[g]=d[g]);e.video||(e.video=!0);p=document.createElement("video");a.call(navigator,e,function(a){q=a;l?k():(p.mozCaptureStream?p.mozSrcObject=q:p.src=c&&c.createObjectURL(q)||q,p.readyState?n():p.addEventListener("loadedmetadata",n,!1),p.play())},function(a){console.log("Unable to access video camera",
a)});return{deferTexture:!0,source:p,render:function(a){f=p.currentTime;a.bindTexture(a.TEXTURE_2D,this.texture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,this.flip);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,p),!0}catch(c){b.logger.error("Error rendering camera video source",c)}return!1},checkDirty:function(){return p.currentTime!==f},destroy:function(){l=!0;k()}}}},{compatible:function(){return!!a},title:"Camera"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){function a(a,b,c,k,n){a=new Uint8Array(a,b,n);c=new Uint8Array(c,k,n);a.set(c)}var c=/GDepth:Data="([\S]*)"/;b.source("depth",function(d,e,h){function k(){q||(r.width=l.naturalWidth,r.height=l.naturalHeight,r.setReady())}function n(d){var g=new Uint8Array(d),e=[],h="",q,p,n,r;if(255==g[0]&&216==g[1]){for(q=0;q<g.byteLength;q++)255===g[q]&&
225===g[q+1]&&(e.push(q),q++);e.push(g.byteLength);for(q=0;q<e.length-1;q++)255===g[e[q]]&&225===g[e[q]+1]&&(n=256*g[e[q]+2]+g[e[q]+3],r=79,r>n&&(r=0),n+=2,p=new ArrayBuffer(n-r),a(p,0,d,e[q]+r,n-r),p=String.fromCharCode.apply(null,new Uint8Array(p)),h+=p);d=c.exec(h);if(null===d)return b.logger.error("JPEG file does not include depth image."),!1;l||(l=document.createElement("img"));l.src="data:image/png;base64,"+d[1];l.complete&&l.naturalWidth?k():(l.addEventListener("load",k,!0),l.addEventListener("error",
function(a){b.logger.error("Error loading depth image.",a)},!0))}else return b.logger.error("Unable to load depth image. File is not a JPEG."),!1}var r=this,p,g,l,q=!1;if(h)return p="string"===typeof d?document.querySelector(d):d,p instanceof window.ArrayBuffer?n(d):e&&e.url?g=e.url:p&&p instanceof window.HTMLImageElement&&("IMG"===p.tagName||h)&&(g=p.src),g||"string"!==typeof d||(g=d),g&&(l=document.createElement("img"),d=new XMLHttpRequest,d.open("GET",g,!0),d.responseType="arraybuffer",d.onload=
function(){n(this.response)},d.send()),l?{deferTexture:!0,source:l,render:Object.getPrototypeOf(this).renderImageCanvas,destroy:function(){q=!0}}:!1},{title:"Depth Image"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){b.source("imagedata",function(a){if(a instanceof Object&&a.data&&a.width&&a.height&&a.width*a.height*4===a.data.length)return this.width=a.width,this.height=a.height,{render:function(b){if(this.dirty)return b.bindTexture(b.TEXTURE_2D,this.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,this.flip),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,
a),this.lastRenderTime=Date.now()/1E3,!0}}},{title:"ImageData",description:"2D Canvas ImageData"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously","three"],a):"object"===typeof exports?a(require("seriously"),require("three")):a(b.Seriously,b.THREE)})(this,function(b,a){var c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),d=b.util.mat4;b.target("three",function(b,h){function k(){p&&r&&!n.initialized&&(n.initialized=!0,n.allowRefresh=!0,n.setReady())}var n=this,r,p;if(a&&b instanceof a.WebGLRenderTarget){if(n.gl)r=n.gl;else if(h)if(h.gl)r=h.gl;else if(h.canvas&&h.canvas.getContext){try{r=
h.canvas.getContext("webgl")}catch(g){}if(!r)try{r=h.canvas.getContext("experimental-webgl")}catch(l){}}if(!r)throw Error("Failed to create Three.js target. Missing WebGL context");this.ready=!1;this.width=b.width;this.height=b.height;if(b.__webglFramebuffer){if(!r.isFramebuffer(b.__webglFramebuffer))throw Error("Failed to create Three.js target. WebGL texture is from a different context");p=b.__webglFramebuffer;k()}else Object.defineProperty(b,"__webglFramebuffer",{configurable:!0,enumerable:!0,
get:function(){return p},set:function(a){a&&(p=a,k())}});this.setReady=function(){p&&this.source&&this.source.ready&&!this.ready&&(this.emit("ready"),this.ready=!0)};this.target=b;return{gl:r,resize:function(){this.width=b.width;this.height=b.height},render:function(a,f,g){var l,h,k;if(r&&this.dirty&&this.ready&&this.source&&(this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||
c:this.transformDirty&&(l=this.transform,d.copy(l,this.source.cumulativeMatrix||c),h=this.source.width/this.width,k=this.source.height/this.height,l[0]*=h,l[1]*=h,l[2]*=h,l[3]*=h,l[4]*=k,l[5]*=k,l[6]*=k,l[7]*=k,this.uniforms.transform=l,this.transformDirty=!1),a(f,g,this.uniforms,p,this),this.emit("render"),this.dirty=!1,b.onUpdate))b.onUpdate()},destroy:function(){Object.defineProperty(b,"__webglFramebuffer",{configurable:!0,enumerable:!0,value:p})}}}},{title:"THREE.js WebGLRenderTarget Target"})});(function(b,a){"function"===typeof define&&define.amd?define([],a):b.MediaLoader=a()})(this,function(){var b=/^[a-z\-]+/i,a={video:"video",audio:"audio",image:"img"};return function(c,d){function e(a){a.preventDefault();return!1}function h(e){var f,h;l&&0>l.indexOf(e.type)?d.error&&d.error(e.type):(h=(h=b.exec(e.type))&&h[0],"file"===g?c(e):"contents"!==g&&a[h]?(h=document.createElement(a[h]),h.src=URL.createObjectURL(e),c(h,e)):(f=new FileReader,f.onload=function(){c(f.result,e)},f.readAsArrayBuffer(e)))}
function k(a){a.preventDefault();a.dataTransfer.files.length&&h(a.dataTransfer.files[0]);return!1}function n(a){a.target.files.length&&h(a.target.files[0])}var r,p,g,l;"object"===typeof c&&(d=c,c=d.callback);if(!c)throw Error("MediaLoader does not work without a callback function");d||(d={});l=d.types||"video/webm video/mp4 video/ogg audio/ogg audio/mp3 image/jpeg image/png".split(" ");g=d.format;if(r=d.target?"string"===typeof r?document.querySelector(d.target):d.target:document.body)r.addEventListener("dragover",
e,!1),r.addEventListener("drop",k,!0);(p=d.input)&&"string"===typeof p&&(p=document.querySelector(p));p&&p.addEventListener("change",n,!1);this.destroy=function(){r&&(r.removeEventListener("dragover",e,!1),r.removeEventListener("drop",k,!0));p&&p.removeEventListener("change",n,!1)}}});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b,c){function d(a){var e={base:(b||"base")+"."+a,blend:(c||"blend")+"."+a};return function(a){return e[a]||a}}return"vec3("+a.replace(/blend|base/g,d("r"))+", "+a.replace(/blend|base/g,d("g"))+", "+a.replace(/blend|base/g,d("b"))+")"}var c={normal:"blend",lighten:"max(blend, base)",
darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",
saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:a("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))",
"blend","base"),colordodge:a("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:a("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:a("BlendLinearLightf(base, blend)"),vividlight:a("BlendVividLightf(base, blend)"),pinlight:a("BlendPinLightf(base, blend)"),hardmix:a("BlendHardMixf(base, blend)"),reflect:a("BlendReflectf(base, blend)"),glow:a("BlendReflectf(blend, base)")},d={normal:!0};b.plugin("accumulator",function(){var a={clear:!1},h,k=0;return{initialize:function(a,
c){a();h=[this.frameBuffer,new b.util.FrameBuffer(c,this.width,this.height)]},shader:function(a,b){var e=a.blendMode||"normal",e=e.toLowerCase();b.fragment=["precision mediump float;\nconst vec3 ZERO = vec3(0.0);\nconst vec3 ONE = vec3(1.0);\nconst vec3 HALF = vec3(0.5);\nconst vec3 TWO = vec3(2.0);\n#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)\n#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)\n#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)\n#define BlendLightenf(base, blend)\t\tmax(blend, base)\n#define BlendDarkenf(base, blend)\t\tmin(blend, base)\n#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))\n#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\nvec3 RGBToHSL(vec3 color) {\n\tvec3 hsl;\n\tfloat fmin = min(min(color.r, color.g), color.b);\n\tfloat fmax = max(max(color.r, color.g), color.b);\n\tfloat delta = fmax - fmin;\n\thsl.z = (fmax + fmin) / 2.0;\n\tif (delta == 0.0) {\n\t\thsl.x = 0.0;\n\t\thsl.y = 0.0;\n\t} else {\n\t\tif (hsl.z < 0.5)\n\t\t\thsl.y = delta / (fmax + fmin);\n\t\telse\n\t\t\thsl.y = delta / (2.0 - fmax - fmin);\n\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\n\t\tif (color.r == fmax )\n\t\t\thsl.x = deltaB - deltaG;\n\t\telse if (color.g == fmax)\n\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;\n\t\telse if (color.b == fmax)\n\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;\n\t\tif (hsl.x < 0.0)\n\t\t\thsl.x += 1.0;\n\t\telse if (hsl.x > 1.0)\n\t\t\thsl.x -= 1.0;\n\t}\n\treturn hsl;\n}\nfloat HueToRGB(float f1, float f2, float hue) {\n\tif (hue < 0.0)\n\t\thue += 1.0;\n\telse if (hue > 1.0)\n\t\thue -= 1.0;\n\tfloat res;\n\tif ((6.0 * hue) < 1.0)\n\t\tres = f1 + (f2 - f1) * 6.0 * hue;\n\telse if ((2.0 * hue) < 1.0)\n\t\tres = f2;\n\telse if ((3.0 * hue) < 2.0)\n\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\telse\n\t\tres = f1;\n\treturn res;\n}\nvec3 HSLToRGB(vec3 hsl) {\n\tvec3 rgb;\n\tif (hsl.y == 0.0)\n\t\trgb = vec3(hsl.z);\n\telse {\n\t\tfloat f2;\n\t\tif (hsl.z < 0.5)\n\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\telse\n\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\n\t\tfloat f1 = 2.0 * hsl.z - f2;\n\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));\n\t\trgb.g = HueToRGB(f1, f2, hsl.x);\n\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));\n\t}\n\treturn rgb;\n}\nvec3 BlendHue(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));\n}\nvec3 BlendSaturation(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));\n}\nvec3 BlendColor(vec3 base, vec3 blend) {\n\tvec3 blendHSL = RGBToHSL(blend);\n\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));\n}\nvec3 BlendLuminosity(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));\n}\nvec3 BlendLighterColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal > baseTotal ? blend : base;\n}\nvec3 BlendDarkerColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal < baseTotal ? blend : base;\n}",
"#define BlendFunction(base, blend) "+c[e],d[e]?"#define MIX_ALPHA":"","varying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D previous;\nuniform float opacity;\nvec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {\n\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);\n\treturn mix(base.rgb, blendedColor, opacity * blend.a);\n}\nvoid main(void) {\n\tvec4 topPixel = texture2D(source, vTexCoord);\n\tvec4 bottomPixel = texture2D(previous, vTexCoord);\n\tif (topPixel.a == 0.0) {\n\t\tgl_FragColor = bottomPixel;\n\t} else {\n\t\tfloat alpha;\n#ifdef MIX_ALPHA\n\t\talpha = topPixel.a * opacity;\n\t\talpha = alpha + bottomPixel.a * (1.0 - alpha);\n#else\n\t\talpha = bottomPixel.a;\n#endif\n\t\tgl_FragColor = vec4(BlendOpacity(bottomPixel, topPixel, opacity), alpha);\n\t}\n}"].join("\n");
return b},resize:function(){h&&(h[0].resize(this.width,this.height),h[1].resize(this.width,this.height))},draw:function(b,c,d,g,l){this.uniforms.previous=this.frameBuffer.texture;k=(k+1)%2;this.frameBuffer=g=h[k];this.texture=g.texture;this.inputs.clear?l(this.baseShader,c,d,g.frameBuffer,null):l(b,c,d,g.frameBuffer,null,a)},destroy:function(){h&&(h[0].destroy(),h[1].destroy(),h.length=0)}}},{inPlace:!1,title:"Accumulator",description:"Draw on top of previous frame",inputs:{source:{type:"image",uniform:"source"},
clear:{type:"boolean",defaultValue:!1},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1},blendMode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight",
"Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight","Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]]}}})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a,c;c=document.createElement("img");c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvAAAAAICAYAAACf+MsnAAAFY0lEQVR4Xu2Z644bOwyDN+//0NsOigEMQdRHyU6CFDnA+bHVWNaFojiTx8/Pz+/f/4/89/v7z9Xj8Tjib3XyTN9usFcMz8gt3h9zXf/O6nD/W1V7Vb9uXad+nHucZ9xenX7OqTHdSfmRXfmPsSn8xPMrllcfCkdVfHSe7Ned0/yp7jv2GPfqK+MCByc0zzvxKi5RPq8cuvE4+JrwpFM7N78K2yu+qb9kd3qV+ZjUx5n/+xnXP81ctW/UHQ5P3Gd360vxKf+n8dGpxXTeKu6h2ansFT6pvo5G2/FP99NsUf9d/xleInfetcj629m9cf9WOV5K+78R8ERGRLYO8VQiecd/1vwKEJV46JBJRzhRfXftVL/MTgM48UmL0l2OSmzs9kctAJfE4/1KkNFzbj8cjFHsJ/u460vhnPDfqddujJ27poLCWWBuHt0YKr/ki+yOKJnk5Z7pPLfLf4TZif+qvi7XuDWg+HbtNEe79ds9H7m1m2/3+YzLK5Hc9e/gYxdfNP+ZfdV9lT3usWn+9310/qiAdxa1O5gTEqVhoLudxVwVNPrvCqDp/ZX4d0Uk1Y7sbgyU4zooCk8nB3i9Y61V5wWpIjDlP+ZJsxPvmLxEOD2sntk5Pz1LBOb0L+sPfQGs6ksYpt7QAiHuUwtkgl+F3Qyf2YxTX53+Vdjfjc8VYIq7KT+abzof7ervZ8fX8d/Jyc3PmTcnRrrPEbyVTnD8T+Y38pH624mfNIr6muzO95S/sh1Gvog/XmW/a6N+scww43zgqLjcOX9cwFeESQK3Gpx32QggTlwk8Ei8OXfE4VMLeCLQiLBjfJM7VA069XefnZBGJz7Vr24dK3GwEoqLD7p/1+4IMWdRdxaMK9CmP4E62F7nm8S7s4B3BMCkBzQPVQ0IM06+2WLvzlDlI+NfF4d0ljiHuF/Zb/4m/4ojTgnA6f0qfiWA135P5l/NoFv/7txm+5ZyyOw0e1R/skd8ZKKwwnjXf9xLrkBV+2x3Pib9Vz3JOMaNL/KZ+oCkXhDUTLxEwLsC41OfI5DEYe9+mXfr0l2mJH5ISHTOUw2U8IjD5LyVUtxEmrvi4V5ejvijWNWicBbOyfsrYejkMMXmdIFEAZH19ASWnNyrPlBdKH+yU3y0gGjGKf4Mv51ft9zzKk83vul5qr9r7+CT9gHx2zvs0/yofpGX1AuC4svqhYJeJJydNZk/urcSxet91dfiUy94HX6oBHCHi5+F38svCeg1h+zZ6nyF5VUzVC8Q0X9LwE/IkMjmpJ3i27XvxuqQ0c4dp/JTfnb9T847AoNIW/nokIYrYKvnJvln/siPwtD0XAeTU+x0luEugWdLNeY4ecl260vxK8Efl3OnZi4uaZZIMBFeJ/hw6xrFvppvV1Q559d8MwwR50cskIBQ2KhE3y7/ZeddAUjxOr3diZ/8U3+I953z7uzR7Lj4rvjl9HxXvaHaOflSfSkf93y24xx94PpX89I5H2t9+fwK+KVzNOwdIeM+e905+ZqqRIj7pYHiU3FNFnBnkO+41EKige3cpX7GunwoARfjIwKrxNhEJFLfMrsbI+G/smfkojAa60vxPcNeCZCqhjSra6ydBaAWSFzaqnb01c4VEdVCWWPM7svstKDWuKrZpwUb7dVsOzPcxUeGdYdfdgV8Vr+Mv1R8Tn/iHcSNWR8jjjv9URzama9qbp0XlBP4y2Jw6u/E577AZTVz/BM/OfySzSjl79o73FRxaFdfuPG5/XE58PbXEvAT8UBn1HKuSIB8ThYwiZfJnd8z768Aib/3R/iN4J0VeMXcVwvynbl/735OBV6BKTfyT+e/T4/f7dP3uW8F3Aqs/PIHbWXeeeKjnSsAAAAASUVORK5CYII=";
a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("ascii",function(){function d(){p=f.height;r=f.width;g=Math.ceil(r/8);l=Math.ceil(p/8);q.resolution=f.uniforms.resolution;q.transform=a;h&&h.resize(g,l)}var e,h,k,n,r,p,g,l,q={},f=this;return{initialize:function(f){function p(){n.bindTexture(n.TEXTURE_2D,k);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);
n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,c);n.bindTexture(n.TEXTURE_2D,null)}var r=this;f();this.texture=this.frameBuffer.texture;n=this.gl;k=n.createTexture();c.naturalWidth?p():c.addEventListener("load",function(){p();r.setDirty()});q.letters=k;n.bindTexture(n.TEXTURE_2D,this.texture||this.frameBuffer&&this.frameBuffer.texture);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,
n.NEAREST);n.bindTexture(n.TEXTURE_2D,null);d();h=new b.util.FrameBuffer(n,g,l);n.bindTexture(n.TEXTURE_2D,h.texture);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);this.uniforms.transform=a;e=this.baseShader},commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D letters;\nuniform vec4 background;\nuniform vec2 resolution;\nconst vec3 lumcoeff = vec3(0.2125, 0.7154, 0.0721);\nconst vec2 fontSize = vec2(8.0, 8.0);\nvec4 lookup(float ascii) {\n\tvec2 pos = mod(vTexCoord * resolution, fontSize) / vec2(752.0, fontSize.x) + vec2(ascii, 0.0);\n\treturn texture2D(letters, pos);\n}\nvoid main(void) {\n\tvec4 sample = texture2D(source, vTexCoord);\n\tvec4 clamped = vec4(floor(sample.rgb * 8.0) / 8.0, sample.a);\n\tfloat luma = dot(sample.rgb,lumcoeff);\n\tfloat char = floor(luma * 94.0) / 94.0;\n\tgl_FragColor = mix(background, clamped, lookup(char).r);\n}";
return b},resize:d,draw:function(a,b,c,d,f){f(e,b,c,h.frameBuffer,!1,{width:g,height:l,blend:!1});q.source=h.texture;q.background=c.background;f(a,b,q,d)},destroy:function(){h&&h.destroy();n&&k&&n.deleteTexture(k)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},background:{type:"color",uniform:"background",defaultValue:[0,0,0,1]}},description:"Display image as ascii text in 8-bit color.",title:"Ascii Text"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("bleach-bypass",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nconst vec4 one = vec4(1.0);\nconst vec4 two = vec4(2.0);\nconst vec4 lumcoeff = vec4(0.2125,0.7154,0.0721,0.0);\nvec4 overlay(vec4 myInput, vec4 previousmix, vec4 amount) {\n\tfloat luminance = dot(previousmix,lumcoeff);\n\tfloat mixamount = clamp((luminance - 0.45) * 10.0, 0.0, 1.0);\n\tvec4 branch1 = two * previousmix * myInput;\n\tvec4 branch2 = one - (two * (one - previousmix) * (one - myInput));\n\tvec4 result = mix(branch1, branch2, vec4(mixamount) );\n\treturn mix(previousmix, result, amount);\n}\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec4 luma = vec4(vec3(dot(pixel,lumcoeff)), pixel.a);\n\tgl_FragColor = overlay(luma, pixel, vec4(amount));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:1,min:0,max:1}},title:"Bleach Bypass",categories:["film"],description:'Bleach Bypass film treatment\nhttp://en.wikipedia.org/wiki/Bleach_bypass\nsee: "Saving Private Ryan", "Minority Report"'})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b,c){function d(a){var g={base:(b||"base")+"."+a,blend:(c||"blend")+"."+a};return function(a){return g[a]||a}}return"vec3("+a.replace(/blend|base/g,d("r"))+", "+a.replace(/blend|base/g,d("g"))+", "+a.replace(/blend|base/g,d("b"))+")"}var c={normal:"blend",lighten:"max(blend, base)",
darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",
saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:a("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))",
"blend","base"),colordodge:a("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:a("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:a("BlendLinearLightf(base, blend)"),vividlight:a("BlendVividLightf(base, blend)"),pinlight:a("BlendPinLightf(base, blend)"),hardmix:a("BlendHardMixf(base, blend)"),reflect:a("BlendReflectf(base, blend)"),glow:a("BlendReflectf(blend, base)")},d={normal:["FUNC_ADD","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","SRC_ALPHA","DST_ALPHA"]},
e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("blend",function(){function a(){var b=p&&d[p.mode];b&&g&&(r.blendEquation=g[b[0]],r.srcRGB=g[b[1]],r.dstRGB=g[b[2]],r.srcAlpha=g[b[3]],r.dstAlpha=g[b[4]])}var b,n,r={clear:!1},p,g;this.resize=function(){var a,c;a=this.inputs.sizeMode;var d;d=this.inputs.bottom;var g=this.inputs.top;"bottom"===a||"top"===a?(c=this.inputs[a])?(a=c.width,c=c.height):c=a=1:d?g?(c="union"===a?Math.max:Math.min,a=c(d.width,g.width),c=c(d.height,g.height)):(a=
d.width,c=d.height):g?(a=g.width,c=g.height):c=a=1;if(this.width!==a||this.height!==c)this.width=a,this.height=c,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=c,this.frameBuffer&&this.frameBuffer.resize(a,c),this.emit("resize"),this.setDirty();this.uniforms.resBottom[0]=d&&d.width||1;this.uniforms.resBottom[1]=d&&d.height||1;this.uniforms.resTop[0]=g&&g.width||1;this.uniforms.resTop[1]=g&&g.height||1;b&&(d&&(n.resolution[0]=d.width,n.resolution[1]=d.height),g&&(b.resolution[0]=g.width,
b.resolution[1]=g.height));for(d=0;d<this.targets.length;d++)this.targets[d].resize()};this.uniforms.resTop=[1,1];this.uniforms.resBottom=[1,1];return{initialize:function(b){p=this.inputs;b();g=this.gl;a()},shader:function(a,g){var f=a.mode||"normal",f=f.toLowerCase();if(d[f])return b||(f=this.inputs.top,b={resolution:[f&&f.width||1,f&&f.height||1],targetRes:this.uniforms.resolution,source:f,transform:f&&f.cumulativeMatrix||e,opacity:this.inputs.opacity},f=this.inputs.bottom,n={resolution:[f&&f.width||
1,f&&f.height||1],targetRes:this.uniforms.resolution,source:f,transform:f&&f.cumulativeMatrix||e,opacity:1}),g.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 targetRes;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.xy *= resolution / targetRes;\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n",
g.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor.a *= opacity;\n}",g;n=b=null;g.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resBottom;\nuniform vec2 resTop;\nvarying vec2 texCoordBottom;\nvarying vec2 texCoordTop;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordBottom = adjusted / resBottom + HALF;\n\ttexCoordTop = adjusted / resTop + HALF;\n}";
g.fragment=["precision mediump float;\nconst vec3 ZERO = vec3(0.0);\nconst vec3 ONE = vec3(1.0);\nconst vec3 HALF = vec3(0.5);\nconst vec3 TWO = vec3(2.0);\n#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)\n#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)\n#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)\n#define BlendLightenf(base, blend)\t\tmax(blend, base)\n#define BlendDarkenf(base, blend)\t\tmin(blend, base)\n#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))\n#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\nvec3 RGBToHSL(vec3 color) {\n\tvec3 hsl;\n\tfloat fmin = min(min(color.r, color.g), color.b);\n\tfloat fmax = max(max(color.r, color.g), color.b);\n\tfloat delta = fmax - fmin;\n\thsl.z = (fmax + fmin) / 2.0;\n\tif (delta == 0.0) {\n\t\thsl.x = 0.0;\n\t\thsl.y = 0.0;\n\t} else {\n\t\tif (hsl.z < 0.5)\n\t\t\thsl.y = delta / (fmax + fmin);\n\t\telse\n\t\t\thsl.y = delta / (2.0 - fmax - fmin);\n\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\n\t\tif (color.r == fmax )\n\t\t\thsl.x = deltaB - deltaG;\n\t\telse if (color.g == fmax)\n\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;\n\t\telse if (color.b == fmax)\n\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;\n\t\tif (hsl.x < 0.0)\n\t\t\thsl.x += 1.0;\n\t\telse if (hsl.x > 1.0)\n\t\t\thsl.x -= 1.0;\n\t}\n\treturn hsl;\n}\nfloat HueToRGB(float f1, float f2, float hue) {\n\tif (hue < 0.0)\n\t\thue += 1.0;\n\telse if (hue > 1.0)\n\t\thue -= 1.0;\n\tfloat res;\n\tif ((6.0 * hue) < 1.0)\n\t\tres = f1 + (f2 - f1) * 6.0 * hue;\n\telse if ((2.0 * hue) < 1.0)\n\t\tres = f2;\n\telse if ((3.0 * hue) < 2.0)\n\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\telse\n\t\tres = f1;\n\treturn res;\n}\nvec3 HSLToRGB(vec3 hsl) {\n\tvec3 rgb;\n\tif (hsl.y == 0.0)\n\t\trgb = vec3(hsl.z);\n\telse {\n\t\tfloat f2;\n\t\tif (hsl.z < 0.5)\n\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\telse\n\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\n\t\tfloat f1 = 2.0 * hsl.z - f2;\n\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));\n\t\trgb.g = HueToRGB(f1, f2, hsl.x);\n\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));\n\t}\n\treturn rgb;\n}\nvec3 BlendHue(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));\n}\nvec3 BlendSaturation(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));\n}\nvec3 BlendColor(vec3 base, vec3 blend) {\n\tvec3 blendHSL = RGBToHSL(blend);\n\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));\n}\nvec3 BlendLuminosity(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));\n}\nvec3 BlendLighterColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal > baseTotal ? blend : base;\n}\nvec3 BlendDarkerColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal < baseTotal ? blend : base;\n}",
"#define BlendFunction(base, blend) "+c[f],"varying vec2 texCoordBottom;\nvarying vec2 texCoordTop;\nuniform sampler2D top;\nuniform sampler2D bottom;\nuniform float opacity;\nvec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {\n\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);\n\treturn mix(base.rgb, blendedColor, opacity * blend.a);\n}\nvoid main(void) {\n\tvec4 topPixel = texture2D(top, texCoordTop);\n\tvec4 bottomPixel = texture2D(bottom, texCoordBottom);\n\tif (topPixel.a == 0.0) {\n\t\tgl_FragColor = bottomPixel;\n\t} else {\n\t\tgl_FragColor = vec4(BlendOpacity(bottomPixel, topPixel, opacity), bottomPixel.a);\n\t}\n}"].join("\n");
return g},draw:function(a,c,f,e,h){d[this.inputs.mode]?(this.inputs.bottom?h(a,c,n,e):(g.viewport(0,0,this.width,this.height),g.bindFramebuffer(g.FRAMEBUFFER,e),g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)),this.inputs.top&&this.inputs.opacity&&h(a,c,b,e,null,r)):h(a,c,f,e)},requires:function(a){return this.inputs.opacity||"top"!==a?!0:!1},inputs:{top:{type:"image",uniform:"top",update:function(){b&&(b.source=this.inputs.top,b.transform=this.inputs.top.cumulativeMatrix||e);
this.resize()}},bottom:{type:"image",uniform:"bottom",update:function(){n&&(n.source=this.inputs.bottom,n.transform=this.inputs.bottom.cumulativeMatrix||e);this.resize()}},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1,updateSources:!0,update:function(a){b&&(b.opacity=a)}},sizeMode:{type:"enum",defaultValue:"bottom",options:["bottom","top","union","intersection"],update:function(){this.resize()}},mode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],
["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight","Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight",
"Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]],update:function(){a()}}}}},{inPlace:function(){return!!d[this.inputs.mode]},description:"Blend two layers",title:"Blend"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=[0.2,0.3,0.5,0.8,1],c=a.length-1,d=[1,0],e=[0,1],h=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("blur",function(k){var n,r,p,g={amount:0,inputScale:1,resolution:[this.width,this.height],transform:h,direction:null};return{initialize:function(a){a();if(a=this.gl)p=
this.baseShader,n=new b.util.FrameBuffer(a,this.width,this.height),r=new b.util.FrameBuffer(a,this.width,this.height)},commonShader:!0,shader:function(a,b){var c=this.gl,c=10<=c.getParameter(c.MAX_VARYING_VECTORS)?"#define USE_VARYINGS":"";b.vertex=[c,"precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform vec2 direction;\nuniform float amount;\nuniform float inputScale;\nconst vec2 zero = vec2(0.0, 0.0);\nvarying vec2 vTexCoord;\n#ifdef USE_VARYINGS\nvec2 one;\nvec2 amount1;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 one;\nvarying vec2 amount1;\n#endif\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n\tone = vec2(1.0, 1.0) * inputScale;\n\tif (inputScale < 1.0) {\n\t\tone -= 1.0 / resolution;\n\t}\n\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));\n\tamount1 = direction * (inputScale * amount * 5.0 / resolution);\n#ifdef USE_VARYINGS\n\tvec2 amount2 = amount1 * 3.0;\n\tvec2 amount3 = amount1 * 6.0;\n\tvec2 amount4 = amount1 * 9.0;\n\tvec2 amount5 = -amount1;\n\tvec2 amount6 = amount5 * 3.0;\n\tvec2 amount7 = amount5 * 6.0;\n\tvec2 amount8 = amount5 * 9.0;\n\tvTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvTexCoord2 = max(zero, min(one, vTexCoord + amount2));\n\tvTexCoord3 = max(zero, min(one, vTexCoord + amount3));\n\tvTexCoord4 = max(zero, min(one, vTexCoord + amount4));\n\tvTexCoord5 = max(zero, min(one, vTexCoord + amount5));\n\tvTexCoord6 = max(zero, min(one, vTexCoord + amount6));\n\tvTexCoord7 = max(zero, min(one, vTexCoord + amount7));\n\tvTexCoord8 = max(zero, min(one, vTexCoord + amount8));\n#endif\n}"].join("\n");
b.fragment=[c,"precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\n#ifdef USE_VARYINGS\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 amount1;\nvarying vec2 one;\nconst vec2 zero = vec2(0.0, 0.0);\n#endif\nvoid main(void) {\n#ifndef USE_VARYINGS\n\tvec2 vTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvec2 vTexCoord2 = max(zero, min(one, vTexCoord + amount1 * 3.0));\n\tvec2 vTexCoord3 = max(zero, min(one, vTexCoord + amount1 * 6.0));\n\tvec2 vTexCoord4 = max(zero, min(one, vTexCoord + amount1 * 9.0));\n\tvec2 vTexCoord5 = max(zero, min(one, vTexCoord - amount1));\n\tvec2 vTexCoord6 = max(zero, min(one, vTexCoord - amount1 * 3.0));\n\tvec2 vTexCoord7 = max(zero, min(one, vTexCoord - amount1 * 6.0));\n\tvec2 vTexCoord8 = max(zero, min(one, vTexCoord - amount1 * 9.0));\n#endif\n\tgl_FragColor = texture2D(source, vTexCoord) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord1) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord2) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord3) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord4) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord5) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord6) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord7) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord8) / 9.0;\n}"].join("\n");
return b},draw:function(b,h,f,k,y){var w,B,M,G,ea={width:0,height:0,blend:!1},A=1;if(B=this.inputs.amount)if(0.01>=B)f.inputScale=1,f.direction=d,f.source=this.inputs.source.texture,y(b,h,f,n.frameBuffer),f.direction=e,f.source=n.texture,y(b,h,f,k);else for(g.amount=B,g.source=this.inputs.source.texture,f=0;f<a.length;f++)w=Math.min(1,a[f]/B),M=Math.floor(w*this.width),G=Math.floor(w*this.height),g.resolution[0]=M,g.resolution[1]=G,g.inputScale=A,A=w,ea.width=M,ea.height=G,g.direction=d,y(b,h,g,n.frameBuffer,
null,ea),g.inputScale=w,g.source=n.texture,g.direction=e,y(b,h,g,f===c?k:r.frameBuffer,null,ea),g.source=r.texture;else f.source=this.inputs.source.texture,y(p,h,f,k)},resize:function(){g.resolution[0]=this.width;g.resolution[1]=this.height;n&&(n.resize(this.width,this.height),r.resize(this.width,this.height))},destroy:function(){n&&(n.destroy(),r.destroy(),r=n=null);g=null}}},{inputs:{source:{type:"image",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:0.2,min:0,max:1}},title:"Gaussian Blur"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("brightness-contrast",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float brightness;\nuniform float saturation;\nuniform float contrast;\nconst vec3 half3 = vec3(0.5);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 color = pixel.rgb * brightness;\n\tcolor = (color - half3) * contrast + half3;\n\tgl_FragColor = vec4(color, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},brightness:{type:"number",uniform:"brightness",defaultValue:1,min:0},contrast:{type:"number",uniform:"contrast",defaultValue:1,min:0}},title:"Brightness/Contrast",description:"Multiply brightness and contrast values. Works the same as CSS filters."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=["Red","Green","Blue","Alpha"],c={r:0,g:1,b:2,a:3,x:0,y:1,z:2,w:3};b.plugin("channels",function(){function d(a,b,d){"string"===typeof a?(b=a.charAt(0).toLowerCase(),b=c[b],void 0===b&&(b=-1),0>b&&(b=parseFloat(a))):b=a;return 0===b||1===b||2===b||3===b?b:p.inputs[d]}function e(){var a=
p.inputs,b,c,d,e;for(b=0;b<k.length;b++){d=k[b];e=r[b];e||(e=r[b]=[],p.uniforms["channels"+b]=e);for(c=0;16>c;c++)e[c]=0;e[a.red]=a.redSource===d?1:0;e[4+a.green]=a.greenSource===d?1:0;e[8+a.blue]=a.blueSource===d?1:0;e[12+a.alpha]=a.alphaSource===d?1:0}}function h(){function a(c){var d;d=b[c];d||(d=p.sources[c]=b[c]=b.source);c=k.indexOf(d);0>c&&(c=k.length,k.push(d),p.uniforms["source"+c]=d)}var b=p.inputs;k.length=0;a("redSource");a("greenSource");a("blueSource");a("alphaSource");p.resize();e()}
var k=[],n=[],r=[],p=this;this.resize=function(){var a,b;a=this.inputs.sizeMode;var c,d,e;if(k.length)if(1===k.length)e=k[0],a=e.width,b=e.height;else if("union"===a)for(c=b=a=0;c<k.length;c++)e=k[0],a=Math.max(a,e.width),b=Math.max(b,e.height);else if("intersection"===a)for(b=a=Infinity,c=0;c<k.length;c++)e=k[0],a=Math.min(a,e.width),b=Math.min(b,e.height);else(e=p.inputs[a+"Source"])?(a=e.width,b=e.height):b=a=1;else b=a=1;for(c=0;c<k.length;c++)e=k[c],(d=p.uniforms["resolution"+c])?(d[0]=e.width,
d[1]=e.height):p.uniforms["resolution"+c]=[e.width,e.height];if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b,this.frameBuffer&&this.frameBuffer.resize(a,b),this.emit("resize"),this.setDirty();for(c=0;c<this.targets.length;c++)this.targets[c].resize()};return{shader:function(){var a,c,d=c="",e="",h="";if(n[k.length])return n[k.length];for(a=0;a<k.length;a++)e+="varying vec2 vTexCoord"+a+";\n",c+="uniform sampler2D source"+a+
";\nuniform mat4 channels"+a+";\nuniform vec2 resolution"+a+";\n\n",h+="    vTexCoord"+a+" = (position.xy * resolution / resolution"+a+") * 0.5 + 0.5;\n",d+="    if (all(greaterThanEqual(vTexCoord"+a+", vec2(0.0))) && all(lessThan(vTexCoord"+a+", vec2(1.0)))) {\n        gl_FragColor += texture2D(source"+a+", vTexCoord"+a+") * channels"+a+";\n    }\n";a=["precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;",c,e,"void main(void) {",h,"\tgl_Position = position;\n}\n"].join("\n");
c=["precision mediump float;",e,c,"void main(void) {\n\tgl_FragColor = vec4(0.0);",d,"}"].join("\n");c=new b.util.ShaderProgram(this.gl,a,c);return n[k.length]=c},inputs:{sizeMode:{type:"enum",defaultValue:"red",options:"red green blue alpha union intersection".split(" "),update:function(){this.resize()}},source:{type:"image",update:h,shaderDirty:!0},redSource:{type:"image",update:h,shaderDirty:!0},greenSource:{type:"image",update:h,shaderDirty:!0},blueSource:{type:"image",update:h,shaderDirty:!0},
alphaSource:{type:"image",update:h,shaderDirty:!0},red:{type:"enum",options:a,validate:d,update:e,defaultValue:0},green:{type:"enum",options:a,validate:d,update:e,defaultValue:1},blue:{type:"enum",options:a,validate:d,update:e,defaultValue:2},alpha:{type:"enum",options:a,validate:d,update:e,defaultValue:3}}}},{inPlace:!1,title:"Channel Mapping"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("checkerboard",function(){function a(){b.resize()}var b=this;return{initialize:function(b){b();a()},shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform vec2 size;\nuniform vec2 anchor;\nvec2 pixelCoord;\nvarying vec2 vGridCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tpixelCoord = resolution * (texCoord - 0.5) / 2.0;\n\tvGridCoord = (pixelCoord - anchor) / size;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec2 vPixelCoord;\nvarying vec2 vGridCoord;\nuniform vec2 resolution;\nuniform vec2 anchor;\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\nvoid main(void) {\n\tvec2 modGridCoord = floor(mod(vGridCoord, 2.0));\n\tif (modGridCoord.x == modGridCoord.y) {\n\t\tgl_FragColor = color1;\n\t} else  {\n\t\tgl_FragColor = color2;\n\t}\n}";return b},inPlace:!0,inputs:{anchor:{type:"vector",uniform:"anchor",dimensions:2,defaultValue:[0,
0]},size:{type:"vector",uniform:"size",dimensions:2,defaultValue:[4,4]},color1:{type:"color",uniform:"color1",defaultValue:[1,1,1,1]},color2:{type:"color",uniform:"color2",defaultValue:[187/255,187/255,187/255,1]},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360}}}},{commonShader:!0,title:"Checkerboard",categories:["generator"]})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("chroma",{shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nuniform vec4 screen;\nuniform float balance;\nvarying float screenSat;\nvarying vec3 screenPrimary;\nvoid main(void) {\n\tfloat fmin = min(min(screen.r, screen.g), screen.b);\n\tfloat fmax = max(max(screen.r, screen.g), screen.b);\n\tfloat secondaryComponents;\n\tscreenPrimary = step(fmax, screen.rgb);\n\tsecondaryComponents = dot(1.0 - screenPrimary, screen.rgb);\n\tscreenSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n}";
b.fragment=[this.inputs.mask?"#define MASK":"","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 screen;\nuniform float screenWeight;\nuniform float balance;\nuniform float clipBlack;\nuniform float clipWhite;\nuniform bool mask;\nvarying float screenSat;\nvarying vec3 screenPrimary;\nvoid main(void) {\n\tfloat pixelSat, secondaryComponents;\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tfloat fmin = min(min(sourcePixel.r, sourcePixel.g), sourcePixel.b);\n\tfloat fmax = max(max(sourcePixel.r, sourcePixel.g), sourcePixel.b);\n\tvec3 pixelPrimary = step(fmax, sourcePixel.rgb);\n\tsecondaryComponents = dot(1.0 - pixelPrimary, sourcePixel.rgb);\n\tpixelSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\tfloat diffPrimary = dot(abs(pixelPrimary - screenPrimary), vec3(1.0));\n\tfloat solid = step(1.0, step(pixelSat, 0.1) + step(fmax, 0.1) + diffPrimary);\n\tfloat alpha = max(0.0, 1.0 - pixelSat / screenSat);\n\talpha = smoothstep(clipBlack, clipWhite, alpha);\n\tvec4 semiTransparentPixel = vec4((sourcePixel.rgb - (1.0 - alpha) * screen.rgb * screenWeight) / max(0.00001, alpha), alpha);\n\tvec4 pixel = mix(semiTransparentPixel, sourcePixel, solid);\n#ifdef MASK\n\tgl_FragColor = vec4(vec3(pixel.a), 1.0);\n#else\n\tgl_FragColor = pixel;\n#endif\n}"].join("\n");
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},screen:{type:"color",uniform:"screen",defaultValue:[66/255,195/255,31/255,1]},weight:{type:"number",uniform:"screenWeight",defaultValue:1,min:0},balance:{type:"number",uniform:"balance",defaultValue:1,min:0,max:1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},mask:{type:"boolean",defaultValue:!1,uniform:"mask",shaderDirty:!0}},title:"Chroma Key",
description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("color",function(){function a(){c.resize()}var c=this,d={width:1,height:1},e=!0;this.resize=function(){var a,b;this.inputs&&this.inputs.width?(a=this.inputs.width,b=this.inputs.height||a):this.inputs&&this.inputs.height?a=b=this.inputs.height:b=a=1;a=Math.floor(a);b=
Math.floor(b);if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)b=this.targets[a],b.resize(),b.setTransformDirty&&b.setTransformDirty()};return{initialize:function(c){this.frameBuffer=new b.util.FrameBuffer(this.gl,1,1);a();e=!0},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nvoid main(void) {\n\tgl_Position = position;\n}\n";b.fragment="precision mediump float;\n\nuniform vec4 color;\nvoid main(void) {\n\tgl_FragColor = color;\n}";
return b},draw:function(a,b,c,r,p){e&&(p(a,b,c,r,null,d),e=!1)},inPlace:!0,inputs:{color:{type:"color",uniform:"color",defaultValue:[0,0,0,1],update:function(){e=!0}},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360}}}},{title:"Color",description:"Generate color",categories:["generator"]})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("colorcomplements",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 guideColor;\nuniform float correlation;\nuniform float amount;\nuniform float concentration;\nfloat hueLerp(float h1, float h2, float v) {\n\tfloat d = abs(h1 - h2);\n\tif (d <= 0.5) {\n\t\treturn mix(h1, h2, v);\n\t} else if (h1 < h2) {\n\t\treturn fract(mix((h1 + 1.0), h2, v));\n\t} else {\n\t\treturn fract(mix(h1, (h2 + 1.0), v));\n\t}\n}\nvec3 rgbToHsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsvToRgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 hsvComplement(vec3 hsv) {\n\tvec3 compl = hsv;\n\tcompl.x = mod(compl.x - 0.5, 1.0);\n\treturn compl;\n}\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 hsv = rgbToHsv(pixel.rgb);\n\tvec3 hsvPole1 = rgbToHsv(guideColor.rgb);\n\tvec3 hsvPole2 = hsvPole1;\n\thsvPole2 = hsvComplement(hsvPole1);\n\tfloat dist1 = abs(hsv.x - hsvPole1.x);\n\tdist1 = dist1 > 0.5 ? 1.0 - dist1 : dist1;\n\tfloat dist2 = abs(hsv.x - hsvPole2.x);\n\tdist2 = dist2 > 0.5 ? 1.0 - dist2 : dist2;\n\tfloat descent = smoothstep(0.0, correlation, hsv.y);\n\tvec3 outputHsv = hsv;\n\tvec3 pole = dist1 < dist2 ? hsvPole1 : hsvPole2;\n\tfloat dist = min(dist1, dist2);\n\tfloat c = descent * amount * (1.0 - pow((dist * 2.0), 1.0 / concentration));\n\toutputHsv.x = hueLerp(hsv.x, pole.x, c);\n\toutputHsv.y = mix(hsv.y, pole.y, c);\n\tgl_FragColor = vec4(hsvToRgb(outputHsv), pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:0.8},concentration:{type:"number",uniform:"concentration",min:0.1,max:4,defaultValue:2},correlation:{type:"number",uniform:"correlation",min:0,max:1,defaultValue:0.5},guideColor:{type:"color",uniform:"guideColor",defaultValue:[1,0.5,0,1]}},title:"Color Complements",categories:["color"],description:"http://theabyssgazes.blogspot.com/2010/03/teal-and-orange-hollywood-please-stop.html"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("colorcube",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nuniform sampler2D source;\nuniform sampler2D colorCube;\nvarying vec2 vTexCoord;\nvec3 sampleAs3DTexture(sampler2D tex, vec3 coord, float size) {\n\tfloat sliceSize = 1.0 / size;\n\tfloat slicePixelSize = sliceSize / size;\n\tfloat sliceInnerSize = slicePixelSize * (size - 1.0);\n\tfloat zSlice0 = min(floor(coord.z * size), size - 1.0);\n\tfloat zSlice1 = min(zSlice0 + 1.0, size - 1.0);\n\tfloat xOffset = slicePixelSize * 0.5 + coord.x * sliceInnerSize;\n\tfloat s0 = xOffset + (zSlice0 * sliceSize);\n\tfloat s1 = xOffset + (zSlice1 * sliceSize);\n\tvec3 slice0Color = texture2D(tex, vec2(s0, 1.0 - coord.y)).rgb;\n\tvec3 slice1Color = texture2D(tex, vec2(s1, 1.0 - coord.y)).rgb;\n\tfloat zOffset = mod(coord.z * size, 1.0);\n\treturn mix(slice0Color, slice1Color, zOffset);\n}\nvoid main(void) {\n\tvec4 originalColor = texture2D(source, vTexCoord);\n\tvec3 color = sampleAs3DTexture(colorCube, originalColor.rgb, 8.0);\n\tgl_FragColor = vec4(color, originalColor.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},cube:{type:"image",uniform:"colorCube"}},title:"Color Cube",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("color-select",{shader:function(a,b,d){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float hueMin;\nuniform float hueMax;\nuniform float hueMinFalloff;\nuniform float hueMaxFalloff;\nuniform float saturationMin;\nuniform float saturationMax;\nuniform float saturationMinFalloff;\nuniform float saturationMaxFalloff;\nuniform float lightnessMin;\nuniform float lightnessMax;\nuniform float lightnessMinFalloff;\nuniform float lightnessMaxFalloff;\nvarying vec2 vTexCoord;\nvarying vec4 adjustedHueRange;\nvarying vec4 saturationRange;\nvarying vec4 lightnessRange;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tfloat hueOffset = hueMin - hueMinFalloff;\n\tadjustedHueRange = mod(vec4(hueOffset, hueMin - hueOffset, hueMax - hueOffset, hueMax + hueMaxFalloff - hueOffset), 360.0);\n\tif (hueMin != hueMax) {\n\t\tif (adjustedHueRange.z == 0.0) {\n\t\t\tadjustedHueRange.z = 360.0;\n\t\t\tadjustedHueRange.w += 360.0;\n\t\t} else if (adjustedHueRange.w == 0.0) {\n\t\t\tadjustedHueRange.w += 360.0;\n\t\t}\n\t}\n\tsaturationRange = vec4(saturationMin - saturationMinFalloff, saturationMin, saturationMax, saturationMax + saturationMaxFalloff );\n\tlightnessRange = vec4(lightnessMin - lightnessMinFalloff, lightnessMin, lightnessMax, lightnessMax + lightnessMaxFalloff );\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform bool mask;\nvarying vec4 adjustedHueRange;\nvarying vec4 saturationRange;\nvarying vec4 lightnessRange;\nvec3 calcHSL(vec3 c) {\n\tfloat minColor = min(c.r, min(c.g, c.b));\n\tfloat maxColor = max(c.r, max(c.g, c.b));\n\tfloat delta = maxColor - minColor;\n\tvec3 hsl = vec3(0.0, 0.0, (maxColor + minColor) / 2.0);\n\tif (delta > 0.0) {\n\t\tif (hsl.z < 0.5) {\n\t\t\thsl.y = delta / (maxColor + minColor);\n\t\t} else {\n\t\t\thsl.y = delta / (2.0 - maxColor - minColor);\n\t\t}\n\t\tif (c.r == maxColor) {\n\t\t\thsl.x = (c.g - c.b) / delta;\n\t\t} else if (c.g == maxColor) {\n\t\t\thsl.x = 2.0 + (c.b - c.r) / delta;\n\t\t} else {\n\t\t\thsl.x = 4.0 + (c.r - c.g) / delta;\n\t\t}\n\t\thsl.x = hsl.x * 360.0 / 6.0;\n\t\tif (hsl.x < 0.0) {\n\t\t\thsl.x += 360.0;\n\t\t} else {\n\t\t\thsl.x = mod(hsl.x, 360.0);\n\t\t}\n\t}\n\treturn hsl;\n}\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tvec3 hsl = calcHSL(color.rgb);\n\tfloat adjustedHue = mod(hsl.x - adjustedHueRange.x, 360.0);\n\tfloat maskValue;\n\tif (adjustedHue < adjustedHueRange.y) {\n\t\tmaskValue = smoothstep(0.0, adjustedHueRange.y, adjustedHue);\n\t} else if (adjustedHue < adjustedHueRange.z) {\n\t\tmaskValue = 1.0;\n\t} else {\n\t\tmaskValue = 1.0 - smoothstep(adjustedHueRange.z, adjustedHueRange.w, adjustedHue);\n\t}\n\tif (maskValue > 0.0) {\n\t\tif (hsl.y < saturationRange.y) {\n\t\t\tmaskValue = min(maskValue, smoothstep(saturationRange.x, saturationRange.y, hsl.y));\n\t\t} else {\n\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(saturationRange.z, saturationRange.w, hsl.y));\n\t\t}\n\t}\n\tif (maskValue > 0.0) {\n\t\tif (hsl.z < lightnessRange.y) {\n\t\t\tmaskValue = min(maskValue, smoothstep(lightnessRange.x, lightnessRange.z, hsl.y));\n\t\t} else {\n\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(lightnessRange.z, lightnessRange.w, hsl.z));\n\t\t}\n\t}\n\tif (mask) {\n\t\tgl_FragColor = vec4(maskValue, maskValue, maskValue, 1.0);\n\t} else {\n\t\tcolor.a = min(color.a, maskValue);\n\t\tgl_FragColor = color;\n\t}\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hueMin:{type:"number",uniform:"hueMin",defaultValue:0},hueMax:{type:"number",uniform:"hueMax",defaultValue:360},hueMinFalloff:{type:"number",uniform:"hueMinFalloff",defaultValue:0,min:0},hueMaxFalloff:{type:"number",uniform:"hueMaxFalloff",defaultValue:0,min:0},saturationMin:{type:"number",uniform:"saturationMin",defaultValue:0,min:0,max:1},saturationMax:{type:"number",uniform:"saturationMax",defaultValue:1,min:0,max:1},saturationMinFalloff:{type:"number",
uniform:"saturationMinFalloff",defaultValue:0,min:0},saturationMaxFalloff:{type:"number",uniform:"saturationMaxFalloff",defaultValue:0,min:0},lightnessMin:{type:"number",uniform:"lightnessMin",defaultValue:0,min:0,max:1},lightnessMax:{type:"number",uniform:"lightnessMax",defaultValue:1,min:0,max:1},lightnessMinFalloff:{type:"number",uniform:"lightnessMinFalloff",defaultValue:0,min:0},lightnessMaxFalloff:{type:"number",uniform:"lightnessMaxFalloff",defaultValue:0,min:0},mask:{type:"boolean",defaultValue:!1,
uniform:"mask"}},title:"Color Select",description:"Create a mask by hue, saturation and lightness range."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("crop",function(){function a(){var a=1,e=1;b.source?(a=b.source.width,e=b.source.height):b.sources&&b.sources.source&&(a=b.sources.source.width,e=b.sources.source.height);a=a-b.inputs.left-b.inputs.right;e=e-b.inputs.top-b.inputs.bottom;a=Math.max(1,Math.floor(a));e=
Math.max(1,Math.floor(e));if(b.width!==a||b.height!==e)b.width=a,b.height=e,b.uniforms.resolution[0]=a,b.uniforms.resolution[1]=e,b.frameBuffer&&b.frameBuffer.resize(b.width,b.height),b.emit("resize"),b.setDirty();for(e=0;e<b.targets.length;e++)a=b.targets[e],a.resize(),a.setTransformDirty&&a.setTransformDirty()}var b=this;b.resize=a;return{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float top;\nuniform float left;\nuniform float bottom;\nuniform float right;\nvarying vec2 vTexCoord;\nconst vec2 ZERO = vec2(0.0);\nconst vec2 ONE = vec2(1.0);\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 dim = resolution + vec2(right + left, bottom + top);\n\tvec2 scale = dim / resolution;\n\tvec2 offset = vec2(left, bottom) / resolution;\n\tvTexCoord = max(ZERO, (texCoord + offset) / scale);\n}\n";
return b},inputs:{source:{type:"image",uniform:"source",update:a},top:{type:"number",uniform:"top",min:0,step:1,update:a,defaultValue:0},left:{type:"number",uniform:"left",min:0,step:1,update:a,defaultValue:0},bottom:{type:"number",uniform:"bottom",min:0,step:1,update:a,defaultValue:0},right:{type:"number",uniform:"right",min:0,step:1,update:a,defaultValue:0}}}},{inPlace:!0,title:"Crop"})});(function(b,a){if("function"===typeof define&&define.amd)define(["seriously"],a);else if("object"===typeof exports)a(require("seriously"));else{var c=b.Seriously;c||(c={plugin:function(a,b){this[a]=b}});a(c)}})(this,function(b){b.plugin("daltonize",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec3 position;\nattribute vec2 texCoord;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tgl_Position = transform * vec4(position, 1.0);\n\tvTexCoord = vec2(texCoord.s, texCoord.t);\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float cbtype;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tif (cbtype == 0.0) {\n\t\tgl_FragColor = color;\n\t\treturn;\n\t}\n\tconst mat3 RGBLMS = mat3( \t\t17.8824, 43.5161, 4.11935,\t\t3.45565, 27.1554, 3.86714,\t\t0.0299566, 0.184309, 1.46709\t);\n\tvec3 LMS = color.rgb * RGBLMS;\n\tvec3 lms = vec3(0.0,0.0,0.0);\n\tif (cbtype < 0.33) {\n\t\tlms = vec3(\t\t\t\t(2.02344 * LMS.g) + (-2.52581 * LMS.b),\t\t\tLMS.g,\t\t\tLMS.b\t\t);\n\t}\n\tif (cbtype > 0.33 && cbtype < 0.66) {\n\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\t(0.494207 * LMS.r) + (1.24827 * LMS.b),\t\t\tLMS.b\t\t);\n\t}\n\tif (cbtype > 0.66) {\n\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\tLMS.g,\t\t\t(-0.395913 * LMS.r) + (0.801109 * LMS.g)\t\t);\n\t}\n\tconst mat3 LMSRGB = mat3(    \t\t0.0809444479, -0.130504409, 0.116721066,\t\t-0.0102485335, 0.0540193266, -0.113614708,\t\t-0.000365296938, -0.00412161469, 0.693511405\t);\n\tvec3 RGB = lms * LMSRGB;\n\tRGB.rgb = color.rgb - RGB.rgb;\n\tRGB.g = 0.7*RGB.r + RGB.g;\n\tRGB.b = 0.7*RGB.r + RGB.b;\n\tcolor.rgb = color.rgb + RGB.rgb;\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},type:{title:"Type",type:"enum",uniform:"cbtype",defaultValue:"0.2",options:[["0.0","Off"],["0.2","Protanope"],["0.6","Deuteranope"],["0.8","Tritanope"]]}},title:"Daltonize",description:"Add contrast to colours to assist CVD (colour-blind) users."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=[0.2,0.3,0.5,0.8],c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("directionblur",function(d){var e,h,k={amount:0,angle:0,inputScale:1,resolution:[this.width,this.height],transform:c,projection:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};return{initialize:function(a){a();
(a=this.gl)&&(e=[new b.util.FrameBuffer(a,this.width,this.height),new b.util.FrameBuffer(a,this.width,this.height)])},commonShader:!0,shader:function(a,b){var c=this.gl,c=10<=c.getParameter(c.MAX_VARYING_VECTORS)?"#define USE_VARYINGS":"";h=this.baseShader;b.vertex=[c,"precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nuniform float angle;\nuniform float amount;\nuniform float inputScale;\nconst vec2 zero = vec2(0.0, 0.0);\n#ifdef USE_VARYINGS\nvec2 one;\nvec2 amount1;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 one;\nvarying vec2 amount1;\n#endif\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n\tone = vec2(1.0, 1.0) * inputScale;\n\tif (inputScale < 1.0) {\n\t\tone -= 1.0 / resolution;\n\t}\n\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));\n\tamount1 = vec2(cos(angle), sin(angle)) * amount * 5.0 / resolution;\n#ifdef USE_VARYINGS\n\tvec2 amount2 = amount1 * 3.0;\n\tvec2 amount3 = amount1 * 6.0;\n\tvec2 amount4 = amount1 * 9.0;\n\tvec2 amount5 = -amount1;\n\tvec2 amount6 = amount5 * 3.0;\n\tvec2 amount7 = amount5 * 6.0;\n\tvec2 amount8 = amount5 * 9.0;\n\tvTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvTexCoord2 = max(zero, min(one, vTexCoord + amount2));\n\tvTexCoord3 = max(zero, min(one, vTexCoord + amount3));\n\tvTexCoord4 = max(zero, min(one, vTexCoord + amount4));\n\tvTexCoord5 = max(zero, min(one, vTexCoord + amount5));\n\tvTexCoord6 = max(zero, min(one, vTexCoord + amount6));\n\tvTexCoord7 = max(zero, min(one, vTexCoord + amount7));\n\tvTexCoord8 = max(zero, min(one, vTexCoord + amount8));\n#endif\n}"].join("\n");
b.fragment=[c,"precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float angle;\nuniform float amount;\nuniform float inputScale;\n#ifdef USE_VARYINGS\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 amount1;\nvarying vec2 one;\nconst vec2 zero = vec2(0.0, 0.0);\n#endif\nvoid main(void) {\n#ifndef USE_VARYINGS\n\tvec2 vTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvec2 vTexCoord2 = max(zero, min(one, vTexCoord + amount1 * 3.0));\n\tvec2 vTexCoord3 = max(zero, min(one, vTexCoord + amount1 * 6.0));\n\tvec2 vTexCoord4 = max(zero, min(one, vTexCoord + amount1 * 9.0));\n\tvec2 vTexCoord5 = max(zero, min(one, vTexCoord - amount1));\n\tvec2 vTexCoord6 = max(zero, min(one, vTexCoord - amount1 * 3.0));\n\tvec2 vTexCoord7 = max(zero, min(one, vTexCoord - amount1 * 6.0));\n\tvec2 vTexCoord8 = max(zero, min(one, vTexCoord - amount1 * 9.0));\n#endif\n\tgl_FragColor = texture2D(source, vTexCoord) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord1) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord2) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord3) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord4) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord5) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord6) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord7) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord8) / 9.0;\n}"].join("\n");
return b},draw:function(b,c,d,g,l){var q,f,v,y,w,B={width:0,height:0,blend:!1},M=1;if(v=this.inputs.amount)if(0.01>=v)l(b,c,d,g);else{k.amount=v;k.angle=this.inputs.angle;k.projection[0]=this.height/this.width;for(d=0;d<a.length;d++)f=Math.min(1,a[d]/v),y=Math.floor(f*this.width),w=Math.floor(f*this.height),k.source=q?q.texture:this.inputs.source.texture,q=e[d%2],k.inputScale=M,M=f,B.width=y,B.height=w,l(b,c,k,q.frameBuffer,null,B);k.source=q.texture;k.inputScale=M;l(b,c,k,g)}else l(h,c,d,g)},resize:function(){k.resolution[0]=
this.width;k.resolution[1]=this.height;e&&(e[0].resize(this.width,this.height),e[1].resize(this.width,this.height))},destroy:function(){e&&(e[0].destroy(),e[1].destroy(),e=null);h&&h.destroy();k=null}}},{inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:0.4,min:0,max:1},angle:{type:"number",uniform:"angle",defaultValue:0}},title:"Directional Motion Blur"})});(function(b,a){"object"===typeof exports?a(require("seriously")):"function"===typeof define&&define.amd?define(["seriously"],a):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a={wrap:"pos = mod(pos, 1.0);",clamp:"pos = min(max(pos, 0.0), 1.0);",ignore:"pos = texCoordSource;",color:"gl_FragColor = color;\n\treturn;"},c={none:[0,0,0,0],red:[1,0,0,0],green:[0,1,0,0],blue:[0,0,1,0],alpha:[0,0,0,1],luma:[0.2125,0.7154,0.0721,0],lightness:[1/3,1/3,1/
3,0]};b.plugin("displacement",function(){this.uniforms.resMap=[1,1];this.uniforms.resSource=[1,1];this.uniforms.xVector=c.red;this.uniforms.yVector=c.green;return{shader:function(b,c){var h=a[b.fillMode];c.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resSource;\nuniform vec2 resMap;\nvarying vec2 texCoordSource;\nvarying vec2 texCoordMap;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordSource = adjusted / resSource + HALF;\n\ttexCoordMap = adjusted / resMap + HALF;\n}";
c.fragment=["precision mediump float;\n\nvarying vec2 texCoordSource;\nvarying vec2 texCoordMap;\nuniform sampler2D source;\nuniform sampler2D map;\nuniform float amount;\nuniform float offset;\nuniform vec2 mapScale;\nuniform vec4 color;\nuniform vec4 xVector;\nuniform vec4 yVector;\nvoid main(void) {\n\tvec4 mapPixel = texture2D(map, texCoordMap);\n\tvec2 mapVector = vec2(dot(mapPixel, xVector), dot(mapPixel, yVector));\n\tvec2 pos = texCoordSource + (mapVector.xy - offset) * mapScale * amount;\n\tif (pos.x < 0.0 || pos.x > 1.0 || pos.y < 0.0 || pos.y > 1.0) {",
"\t\t"+h,"\t}\n\tgl_FragColor = texture2D(source, pos);\n}"].join("\n");return c},requires:function(a){return this.inputs.mapScale||"map"!==a?!0:!1},resize:function(){var a=this.inputs.source,b=this.inputs.map;a?(this.uniforms.resSource[0]=a.width,this.uniforms.resSource[1]=a.height):(this.uniforms.resSource[0]=1,this.uniforms.resSource[1]=1);b?(this.uniforms.resMap[0]=b.width,this.uniforms.resMap[1]=b.height):(this.uniforms.resMap[0]=1,this.uniforms.resMap[1]=1)}}},{inputs:{source:{type:"image",
uniform:"source"},map:{type:"image",uniform:"map"},xChannel:{type:"enum",defaultValue:"red",options:"red green blue alpha luma lightness none".split(" "),update:function(a){this.uniforms.xVector=c[a]}},yChannel:{type:"enum",defaultValue:"green",options:"red green blue alpha luma lightness none".split(" "),update:function(a){this.uniforms.yVector=c[a]}},fillMode:{type:"enum",shaderDirty:!0,defaultValue:"color",options:["color","wrap","clamp","ignore"]},color:{type:"color",uniform:"color",defaultValue:[0,
0,0,0]},offset:{type:"number",uniform:"offset",defaultValue:0.5},mapScale:{type:"vector",dimensions:2,uniform:"mapScale",defaultValue:[1,1],updateSources:!0},amount:{type:"number",uniform:"amount",defaultValue:1}},title:"Displacement Map",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("dither",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\n#define mod4(a) (a >= 4 ? a - 4 : a)\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nconst mat4 dither = mat4(1.0, 33.0, 9.0, 41.0,49.0, 17.0, 57.0, 25.0,13.0, 45.0, 5.0, 37.0,61.0, 29.0, 53.0, 21.0);\nfloat find_closest(int x, int y, float c0) {\n\tfloat limit = 0.0;\n\tint x4 = mod4(x);\n\tint y4 = mod4(y);\n\tfor (int i = 0; i < 4; i++) {\n\t\tif (i == x4) {\n\t\t\tfor (int j = 0; j < 4; j++) {\n\t\t\t\tif (j == y4) {\n\t\t\t\t\tlimit = dither[i][j];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (x < 4) {\n\t\tif (y >= 4) {\n\t\t\tlimit += 3.0;\n\t\t}\n\t} else {\n\t\tif (y >= 4) {\n\t\t\tlimit += 1.0;\n\t\t} else {\n\t\t\tlimit += 2.0;\n\t\t}\n\t}\n\tlimit /= 65.0;\n\treturn c0 < limit ? 0.0 : 1.0;\n}\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec2 coord = vTexCoord * resolution;\n\tint x = int(mod(coord.x, 8.0));\n\tint y = int(mod(coord.y, 8.0));\n\tpixel.r = find_closest(x, y, pixel.r);\n\tpixel.g = find_closest(x, y, pixel.g);\n\tpixel.b = find_closest(x, y, pixel.b);\n\tgl_FragColor = pixel;\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"}},title:"Dither"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b){var c;for(c=0;c<b.length;c++)b[c]*=a;return b}var c=Math.sqrt,d,e=[],h,k,n;h=[a(1/(2*c(2)),[1,c(2),1,0,0,0,-1,-c(2),-1]),a(1/(2*c(2)),[1,0,-1,c(2),0,-c(2),1,0,-1]),a(1/(2*c(2)),[0,-1,c(2),1,0,-1,-c(2),1,0]),a(1/(2*c(2)),[c(2),-1,0,-1,0,1,0,1,-c(2)]),a(0.5,[0,1,
0,-1,0,-1,0,1,0]),a(0.5,[-1,0,1,0,0,0,1,0,-1]),a(1/6,[1,-2,1,-2,4,-2,1,-2,1]),a(1/6,[-2,1,-2,1,4,1,-2,1,-2]),a(1/3,[1,1,1,1,1,1,1,1,1])];for(c=0;c<h.length;c++)for(d=0;d<h[c].length;d++)e.push(h[c][d]);k=new Float32Array(e);n=new Float32Array([1,2,1,0,0,0,-1,-2,-1,1,0,-1,2,0,-2,1,0,-1]);b.plugin("edge",{initialize:function(a){a();this.uniforms.pixelWidth=1/this.width;this.uniforms.pixelHeight=1/this.height;this.uniforms["G[0]"]="sobel"===this.inputs.mode?n:k},shader:function(a,b){b.fragment=["sobel"===
a.mode?"#define N_MATRICES 2\n#define SOBEL\n":"#define N_MATRICES 9\n","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float pixelWidth;\nuniform float pixelHeight;\nuniform mat3 G[9];\nvoid main(void) {\n\tmat3 I;\n\tfloat dp3, cnv[9];\n\tvec3 tc;\n\tfloat fi = 0.0, fj = 0.0;\n\tfor (int i = 0; i < 3; i++) {\n\t\tfj = 0.0;\n\t\tfor (int j = 0; j < 3; j++) {\n\t\t\tI[i][j] = length( texture2D(source, vTexCoord + vec2((fi - 1.0) * pixelWidth, (fj - 1.0) * pixelHeight)).rgb );\n\t\t\tfj += 1.0;\n\t\t};\n\t\tfi += 1.0;\n\t};\n\tfor (int i = 0; i < N_MATRICES; i++) {\n\t\tdp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n\t\tcnv[i] = dp3 * dp3;\n\t};\n#ifdef SOBEL\n\ttc = vec3(0.5 * sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));\n#else\n\tfloat M = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]);\n\tfloat S = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]) + (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + cnv[8];\n\ttc = vec3(sqrt(M/S));\n#endif\n\tgl_FragColor = vec4(tc, 1.0);\n}"].join("\n");
return b},resize:function(){this.uniforms.pixelWidth=1/this.width;this.uniforms.pixelHeight=1/this.height},inputs:{source:{type:"image",uniform:"source"},mode:{type:"enum",shaderDirty:!0,defaultValue:"sobel",options:[["sobel","Sobel"],["frei-chen","Frei-Chen"]],update:function(){this.uniforms["G[0]"]="sobel"===this.inputs.mode?n:k}}},description:"Edge Detect",title:"Edge Detect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("emboss",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 offset = 1.0 / resolution;\n\tvTexCoord1 = texCoord - offset;\n\tvTexCoord2 = texCoord + offset;\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nuniform sampler2D source;\nuniform float amount;\nconst vec3 average = vec3(1.0 / 3.0);\nvoid main (void)  {\n\tvec4 pixel = vec4(0.5, 0.5, 0.5, 1.0);\n\tpixel -= texture2D(source, vTexCoord1) * amount;\n\tpixel += texture2D(source, vTexCoord2) * amount;\n\tpixel.rgb = vec3(dot(pixel.rgb, average));\n\tgl_FragColor = pixel;\n}";return b},inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",
defaultValue:1,min:-85,max:85}},title:"Emboss",categories:[],description:"Emboss"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("exposure",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float exposure;\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(pow(2.0, exposure) * pixel.rgb, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},exposure:{type:"number",uniform:"exposure",defaultValue:1,min:-8,max:8}},title:"Exposure",categories:["film"],description:"Exposure control"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("fader",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 color;\nuniform float amount;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor = mix(gl_FragColor, color, amount);\n}";
return b},requires:function(a,b){return 1>b.amount},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},color:{type:"color",uniform:"color",defaultValue:[0,0,0,1]},amount:{type:"number",uniform:"amount",defaultValue:0.5,min:0,max:1}},title:"Fader",description:"Fade image to a color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("falsecolor",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nuniform vec4 black;\nuniform vec4 white;\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luminance = dot(pixel.rgb, luma);\n\tvec4 result = mix(black, white, luminance);\n\tgl_FragColor = vec4(result.rgb, pixel.a * result.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},black:{type:"color",uniform:"black",defaultValue:[0,0,0.5,1]},white:{type:"color",uniform:"white",defaultValue:[1,0,0,1]}},title:"False Color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("filmgrain",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform float time;\nuniform float amount;\nuniform bool colored;\nfloat timer;\nconst float permTexUnit = 1.0/256.0;\nconst float permTexUnitHalf = 0.5/256.0;\nvec4 rnm(in vec2 tc) {\n\tfloat noise = sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;\n\tfloat noiseR = fract(noise)*2.0-1.0;\n\tfloat noiseG = fract(noise*1.2154)*2.0-1.0; \n\tfloat noiseB = fract(noise*1.3453)*2.0-1.0;\n\tfloat noiseA = fract(noise*1.3647)*2.0-1.0;\n\t\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\nfloat fade(in float t) {\n\treturn t*t*t*(t*(t*6.0-15.0)+10.0);\n}\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = permTexUnit*floor(p)+permTexUnitHalf;\n\tvec3 pf = fract(p);\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3 grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3 grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;\n\tvec3 grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3 grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\tfloat perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;\n\tvec3 grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3 grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\tfloat perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;\n\tvec3 grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3 grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\treturn n_xyz;\n}\nvoid main(void) {\n\ttimer = mod(time, 10000.0) / 10000.0;\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 noise = vec3(pnoise3D(vec3(vTexCoord * resolution, timer + 0.0)));\n\tif (colored) {\n\t\tnoise.g = pnoise3D(vec3(vTexCoord * resolution, timer + 1.0));\n\t\tnoise.b = pnoise3D(vec3(vTexCoord * resolution, timer + 2.0));\n\t}\n\tgl_FragColor = vec4(pixel.rgb + noise * amount, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",uniform:"time"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:0.03},colored:{type:"boolean",uniform:"colored",defaultValue:!1}},title:"Film Grain",description:"Don't over-do it."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("freeze",{draw:function(a,b,d,e,h){this.inputs.frozen||h(a,b,d,e)},requires:function(){return!this.inputs.frozen},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},frozen:{type:"boolean",defaultValue:!1,updateSources:!0}},title:"Freeze",description:"Freeze Frame"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("fxaa",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordNW;\nvarying vec2 vTexCoordNE;\nvarying vec2 vTexCoordSW;\nvarying vec2 vTexCoordSE;\nconst vec2 diag = vec2(1.0, -1.0);\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tvec2 invRes = 1.0 / resolution;\n\tvTexCoordNW = texCoord - invRes;\n\tvTexCoordNE = texCoord + invRes * diag;\n\tvTexCoordSW = texCoord - invRes * diag;\n\tvTexCoordSE = texCoord + invRes;\n}\n";
b.fragment="precision mediump float;\n#define FXAA_REDUCE_MIN (1.0 / 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordNW;\nvarying vec2 vTexCoordNE;\nvarying vec2 vTexCoordSW;\nvarying vec2 vTexCoordSE;\nuniform vec2 resolution;\nuniform sampler2D source;\nconst vec3 luma = vec3(0.299, 0.587, 0.114);\nvoid main(void) {\n\tvec4 original = texture2D(source, vTexCoord);\n\tvec3 rgbNW = texture2D(source, vTexCoordNW).rgb;\n\tvec3 rgbNE = texture2D(source, vTexCoordNE).rgb;\n\tvec3 rgbSW = texture2D(source, vTexCoordSW).rgb;\n\tvec3 rgbSE = texture2D(source, vTexCoordSE).rgb;\n\tfloat lumaNW = dot(rgbNW, luma);\n\tfloat lumaNE = dot(rgbNE, luma);\n\tfloat lumaSW = dot(rgbSW, luma);\n\tfloat lumaSE = dot(rgbSE, luma);\n\tfloat lumaM = dot(original.rgb, luma);\n\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * 0.25 * FXAA_REDUCE_MUL, FXAA_REDUCE_MIN);\n\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n\tdir = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX), dir * rcpDirMin)) / resolution;\n\tvec3 rgbA = 0.5 * (\n\t\ttexture2D(source, vTexCoord + dir * (1.0 / 3.0 - 0.5)).rgb +\n\t\ttexture2D(source, vTexCoord + dir * (2.0 / 3.0 - 0.5)).rgb);\n\tvec3 rgbB = rgbA * 0.5 + 0.25 * (\n\t\ttexture2D(source, vTexCoord - dir * 0.5).rgb +\n\t\ttexture2D(source, vTexCoord + dir * 0.5).rgb);\n\tfloat lumaB = dot(rgbB, luma);\n\tif (lumaB < lumaMin || lumaB > lumaMax) {\n\t\tgl_FragColor = vec4(rgbA, original.a);\n\t} else {\n\t\tgl_FragColor = vec4(rgbB, original.a);\n\t}\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"FXAA",description:"Fast approximate anti-aliasing"})});(function(b,a){"object"===typeof exports?a(require("seriously")):"function"===typeof define&&define.amd?define(["seriously"],a):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("gradientwipe",function(){this.uniforms.resGradient=[1,1];this.uniforms.resSource=[1,1];return{shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resSource;\nuniform vec2 resGradient;\nvarying vec2 texCoordSource;\nvarying vec2 texCoordGradient;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordSource = adjusted / resSource + HALF;\n\ttexCoordGradient = adjusted / resGradient + HALF;\n}";
b.fragment="precision mediump float;\n\nvarying vec2 texCoordSource;\nvarying vec2 texCoordGradient;\nuniform sampler2D source;\nuniform sampler2D gradient;\nuniform float transition;\nuniform float smoothness;\nuniform bool invert;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main(void) {\n\tfloat gradientVal = 1.0 - dot(texture2D(gradient, texCoordGradient).rgb, lumcoeff);\n\tif (invert) {\n\t\tgradientVal = 1.0 - gradientVal;\n\t}\n\tfloat amount = 1.0 - transition;\n\tfloat mn = (amount - smoothness * (1.0 - amount));\n\tfloat mx = (amount + smoothness * amount);\n\tif (gradientVal <= mn) {\n\t\tgl_FragColor = texture2D(source, texCoordSource);\n\t\treturn;\n\t}\n\tif (gradientVal >= mx) {\n\t\tgl_FragColor = vec4(0.0);\n\t\treturn;\n\t}\n\tfloat alpha = mix(1.0, 0.0, smoothstep(mn, mx, gradientVal));\n\tvec4 pixel = texture2D(source, texCoordSource);\n\tgl_FragColor = vec4(pixel.rgb, pixel.a * alpha);\n}";
return b},draw:function(a,b,d,e,h){0>=d.transition?h(this.baseShader,b,d,e):1<=d.transition?(a=this.gl,a.viewport(0,0,this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,e),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):h(a,b,d,e)},inPlace:!1,requires:function(a,b){return"source"===a&&1<=b.transition||"gradient"===a&&(0>=b.transition||1<=b.transition)?!1:!0},resize:function(){var a=this.inputs.source,b=this.inputs.gradient;a?(this.uniforms.resSource[0]=a.width,this.uniforms.resSource[1]=
a.height):(this.uniforms.resSource[0]=1,this.uniforms.resSource[1]=1);b?(this.uniforms.resGradient[0]=b.width,this.uniforms.resGradient[1]=b.height):(this.uniforms.resGradient[0]=1,this.uniforms.resGradient[1]=1)}}},{inputs:{source:{type:"image",uniform:"source"},gradient:{type:"image",uniform:"gradient"},transition:{type:"number",uniform:"transition",defaultValue:0},invert:{type:"boolean",uniform:"invert",defaultValue:!1},smoothness:{type:"number",uniform:"smoothness",defaultValue:0,min:0,max:1}},
title:"Gradient Wipe"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("hex",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform vec2 center;\nuniform float size;\nvoid main(void) {\n\tvec2 aspect = normalize(resolution);\n\tvec2 tex = (vTexCoord * aspect - center) / size;\n\ttex.y /= 0.866025404;\n\ttex.x -= tex.y * 0.5;\n\tvec2 a;\n\tif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n\t\ta = vec2(floor(tex.x), floor(tex.y));\n\t} else {\n\t\ta = vec2(ceil(tex.x), ceil(tex.y));\n\t}\n\tvec2 b = vec2(ceil(tex.x), floor(tex.y));\n\tvec2 c = vec2(floor(tex.x), ceil(tex.y));\n\tvec3 tex3 = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n\tvec3 a3 = vec3(a.x, a.y, 1.0 - a.x - a.y);\n\tvec3 b3 = vec3(b.x, b.y, 1.0 - b.x - b.y);\n\tvec3 c3 = vec3(c.x, c.y, 1.0 - c.x - c.y);\n\tfloat alen =length(tex3 - a3);\n\tfloat blen =length(tex3 - b3);\n\tfloat clen =length(tex3 - c3);\n\tvec2 choice;\n\tif (alen < blen) {\n\t\tif (alen < clen) {\n\t\t\tchoice = a;\n\t\t} else {\n\t\t\tchoice = c;\n\t\t}\n\t} else {\n\t\tif (blen < clen) {\n\t\t\tchoice = b;\n\t\t} else {\n\t\t\tchoice = c;\n\t\t}\n\t}\n\tchoice.x += choice.y * 0.5;\n\tchoice.y *= 0.866025404;\n\tchoice *= size / aspect;\n\tgl_FragColor = texture2D(source, choice + center / aspect);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},size:{type:"number",uniform:"size",min:0,max:0.4,defaultValue:0.01},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0,0]}},title:"Hex",description:"Hexagonal Pixelate"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("highlights-shadows",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float shadows;\nuniform float highlights;\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luminance = dot(pixel.rgb, luma);\n\tfloat shadow = clamp((pow(luminance, 1.0 / (shadows + 1.0)) + (-0.76) * pow(luminance, 2.0 / (shadows + 1.0))) - luminance, 0.0, 1.0);\n\tfloat highlight = clamp((1.0 - (pow(1.0 - luminance, 1.0 / (2.0 - highlights)) + (-0.8) * pow(1.0 - luminance, 2.0 / (2.0 - highlights)))) - luminance, -1.0, 0.0);\n\tvec3 rgb = (luminance + shadow + highlight) * (pixel.rgb / vec3(luminance));\n\tgl_FragColor = vec4(rgb, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},highlights:{type:"number",uniform:"highlights",min:0,max:1,defaultValue:1},shadows:{type:"number",uniform:"shadows",min:0,max:1,defaultValue:0}},title:"Highlights/Shadows",description:"Darken highlights, lighten shadows"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("hue-saturation",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 transform;\nuniform float hue;\nuniform float saturation;\nvarying vec2 vTexCoord;\nvarying vec3 weights;\nvoid main(void) {\n\tfloat angle = hue * 3.14159265358979323846264;\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\tweights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec3 weights;\nuniform sampler2D source;\nuniform float hue;\nuniform float saturation;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tfloat len = length(color.rgb);\n\tcolor.rgb = vec3(dot(color.rgb, weights.xyz), dot(color.rgb, weights.zxy), dot(color.rgb, weights.yzx) );\n\tvec3 adjustment = (color.r + color.g + color.b) / 3.0 - color.rgb;\n\tif (saturation > 0.0) {\n\t\tadjustment *= (1.0 - 1.0 / (1.0 - saturation));\n\t} else {\n\t\tadjustment *= (-saturation);\n\t}\n\tcolor.rgb += adjustment;\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hue:{type:"number",uniform:"hue",defaultValue:0.4,min:-1,max:1},saturation:{type:"number",uniform:"saturation",defaultValue:0,min:-1,max:1}},title:"Hue/Saturation",description:"Rotate hue and multiply saturation."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("invert",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(1.0 - gl_FragColor.rgb, gl_FragColor.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Invert",description:"Invert image color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("kaleidoscope",{commonShader:!0,shader:function(a,b){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float segments;\nuniform float offset;","const float PI = "+Math.PI+";","const float TAU = 2.0 * PI;\nvoid main(void) {\n\tif (segments == 0.0) {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n\t} else {\n\t\tvec2 centered = vTexCoord - 0.5;\n\t\tfloat r = length(centered);\n\t\tfloat theta = atan(centered.y, centered.x);\n\t\ttheta = mod(theta, TAU / segments);\n\t\ttheta = abs(theta - PI / segments);\n\t\tvec2 newCoords = r * vec2(cos(theta), sin(theta)) + 0.5;\n\t\tgl_FragColor = texture2D(source, mod(newCoords - offset, 1.0));\n\t}\n}"].join("\n");
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},segments:{type:"number",uniform:"segments",defaultValue:6},offset:{type:"number",uniform:"offset",defaultValue:0}},title:"Kaleidoscope"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),c=/\d+/;b.plugin("layers",function(b){function e(){k.resize()}var h,k=this,n={clear:!1},r;"number"===typeof b&&2<=b?h=b:(h=b&&b.count||4,h=Math.max(2,h));r={sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection"],
update:function(){this.resize()}}};for(b=0;b<h;b++)r.sizeMode.options.push(b.toString()),r.sizeMode.options.push("source"+b),r["source"+b]={type:"image",update:e},r["opacity"+b]={type:"number",defaultValue:1,min:0,max:1,updateSources:!0};this.uniforms.layerResolution=[1,1];this.resize=function(){var a,b;a=this.inputs.sizeMode;var d,e;if("union"===a)for(d=b=a=0;d<h;d++){if(e=this.inputs["source"+d])a=Math.max(a,e.width),b=Math.max(b,e.height)}else if("intersection"===a)for(b=a=Infinity,d=0;d<h;d++){if(e=
this.inputs["source"+d])a=Math.min(a,e.width),b=Math.min(b,e.height)}else if(b=a=1,d=h-1,(e=c.exec(this.inputs.sizeMode))&&(d=Math.min(parseInt(e[0],10),d)),e=this.inputs["source"+d])a=e.width,b=e.height;if(this.width!==a||this.height!==b)for(this.width=a,this.height=b,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b,this.frameBuffer&&this.frameBuffer.resize(a,b),this.emit("resize"),this.setDirty(),d=0;d<this.targets.length;d++)this.targets[d].resize()};return{initialize:function(a){var b=
this.gl;a();n.blendEquation=b.FUNC_ADD;n.srcRGB=b.SRC_ALPHA;n.dstRGB=b.ONE_MINUS_SRC_ALPHA;n.srcAlpha=b.SRC_ALPHA;n.dstAlpha=b.DST_ALPHA},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 layerResolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * layerResolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / layerResolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (layerResolution.x / layerResolution.y);\n\tgl_Position.xy *= layerResolution / resolution;\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float opacity;\nvoid main(void) {\n\tif (any(lessThan(vTexCoord, vec2(0.0))) || any(greaterThanEqual(vTexCoord, vec2(1.0)))) {\n\t\tgl_FragColor = vec4(0.0);\n\t} else {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n\t\tgl_FragColor *= opacity;\n\t}\n}";return b},requires:function(a,b){var d,e=h;(d=c.exec(this.inputs.sizeMode))&&(e=parseInt(d[0],10));return e>=h?!1:!(!b[a]||!b["opacity"+e])},draw:function(b,
c,d,e,f){var k,r,w;k=this.gl;k.viewport(0,0,this.width,this.height);k.bindFramebuffer(k.FRAMEBUFFER,e);k.clearColor(0,0,0,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);for(k=0;k<h;k++)w=this.inputs["source"+k],r=this.inputs["opacity"+k],w&&r&&(d.opacity=r,d.layerResolution[0]=w.width,d.layerResolution[1]=w.height,d.source=w,d.transform=w.cumulativeMatrix||a,f(b,c,d,e,null,n))},inputs:r}},{inPlace:!0,description:"Multiple layers",title:"Layers"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("linear-transfer",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 slope;\nuniform vec4 intercept;\nconst vec3 half3 = vec3(0.5);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = pixel * slope + intercept;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},slope:{type:"vector",dimensions:4,uniform:"slope",defaultValue:[1,1,1,1]},intercept:{type:"vector",uniform:"intercept",dimensions:4,defaultValue:[0,0,0,0]}},title:"Linear Transfer",description:"For each color channel: [slope] * [value] + [intercept]"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("lumakey",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float threshold;\nuniform float clipBlack;\nuniform float clipWhite;\nuniform bool invert;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luma = dot(pixel.rgb,lumcoeff);\n\tfloat alpha = 1.0 - smoothstep(clipBlack, clipWhite, luma);\n\tif (invert) alpha = 1.0 - alpha;\n\tgl_FragColor = vec4(pixel.rgb, min(pixel.a, alpha) );\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0.9,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},invert:{type:"boolean",uniform:"invert",defaultValue:!1}},title:"Luma Key",categories:["key"],description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("mirror",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nuniform vec2 resolution;\nuniform sampler2D source;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vec2(0.5 - abs(0.5 - vTexCoord.x), vTexCoord.y));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Mirror",description:"Shader Mirror Effect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("nightvision",{commonShader:!0,shader:function(a,b,d){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float timer;\nuniform float luminanceThreshold;\nuniform float amplification;\nuniform vec3 nightVisionColor;",d.shader.makeNoise,
"void main(void) {\n\tvec3 noise = vec3(makeNoise(vTexCoord.x, vTexCoord.y, timer), makeNoise(vTexCoord.x, vTexCoord.y, timer * 200.0 + 1.0), makeNoise(vTexCoord.x, vTexCoord.y, timer * 100.0 + 3.0));\n\tvec4 pixel = texture2D(source, vTexCoord + noise.xy * 0.0025);\n\tfloat luminance = dot(vec3(0.299, 0.587, 0.114), pixel.rgb);\n\tpixel.rgb *= step(luminanceThreshold, luminance) * amplification;\n\tgl_FragColor = vec4( (pixel.rgb + noise * 0.1) * nightVisionColor, pixel.a);\n}"].join("\n");return b},
inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},timer:{type:"number",uniform:"timer",defaultValue:0},luminanceThreshold:{type:"number",uniform:"luminanceThreshold",defaultValue:0.1,min:0,max:1},amplification:{type:"number",uniform:"amplification",defaultValue:1.4,min:0},color:{type:"color",uniform:"nightVisionColor",defaultValue:[0.1,0.95,0.2]}},title:"Night Vision",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("noise",{shader:function(a,b,d){d=["precision mediump float;","#define Blend(base, blend, funcf)\t\tvec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))","#define BlendOverlayf(base, blend) (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))",
"#define BlendOverlay(base, blend)\t\tBlend(base, blend, BlendOverlayf)","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","uniform float amount;","uniform float timer;",d.shader.noiseHelpers,d.shader.snoise3d,d.shader.random,"void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat r = random(vec2(timer * vTexCoord.xy));","\tfloat noise = snoise(vec3(vTexCoord * (1024.4 + r * 512.0), timer)) * 0.5;"];a.overlay?(d.push("\tvec3 overlay = BlendOverlay(pixel.rgb, vec3(noise));"),
d.push("\tpixel.rgb = mix(pixel.rgb, overlay, amount);")):d.push("\tpixel.rgb += noise * amount;");d.push("\tgl_FragColor = pixel;}");b.fragment=d.join("\n");return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},overlay:{type:"boolean",shaderDirty:!0,defaultValue:!0},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:1},timer:{type:"number",uniform:"timer",defaultValue:0,step:1}},title:"Noise",description:"Add noise"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("panorama",function(){function a(){b.resize()}var b=this;this.resize=function(){var a=this.width,e=this.height,h=b.inputs.source;this.source?(a=this.source.width,e=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,e=this.sources.source.height):
e=a=1;b.inputs.width?(a=b.inputs.width,b.inputs.height?e=b.inputs.height:h&&(e=a*h.height/h.width)):b.inputs.height&&(e=b.inputs.height,h&&(a=e*h.width/h.height));a=Math.floor(a);e=Math.floor(e);h&&(this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=e);if(this.width!==a||this.height!==e)this.width=a,this.height=e,this.frameBuffer&&this.frameBuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)this.targets[a].resize()};return{shader:function(a,
b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D source;\nuniform float fov;\nuniform float yaw;\nuniform float pitch;\nconst float M_PI = 3.141592653589793238462643;\nconst float M_TWOPI = 6.283185307179586476925286;\nmat3 rotationMatrix(vec2 euler) {\n\tvec2 se = sin(euler);\n\tvec2 ce = cos(euler);\n\treturn mat3(ce.x, 0, -se.x, 0, 1, 0, se.x, 0, ce.x) * \n\t\t\tmat3(1, 0, 0, 0, ce.y, -se.y, 0, se.y, ce.y);\n}\nvec3 toCartesian( vec2 st ) {\n\treturn normalize(vec3(st.x, st.y, 0.5 / tan(0.5 * radians(fov))));\n}\nvec2 toSpherical(vec3 cartesianCoord) {\n\tvec2 st = vec2(\n\t\tatan(cartesianCoord.x, cartesianCoord.z),\n\t\tacos(cartesianCoord.y)\n\t);\n\tif(st.x < 0.0)\n\t\tst.x += M_TWOPI;\n\treturn st;\n}\nvoid main(void) {\n\tvec2 sphericalCoord = gl_FragCoord.xy / resolution - vec2(0.5);\n\tsphericalCoord.y *= -resolution.y / resolution.x;\n\tvec3 cartesianCoord = rotationMatrix(radians(vec2(yaw + 180., -pitch))) * toCartesian(sphericalCoord);\n\tgl_FragColor = texture2D(source, toSpherical( cartesianCoord )/vec2(M_TWOPI, M_PI));\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360},yaw:{type:"number",uniform:"yaw",min:0,max:360,defaultValue:0},fov:{type:"number",uniform:"fov",min:0,max:180,defaultValue:80},pitch:{type:"number",uniform:"pitch",min:-90,max:90,defaultValue:0}}}},{commonShader:!0,title:"Panorama"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("pixelate",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform vec2 pixelSize;\nvoid main(void) {\n\tvec2 delta = pixelSize / resolution;\n\tgl_FragColor = texture2D(source, delta * floor(vTexCoord / delta));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},pixelSize:{type:"vector",dimensions:2,defaultValue:[8,8],min:0,uniform:"pixelSize"}},title:"Pixelate"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("polar",{commonShader:!0,shader:function(a,b){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float angle;","const float PI = "+Math.PI+";","void main(void) {\n\tvec2 norm = (1.0 - vTexCoord) * 2.0 - 1.0;\n\tfloat theta = mod(PI + atan(norm.x, norm.y) - angle * (PI / 180.0), PI * 2.0);\n\tvec2 polar = vec2(theta / (2.0 * PI), length(norm));\n\tgl_FragColor = texture2D(source, polar);\n}"].join("\n");
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},angle:{type:"number",uniform:"angle",defaultValue:0}},title:"Polar Coordinates",description:"Convert cartesian to polar coordinates"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("ripple",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float wave;\nuniform float distortion;\nuniform vec2 center;\nvoid main(void) {\n\tfloat scalar = abs(1.0 - abs(distance(vTexCoord, center)));\n\tfloat sinOffset = sin(wave / scalar);\n\tsinOffset = clamp(sinOffset, 0.0, 1.0);\n\tfloat sinSign = cos(wave / scalar);\n\tsinOffset = sinOffset * distortion / 32.0;\n\tgl_FragColor = texture2D(source, vTexCoord + sinOffset * sinSign);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},wave:{type:"number",uniform:"wave",defaultValue:Math.PI/0.75},distortion:{type:"number",uniform:"distortion",defaultValue:1},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0.5,0.5]}},title:"Ripple Distortion",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("scanlines",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float lines;\nuniform float width;\nuniform float intensity;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat darken = 2.0 * abs( fract(vTexCoord.y * lines / 2.0) - 0.5);\n\tdarken = clamp(darken - width + 0.5, 0.0, 1.0);\n\tdarken = 1.0 - ((1.0 - darken) * intensity);\n\tgl_FragColor = vec4(pixel.rgb * darken, 1.0);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},lines:{type:"number",uniform:"lines",defaultValue:60},size:{type:"number",uniform:"size",defaultValue:0.2,min:0,max:1},intensity:{type:"number",uniform:"intensity",defaultValue:0.1,min:0,max:1}},title:"Scan Lines",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=/\d+/;b.plugin("select",function(b){function d(){k.resize()}function e(){var a;a=k.inputs["source"+k.inputs.active];k.texture=a&&a.texture;d()}var h,k=this,n;"number"===typeof b&&2<=b?h=b:(h=b&&b.count||4,h=Math.max(2,h));n={active:{type:"number",step:1,min:0,max:h-1,defaultValue:0,
update:e,updateSources:!0},sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection","active"],update:d}};for(b=0;b<h;b++)n.sizeMode.options.push(b.toString()),n.sizeMode.options.push("source"+b),n["source"+b]={type:"image",update:e};this.uniforms.layerResolution=[1,1];this.resize=function(){var b,c;b=this.inputs.sizeMode;var d,e,k;if("union"===b)for(d=c=b=0;d<h;d++){if(k=this.inputs["source"+d])b=Math.max(b,k.width),c=Math.max(c,k.height)}else if("intersection"===b)for(c=b=Infinity,
d=0;d<h;d++){if(k=this.inputs["source"+d])b=Math.min(b,k.width),c=Math.min(c,k.height)}else if("active"===b)d=this.inputs.active,k=this.inputs["source"+d],b=Math.max(1,k&&k.width||1),c=Math.max(1,k&&k.height||1);else for(c=b=1,e=h-1,(d=a.exec(this.inputs.sizeMode))&&(e=Math.min(parseInt(d[0],10),e)),d=0;d<=e;d++)if(k=this.inputs["source"+d]){b=k.width;c=k.height;break}if(this.width!==b||this.height!==c)this.width=b,this.height=c,this.emit("resize"),this.setDirty();for(d=0;d<this.targets.length;d++)this.targets[d].resize()};
return{initialize:function(){this.initialized=!0;this.shaderDirty=!1},requires:function(a){return!(!this.inputs[a]||a!=="source"+this.inputs.active)},draw:function(){var a;a=k.inputs["source"+k.inputs.active];k.texture=a&&a.texture},inputs:n}},{title:"Select",description:"Select a single source image from a list of source nodes.",inPlace:!1,commonShader:!0})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("sepia",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\nconst mat4 coeff = mat4(0.393, 0.349, 0.272, 1.0,0.796, 0.686, 0.534, 1.0, 0.189, 0.168, 0.131, 1.0, 0.0, 0.0, 0.0, 1.0 );\nvoid main(void) {\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tgl_FragColor = coeff * sourcePixel;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Sepia",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("simplex",function(){function a(){b.resize()}var b=this;return{shader:function(a,b,c){function k(a){return 0===a-Math.floor(a)?a+".0":a}var n=1,r=1,p=0;b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform float amount;\nuniform vec2 noiseScale;\nuniform vec2 noiseOffset;\nuniform float time;\nuniform vec4 black;\nuniform vec4 white;",
c.shader.noiseHelpers,c.shader.snoise3d,"void main(void) {\n\tfloat total = 0.0;\n\tvec3 pos = vec3(vTexCoord.xy * noiseScale + noiseOffset, time);"].join("\n");for(c=0;c<a.octaves;c++)n=Math.pow(2,c),r=Math.pow(a.persistence,c),p+=r,b.fragment+="\ttotal += snoise(pos * "+k(n)+") * "+k(r)+";\n";b.fragment+=["\ttotal *= amount / "+k(p)+";","\ttotal = (total + 1.0)/ 2.0;\n\tgl_FragColor = mix(black, white, total);\n}"].join("\n");return b},inputs:{noiseScale:{type:"vector",dimensions:2,uniform:"noiseScale",
defaultValue:[1,1]},noiseOffset:{type:"vector",dimensions:2,uniform:"noiseOffset",defaultValue:[0,0]},octaves:{type:"number",shaderDirty:!0,min:1,max:8,step:1,defaultValue:1},persistence:{type:"number",defaultValue:0.5,min:0,max:0.5},amount:{type:"number",uniform:"amount",min:0,defaultValue:1},time:{type:"number",uniform:"time",defaultValue:0},width:{type:"number",min:0,step:1,update:a,defaultValue:0},height:{type:"number",min:0,step:1,update:a,defaultValue:0},black:{type:"color",uniform:"black",
defaultValue:[0,0,0,1]},white:{type:"color",uniform:"white",defaultValue:[1,1,1,1]}}}},{title:"Simplex Noise",description:"Generate Simplex Noise"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("sketch",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nfloat res = resolution.x;\nfloat n0 = 97.0 / res;\nfloat n1 = 15.0 / res;\nfloat n2 = 97.0 / res;\nfloat n3 = 9.7 / res;\nfloat total = n2 + ( 4.0 * n0 ) + ( 4.0 * n1 );\nconst vec3 div3 = vec3(1.0 / 3.0);\nvoid main(void) {\n\tfloat offset, temp1, temp2;\n\tvec4 m, p0, p1, p2, p3, p4, p5, p6, p7, p8;\n\toffset = n3;\n\tp0=texture2D(source,vTexCoord);\n\tp1=texture2D(source,vTexCoord+vec2(-offset,-offset));\n\tp2=texture2D(source,vTexCoord+vec2( offset,-offset));\n\tp3=texture2D(source,vTexCoord+vec2( offset, offset));\n\tp4=texture2D(source,vTexCoord+vec2(-offset, offset));\n\toffset=n3*2.0;\n\tp5=texture2D(source,vTexCoord+vec2(-offset,-offset));\n\tp6=texture2D(source,vTexCoord+vec2( offset,-offset));\n\tp7=texture2D(source,vTexCoord+vec2( offset, offset));\n\tp8=texture2D(source,vTexCoord+vec2(-offset, offset));\n\tm = (p0 * n2 + (p1 + p2 + p3 + p4) * n0 + (p5 + p6 + p7 + p8) * n1) / total;\n\ttemp1 = dot(p0.rgb, div3);\n\ttemp2 = dot(m.rgb, div3);\n\tif (temp2 <= 0.0005) {\n\t\tgl_FragColor = vec4( 1.0, 1.0, 1.0, p0.a);\n\t} else {\n\t\tgl_FragColor = vec4( vec3(min(temp1 / temp2, 1.0)), p0.a);\n\t}\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Sketch",description:"Pencil/charcoal sketch"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("split",function(){var a,b=[1,1],d=[1,1];this.resize=function(){var a,h;a=this.inputs.sizeMode;var k;k=this.inputs.sourceA;var n=this.inputs.sourceB;"a"===a||"b"===a?(h="a"===a?k:n)?(a=h.width,h=h.height):h=a=1:k?n?(h="union"===a?Math.max:Math.min,a=h(k.width,n.width),
h=h(k.height,n.height)):(a=k.width,h=k.height):n?(a=n.width,h=n.height):h=a=1;if(this.width!==a||this.height!==h)this.width=a,this.height=h,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=h,this.frameBuffer&&this.frameBuffer.resize(a,h),this.emit("resize"),this.setDirty();k&&(b[0]=k.width,b[1]=k.height);n&&(d[0]=n.width,d[1]=n.height);for(k=0;k<this.targets.length;k++)this.targets[k].resize()};return{initialize:function(e){e();this.uniforms.resolutionA=b;this.uniforms.resolutionB=d;a=this.baseShader},
commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\nuniform mat4 projection;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nuniform float angle;\nvarying float c;\nvarying float s;\nvarying float t;\nvoid main(void) {\n   c = cos(angle);\n   s = sin(angle);\n\tt = abs(c + s);\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 adjustedTexCoord = (texCoord - 0.5) * resolution;\n\tvTexCoordA = adjustedTexCoord / resolutionA + 0.5;\n\tvTexCoordB = adjustedTexCoord / resolutionB + 0.5;\n\tvTexCoord = texCoord;\n}";
b.fragment="precision mediump float;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying float c;\nvarying float s;\nvarying float t;\nuniform sampler2D sourceA;\nuniform sampler2D sourceB;\nuniform float split;\nuniform float angle;\nuniform float fuzzy;\nvec4 textureLookup(sampler2D tex, vec2 texCoord) {\n\tif (any(lessThan(texCoord, vec2(0.0))) || any(greaterThan(texCoord, vec2(1.0)))) {\n\t\treturn vec4(0.0);\n\t} else {\n\t\treturn texture2D(tex, texCoord);\n\t}\n}\nvoid main(void) {\n\tvec4 pixel1 = textureLookup(sourceA, vTexCoordA);\n\tvec4 pixel2 = textureLookup(sourceB, vTexCoordB);\n\tfloat mn = (split - fuzzy * (1.0 - split));\n\tfloat mx = (split + fuzzy * split);;\n\tvec2 coords = vTexCoord - vec2(0.5);\n\tcoords = vec2(coords.x * c - coords.y * s, coords.x * s + coords.y * c);\n\tfloat scale = max(abs(c - s), abs(s + c));\n\tcoords /= scale;\n\tcoords += vec2(0.5);\n\tfloat x = coords.x;;\n\tgl_FragColor = mix(pixel2, pixel1, smoothstep(mn, mx, x));\n}";
return b},draw:function(b,c,d,n,r){1<=d.split?(d.source=d.sourceB,r(a,c,d,n)):0>=d.split?(d.source=d.sourceA,r(a,c,d,n)):r(b,c,d,n)},inPlace:!1,requires:function(a,b){return"sourceA"===a&&1<=b.split||"sourceB"===a&&0>=b.split?!1:!0}}},{inputs:{sourceA:{type:"image",uniform:"sourceA",shaderDirty:!1,update:function(){this.resize()}},sourceB:{type:"image",uniform:"sourceB",shaderDirty:!1,update:function(){this.resize()}},sizeMode:{type:"enum",defaultValue:"a",options:["a","b","union","intersection"],
update:function(){this.resize()}},split:{type:"number",uniform:"split",defaultValue:0.5,min:0,max:1,updateSources:!0},angle:{type:"number",uniform:"angle",defaultValue:0},fuzzy:{type:"number",uniform:"fuzzy",defaultValue:0,min:0,max:1}},description:"Split screen or wipe",title:"Split"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("throttle",function(){var a=0;return{draw:function(b,d,e,h,k){this.inputs.frameRate&&Date.now()-a>=1E3/this.inputs.frameRate&&(k(b,d,e,h),a=Date.now())},requires:function(b,d){return d.frameRate&&Date.now()-a>=1E3/d.frameRate?!0:!1}}},{inPlace:!0,commonShader:!0,title:"Throttle",
description:"Throttle frame rate",inputs:{source:{type:"image",uniform:"source"},frameRate:{type:"number",uniform:"opacity",defaultValue:15,min:0}}})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("tone",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main(void) {\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tvec3 sceneColor = light.rgb * sourcePixel.rgb;\n\tvec3 gray = vec3(dot(lumcoeff, sceneColor));\n\tvec3 muted = mix(sceneColor, gray, desat);\n\tvec3 tonedColor = mix(dark.rgb, light.rgb, gray);\n\tgl_FragColor = vec4(mix(muted, tonedColor, toned), sourcePixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},light:{type:"color",uniform:"light",defaultValue:[1,0.9,0.5,1]},dark:{type:"color",uniform:"dark",defaultValue:[0.2,0.05,0,1]},toned:{type:"number",uniform:"toned",defaultValue:1,minimumRange:0,maximumRange:1},desat:{type:"number",uniform:"desat",defaultValue:0.5,minimumRange:0,maximumRange:1}},title:"Tone",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("tvglitch",function(){var a,c,d,e,h,k;return{initialize:function(c){var r,p,g,l;k=this.gl;a=this.height;l=[];p=0.3-0.02;g=0.8-0.2;for(r=0;20>r;r++)l.push(2*Math.random()-1),l.push(Math.random()*g+0.2),l.push(Math.random()*p+0.02),l.push(0.2*Math.random());d=k.createBuffer();
k.bindBuffer(k.ARRAY_BUFFER,d);k.bufferData(k.ARRAY_BUFFER,new Float32Array(l),k.STATIC_DRAW);d.itemSize=4;d.numItems=20;e=new b.util.ShaderProgram(k,"precision mediump float;\nattribute vec4 particle;\nuniform float time;\nuniform float height;\nvarying float intensity;\nvoid main(void) {\n\tfloat y = particle.x + time * particle.y;\n\ty = fract((y + 1.0) / 2.0) * 4.0 - 2.0;\n\tintensity = particle.w;\n\tgl_Position = vec4(0.0, -y , 1.0, 2.0);\n\tgl_PointSize = height * particle.z;\n}","precision mediump float;\nvarying float intensity;\nvoid main(void) {\n\tgl_FragColor = vec4(1.0);\n\tgl_FragColor.a = 2.0 * intensity * (1.0 - abs(gl_PointCoord.y - 0.5));\n}");
h=new b.util.FrameBuffer(k,1,Math.max(1,this.height/2));c()},commonShader:!0,shader:function(a,c){c.fragment=["precision mediump float;\n#define HardLight(top, bottom)  (1.0 - 2.0 * (1.0 - top) * (1.0 - bottom))\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D particles;\nuniform float time;\nuniform float scanlines;\nuniform float lineSync;\nuniform float lineHeight;\nuniform float distortion;\nuniform float vsync;\nuniform float bars;\nuniform float frameSharpness;\nuniform float frameShape;\nuniform float frameLimit;\nuniform vec4 frameColor;",
b.util.shader.noiseHelpers+b.util.shader.snoise2d+"void main(void) {","\tvec2 texCoord = vTexCoord;\n\tfloat drandom = snoise(vec2(time * 50.0, texCoord.y /lineHeight));\n\tfloat distortAmount = distortion * (drandom - 0.25) * 0.5;\n\tvec4 particleOffset = texture2D(particles, vec2(0.0, texCoord.y));\n\tdistortAmount -= lineSync * (2.0 * particleOffset.a - 0.5);\n\ttexCoord.x -= distortAmount;\n\ttexCoord.x = mod(texCoord.x, 1.0);\n\tfloat roll;\n\tif (vsync != 0.0) {\n\t\troll = fract(time / vsync);\n\t\ttexCoord.y = mod(texCoord.y - roll, 1.0);\n\t}\n\tvec4 pixel = texture2D(source, texCoord);\n\tfloat barsAmount = particleOffset.r;\n\tif (barsAmount > 0.0) {\n\t\tpixel = vec4(pixel.r + bars * barsAmount,pixel.g + bars * barsAmount,pixel.b + bars * barsAmount,pixel.a);\n\t}\n\tif (mod(texCoord.y / lineHeight, 2.0) < 1.0 ) {\n\t\tpixel.rgb *= (1.0 - scanlines);\n\t}\n\tfloat f = (1.0 - gl_FragCoord.x * gl_FragCoord.x) * (1.0 - gl_FragCoord.y * gl_FragCoord.y);\n\tfloat frame = clamp( frameSharpness * (pow(f, frameShape) - frameLimit), 0.0, 1.0);\n\tgl_FragColor = mix(frameColor, pixel, frame);\n}"].join("\n");
return c},resize:function(){h&&h.resize(1,Math.max(1,this.height/2))},draw:function(b,r,p,g,l){var q=c!==this.inputs.time,f;a!==this.height&&(a=this.height,q=!0);p.lineHeight=1/this.height;this.inputs.verticalSync?(f=0.2/this.inputs.verticalSync,p.vsync=f):(f=1,p.vsync=0);p.time=this.inputs.time%(1E3*f);p.distortion=Math.random()*this.inputs.distortion;q&&(this.inputs.lineSync||this.inputs.bars)&&(e.use(),k.viewport(0,0,1,this.height/2),k.bindFramebuffer(k.FRAMEBUFFER,h.frameBuffer),k.clear(k.COLOR_BUFFER_BIT|
k.DEPTH_BUFFER_BIT),k.enableVertexAttribArray(e.location.particle),k.bindBuffer(k.ARRAY_BUFFER,d),k.vertexAttribPointer(e.location.particle,d.itemSize,k.FLOAT,!1,0,0),k.enable(k.BLEND),k.blendFunc(k.SRC_ALPHA,k.ONE),e.time.set(p.time),e.height.set(this.height),k.drawArrays(k.POINTS,0,20),c=this.inputs.time);p.particles=h.texture;l(b,r,p,g)},destroy:function(){d=null;h&&(h.destroy(),h=null)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",defaultValue:0},
distortion:{type:"number",defaultValue:0.1,min:0,max:1},verticalSync:{type:"number",defaultValue:0.1,min:0,max:1},lineSync:{type:"number",uniform:"lineSync",defaultValue:0.2,min:0,max:1},scanlines:{type:"number",uniform:"scanlines",defaultValue:0.3,min:0,max:1},bars:{type:"number",uniform:"bars",defaultValue:0,min:0,max:1},frameShape:{type:"number",uniform:"frameShape",min:0,max:2,defaultValue:0.27},frameLimit:{type:"number",uniform:"frameLimit",min:-1,max:1,defaultValue:0.34},frameSharpness:{type:"number",
uniform:"frameSharpness",min:0,max:40,defaultValue:8.4},frameColor:{type:"color",uniform:"frameColor",defaultValue:[0,0,0,1]}},title:"TV Glitch"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("vibrance",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tfloat average = (color.r + color.g + color.b) / 3.0;\n\tfloat mx = max(color.r, max(color.g, color.b));\n\tfloat amt = (mx - average) * (-3.0 * amount);\n\tcolor.rgb = mix(color.rgb, vec3(mx), amt);\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:0,min:-1,max:1}},title:"Vibrance",description:"Non-peaking saturation effect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("vignette",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec2 pos = vTexCoord.xy - 0.5;\n\tfloat vignette = 1.0 - (dot(pos, pos) * amount);\n\tgl_FragColor = vec4(pixel.rgb * vignette, pixel.a);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:1,min:0}},title:"Vignette",description:"Vignette"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("whitebalance",function(){function c(c,d){var g,y,w;if(h!==c||k!==d)if(h=c,k=d,y=Math.ceil(Math.log(Math.max(d,c))/r),g=Math.pow(2,y),g>l&&(y=Math.ceil(Math.log(l)/r),g=l),y++,n!==g){for(n=g;e.length>y;)e.pop().fb.destroy();
for(;e.length<y;)w=e.length,g=Math.pow(2,w),e.push({fb:new b.util.FrameBuffer(p.gl,g,g),opts:{width:g,height:g},uniforms:{level:e.length,offset:0.25/g,transform:a,projection:a,resolution:[g,g]}}),w&&(e[w-1].uniforms.source=e[w].fb.texture)}}var d,e=[],h,k,n,r=Math.log(2),p=this,g,l;return{initialize:function(a){g=this.gl;l=g.getParameter(g.MAX_TEXTURE_SIZE);this.inputs.auto&&c(this.width,this.height);a()},shader:function(a,c){var e=a.auto;e&&!d&&(d=new b.util.ShaderProgram(this.gl,c.vertex,"precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float offset;\nuniform int level;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord - vec2(offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(offset, -offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(-offset, offset));\n\tpixel /= 4.0;\n\tgl_FragColor = pixel;\n}"));
c.fragment=[e?"#define AUTO":"","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\n#ifdef AUTO\nuniform sampler2D whiteSource;\n#else\nuniform vec4 white;\n#endif\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n#ifdef AUTO\n\tvec4 white = texture2D(whiteSource, vTexCoord);\n#endif\n\tvec3 target = vec3(dot(white.rgb, luma));\n\tpixel.rgb = pixel.rgb * target / white.rgb;\n\tgl_FragColor = pixel;\n}"].join("\n");
return c},resize:function(){this.gl&&this.inputs.auto&&c(this.width,this.height)},draw:function(a,b,c,g,h){var k,l;if(this.inputs.auto){k=e.length-1;for(e[k].uniforms.source=c.source;0<=k;)l=e[k],h(d,b,l.uniforms,l.fb.frameBuffer,null,l.opts),k--;c.whiteSource=e[0].fb.texture}h(a,b,c,g)},destroy:function(){for(;e.length;)e.pop().destroy()},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},white:{type:"color",uniform:"white",defaultValue:[1,1,1]},auto:{type:"boolean",shaderDirty:!0,
defaultValue:!0}}}},{title:"White Balance"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){function a(){var a;if(!q){r=new Uint8Array(256);p=new Uint8Array(512);g=new Uint8Array(512);l=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);for(a=0;256>a;a++)r[a]=256*n();for(a=0;512>a;a++)p[a]=r[a&255],g[a]=p[a]%12;q=!0}}function c(a,b){var c=0,d=0,e=0,n=(a+b)*h,q=Math.floor(a+n),
r=Math.floor(b+n),n=(q+r)*k,A=a-(q-n),H=b-(r-n),u=A>H?1:0,D=(u+1)%2,z=A-u+k,T=H-D+k,n=A-1+2*k,C=H-1+2*k,q=q&255,r=r&255,J=0.5-A*A-H*H,E;0<=J&&(E=3*g[q+p[r]],J*=J,c=J*J*(l[E]*A+l[E+1]*H));A=0.5-z*z-T*T;0<=A&&(E=3*g[q+u+p[r+D]],A*=A,d=A*A*(l[E]*z+l[E+1]*T));A=0.5-n*n-C*C;0<=A&&(E=3*g[q+1+p[r+1]],A*=A,e=A*A*(l[E]*n+l[E+1]*C));return 70*(c+d+e)}var d=b.util.mat4,e=Math.PI,h=0.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,n=Math.random,r,p,g,l,q=!1;b.transform("camerashake",function(){function b(a,c,d){var f=
h.width,g=h.height,k=1,l,n,p,q,r;if(d-=e*Math.floor(d/e))q=Math.sin(d),r=Math.sqrt(1-q*q),l=f/2,n=g/2,d=Math.abs(l*r-n*q),k=Math.abs(l*q+n*r),l=-l,p=Math.abs(l*r-n*q),l=Math.abs(l*q+n*r),k=2*Math.max(d/f,p/f,k/g,l/g);return k*=Math.max((2*Math.abs(a)+f)/f,(2*Math.abs(c)+g)/g)}function g(){var a=h.matrix,v,C,J,E,U;C=0;var P,F=1,S=F=0;J=v=0;var N,O,ca,Y,ka;if(n||p||r){J=l*q;for(P=0;P<k;P++)E=Math.pow(2,P),U=Math.pow(0.5,P),C+=U,r&&(v+=c(J*E,7*E)*U),n&&(F+=c(J*E,11*E)*U),p&&(S+=c(J*E,13*E)*U);v*=r/C;
F*=n/C;S*=p/C;J=v*e/180;d.identity(a);C=F;E=S;a[12]=a[0]*C+a[4]*E+a[12];a[13]=a[1]*C+a[5]*E+a[13];a[14]=a[2]*C+a[6]*E+a[14];a[15]=a[3]*C+a[7]*E+a[15];v&&(v=Math.sin(J),C=Math.cos(J),E=a[0],U=a[1],P=a[2],N=a[3],O=a[4],ca=a[5],Y=a[6],ka=a[7],a[0]=E*C+O*v,a[1]=U*C+ca*v,a[2]=P*C+Y*v,a[3]=N*C+ka*v,a[4]=O*C-E*v,a[5]=ca*C-U*v,a[6]=Y*C-P*v,a[7]=ka*C-N*v);u&&(1===H?F=D:(F=b(F,S,J),F=H*D+(1-H)*F),1!==F&&(a[0]*=F,a[1]*=F,a[2]*=F,a[3]*=F,a[4]*=F,a[5]*=F,a[6]*=F,a[7]*=F));h.transformed=!0}else h.transformed=!1}
var h=this,k=1,l=0,n=0,p=0,q=1,r=0,H=0,u=!0,D=1;a();return{resize:g,inputs:{time:{get:function(){return l},set:function(a){if(a===l)return!1;l=a;g();return!0},type:"number"},frequency:{get:function(){return q},set:function(a){if(a===q)return!1;q=a;g();return!0},type:"number"},octaves:{get:function(){return k},set:function(a){a=Math.max(1,a);if(a===k)return!1;k=a;g();return!0},type:"number"},rotation:{get:function(){return r},set:function(a){if(a===r)return!1;r=a;D=b(n,p,r*e/180);g();return!0},type:"number"},
amplitudeX:{get:function(){return n},set:function(a){a=Math.max(0,a);if(a===n)return!1;n=a;D=b(n,p,r*e/180);g();return!0},type:"number"},amplitudeY:{get:function(){return p},set:function(a){a=Math.max(0,a);if(a===p)return!1;p=a;D=b(n,p,r*e/180);g();return!0},type:"number"},autoScale:{get:function(){return u},set:function(a){a=!!a;if(a===u)return!1;u=a;g();return!0},type:"boolean"},preScale:{get:function(){return H},set:function(a){a=Math.max(0,Math.min(1,a));if(a===H)return!1;H=a;g();return!0},type:"number"}}}},
{title:"Camera Shake"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){var a=b.util.mat4;b.transform("3d",function(b){function d(){function b(a,c,d){u[12]=u[0]*a+u[4]*c+u[8]*d+u[12];u[13]=u[1]*a+u[5]*c+u[9]*d+u[13];u[14]=u[2]*a+u[6]*c+u[10]*d+u[14];u[15]=u[3]*a+u[7]*c+u[11]*d+u[15]}function c(){var a;y&&(a=-(h?y*Math.PI/180:y),D=Math.sin(a),z=Math.cos(a),U=u[4],P=u[5],F=u[6],S=u[7],N=u[8],O=u[9],ca=u[10],Y=
u[11],u[4]=U*z+N*D,u[5]=P*z+O*D,u[6]=F*z+ca*D,u[7]=S*z+Y*D,u[8]=N*z-U*D,u[9]=O*z-P*D,u[10]=ca*z-F*D,u[11]=Y*z-S*D)}function d(){var a;w&&(a=-(h?w*Math.PI/180:w),D=Math.sin(a),z=Math.cos(a),T=u[0],C=u[1],J=u[2],E=u[3],N=u[8],O=u[9],ca=u[10],Y=u[11],u[0]=T*z-N*D,u[1]=C*z-O*D,u[2]=J*z-ca*D,u[3]=E*z-Y*D,u[8]=T*D+N*z,u[9]=C*D+O*z,u[10]=J*D+ca*z,u[11]=E*D+Y*z)}function H(){var a;B&&(a=-(h?B*Math.PI/180:B),D=Math.sin(a),z=Math.cos(a),T=u[0],C=u[1],J=u[2],E=u[3],U=u[4],P=u[5],F=u[6],S=u[7],u[0]=T*z+U*D,u[1]=
C*z+P*D,u[2]=J*z+F*D,u[3]=E*z+S*D,u[4]=U*z-T*D,u[5]=P*z-C*D,u[6]=F*z-J*D,u[7]=S*z-E*D)}var u=e.matrix,D,z,T,C,J,E,U,P,F,S,N,O,ca,Y;q||f||v||y||w||B||1!==p||1!==g||1!==l?(a.identity(u),b(q+k,f+n,v+r),"XYZ"===M?(c(),d(),H()):"XZY"===M?(c(),H(),d()):"YXZ"===M?(d(),c(),H()):"YZX"===M?(d(),H(),c()):"ZXY"===M?(H(),c(),d()):(H(),d(),c()),1!==p&&(u[0]*=p,u[1]*=p,u[2]*=p,u[3]*=p),1!==g&&(u[4]*=g,u[5]*=g,u[6]*=g,u[7]*=g),1!==l&&(u[8]*=l,u[9]*=l,u[10]*=l,u[11]*=l),b(-k,-n,-r),e.transformed=!0):e.transformed=
!1}var e=this,h=!(b&&b.radians),k=0,n=0,r=0,p=1,g=1,l=1,q=0,f=0,v=0,y=0,w=0,B=0,M="XYZ";return{inputs:{reset:{method:function(){r=n=k=0;l=g=p=1;B=w=y=v=f=q=0;return e.transformed?(e.transformed=!1,!0):!1}},translate:{method:function(a,b,c){isNaN(a)&&(a=q);isNaN(b)&&(b=f);isNaN(c)&&(c=v);if(a===q&&b===f&&c===v)return!1;q=a;f=b;v=c;d();return!0},type:["number","number","number"]},translateX:{get:function(){return q},set:function(a){if(a===q)return!1;q=a;d();return!0},type:"number"},translateY:{get:function(){return f},
set:function(a){if(a===f)return!1;f=a;d();return!0},type:"number"},translateZ:{get:function(){return v},set:function(a){if(a===v)return!1;v=a;d();return!0},type:"number"},rotationOrder:{get:function(){return M},set:function(a){if(a===M)return!1;M=a;d();return!0},type:"number"},rotationX:{get:function(){return y},set:function(a){if(a===y)return!1;y=a;d();return!0},type:"number"},rotationY:{get:function(){return w},set:function(a){if(a===w)return!1;w=a;d();return!0},type:"number"},rotationZ:{get:function(){return B},
set:function(a){if(a===B)return!1;B=a;d();return!0},type:"number"},center:{method:function(a,b,c){isNaN(a)&&(a=k);isNaN(b)&&(b=n);isNaN(c)&&(c=r);if(a===k&&b===n&&c===r)return!1;k=a;n=b;r=c;d();return!0},type:["number","number","number"]},centerX:{get:function(){return k},set:function(a){if(a===k)return!1;k=a;d();return!0},type:"number"},centerY:{get:function(){return n},set:function(a){if(a===n)return!1;n=a;d();return!0},type:"number"},centerZ:{get:function(){return r},set:function(a){if(a===r)return!1;
r=a;d();return!0},type:"number"},scale:{method:function(a,b,c){var e,f;e=isNaN(a)?p:a;isNaN(b)?!isNaN(a)&&isNaN(c)?f=a=e:a=g:a=b;isNaN(c)?void 0===f&&(f=l):f=c;if(e===p&&a===g&&f===l)return!1;p=e;g=a;l=f;d();return!0},type:["number","number","number"]},scaleX:{get:function(){return p},set:function(a){if(a===p)return!1;p=a;d();return!0},type:"number"},scaleY:{get:function(){return g},set:function(a){if(a===g)return!1;g=a;d();return!0},type:"number"},scaleZ:{get:function(){return l},set:function(a){if(a===
l)return!1;l=a;d();return!0},type:"number"}}}},{title:"3D Transform",description:"Translate, Rotate, Scale"})});

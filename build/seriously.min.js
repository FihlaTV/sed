'use strict';var URL,require,WeakMap,module,exports,define;(function(b,a){"function"===typeof define&&define.amd?define("seriously",function(){var c=a(b);b.Seriously||(b.Seriously=c);return c}):"object"===typeof exports?module.exports=a(b):"function"!==typeof b.Seriously&&(b.Seriously=a(b))})(this,function(b){function a(a,b){var c,d;if("string"===typeof a)c=x.querySelector(a);else if(!a)return!1;a.tagName&&(c=a);if(!c)return a;d=c.tagName.toLowerCase();return b&&0>b.indexOf(d)?a:c}function c(a,b){var d,h;a.prototype&&b.prototype&&a.prototype!==b.prototype&&
c(a.prototype,b.prototype);for(d in b)b.hasOwnProperty(d)&&(h=Object.getOwnPropertyDescriptor(b,d),h.get||h.set?Object.defineProperty(a,d,{configurable:!0,enumerable:!0,get:h.get,set:h.set}):a[d]=b[d]);return a}function d(a){var b;if(!y)return P;if("function"===typeof y[a])b=y[a];else if("function"===typeof y.log)b=y.log;else return P;return b.bind?b.bind(y):function(){b.apply(y,arguments)}}function l(a,b,c,d,h){function f(a,b,c){c%=1;0>c&&(c+=1);return c<1/6?a+(b-a)*c*6:0.5>c?b:c<2/3?a+(b-a)*(2/
3-c)*6:a}b=0.5>c?c*(b+1):c+b-c*b;c=2*c-b;h||(h=[]);h[0]=f(c,b,a+1/3);h[1]=f(c,b,a);h[2]=f(c,b,a-1/3);h[3]=d;return h}function n(a){var b,c,d,h="#",f=1>a[3]?4:3;for(b=0;b<f;b++)c=Math.min(255,Math.round(255*a[b]||0)),d=c.toString(16),16>c&&(d="0"+d),h+=d;return h}function e(a){return Array.isArray(a)||a&&a.BYTES_PER_ELEMENT&&"length"in a}function g(a){function c(){u.length&&u.shift()()}if("function"!==typeof a)throw Error("setTimeoutZero argument is not a function");u.push(a);"file:"===b.location.protocol?
setTimeout(c,0):b.postMessage("seriously-timeout-message",b.location)}function r(a,c){var d;try{d=b.WebGLDebugUtils&&c&&c.debugContext?b.WebGLDebugUtils.makeDebugContext(a.getContext("webgl",c)):a.getContext("webgl",c)}catch(h){}if(!d)try{d=a.getContext("experimental-webgl",c)}catch(f){}return d}function p(){var a;v&&v.getError()===v.CONTEXT_LOST_WEBGL&&(v=void 0);if(v||!b.WebGLRenderingContext||M)return v;a=x.createElement("canvas");(v=r(a))?a.addEventListener("webglcontextlost",function t(b){b.preventDefault();
v&&v.canvas===this&&(v=void 0,a.removeEventListener("webglcontextlost",t,!1))},!1):f.logger.warn("Unable to access WebGL.");return v}function h(a){function b(a,c){var k,t;e(a)?(k=a[0],t=a[1]||k):k=a;"string"===typeof k?k=k.toLowerCase():"number"===typeof k?k=String(k):k||(k="");h[k]=t;c||(d.firstValue=k)}function c(a){return a}var d,h,m;for(m in a.inputs)if(a.inputs.hasOwnProperty(m)){if(0<=a.reserved.indexOf(m)||Object.prototype[m])throw Error("Reserved input name: "+m);d=a.inputs[m];d.name=m;isNaN(d.min)&&
(d.min=-Infinity);isNaN(d.max)&&(d.max=Infinity);isNaN(d.minCount)&&(d.minCount=-Infinity);isNaN(d.maxCount)&&(d.maxCount=Infinity);isNaN(d.step)&&(d.step=0);"enum"===d.type&&d.options&&e(d.options)&&d.options.length&&(h={},d.options.forEach(b),d.options=h);"vector"===d.type?2>d.dimensions?d.dimensions=2:4<d.dimensions?d.dimensions=4:!d.dimensions||isNaN(d.dimensions)?d.dimensions=4:d.dimensions=Math.round(d.dimensions):d.dimensions=1;d.shaderDirty=!!d.shaderDirty;"function"!==typeof d.validate&&
(d.validate=f.inputValidators[d.type]||c);a.defaultImageInput||"image"!==d.type||(a.defaultImageInput=m)}}function m(a,b,c,d){var h,f;this.type=a.UNSIGNED_BYTE;h=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,h);d&&d.texture?(this.texture=d.texture,a.bindTexture(a.TEXTURE_2D,this.texture),this.ownTexture=!1):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.ownTexture=!0);try{this.type===a.FLOAT?(f=new Float32Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.FLOAT,f)):(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null),this.type=a.UNSIGNED_BYTE)}catch(m){this.type=a.UNSIGNED_BYTE,f=new Uint8Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,
a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,f)}d=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,d);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b,c);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,d);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);f=a.checkFramebufferStatus(a.FRAMEBUFFER);if(f===a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");if(f===a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
if(f===a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");if(f===a.FRAMEBUFFER_UNSUPPORTED)throw Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");if(f!==a.FRAMEBUFFER_COMPLETE)throw Error("Incomplete framebuffer: "+f);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);this.gl=a;this.frameBuffer=h;this.renderBuffer=d;this.width=b;this.height=c}function q(a,b,c){function d(b,
c){var t,h;t=c?a.createShader(a.FRAGMENT_SHADER):a.createShader(a.VERTEX_SHADER);a.shaderSource(t,b);a.compileShader(t);if(!a.getShaderParameter(t,a.COMPILE_STATUS)){b=b.split(/[\n\r]/);for(h=0;h<b.length;h++)b[h]=h+1+":\t"+b[h];b.unshift("Error compiling "+(c?"fragment":"vertex")+" shader:");f.logger.error(b.join("\n"));throw Error("Shader error: "+a.getShaderInfoLog(t));}return t}function h(b,c){if(b.type===a.SAMPLER_2D)return function(d){b.glTexture=a["TEXTURE"+d];a.uniform1i(c,d)};if(b.type===
a.BOOL||b.type===a.INT)return 1<b.size?function(b){a.uniform1iv(c,b)}:function(b){a.uniform1i(c,b)};if(b.type===a.FLOAT)return 1<b.size?function(b){a.uniform1fv(c,b)}:function(b){a.uniform1f(c,b)};if(b.type===a.FLOAT_VEC2)return function(b){a.uniform2f(c,b[0],b[1])};if(b.type===a.FLOAT_VEC3)return function(b){a.uniform3f(c,b[0],b[1],b[2])};if(b.type===a.FLOAT_VEC4)return function(b){a.uniform4f(c,b[0],b[1],b[2],b[3])};if(b.type===a.FLOAT_MAT3)return function(b){a.uniformMatrix3fv(c,!1,b)};if(b.type===
a.FLOAT_MAT4)return function(b){a.uniformMatrix4fv(c,!1,b)};throw Error("Unknown shader uniform type: "+b.type);}function m(b){return function(){return a.getUniform(e,b)}}var e,l,g,q="";l=d(b);g=d(c,!0);e=a.createProgram();a.attachShader(e,l);(b=a.getShaderInfoLog(l))&&(q+="Vertex shader error: "+b+"\n");a.attachShader(e,g);(b=a.getShaderInfoLog(g))&&(q+="Fragment shader error: "+b+"\n");a.linkProgram(e);if(!a.getProgramParameter(e,a.LINK_STATUS))throw q+=a.getProgramInfoLog(e),a.deleteProgram(e),
a.deleteShader(l),a.deleteShader(g),Error("Could not initialise shader: "+q);a.useProgram(e);this.uniforms={};b=a.getProgramParameter(e,a.ACTIVE_UNIFORMS);for(q=0;q<b;++q)c={info:a.getActiveUniform(e,q)},c.name=c.info.name.replace(/\[0\]$/,""),c.loc=a.getUniformLocation(e,c.name),c.set=h(c.info,c.loc),c.get=m(c.loc),this.uniforms[c.name]=c,this[c.name]||(this[c.name]=c);this.attributes={};this.location={};b=a.getProgramParameter(e,a.ACTIVE_ATTRIBUTES);for(q=0;q<b;++q)c={info:a.getActiveAttrib(e,q)},
c.name=c.info.name,c.location=a.getAttribLocation(e,c.name),this.attributes[c.name]=c,this.location[c.name]=c.location;this.gl=a;this.program=e;this.destroy=function(){var b;a&&(a.deleteProgram(e),a.deleteShader(l),a.deleteShader(g));for(b in this)this.hasOwnProperty(b)&&delete this[b];g=l=e=null}}function f(d){function e(a,b){var c,d,t;if(!b)return!1;c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,a.vertices,b.STATIC_DRAW);c.size=3;d=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
d);b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.indices,b.STATIC_DRAW);t=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,t);b.bufferData(b.ARRAY_BUFFER,a.coords,b.STATIC_DRAW);t.size=2;return{vertex:c,index:d,texCoord:t,length:a.indices.length,mode:a.mode||b.TRIANGLES}}function t(a){var b={};b.vertices=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]);b.indices=new Uint16Array([0,1,2,0,2,3]);b.coords=new Float32Array([0,0,1,0,1,1,0,1]);return e(b,a)}function l(a){var b;if(!s)if(a.canvas.addEventListener("webglcontextlost",
u,!1),a.canvas.addEventListener("webglcontextrestored",p,!1),a.isContextLost())f.logger.warn("Unable to attach lost WebGL context. Will try again when context is restored.");else{s=a;S=a.canvas;V=t(s);$=new q(s,aa,ka);for(a=0;a<la.length;a++)b=la[a],b.gl=s,b.initialize(),b.buildShader();for(a=0;a<ba.length;a++)b=ba[a],b.initialize();for(a=0;a<W.length;a++)b=W[a],b.model||(b.model=V,b.shader=$)}}function p(){var a,b;if(O&&!s)if(a=O.target,a instanceof WebGLFramebuffer)f.logger.error("Unable to restore target built on WebGLFramebuffer");
else if(a=r(a,{alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:O.debugContext}))if(a.isContextLost())f.logger.error("Unable to restore WebGL Context");else{l(a);O.frameBuffer=O.renderToTexture?new m(s,O.width,O.height,!1):{frameBuffer:null};for(a=0;a<ga.length;a++)b=ga[a],b.setDirty(),b.emit("webglcontextrestored");f.logger.log("WebGL context restored")}}function u(a){var b,c;a&&(f.logger.warn("WebGL context lost"),a.preventDefault());ca&&(ta(ca),ca=0);S&&S.removeEventListener("webglcontextlost",
u,!1);for(b=0;b<la.length;b++)c=la[b],c.gl=null,c.initialized=!1,c.baseShader=null,c.model=null,c.frameBuffer=null,c.texture=null,c.shader&&c.shader.destroy&&(c.shader.destroy(),c.effect.commonShader&&delete ia[c.hook]),c.shaderDirty=!0,c.shader=null,c.effect.lostContext&&c.effect.lostContext.call(c),a&&c.emit("webglcontextlost");for(b=0;b<ba.length;b++)c=ba[b],c.texture=null,c.initialized=!1,c.allowRefresh=!1,a&&c.emit("webglcontextlost");for(b=0;b<E.length;b++)c=E[b],c.frameBuffer=null,c.texture=
null,a&&c.emit("webglcontextlost");for(b=0;b<W.length;b++)c=W[b],c.model=!1,c.frameBuffer=null,a&&c.emit("webglcontextlost");$&&$.destroy&&$.destroy();s&&(s.deleteBuffer(V.vertex),s.deleteBuffer(V.texCoord),s.deleteBuffer(V.index));V&&(delete V.vertex,delete V.texCoord,delete V.index);S=s=$=V=null}function v(a){var b,c=!1;ca=0;if(ma.length)for(c=!0,b=0;b<ma.length;b++)ma[b].call(Z,a);if(ba&&ba.length)for(c=!0,b=0;b<ba.length;b++)if(a=ba[b],a.dirty||a.checkDirty&&a.checkDirty())a.dirty=!1,a.setDirty();
for(b=0;b<W.length;b++)a=W[b],a.auto&&a.dirty&&a.render();if(na.length)for(c=!0,b=0;b<na.length;b++)na[b].call(Z);c&&!ca&&(ca=ua(v))}function oa(a,b,c,d,t,k){var h=0,f,e,m=t&&t.gl||s,l;if(m){t?(e=k&&k.width||t.width||m.canvas.width,t=k&&k.height||t.height||m.canvas.height):(e=k&&k.width||m.canvas.width,t=k&&k.height||m.canvas.height);a.use();m.viewport(0,0,e,t);m.bindFramebuffer(m.FRAMEBUFFER,d);m.enableVertexAttribArray(a.location.position);m.enableVertexAttribArray(a.location.texCoord);b.texCoord&&
(m.bindBuffer(m.ARRAY_BUFFER,b.texCoord),m.vertexAttribPointer(a.location.texCoord,b.texCoord.size,m.FLOAT,!1,0,0));m.bindBuffer(m.ARRAY_BUFFER,b.vertex);m.vertexAttribPointer(a.location.position,b.vertex.size,m.FLOAT,!1,0,0);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,b.index);k&&k.depth?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST);k?void 0===k.blend||k.blend?(s.enable(s.BLEND),d=void 0===k.srcRGB?s.ONE:k.srcRGB,t=k.dstRGB||s.ZERO,e=void 0===k.srcAlpha?d:k.srcAlpha,l=void 0===k.dstAlpha?t:k.dstAlpha,s.blendFuncSeparate(d,
t,e,l),s.blendEquation(k.blendEquation||s.FUNC_ADD)):s.disable(s.BLEND):(s.enable(s.BLEND),s.blendFunc(s.ONE,s.ZERO),s.blendEquation(s.FUNC_ADD));for(f in c)c.hasOwnProperty(f)&&(d=c[f],e=a.uniforms[f])&&(d instanceof WebGLTexture?(m.activeTexture(m.TEXTURE0+h),m.bindTexture(m.TEXTURE_2D,d),e.set(h),h++):d instanceof X||d instanceof Q||d instanceof R?d.texture&&(m.activeTexture(m.TEXTURE0+h),m.bindTexture(m.TEXTURE_2D,d.texture),e.set(h),h++):void 0!==d&&null!==d&&e.set(d));if(!k||void 0===k.clear||
k.clear)m.clearColor(0,0,0,0),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);m.drawElements(b.mode,b.length,m.UNSIGNED_SHORT,0);s.enable(s.DEPTH_TEST)}}function B(b,c,d){var k,t;if("string"!==typeof b||!c&&0!==c)d&&"object"===typeof d||(d=c),c=b;"string"===typeof b&&z[b]||(b=null);if(c instanceof X||c instanceof Q||c instanceof R)k=c;else if(c instanceof qa||c instanceof ra||c instanceof sa){if(k=pa[c.id],!k)throw Error("Cannot connect a foreign node");}else{"string"===typeof c&&isNaN(c)&&(c=a(c,
["canvas","img","video"]));for(t=0;t<ba.length;t++)if(k=ba[t],(!b||b===k.hook)&&k.compare&&k.compare(c,d))return k;k=new X(b,c,d)}return k}function M(a,b){var c,d,k;if(!(a instanceof Q||a instanceof R))return!1;if(a===b)return!0;k=a.sources;for(c in k)if(k.hasOwnProperty(c)&&(d=k[c],d===b||M(d,b)))return!0;return!1}if(b===this||!(this instanceof f)||void 0!==this.id)return new f(d);var F=++U,Z=this,ga=[],pa={},ja=0,ba=[],W=[],E=[],la=[],ha={},ma=[],na=[],N={},S,s,O,V,ia={},$,I,X,Q,R,Y,qa,ra,sa,va,
ya=!1,za=!1,ca;I=function(){this.ready=!1;this.height=this.width=1;this.gl=s;this.uniforms={resolution:[this.width,this.height],transform:null};this.dirty=!0;this.isDestroyed=!1;this.seriously=Z;this.listeners={};this.id=ja;ja++};I.prototype.setReady=function(){var a;if(!this.ready&&(this.ready=!0,this.emit("ready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setReady()};I.prototype.setUnready=function(){var a;if(this.ready&&(this.ready=!1,this.emit("unready"),this.targets))for(a=
0;a<this.targets.length;a++)this.targets[a].setUnready()};I.prototype.setDirty=function(){var a;if(!this.dirty&&(this.emit("dirty"),this.dirty=!0,this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setDirty()};I.prototype.initFrameBuffer=function(a){s&&(this.frameBuffer=new m(s,this.width,this.height,a))};I.prototype.readPixels=function(a,b,c,d,k){var t=this.gl||s;if(!s)throw Error("Cannot read pixels until a canvas is connected");this.frameBuffer||(this.initFrameBuffer(),this.setDirty());
this.render();if(void 0===k)k=new Uint8Array(c*d*4);else if(!k instanceof Uint8Array)throw Error("Incompatible array type");t.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer.frameBuffer);t.readPixels(a,b,c,d,s.RGBA,s.UNSIGNED_BYTE,k);return k};I.prototype.resize=function(){var a,b;this.source?(a=this.source.width,b=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,b=this.sources.source.height):this.inputs&&this.inputs.width?(a=this.inputs.width,b=this.inputs.height||
a):this.inputs&&this.inputs.height?a=b=this.inputs.height:b=a=1;a=Math.floor(a);b=Math.floor(b);if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.emit("resize"),this.setDirty();this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b);this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(a,b)};I.prototype.on=function(a,b){var c,d=-1;a&&"function"===typeof b&&((c=this.listeners[a])?d=c.indexOf(b):c=this.listeners[a]=[],0>d&&
c.push(b))};I.prototype.off=function(a,b){var c,d=-1;a&&"function"===typeof b&&(c=this.listeners[a])&&(d=c.indexOf(b),0<=d&&c.splice(d,1))};I.prototype.emit=function(a){var b=this.listeners[a];if(b&&b.length)for(a=0;a<b.length;a++)g(b[a])};I.prototype.destroy=function(){var a,b;delete this.gl;delete this.seriously;for(b in this.listeners)this.listeners.hasOwnProperty(b)&&delete this.listeners[b];for(a in this.uniforms)this.uniforms.hasOwnProperty(a)&&delete this.uniforms[a];this.targets&&delete this.targets;
this.frameBuffer&&this.frameBuffer.destroy&&(this.frameBuffer.destroy(),delete this.frameBuffer);a=ga.indexOf(this);0<=a&&ga.splice(a,1);delete pa[this.id];this.isDestroyed=!0};qa=function(b){function d(b,c){var w,k,L;L=f.effect.inputs[b];w=f.inputElements[b];"string"===typeof c&&isNaN(c)&&("enum"===L.type?L.options.hasOwnProperty(c)||(c=a(c,["select"])):"number"===L.type||"boolean"===L.type?c=a(c,["input","select"]):"image"===L.type&&(c=a(c,["canvas","img","video"])));c instanceof HTMLInputElement||
c instanceof HTMLSelectElement?(k=c.value,w&&w.element!==c&&(w.element.removeEventListener("change",w.listener,!0),w.element.removeEventListener("input",w.listener,!0),delete f.inputElements[b],w=null),w||(w={element:c,listener:function(a,b){return function(){var d,w;d="checkbox"===c.type?c.checked:b.value;w=f.setInput(a,d);"color"===L.type&&(w=n(w).substr(0,7));w!==d&&(b.value=w)}}(b,c)},f.inputElements[b]=w,"range"===c.type&&c.addEventListener("input",w.listener,!0),c.addEventListener("change",
w.listener,!0)),w&&"checkbox"===c.type&&(k=c.checked)):(w&&(w.element.removeEventListener("change",w.listener,!0),w.element.removeEventListener("input",w.listener,!0),delete f.inputElements[b]),k=c);f.setInput(b,k);return f.inputs[b]}function k(a){return function(b){return(b=d(a,b))&&b.pub}}function t(a){return function(){var b=f.inputs[a];return b&&b.pub}}function h(a){return function(b){return d(a,b)}}function m(a){return function(){return f.inputs[a]}}var e,f=b;for(e in f.effect.inputs)if(f.effect.inputs.hasOwnProperty(e))if(void 0===
this[e])"image"===f.effect.inputs[e].type?Object.defineProperty(this,e,{configurable:!0,enumerable:!0,get:t(e),set:k(e)}):Object.defineProperty(this,e,{configurable:!0,enumerable:!0,get:m(e),set:h(e)});else throw Error("Cannot overwrite Seriously."+e);Object.defineProperties(this,{effect:{enumerable:!0,configurable:!0,get:function(){return f.hook}},title:{enumerable:!0,configurable:!0,get:function(){return f.effect.title||f.hook}},width:{enumerable:!0,configurable:!0,get:function(){return f.width}},
height:{enumerable:!0,configurable:!0,get:function(){return f.height}},id:{enumerable:!0,configurable:!0,get:function(){return f.id}}});this.render=function(){f.render();return this};this.readPixels=function(a,b,c,d,w){return f.readPixels(a,b,c,d,w)};this.on=function(a,b){f.on(a,b)};this.off=function(a,b){f.off(a,b)};this.inputs=function(a){var b,d;b=f.effect.inputs;if(a){b=b[a];if(!b)return null;a={type:b.type,defaultValue:b.defaultValue,title:b.title||a};"number"===b.type?(a.min=b.min,a.max=b.max,
a.step=b.step):"enum"===b.type?a.options=c({},b.options):"vector"===b.type&&(a.dimensions=b.dimensions);b.description&&(a.description=b.description);return a}a={};for(d in b)b.hasOwnProperty(d)&&(a[d]=this.inputs(d));return a};this.alias=function(a,b){f.alias(a,b);return this};this.matte=function(a){f.matte(a)};this.destroy=function(){var a,b;f.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?
delete this[a]:this[a]=P)};this.isDestroyed=function(){return f.isDestroyed};this.isReady=function(){return f.ready}};Q=function(a,b){var d,k,t,f,m={};I.call(this,b);this.gl=s;this.effectRef=G[a];this.sources={};this.targets=[];this.inputElements={};this.shaderDirty=this.dirty=!0;this.hook=a;this.options=b;this.transform=null;this.effect=c({},this.effectRef);this.effectRef.definition&&c(this.effect,this.effectRef.definition.call(this,b));h(this.effect);this.uniforms.transform=D;this.inputs={};f=N[a];
for(d in this.effect.inputs)if(this.effect.inputs.hasOwnProperty(d)){k=this.effect.inputs[d];if(void 0===k.defaultValue||null===k.defaultValue)"number"===k.type?k.defaultValue=Math.min(Math.max(0,k.min),k.max):"color"===k.type?k.defaultValue=[0,0,0,0]:"boolean"===k.type?k.defaultValue=!1:"string"===k.type?k.defaultValue="":"enum"===k.type&&(k.defaultValue=k.firstValue);t=k.validate.call(this,k.defaultValue,k);f&&void 0!==f[d]&&(t=k.validate.call(this,f[d],k,k.defaultValue,t),f[d]=t,"image"===k.type&&
(m[d]=t));this.inputs[d]=t;k.uniform&&(this.uniforms[k.uniform]=k.defaultValue)}s&&(this.initialize(),this.effect.commonShader&&this.buildShader());this.updateReady();this.inPlace=this.effect.inPlace;this.pub=new qa(this);ga.push(this);pa[this.id]=this;la.push(this);C[a].push(this);for(d in m)m.hasOwnProperty(d)&&this.setInput(d,m[d])};Q.prototype=Object.create(I.prototype);Q.prototype.constructor=Q;Q.prototype.initialize=function(){if(!this.initialized){var a=this;this.baseShader=$;this.model=this.shape?
e(this.shape,this.gl):V;"function"===typeof this.effect.initialize?this.effect.initialize.call(this,function(){a.initFrameBuffer(!0)},s):this.initFrameBuffer(!0);this.frameBuffer&&(this.texture=this.frameBuffer.texture);this.initialized=!0}};Q.prototype.resize=function(){var a;I.prototype.resize.call(this);this.effect.resize&&this.effect.resize.call(this);for(a=0;a<this.targets.length;a++)this.targets[a].resize()};Q.prototype.updateReady=function(){var a,b,c,d=!0;c=this.effect;for(b in c.inputs)if(c.inputs.hasOwnProperty(b)&&
(a=this.effect.inputs[b],"image"===a.type&&!(this.sources[b]&&this.sources[b].ready||c.requires&&!c.requires.call(this,b,this.inputs)))){d=!1;break}if(this.ready!==d&&(this.ready=d,this.emit(d?"ready":"unready"),b=d?"setReady":"setUnready",this.targets))for(a=0;a<this.targets.length;a++)this.targets[a][b]()};Q.prototype.setReady=Q.prototype.updateReady;Q.prototype.setUnready=Q.prototype.updateReady;Q.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;
this.targets.push(a)};Q.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1)};Q.prototype.removeSource=function(a){var b,c=a&&a.pub;for(b in this.inputs)!this.inputs.hasOwnProperty(b)||this.inputs[b]!==a&&this.inputs[b]!==c||(this.inputs[b]=null);for(b in this.sources)!this.sources.hasOwnProperty(b)||this.sources[b]!==a&&this.sources[b]!==c||(this.sources[b]=null)};Q.prototype.buildShader=function(){var a,b=this.effect;this.shaderDirty&&(b.commonShader&&
ia[this.hook]?(this.shader||ia[this.hook].count++,this.shader=ia[this.hook].shader):b.shader?(this.shader&&!b.commonShader&&this.shader.destroy(),a=b.shader.call(this,this.inputs,{vertex:aa,fragment:ka},f.util),this.shader=a instanceof q?a:a&&a.vertex&&a.fragment?new q(s,a.vertex,a.fragment):$,b.commonShader&&(ia[this.hook]={count:1,shader:this.shader})):this.shader=$,this.shaderDirty=!1)};Q.prototype.render=function(){function a(b,c,d,w,t,f){oa(b,c,d,w,t||k,f)}var b,c,d=this.effect,k=this,t;if(s){this.initialized||
this.initialize();this.shaderDirty&&this.buildShader();if(this.dirty&&this.ready){for(b in this.sources)!this.sources.hasOwnProperty(b)||d.requires&&!d.requires.call(this,b,this.inputs)||(t="function"===typeof this.inPlace?this.inPlace(b):this.inPlace,this.sources[b].render(!t));this.frameBuffer&&(c=this.frameBuffer.frameBuffer);"function"===typeof d.draw?(d.draw.call(this,this.shader,this.model,this.uniforms,c,a),this.emit("render")):c&&(oa(this.shader,this.model,this.uniforms,c,this),this.emit("render"));
this.dirty=!1}return this.texture}};Q.prototype.setInput=function(a,b){var c,d,k;if(this.effect.inputs.hasOwnProperty(a)){c=this.effect.inputs[a];if("image"===c.type){if(b){if(b=B(b),b!==this.sources[a]){a:if(d=this.sources[a]){for(k in this.sources)if(k!==a&&this.sources.hasOwnProperty(k)&&this.sources[k]===d)break a;d.removeTarget(this)}if(M(b,this))throw Error("Attempt to make cyclical connection.");this.sources[a]=b;b.addTarget(this)}}else delete this.sources[a],b=!1;d=this.sources[a];k=Object.keys(this.sources);
!0===this.inPlace&&1===k.length?(k=this.sources[k[0]],this.uniforms.transform=k&&k.cumulativeMatrix||D):this.uniforms.transform=D}else d=N[this.hook]&&void 0!==N[this.hook][a]?N[this.hook][a]:c.defaultValue,d=b=c.validate.call(this,b,c,d,this.inputs[a]);if(this.inputs[a]===b&&"color"!==c.type&&"vector"!==c.type)return b;this.inputs[a]=b;c.uniform&&(this.uniforms[c.uniform]=d);"image"===c.type?(this.resize(),this.updateReady()):c.updateSources&&this.updateReady();c.shaderDirty&&(this.shaderDirty=!0);
this.setDirty();c.update&&c.update.call(this,b);return b}};Q.prototype.alias=function(a,b){var c=this;if(0<=Aa.indexOf(b))throw Error("'"+b+"' is a reserved name and cannot be used as an alias.");this.effect.inputs.hasOwnProperty(a)&&(b||(b=a),Z.removeAlias(b),ha[b]={node:this,input:a},Object.defineProperty(Z,b,{configurable:!0,enumerable:!0,get:function(){return c.inputs[a]},set:function(b){return c.setInput(a,b)}}));return this};Q.prototype.matte=function(a){function b(a){var c,d,k,w,f,h=[],e;if(!a.simple){for(c=
0;c<a.edges.length;c++)for(k=a.edges[c],d=c+1;d<a.edges.length;d++){w=a.edges[d];a:{f=k[0];e=k[1];var L=w[0],l=w[1],g=void 0,q=void 0,n=void 0,q=g=void 0,g=(l.x-L.x)*(f.y-L.y)-(l.y-L.y)*(f.x-L.x),q=(e.x-f.x)*(f.y-L.y)-(e.y-f.y)*(f.x-L.x);if(n=(l.y-L.y)*(e.x-f.x)-(l.x-L.x)*(e.y-f.y))if(g/=n,q/=n,0<g&&1>=g&&0<q&&1>=q){f={x:f.x+g*(e.x-f.x),y:f.y+g*(e.y-f.y)};break a}f=!1}f&&(f.edge1=k,f.edge2=w,h.push(f))}if(h.length){d=[];for(c=0;c<h.length;c++)f=h[c],k=f.edge1,w=f.edge2,e={x:f.x,y:f.y,prev:k[0],next:w[1],
id:m.length},a.vertices.push(e),m.push(e),k={x:f.x,y:f.y,prev:w[0],next:k[1],id:m.length},a.vertices.push(k),m.push(e),e.prev.next=e,e.next.prev=e,k.prev.next=k,k.next.prev=k;do{h={edges:[],vertices:[],simple:!0};d.push(h);k=w=a.vertices[0];do c=a.vertices.indexOf(w),a.vertices.splice(c,1),h.edges.push([w,w.next]),h.vertices.push(w),w=w.next;while(w!==k)}while(a.vertices.length);c=t.indexOf(a);t.splice(c,1);for(c=0;c<d.length;c++)t.push(d[c])}else a.simple=!0}}function c(a){var b,d,k=a.vertices.length,
w,f=0;b=k-1;for(d=0;d<k;b=d,d++)b=a.vertices[b],w=a.vertices[d],f+=b.x*w.y-w.x*b.y;return 0<f}function d(a){var b,c=a.vertices,k,w=[],t=[],h,m,e,L;k=c.length;if(a.clockWise)for(b=0;b<k;b++)w[b]=b;else for(b=0;b<k;b++)w[b]=k-1-b;h=2*k;m=0;for(b=k-1;2<k;){if(0>=h--)return t;e=b;k<=e&&(e=0);b=e+1;k<=b&&(b=0);L=b+1;k<L&&(L=0);var l;a:{var g=l=void 0,q=void 0,n=void 0,p=void 0,g=c[w[e]],q=c[w[b]],n=c[w[L]];if(0>(q.x-g.x)*(n.y-g.y)-(q.y-g.y)*(n.x-g.x))l=!1;else{for(l=0;l<k;l++)if(l!==e&&l!==b&&l!==L){var p=
c[w[l]],K=void 0,r=void 0,x=void 0,xa=void 0,s=void 0,A=void 0,u=void 0,G=void 0,y=void 0,wa=void 0,ja=void 0,v=void 0,K=x=s=void 0,K=n.x-q.x,r=n.y-q.y,x=g.x-n.x,xa=g.y-n.y,s=q.x-g.x,A=q.y-g.y,u=p.x-g.x,G=p.y-g.y,y=p.x-q.x,wa=p.y-q.y,ja=p.x-n.x,v=p.y-n.y,K=K*wa-r*y,s=s*G-A*u,x=x*v-xa*ja;if(0<=K&&0<=x&&0<=s){l=!1;break a}}l=!0}}if(l){h=w[e];e=w[b];L=w[L];a.clockWise?(t.push(c[h]),t.push(c[e]),t.push(c[L])):(t.push(c[L]),t.push(c[e]),t.push(c[h]));m++;L=b;for(h=b+1;h<k;L++,h++)w[L]=w[h];k--;h=2*k}}f.indices=
t}var k,t=[],f,m=[],h,l,g,q,p,n={};k=function(a){return a&&a.length&&Array.isArray(a)?!Array.isArray(a[0])||Array.isArray(a[0])&&!isNaN(a[0][0])?[a]:a:[]}(a);for(h=0;h<k.length;h++){a=k[h];p=null;f={vertices:[],edges:[]};for(l=0;l<a.length;l++)g=a[l],"object"!==typeof g||isNaN(g.x)||isNaN(g.y)?2<=g.length&&!isNaN(g[0])&&!isNaN(g[1])&&(q={x:g[0],y:g[1],id:m.length}):q={x:g.x,y:g.y,id:m.length},q&&(p?(p.next=q,q.prev=p,q.next=f.vertices[0],f.vertices[0].prev=q):(f.head=q,q.next=q,q.prev=q),m.push(q),
f.vertices.push(q),p=q);if(2<f.vertices.length)for(3===f.vertices.length&&(f.simple=!0),t.push(f),l=0;l<f.vertices.length;l++)q=f.vertices[l],f.edges.push([q,q.next])}for(h=t.length-1;0<=h;h--)f=t[h],b(f);for(h=0;h<t.length;h++)f=t[h],f.clockWise=c(f),d(f);n.vertices=[];n.coords=[];for(h=0;h<m.length;h++)g=m[h],n.vertices.push(2*g.x-1),n.vertices.push(-2*g.y+1),n.vertices.push(-1),n.coords.push(g.x),n.coords.push(-1*g.y+1);n.vertices=new Float32Array(n.vertices);n.coords=new Float32Array(n.coords);
n.indices=[];for(h=0;h<t.length;h++)for(f=t[h],l=0;l<f.indices.length;l++)g=f.indices[l],n.indices.push(g.id);n.indices=new Uint16Array(n.indices);this.shape=n;this.gl&&e(n,this.gl)};Q.prototype.destroy=function(){var a,b,c=this.hook;this.effect.destroy&&"function"===typeof this.effect.destroy&&this.effect.destroy.call(this);delete this.effect;ia[c]&&(ia[c].count--,ia[c].count||delete ia[c]);this.shader&&this.shader.destroy&&this.shader!==$&&!ia[c]&&this.shader.destroy();delete this.shader;for(a in this.inputElements)this.inputElements.hasOwnProperty(a)&&
(b=this.inputElements[a],b.element.removeEventListener("change",b.listener,!0),b.element.removeEventListener("input",b.listener,!0));for(a in this.sources)this.sources.hasOwnProperty(a)&&((b=this.sources[a])&&b.removeTarget&&b.removeTarget(this),delete this.sources[a]);for(;this.targets.length;)(b=this.targets.pop())&&b.removeSource&&b.removeSource(this);for(a in this)this.hasOwnProperty(a)&&"id"!==a&&delete this[a];for(a in ha)ha.hasOwnProperty(a)&&(b=ha[a],b.node===this&&Z.removeAlias(a));a=la.indexOf(this);
0<=a&&la.splice(a,1);a=C[c].indexOf(this);0<=a&&C[c].splice(a,1);I.prototype.destroy.call(this)};ra=function(a){Object.defineProperties(this,{original:{enumerable:!0,configurable:!0,get:function(){return a.source}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}},width:{enumerable:!0,configurable:!0,get:function(){return a.width}},height:{enumerable:!0,configurable:!0,get:function(){return a.height}}});this.render=function(){a.render()};this.update=function(){a.setDirty()};this.readPixels=
function(b,c,d,k,f){return a.readPixels(b,c,d,k,f)};this.on=function(b,c){a.on(b,c)};this.off=function(b,c){a.off(b,c)};this.destroy=function(){var b,c;a.destroy();for(b in this)this.hasOwnProperty(b)&&"isDestroyed"!==b&&"id"!==b&&(c=Object.getOwnPropertyDescriptor(this,b),c.get||c.set||"function"!==typeof this[b]?delete this[b]:this[b]=P)};this.isDestroyed=function(){return a.isDestroyed};this.isReady=function(){return a.ready}};X=function(b,d,k){function f(a,b,d,k){var w=z[a];if(w.definition)if(w=
w.definition.call(q,b,d,k))w=c(c({},z[a]),w);else return null;return w}function t(a){return q.source===a}var h=k||{},e=void 0===h.flip?!0:h.flip,m=h.width,l=h.height,g=!1,q=this,n=!1,p,K;I.call(this);if(b&&"string"!==typeof b||!d&&0!==d)k&&"object"===typeof k||(k=d),d=b;"string"===typeof d&&isNaN(d)&&(d=a(d,["canvas","img","video"]));"string"===typeof b&&z[b]&&(K=f(b,d,k,!0))&&(this.hook=b,n=!0,g=K.deferTexture,this.plugin=K,this.compare=K.compare,this.checkDirty=K.checkDirty,K.source&&(d=K.source));
if(!K&&d instanceof HTMLElement)"CANVAS"===d.tagName?(this.width=d.width,this.height=d.height,this.render=this.renderImageCanvas,n=!0,this.hook="canvas",this.compare=t):"IMG"===d.tagName&&(this.width=d.naturalWidth||1,this.height=d.naturalHeight||1,d.complete&&d.naturalWidth||(g=!0),d.addEventListener("load",function(){if(!q.isDestroyed){if(q.width!==d.naturalWidth||q.height!==d.naturalHeight)q.width=d.naturalWidth,q.height=d.naturalHeight,q.resize();q.setDirty();q.setReady()}},!0),this.render=this.renderImageCanvas,
n=!0,this.hook="image",this.compare=t);else if(!K&&d instanceof WebGLTexture){if(s&&!s.isTexture(d))throw Error("Not a valid WebGL texture.");isNaN(m)?isNaN(l)||(m=l):isNaN(l)&&(l=m);this.width=m;this.height=l;void 0===h.flip&&(e=!1);n=!0;this.texture=d;this.initialized=!0;this.hook="texture";this.compare=t;this.render=function(){}}if(!n&&!K)for(p in z)if(z.hasOwnProperty(p)&&z[p]&&(K=f(p,d,k,!1))){this.hook=p;n=!0;g=K.deferTexture;this.plugin=K;this.compare=K.compare;this.checkDirty=K.checkDirty;
K.source&&(d=K.source);break}if(!n)throw Error("Unknown source type");this.source=d;void 0===this.flip&&(this.flip=e);this.targets=[];g||q.setReady();this.pub=new ra(this);ga.push(this);pa[this.id]=this;ba.push(this);T[this.hook].push(this);ba.length&&!ca&&v()};X.prototype=Object.create(I.prototype);X.prototype.constructor=X;X.prototype.initialize=function(){var a;s&&!this.texture&&this.ready&&(a=s.createTexture(),s.bindTexture(s.TEXTURE_2D,a),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.texParameteri(s.TEXTURE_2D,
s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_2D,null),this.texture=a,this.allowRefresh=this.initialized=!0,this.setDirty())};X.prototype.initFrameBuffer=function(a){s&&(this.frameBuffer=new m(s,this.width,this.height,{texture:this.texture,useFloat:a}))};X.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===
a)return;this.targets.push(a)};X.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1)};X.prototype.resize=function(){var a,b;this.uniforms.resolution[0]=this.width;this.uniforms.resolution[1]=this.height;this.framebuffer&&this.framebuffer.resize(this.width,this.height);this.emit("resize");this.setDirty();if(this.targets)for(a=0;a<this.targets.length;a++)b=this.targets[a],b.resize(),b.setTransformDirty&&b.setTransformDirty()};X.prototype.setReady=
function(){var a;if(!this.ready&&(this.ready=!0,this.resize(),this.initialize(),this.emit("ready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setReady()};X.prototype.render=function(){var a=this.source;s&&(a||0===a)&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.plugin&&this.plugin.render&&(this.dirty||this.checkDirty&&this.checkDirty())&&this.plugin.render.call(this,s,oa,V,$)&&(this.dirty=!1,this.emit("render")))};X.prototype.renderImageCanvas=function(){var a=
this.source;if(s&&a&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.dirty)){s.bindTexture(s.TEXTURE_2D,this.texture);s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,this.flip);s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,a),this.dirty=!1,this.emit("render"),!0}catch(c){c.code===b.DOMException.SECURITY_ERR&&(this.allowRefresh=!1,f.logger.error("Unable to access cross-domain image"))}return!1}};X.prototype.destroy=
function(){var a,b;this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this);for(s&&this.texture&&s.deleteTexture(this.texture);this.targets.length;)(a=this.targets.pop())&&a.removeSource&&a.removeSource(this);a=ba.indexOf(this);0<=a&&ba.splice(a,1);a=T[this.hook].indexOf(this);0<=a&&T[this.hook].splice(a,1);for(b in this)this.hasOwnProperty(b)&&"id"!==b&&delete this[b];I.prototype.destroy.call(this)};va=function(a){Object.defineProperties(this,{source:{enumerable:!0,configurable:!0,get:function(){if(a.source)return a.source.pub},
set:function(b){a.setSource(b)}},original:{enumerable:!0,configurable:!0,get:function(){return a.target}},width:{enumerable:!0,configurable:!0,get:function(){return a.width},set:function(b){!isNaN(b)&&0<b&&a.width!==b&&(a.width=b,a.resize(),a.setTransformDirty())}},height:{enumerable:!0,configurable:!0,get:function(){return a.height},set:function(b){!isNaN(b)&&0<b&&a.height!==b&&(a.height=b,a.resize(),a.setTransformDirty())}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}}});this.render=
function(){a.render()};this.readPixels=function(b,c,d,k,f){return a.readPixels(b,c,d,k,f)};this.on=function(b,c){a.on(b,c)};this.off=function(b,c){a.off(b,c)};this.go=function(b){a.go(b)};this.stop=function(){a.stop()};this.getTexture=function(){return a.frameBuffer.texture};this.destroy=function(){var b,c;a.destroy();for(b in this)this.hasOwnProperty(b)&&"isDestroyed"!==b&&"id"!==b&&(c=Object.getOwnPropertyDescriptor(this,b),c.get||c.set||"function"!==typeof this[b]?delete this[b]:this[b]=P)};this.inputs=
function(a){return{source:{type:"image"}}};this.isDestroyed=function(){return a.isDestroyed};this.isReady=function(){return a.ready}};Y=function(a,b,d){function k(a,b,d,f){var t=H[a];if(t.definition){t=t.definition.call(n,b,d,f);if(!t)return null;t=c(c({},H[a]),t);n.hook=G;p=!0;n.plugin=t;n.compare=t.compare;t.gl&&!n.gl&&(n.gl=t.gl,s||l(t.gl));n.gl===s&&(n.model=V,n.shader=$)}return t}var h,e,g,n=this,p=!1,K,x,A,u,G;I.call(this);if(a&&"string"!==typeof a||!b&&0!==b)d&&"object"===typeof d||(d=b),b=
a;d=d||{};h=void 0===d.flip?!0:d.flip;e=parseInt(d.width,10);g=parseInt(d.height,10);x=d.debugContext;"string"===typeof a&&H[a]&&k(a,b,d,!0);this.renderToTexture=d.renderToTexture;if(b instanceof WebGLFramebuffer)if(A=b,d instanceof HTMLCanvasElement)b=d;else if(d instanceof WebGLRenderingContext)b=d.canvas;else if(d.canvas instanceof HTMLCanvasElement)b=d.canvas;else if(d.context instanceof WebGLRenderingContext)b=d.context.canvas;else throw Error("Must provide a canvas with WebGLFramebuffer target");
if(b instanceof HTMLElement&&"CANVAS"===b.tagName){e=b.width;g=b.height;if(!s||s.canvas!==b&&d.allowSecondaryWebGL)K=r(b,{alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:x});if(K)s&&s!==K?(this.gl=K,this.frameBuffer={frameBuffer:A||null},this.shader=new q(this.gl,aa,ka),this.model=t.call(this,this.gl),this.pixels=null,this.texture=this.gl.createTexture(),this.gl.bindTexture(s.TEXTURE_2D,this.texture),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),
this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.render=this.renderSecondaryWebGL):(O||(O=this),s||l(K),this.render=this.renderWebGL,d.renderToTexture?s&&(this.frameBuffer=new m(s,e,g,!1)):this.frameBuffer={frameBuffer:A||null});else{if(!d.allowSecondaryWebGL&&s&&s.canvas!==b)throw Error("Only one WebGL target canvas allowed. Set allowSecondaryWebGL option to create secondary context.");
this.render=P;f.logger.log("Unable to create WebGL context.")}p=!0}if(!p)for(G in H)if(H.hasOwnProperty(G)&&H[G]&&k(G,b,d,!1))break;if(!p)throw Error("Unknown target type");J&&((u=J.get(b))?f.logger.warn("Target already in use by another instance",b,Object.keys(u).map(function(a){return u[a]})):(u={},J.set(b,u)),u[Z.id]=Z);this.target=b;this.transform=null;this.transformDirty=!0;this.flip=h;e&&(this.width=e);g&&(this.height=g);this.uniforms.resolution[0]=this.width;this.uniforms.resolution[1]=this.height;
this.auto=void 0!==d.auto?d.auto:ya;this.frames=0;this.pub=new va(this);ga.push(this);pa[this.id]=this;W.push(this)};Y.prototype=Object.create(I.prototype);Y.prototype.constructor=Y;Y.prototype.setSource=function(a){a=B(a);a!==this.source&&(this.source&&this.source.removeTarget(this),this.source=a,a.addTarget(this),a&&(this.resize(),a.ready?this.setReady():this.setUnready()),this.setDirty())};Y.prototype.setDirty=function(){this.dirty=!0;this.auto&&!ca&&(ca=ua(v))};Y.prototype.resize=function(){if(this.target instanceof
HTMLCanvasElement){if(this.width!==this.target.width||this.height!==this.target.height)this.target.width=this.width,this.target.height=this.height,this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,this.emit("resize"),this.setTransformDirty()}else this.plugin&&this.plugin.resize&&this.plugin.resize.call(this);!this.source||this.source.width===this.width&&this.source.height===this.height||this.transform||(this.transform=new Float32Array(16))};Y.prototype.setTransformDirty=
function(){this.transformDirty=!0;this.setDirty()};Y.prototype.go=function(){this.auto=!0;this.setDirty()};Y.prototype.stop=function(){this.auto=!1};Y.prototype.render=function(){s&&this.plugin&&this.plugin.render&&this.plugin.render.call(this,oa,$,V)};Y.prototype.renderWebGL=function(){var a,b,c;this.resize();s&&this.dirty&&this.ready&&this.source&&(this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=
this.source.cumulativeMatrix||D:this.transformDirty&&(a=this.transform,ea.copy(a,this.source.cumulativeMatrix||D),b=this.source.width/this.width,c=this.source.height/this.height,a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=c,this.uniforms.transform=a,this.transformDirty=!1),oa($,V,this.uniforms,this.frameBuffer.frameBuffer,this,da),this.emit("render"),this.dirty=!1)};Y.prototype.renderSecondaryWebGL=function(){var a,b,c;this.dirty&&this.ready&&this.source&&(this.emit("render"),this.source.render(!0),
a=this.source.width,b=this.source.height,this.pixels&&this.pixels.length===a*b*4||(this.pixels=new Uint8Array(a*b*4)),this.source.readPixels(0,0,a,b,this.pixels),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,a,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pixels),a===this.width&&b===this.height?this.uniforms.transform=D:this.transformDirty&&(a=this.transform,ea.copy(a,D),b=this.source.width/this.width,c=this.source.height/this.height,a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=
c,this.uniforms.transform=a,this.transformDirty=!1),this.uniforms.source=this.texture,oa(this.shader,this.model,this.uniforms,null,this,da),this.dirty=!1)};Y.prototype.removeSource=function(a){if(this.source===a||this.source===a.pub)this.source=null};Y.prototype.destroy=function(){var a;this.source&&this.source.removeTarget&&this.source.removeTarget(this);J&&(a=J.get(this.target),delete a[Z.id],Object.keys(a).length||J.delete(this.target));this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this);
delete this.source;delete this.target;delete this.pub;delete this.uniforms;delete this.pixels;delete this.auto;a=W.indexOf(this);0<=a&&W.splice(a,1);I.prototype.destroy.call(this);this===O&&(S.removeEventListener("webglcontextrestored",p,!1),u(),O=null)};sa=function(b){function d(b,c,k){var f;f=t.inputElements[b];"string"===typeof k&&isNaN(k)&&("enum"===c.type?c.options.hasOwnProperty(k)||(k=a(k,["select"])):"number"===c.type||"boolean"===c.type?k=a(k,["input","select"]):"image"===c.type&&(k=a(k,
["canvas","img","video"])));k instanceof HTMLInputElement||k instanceof HTMLSelectElement?(c=k.value,f&&f.element!==k&&(f.element.removeEventListener("change",f.listener,!0),f.element.removeEventListener("input",f.listener,!0),delete t.inputElements[b],f=null),f||(f={element:k,listener:function(a){return function(){var c,d;c="checkbox"===k.type?k.checked:a.value;d=t.setInput(b,c);"color"===k.type&&(d=n(d));d!==c&&(a.value=d)}}(k)},t.inputElements[b]=f,"range"===k.type&&k.addEventListener("input",
f.listener,!0),k.addEventListener("change",f.listener,!0)),f&&"checkbox"===k.type&&(c=k.checked)):(f&&(f.element.removeEventListener("change",f.listener,!0),f.element.removeEventListener("input",f.listener,!0),delete t.inputElements[b]),c=k);t.setInput(b,c)}function k(a,b){Object.defineProperty(h,a,{configurable:!0,enumerable:!0,get:function(){return b.get.call(t)},set:function(c){d(a,b,c)}})}function f(a){return function(){a.apply(t,arguments)&&t.setTransformDirty()}}var t=b,h=this,e;Object.defineProperties(this,
{transform:{enumerable:!0,configurable:!0,get:function(){return t.hook}},title:{enumerable:!0,configurable:!0,get:function(){return t.plugin.title||t.hook}},width:{enumerable:!0,configurable:!0,get:function(){return t.width}},height:{enumerable:!0,configurable:!0,get:function(){return t.height}},id:{enumerable:!0,configurable:!0,get:function(){return t.id}},source:{enumerable:!0,configurable:!0,get:function(){return t.source&&t.source.pub},set:function(a){t.setSource(a)}}});for(e in t.methods)t.methods.hasOwnProperty(e)&&
(this[e]=f(t.methods[e]));for(e in t.inputs)t.inputs.hasOwnProperty(e)&&k(e,t.inputs[e]);this.update=function(){t.setDirty()};this.inputs=function(a){var b,d;b=t.plugin.inputs;if(a){b=b[a];if(!b||b.method)return null;a={type:b.type,defaultValue:b.defaultValue,title:b.title||a};"number"===b.type?(a.min=b.min,a.max=b.max,a.step=b.step):"enum"===b.type?a.options=c({},b.options):"vector"===b.type&&(a.dimensions=b.dimensions);b.description&&(a.description=b.description);return a}a={};for(d in b)b.hasOwnProperty(d)&&
!b[d].method&&(a[d]=this.inputs(d));return a};this.alias=function(a,b){t.alias(a,b);return this};this.on=function(a,b){t.on(a,b)};this.off=function(a,b){t.off(a,b)};this.destroy=function(){var a,b;t.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=P)};this.isDestroyed=function(){return t.isDestroyed};this.isReady=function(){return t.ready}};R=function(a,b){var d,
k,t,f,e;this.matrix=new Float32Array(16);this.cumulativeMatrix=new Float32Array(16);this.ready=!1;this.height=this.width=1;this.seriously=Z;this.transformRef=fa[a];this.hook=a;this.id=ja;ja++;this.options=b;this.sources=null;this.targets=[];this.inputElements={};this.inputs={};this.methods={};this.listeners={};this.uniforms=this.frameBuffer=this.texture=null;this.transformDirty=this.dirty=!0;this.transformed=this.isDestroyed=this.renderDirty=!1;this.plugin=c({},this.transformRef);this.transformRef.definition&&
c(this.plugin,this.transformRef.definition.call(this,b));for(d in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(d)&&(k=this.plugin.inputs[d],k.method&&"function"===typeof k.method?this.methods[d]=k.method:"function"===typeof k.set&&"function"===typeof k.get&&(this.inputs[d]=k));h(this.plugin);e=N[a];for(d in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(d)&&(k=this.plugin.inputs[d],"function"===typeof k.set&&"function"===typeof k.get&&"function"!==typeof k.method&&(t=k.get.call(this),
f=void 0===k.defaultValue?t:k.defaultValue,f=k.validate.call(this,f,k,t),e&&void 0!==e[d]&&(f=k.validate.call(this,e[d],k,k.defaultValue,f),e[d]=f),f!==t&&k.set.call(this,f)));ga.push(this);pa[this.id]=this;this.pub=new sa(this);E.push(this);A[a].push(this)};R.prototype=Object.create(I.prototype);R.prototype.constructor=R;R.prototype.setDirty=function(){this.renderDirty=!0;I.prototype.setDirty.call(this)};R.prototype.setTransformDirty=function(){var a,b;this.renderDirty=this.dirty=this.transformDirty=
!0;for(a=0;a<this.targets.length;a++)b=this.targets[a],b.setTransformDirty?b.setTransformDirty():b.setDirty()};R.prototype.resize=function(){var a;I.prototype.resize.call(this);this.plugin.resize&&this.plugin.resize.call(this);for(a=0;a<this.targets.length;a++)this.targets[a].resize();this.setTransformDirty()};R.prototype.setSource=function(a){a=B(a);if(a!==this.source){if(M(a,this))throw Error("Attempt to make cyclical connection.");this.source&&this.source.removeTarget(this);this.source=a;a.addTarget(this);
a&&a.ready?this.setReady():this.setUnready();this.resize()}};R.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};R.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1);this.targets&&this.targets.length&&this.resize()};R.prototype.setInput=function(a,b){var c,d,k;if(this.plugin.inputs.hasOwnProperty(a))return c=this.plugin.inputs[a],d=N[this.hook]&&void 0!==N[this.hook][a]?
N[this.hook][a]:c.defaultValue,k=c.get.call(this),void 0===d&&(d=k),b=c.validate.call(this,b,c,d,k),c.set.call(this,b)&&this.setTransformDirty(),c.get.call(this)};R.prototype.alias=function(a,b){var c=this,d,k;if(0<=Aa.indexOf(b))throw Error("'"+b+"' is a reserved name and cannot be used as an alias.");if(this.plugin.inputs.hasOwnProperty(a)){b||(b=a);Z.removeAlias(b);if(d=this.inputs[a])k=c.inputs[a],Object.defineProperty(Z,b,{configurable:!0,enumerable:!0,get:function(){return k.get.call(c)},set:function(a){k.set.call(c,
a)&&c.setTransformDirty()}});else if(d=this.methods[a])k=d,Z[b]=function(){k.apply(c,arguments)&&c.setTransformDirty()};d&&(ha[b]={node:this,input:a})}return this};R.prototype.render=function(a){if(this.source)return this.source.render(),this.transformDirty&&(this.transformed?this.source.cumulativeMatrix?ea.multiply(this.cumulativeMatrix,this.matrix,this.source.cumulativeMatrix):ea.copy(this.cumulativeMatrix,this.matrix):ea.copy(this.cumulativeMatrix,this.source.cumulativeMatrix||D),this.transformDirty=
!1),a&&s?(this.renderDirty&&(this.frameBuffer||(this.uniforms={resolution:[this.width,this.height]},this.frameBuffer=new m(s,this.width,this.height)),this.uniforms.source=this.source.texture,this.uniforms.transform=this.cumulativeMatrix||D,oa($,V,this.uniforms,this.frameBuffer.frameBuffer,this),this.renderDirty=!1),this.texture=this.frameBuffer.texture):this.texture=this.source?this.source.texture:null,this.dirty=!1,this.texture;this.transformDirty&&(ea.copy(this.cumulativeMatrix,this.matrix),this.transformDirty=
!1);this.texture=null;this.dirty=!1};R.prototype.readPixels=function(a,b,c,d,k){var t=this.gl||s;if(!s)throw Error("Cannot read pixels until a canvas is connected");this.render(!0);if(void 0===k)k=new Uint8Array(c*d*4);else if(!k instanceof Uint8Array)throw Error("Incompatible array type");t.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer.frameBuffer);t.readPixels(a,b,c,d,s.RGBA,s.UNSIGNED_BYTE,k);return k};R.prototype.destroy=function(){var a,b,c,d=this.hook;this.plugin.destroy&&"function"===typeof this.plugin.destroy&&
this.plugin.destroy.call(this);delete this.effect;this.frameBuffer&&(this.frameBuffer.destroy(),delete this.frameBuffer,delete this.texture);for(a in this.inputElements)this.inputElements.hasOwnProperty(a)&&(c=this.inputElements[a],c.element.removeEventListener("change",c.listener,!0),c.element.removeEventListener("input",c.listener,!0));for(this.source&&this.source.removeTarget(this);this.targets.length;)(c=this.targets.pop())&&c.removeSource&&c.removeSource(this);for(b in this)this.hasOwnProperty(b)&&
"id"!==b&&delete this[b];for(b in ha)ha.hasOwnProperty(b)&&(c=ha[b],c.node===this&&Z.removeAlias(b));a=E.indexOf(this);0<=a&&E.splice(a,1);a=A[d].indexOf(this);0<=a&&A[d].splice(a,1);I.prototype.destroy.call(this)};R.prototype.setReady=I.prototype.setReady;R.prototype.setUnready=I.prototype.setUnready;R.prototype.on=I.prototype.on;R.prototype.off=I.prototype.off;R.prototype.emit=I.prototype.emit;d=d instanceof HTMLCanvasElement?{canvas:d}:d||{};d.canvas&&y.log("canvas",d.canvas);this.effect=function(a,
b){if(!G[a])throw Error("Unknown effect: "+a);return(new Q(a,b)).pub};this.source=function(a,b,c){return B(a,b,c).pub};this.transform=function(a,b){"string"!==typeof a&&(b=a,a=!1);if(a){if(!fa[a])throw Error("Unknown transform: "+a);}else if(a=d&&d.defaultTransform||"2d",!fa[a])throw Error("No transform specified");return(new R(a,b)).pub};this.target=function(a,b,c){var d,k;a&&"string"===typeof a&&!H[a]&&(d=x.querySelector(a));if("string"!==typeof a||!b&&0!==b||d)c&&"object"===typeof c||(c=b),b=d||
a,a=null;"string"===typeof b&&isNaN(b)&&(b=x.querySelector(b));for(k=0;k<W.length;k++)if(d=W[k],(!a||a===d.hook)&&(d.target===b||d.compare&&d.compare(b,c)))return d.pub;d=new Y(a,b,c);return d.pub};this.aliases=function(){return Object.keys(ha)};this.removeAlias=function(a){ha[a]&&(delete this[a],delete ha[a])};this.defaults=function(a,b){var d;if(a)if("object"===typeof a)for(d in a)a.hasOwnProperty(d)&&this.defaults(d,a[d]);else null===b?delete N[a]:"object"===typeof b&&(N[a]=c({},b));else if(null===
a)for(d in N)N.hasOwnProperty(d)&&delete N[d]};this.go=function(a,b){var c;"function"===typeof a&&0>ma.indexOf(a)&&ma.push(a);"function"===typeof b&&0>na.indexOf(b)&&na.push(b);ya=!0;for(c=0;c<W.length;c++)W[c].go();ca||!ma.length&&!na.length||v()};this.stop=function(){ma.length=0;na.length=0;ta(ca);ca=0};this.render=function(){var a;for(a=0;a<W.length;a++)W[a].render(d)};this.destroy=function(){for(var a,b;ga.length;)b=ga[0],b.pub.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&
"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=P);Z=null;ba=[];W=[];la=[];ga=[];ma.length=0;na.length=0;ta(ca);ca=0;za=!0};this.isDestroyed=function(){return za};this.incompatible=function(a){var b,c=!1;if(c=f.incompatible(a))return c;if(!a){for(b in C)if(C.hasOwnProperty(b)&&C[b].length&&(a=G[b])&&"function"===typeof a.compatible&&!a.compatible.call(this))return"plugin-"+b;for(b in T)if(T.hasOwnProperty(b)&&T[b].length&&(a=z[b])&&
"function"===typeof a.compatible&&!a.compatible.call(this))return"source-"+b}return!1};this.isNode=function(a){return a&&(a=pa[a.id])&&!a.isDestroyed?!0:!1};this.isSource=function(a){return this.isNode(a)&&a instanceof ra};this.isEffect=function(a){return this.isNode(a)&&a instanceof qa};this.isTransform=function(a){return this.isNode(a)&&a instanceof sa};this.isTarget=function(a){return this.isNode(a)&&a instanceof va};Object.defineProperties(this,{id:{enumerable:!0,configurable:!0,get:function(){return F}}});
this.defaults(d.defaults)}var x=b.document,y=b.console,v,B,M,G={},fa={},z={},H={},u=[],C={},A={},T={canvas:[],image:[],video:[]},F={},J=b.WeakMap&&new WeakMap,D,U=0,P=function(){},E,S={transparent:[0,0,0,0],black:[0,0,0,1],red:[1,0,0,1],green:[0,128/255,0,1],blue:[0,0,1,1],white:[1,1,1,1],silver:[192/255,192/255,192/255,1],gray:[128/255,128/255,128/255,1],maroon:[128/255,0,0,1],purple:[128/255,0,128/255,1],fuchsia:[1,0,1,1],lime:[0,1,0,1],olive:[128/255,128/255,0,1],yellow:[1,1,0,1],navy:[0,0,128/
255,1],teal:[0,128/255,128/255,1],aqua:[0,1,1,1],orange:[1,165/255,0,1]},N=["x","y","z","w"],O=["r","g","b","a"],da={srcRGB:770,dstRGB:771,srcAlpha:1,dstAlpha:771},aa,ka,ea={frustum:function(a,b,c,d,f,h,e){e||(e=ea.create());var m=b-a,g=d-c,q=h-f;e[0]=2*f/m;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*f/g;e[6]=0;e[7]=0;e[8]=(b+a)/m;e[9]=(d+c)/g;e[10]=-(h+f)/q;e[11]=-1;e[12]=0;e[13]=0;e[14]=-(h*f*2)/q;e[15]=0;return e},perspective:function(a,b,c,d,f){a=c*Math.tan(a*Math.PI/360);b*=a;return ea.frustum(-b,b,-a,
a,c,d,f)},multiply:function(a,b,c){var d=b[0],f=b[1],e=b[2],h=b[3],m=b[4],g=b[5],q=b[6],l=b[7],n=b[8],p=b[9],x=b[10],r=b[11],A=b[12],u=b[13],G=b[14];b=b[15];var y=c[0],v=c[1],z=c[2],B=c[3];a[0]=y*d+v*m+z*n+B*A;a[1]=y*f+v*g+z*p+B*u;a[2]=y*e+v*q+z*x+B*G;a[3]=y*h+v*l+z*r+B*b;y=c[4];v=c[5];z=c[6];B=c[7];a[4]=y*d+v*m+z*n+B*A;a[5]=y*f+v*g+z*p+B*u;a[6]=y*e+v*q+z*x+B*G;a[7]=y*h+v*l+z*r+B*b;y=c[8];v=c[9];z=c[10];B=c[11];a[8]=y*d+v*m+z*n+B*A;a[9]=y*f+v*g+z*p+B*u;a[10]=y*e+v*q+z*x+B*G;a[11]=y*h+v*l+z*r+B*b;
y=c[12];v=c[13];z=c[14];B=c[15];a[12]=y*d+v*m+z*n+B*A;a[13]=y*f+v*g+z*p+B*u;a[14]=y*e+v*q+z*x+B*G;a[15]=y*h+v*l+z*r+B*b;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}},ua=function(){var a=
0;return b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(c){var d,f,e;d=(new Date).getTime();f=Math.max(0,16-(d-a));e=b.setTimeout(function(){c(d+f)},f);a=d+f;return e}}(),ta=function(){return b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.mozCancelAnimationFrame||b.oCancelAnimationFrame||b.msCancelAnimationFrame||function(a){b.cancelTimeout(a)}}(),Ba="alias destroy effect id initialize inputs isDestroyed isReady matte off on readPixels render title update".split(" "),
Ca="alias destroy id inputs isDestroyed isReady off on source title update".split(" "),Aa=["aliases","defaults","destroy","effect","go","id","incompatible","isDestroyed","isEffect",,"isNode","isSource","isTarget","isTransform","removeAlias","render","source","stop","target","transform"];b.addEventListener("message",function(a){a.source===b&&"seriously-timeout-message"===a.data&&(a.stopPropagation(),0<u.length&&u.shift()())},!0);m.prototype.resize=function(a,b){var c=this.gl;if(this.width!==a||this.height!==
b)this.width=a,this.height=b,c&&(c.bindTexture(c.TEXTURE_2D,this.texture),c.bindFramebuffer(c.FRAMEBUFFER,this.frameBuffer),c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this.texture,0),c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null))};
m.prototype.destroy=function(){var a=this.gl;a&&(a.deleteFramebuffer(this.frameBuffer),a.deleteRenderbuffer(this.renderBuffer),this.ownTexture&&a.deleteTexture(this.texture));delete this.frameBuffer;delete this.renderBuffer;delete this.texture;delete this.gl};q.prototype.use=function(){this.gl.useProgram(this.program)};f.incompatible=function(a){var c,d;void 0===M&&((c=x.createElement("canvas"))&&c.getContext?b.WebGLRenderingContext?(d=p())||(M="context"):M="webgl":M="canvas");if(M)return M;if(a){if((c=
G[a])&&"function"===typeof c.compatible&&!c.compatible(d))return"plugin-"+a;if((c=z[a])&&"function"===typeof c.compatible&&!c.compatible(d))return"source-"+a}return!1};f.plugin=function(a,b,d){if(G[a])f.logger.warn("Effect ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d)return d=c({},d),"function"===typeof b&&(d.definition=b),d.reserved=Ba,d.inputs&&h(d),d.title||(d.title=a),G[a]=d,C[a]=[],d};f.removePlugin=function(a){var b,c;if(!a||!G[a])return this;if(b=C[a]){for(;b.length;)c=
b.shift(),c.destroy();delete C[a]}delete G[a];return this};f.source=function(a,b,d){if(z[a])f.logger.warn("Source ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.title||(d.title=a),z[a]=d,T[a]=[],d};f.removeSource=function(a){var b,c;if(!a||!z[a])return this;if(b=T[a]){for(;b.length;)c=b.shift(),c.destroy();delete T[a]}delete z[a];return this};f.transform=function(a,b,d){if(fa[a])f.logger.warn("Transform ["+a+
"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.reserved=Ca,d.inputs&&h(d),d.title||(d.title=a),fa[a]=d,A[a]=[],d};f.removeTransform=function(a){var b,c;if(!a||!fa[a])return this;if(b=A[a]){for(;b.length;)c=b.shift(),c.destroy();delete A[a]}delete fa[a];return this};f.target=function(a,b,d){if(H[a])f.logger.warn("Target ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===
typeof b&&(d.definition=b),d.title||(d.title=a),H[a]=d,F[a]=[],d};f.removeTarget=function(a){var b,c;if(!a||!H[a])return this;if(b=F[a]){for(;b.length;)c=b.shift(),c.destroy();delete F[a]}delete H[a];return this};f.inputValidators={color:function(a,c,d,h){var m;d=h||[];if("string"===typeof a){if((m=/^(rgb|hsl)a?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*(\d+(\.\d*)?)\s*)?\)/i.exec(a))&&m.length){if(3>m.length)return d[0]=d[1]=d[2]=d[3]=0,d;d[3]=1;for(c=0;3>c;c++)d[c]=parseFloat(m[c+2])/255;isNaN(m[6])||
(d[3]=parseFloat(m[6]));return"hsl"===m[1].toLowerCase()?l(d[0],d[1],d[2],d[3],d):d}if((m=/^#(([0-9a-fA-F]{3,8}))/.exec(a))&&m.length)return m=m[1],3===m.length?(d[0]=parseInt(m[0],16)/15,d[1]=parseInt(m[1],16)/15,d[2]=parseInt(m[2],16)/15,d[3]=1):4===m.length?(d[0]=parseInt(m[0],16)/15,d[1]=parseInt(m[1],16)/15,d[2]=parseInt(m[2],16)/15,d[3]=parseInt(m[3],16)/15):6===m.length?(d[0]=parseInt(m.substr(0,2),16)/255,d[1]=parseInt(m.substr(2,2),16)/255,d[2]=parseInt(m.substr(4,2),16)/255,d[3]=1):8===
m.length?(d[0]=parseInt(m.substr(0,2),16)/255,d[1]=parseInt(m.substr(2,2),16)/255,d[2]=parseInt(m.substr(4,2),16)/255,d[3]=parseInt(m.substr(6,2),16)/255):d[0]=d[1]=d[2]=d[3]=0,d;if(m=S[a.toLowerCase()]){for(c=0;4>c;c++)d[c]=m[c];return d}B||(B=x.createElement("a"));B.style.backgroundColor="";B.style.backgroundColor=a;m=b.getComputedStyle(B);if((m=m.getPropertyValue("background-color")||m.getPropertyValue("backgroundColor")||B.style.backgroundColor)&&m!==a)return f.inputValidators.color(m,c,h);d[0]=
d[1]=d[2]=d[3]=0;return d}if(e(a)){d=a;if(3>d.length)return d[0]=d[1]=d[2]=d[3]=0,d;for(c=0;3>c;c++)if(isNaN(d[c]))return d[0]=d[1]=d[2]=d[3]=0,d;4>d.length&&d.push(1);return d}if("number"===typeof a)return d[0]=d[1]=d[2]=a,d[3]=1,d;if("object"===typeof a){for(c=0;4>c;c++)m=O[c],null===a[m]||isNaN(a[m])?d[c]=3===c?1:0:d[c]=a[m];return d}d[0]=d[1]=d[2]=d[3]=0;return d},number:function(a,b,c){if(isNaN(a))return c||0;a=parseFloat(a);return a<b.min?b.min:a>b.max?b.max:b.step?Math.round(a/b.step)*b.step:
a},"enum":function(a,b,c){b=b.options||[];"string"===typeof a?a=a.toLowerCase():"number"===typeof a?a=a.toString():a||(a="");return b.hasOwnProperty(a)?a:c||""},vector:function(a,b,c,d){var f;b=b.dimensions||4;d=d||[];if(e(a)){for(c=0;c<b;c++)d[c]=a[c]||0;return d}if("object"===typeof a){for(c=0;c<b;c++)f=N[c],void 0===a[f]&&(f=O[c]),d[c]=a[f]||0;return d}a=parseFloat(a)||0;for(c=0;c<b;c++)d[c]=a;return d},"boolean":function(a){return!a||a&&a.toLowerCase&&"false"===a.toLowerCase()?!1:!0},string:function(a){return"string"===
typeof a?a:0===a||a?a.toString?a.toString():String(a):""}};f.prototype.effects=f.effects=function(){var a,b,c,d={},f,e;for(a in G)if(G.hasOwnProperty(a)){b=G[a];c={title:b.title||a,description:b.description||"",inputs:{}};for(e in b.inputs)b.inputs.hasOwnProperty(e)&&(f=b.inputs[e],c.inputs[e]={type:f.type,defaultValue:f.defaultValue,step:f.step,min:f.min,max:f.max,minCount:f.minCount,maxCount:f.maxCount,dimensions:f.dimensions,title:f.title||e,description:f.description||"",options:f.options||[]});
d[a]=c}return d};b.Float32Array&&(D=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]));b.Seriously&&"object"===typeof b.Seriously&&function(){for(var a in b.Seriously)b.Seriously.hasOwnProperty(a)&&"plugin"!==a&&"object"===typeof b.Seriously[a]&&f.plugin(a,b.Seriously[a])}();f.logger={log:d("log"),info:d("info"),warn:d("warn"),error:d("error")};f.util={mat4:ea,checkSource:function(c){var d,e;c=a(c,["img","canvas","video"]);if(!c)return!1;d=x.createElement("canvas");if(!d)return f.logger.warn("Browser does not support canvas or Seriously.js"),
!1;if(0===c.naturalWidth&&"IMG"===c.tagName)return f.logger.warn("Image not loaded"),!1;if(0===c.readyState&&0===c.videoWidth&&"VIDEO"===c.tagName)return f.logger.warn("Video not loaded"),!1;if(e=p()){(d=e.createTexture())||f.logger.error("Test WebGL context has been lost");e.bindTexture(e.TEXTURE_2D,d);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c)}catch(m){return m.code===b.DOMException.SECURITY_ERR?f.logger.log("Unable to access cross-domain image"):f.logger.error("Error storing image to texture: "+
m.message),e.deleteTexture(d),!1}e.deleteTexture(d)}else{e=d.getContext("2d");try{e.drawImage(c,0,0),e.getImageData(0,0,1,1)}catch(h){return h.code===b.DOMException.SECURITY_ERR?f.logger.log("Unable to access cross-domain image"):f.logger.error("Error drawing image to canvas: "+h.message),!1}}return!0},hslToRgb:l,colors:S,setTimeoutZero:g,ShaderProgram:q,FrameBuffer:m,requestAnimationFrame:ua,shader:{makeNoise:"float makeNoise(float u, float v, float timer) {\n\tfloat x = u * v * mod(timer * 1000.0, 100.0);\n\tx = mod(x, 13.0) * mod(x, 127.0);\n\tfloat dx = mod(x, 0.01);\n\treturn clamp(0.1 + dx * 100.0, 0.0, 1.0);\n}\n",
random:"#ifndef RANDOM\n#define RANDOM\nfloat random(vec2 n) {\n\treturn 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n#endif\n"}};f.source("video",function(a,c,d){function e(){a.removeEventListener("loadedmetadata",e,!0);if(!n)if(a.videoWidth){if(g.width!==a.videoWidth||g.height!==a.videoHeight)g.width=a.videoWidth,g.height=a.videoHeight,g.resize();p&&g.setReady()}else p=!0,setTimeout(e,50)}function m(){r=!0}function h(){r=!1;g.setDirty()}var g=this,q,l,n=!1,p=!1,r=!1,
A=0;if(a instanceof b.HTMLVideoElement)return a.readyState?e():(p=!0,a.addEventListener("loadedmetadata",e,!0)),a.addEventListener("seeking",m,!1),a.addEventListener("seeked",h,!1),{deferTexture:p,source:a,render:function ja(c){var d,e;A=a.currentTime;if(!a.videoHeight||!a.videoWidth)return!1;E?(l||(l=x.createElement("canvas").getContext("2d"),q=l.canvas,q.width=g.width,q.height=g.height),d=q,l.drawImage(a,0,0,g.width,g.height)):d=a;c.bindTexture(c.TEXTURE_2D,g.texture);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,
g.flip);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,d);if(void 0===E){e=c.getError();if(e===c.INVALID_VALUE)return E=!0,ja(c);E=!1}return!0}catch(m){m.code===b.DOMException.SECURITY_ERR?(g.allowRefresh=!1,f.logger.error("Unable to access cross-domain image")):f.logger.error("Error rendering video source",m)}return!1},checkDirty:function(){return!r&&a.currentTime!==A},compare:function(a){return g.source===a},destroy:function(){n=
!0;a.removeEventListener("seeking",m,!1);a.removeEventListener("seeked",h,!1);a.removeEventListener("loadedmetadata",e,!0)}}},{title:"Video"});f.transform("2d",function(a){function b(){function a(b,c){k[12]=k[0]*b+k[4]*c+k[12];k[13]=k[1]*b+k[5]*c+k[13];k[14]=k[2]*b+k[6]*c+k[14];k[15]=k[3]*b+k[7]*c+k[15]}var k=c.matrix,r,x,A,u,y,G,v,z,B,s;g||q||l||n||p||1!==m||1!==h?(ea.identity(k),a(g+f,q+e),n&&(k[4]=n/c.width),p&&(k[1]=p/c.height),l&&(A=k[0],u=k[1],y=k[2],G=k[3],v=k[4],z=k[5],B=k[6],s=k[7],r=-(d?
l*Math.PI/180:l),x=Math.sin(r),r=Math.cos(r),k[0]=A*r+v*x,k[1]=u*r+z*x,k[2]=y*r+B*x,k[3]=G*r+s*x,k[4]=v*r-A*x,k[5]=z*r-u*x,k[6]=B*r-y*x,k[7]=s*r-G*x),1!==m&&(k[0]*=m,k[1]*=m,k[2]*=m,k[3]*=m),1!==h&&(k[4]*=h,k[5]*=h,k[6]*=h,k[7]*=h),a(-f,-e),c.transformed=!0):c.transformed=!1}var c=this,d=!(a&&a.radians),f=0,e=0,m=1,h=1,g=0,q=0,l=0,n=0,p=0;return{inputs:{reset:{method:function(){e=f=0;h=m=1;p=n=l=q=g=0;return c.transformed?(c.transformed=!1,!0):!1}},translate:{method:function(a,c){isNaN(a)&&(a=g);
isNaN(c)&&(c=q);if(a===g&&c===q)return!1;g=a;q=c;b();return!0},type:["number","number"]},translateX:{get:function(){return g},set:function(a){if(a===g)return!1;g=a;b();return!0},type:"number"},translateY:{get:function(){return q},set:function(a){if(a===q)return!1;q=a;b();return!0},type:"number"},rotation:{get:function(){return l},set:function(a){if(a===l)return!1;l=parseFloat(a);b();return!0},type:"number"},center:{method:function(a,c){isNaN(a)&&(a=f);isNaN(c)&&(c=e);if(a===f&&c===e)return!1;f=a;
e=c;b();return!0},type:["number","number"]},centerX:{get:function(){return f},set:function(a){if(a===f)return!1;f=a;b();return!0},type:"number"},centerY:{get:function(){return e},set:function(a){if(a===e)return!1;e=a;b();return!0},type:"number"},skew:{method:function(a,c){isNaN(a)&&(a=n);isNaN(c)&&(c=p);if(a===n&&c===p)return!1;n=a;p=c;b();return!0},type:["number","number"]},skewX:{get:function(){return n},set:function(a){if(a===n)return!1;n=a;b();return!0},type:"number"},skewY:{get:function(){return p},
set:function(a){if(a===p)return!1;p=a;b();return!0},type:"number"},scale:{method:function(a,c){var d,f;d=isNaN(a)?m:a;if(isNaN(c)){if(isNaN(a))return!1;f=d}else f=c;if(d===m&&f===h)return!1;m=d;h=f;b();return!0},type:["number","number"]},scaleX:{get:function(){return m},set:function(a){if(a===m)return!1;m=a;b();return!0},type:"number"},scaleY:{get:function(){return h},set:function(a){if(a===h)return!1;h=a;b();return!0},type:"number"}}}},{title:"2D Transform",description:"Translate, Rotate, Scale, Skew"});
f.transform("flip",function(){function a(){var d=b.matrix;c?(d[0]=-1,d[5]=1):(d[0]=1,d[5]=-1)}var b=this,c=!0;ea.identity(b.matrix);a();b.transformDirty=!0;b.transformed=!0;return{inputs:{direction:{get:function(){return c?"horizontal":"vertical"},set:function(b){b="vertical"===b?!1:!0;if(b===c)return!1;c=b;a();return!0},type:"string"}}}},{title:"Flip",description:"Flip Horizontal/Vertical"});f.transform("reformat",function(){function a(){var b=d.matrix,c=f||d.width,h=e||d.height,g=d.source,q=g&&
g.width||1,g=g&&g.height||1,k,l;"distort"===m||c===q&&h===g?d.transformed=!1:(k=q/g,l=c/h,"none"===m?(c=q/c,h=g/h):"width"===m||"contain"===m&&l<=k?(c=1,h=l/k):"height"===m||"contain"===m&&l>k?(c=k/l,h=1):l>k?(c=1,h=l/k):(c=k/l,h=1),1===c&&1===h?d.transformed=!1:(ea.identity(b),1!==c&&(b[0]*=c,b[1]*=c,b[2]*=c,b[3]*=c),1!==h&&(b[4]*=h,b[5]*=h,b[6]*=h,b[7]*=h),d.transformed=!0))}function b(){return f||d.source&&d.source.width||1}function c(){return e||d.source&&d.source.height||1}var d=this,f,e,m="contain";
this.resize=function(){var d=b(),f=c();if(this.width!==d||this.height!==f)for(this.width=d,this.height=f,this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=d,this.uniforms.resolution[1]=f),this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(d,f),d=0;d<this.targets.length;d++)this.targets[d].resize();this.setTransformDirty();a()};return{inputs:{width:{get:b,set:function(a){a=Math.floor(a);if(a===f)return!1;f=a;this.resize();return!1},type:"number"},height:{get:c,set:function(a){a=
Math.floor(a);if(a===e)return!1;e=a;this.resize();return!1},type:"number"},mode:{get:function(){return m},set:function(b){if(b===m)return!1;m=b;a();return!0},type:"enum",options:"cover contain distort width height none".split(" ")}}}},{title:"Reformat",description:"Change output dimensions"});aa="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n";
ka="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nvoid main(void) {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n}";f.util.shader.noiseHelpers="#ifndef NOISE_HELPERS\n#define NOISE_HELPERS\nvec2 mod289(vec2 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat taylorInvSqrt(float r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\n#endif\n";
f.util.shader.snoise2d="#ifndef NOISE2D\n#define NOISE2D\nfloat snoise(vec2 v) {\n\tconst vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n\t\t0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n\t\t-0.577350269189626, // -1.0 + 2.0 * C.x\n\t\t0.024390243902439); // 1.0 / 41.0\n\tvec2 i = floor(v + dot(v, C.yy));\n\tvec2 x0 = v - i + dot(i, C.xx);\n\tvec2 i1;\n\t//i1.x = step(x0.y, x0.x); // x0.x > x0.y ? 1.0 : 0.0\n\t//i1.y = 1.0 - i1.x;\n\ti1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\t// x0 = x0 - 0.0 + 0.0 * C.xx ;\n\t// x1 = x0 - i1 + 1.0 * C.xx ;\n\t// x2 = x0 - 1.0 + 2.0 * C.xx ;\n\tvec4 x12 = x0.xyxy + C.xxzz;\n\tx12.xy -= i1;\n\ti = mod289(i); // Avoid truncation effects in permutation\n\tvec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\n\tvec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);\n\tm = m*m ;\n\tm = m*m ;\n\tvec3 x = 2.0 * fract(p * C.www) - 1.0;\n\tvec3 h = abs(x) - 0.5;\n\tvec3 ox = floor(x + 0.5);\n\tvec3 a0 = x - ox;\n\tm *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\tvec3 g;\n\tg.x = a0.x * x0.x + h.x * x0.y;\n\tg.yz = a0.yz * x12.xz + h.yz * x12.yw;\n\treturn 130.0 * dot(m, g);\n}\n#endif\n";
f.util.shader.snoise3d="#ifndef NOISE3D\n#define NOISE3D\nfloat snoise(vec3 v) {\n\tconst vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i = floor(v + dot(v, C.yyy));\n\tvec3 x0 = v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(g.xyz, l.zxy);\n\tvec3 i2 = max(g.xyz, l.zxy);\n\t// x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t// x1 = x0 - i1 + 1.0 * C.xxx;\n\t// x2 = x0 - i2 + 2.0 * C.xxx;\n\t// x3 = x0 - 1.0 + 3.0 * C.xxx;\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i);\n\tvec4 p = permute(permute(permute(\n\t\t\t\t\t\ti.z + vec4(0.0, i1.z, i2.z, 1.0))\n\t\t\t\t\t\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0))\n\t\t\t\t\t\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3 ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p, 7 * 7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_); // mod(j, N)\n\tvec4 x = x_ * ns.x + ns.yyyy;\n\tvec4 y = y_ * ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4(x.xy, y.xy);\n\tvec4 b1 = vec4(x.zw, y.zw);\n\t//vec4 s0 = vec4(lessThan(b0, 0.0)) * 2.0 - 1.0;\n\t//vec4 s1 = vec4(lessThan(b1, 0.0)) * 2.0 - 1.0;\n\tvec4 s0 = floor(b0) * 2.0 + 1.0;\n\tvec4 s1 = floor(b1) * 2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw * sh.zzww ;\n\tvec3 p0 = vec3(a0.xy, h.x);\n\tvec3 p1 = vec3(a0.zw, h.y);\n\tvec3 p2 = vec3(a1.xy, h.z);\n\tvec3 p3 = vec3(a1.zw, h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot(m*m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n}\n#endif\n";
f.util.shader.snoise4d="#ifndef NOISE4D\n#define NOISE4D\nvec4 grad4(float j, vec4 ip)\n\t{\n\tconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n\tvec4 p, s;\n\n\tp.xyz = floor(fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n\tp.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n\ts = vec4(lessThan(p, vec4(0.0)));\n\tp.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n\treturn p;\n\t}\n\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n\t{\n\tconst vec4 C = vec4(0.138196601125011, // (5 - sqrt(5))/20 G4\n\t\t\t\t\t\t0.276393202250021, // 2 * G4\n\t\t\t\t\t\t0.414589803375032, // 3 * G4\n\t\t\t\t\t\t-0.447213595499958); // -1 + 4 * G4\n\n\tvec4 i = floor(v + dot(v, vec4(F4)));\n\tvec4 x0 = v - i + dot(i, C.xxxx);\n\n\n\tvec4 i0;\n\tvec3 isX = step(x0.yzw, x0.xxx);\n\tvec3 isYZ = step(x0.zww, x0.yyz);\n\ti0.x = isX.x + isX.y + isX.z;\n\ti0.yzw = 1.0 - isX;\n\ti0.y += isYZ.x + isYZ.y;\n\ti0.zw += 1.0 - isYZ.xy;\n\ti0.z += isYZ.z;\n\ti0.w += 1.0 - isYZ.z;\n\n\tvec4 i3 = clamp(i0, 0.0, 1.0);\n\tvec4 i2 = clamp(i0 - 1.0, 0.0, 1.0);\n\tvec4 i1 = clamp(i0 - 2.0, 0.0, 1.0);\n\n\tvec4 x1 = x0 - i1 + C.xxxx;\n\tvec4 x2 = x0 - i2 + C.yyyy;\n\tvec4 x3 = x0 - i3 + C.zzzz;\n\tvec4 x4 = x0 + C.wwww;\n\n\ti = mod289(i);\n\tfloat j0 = permute(permute(permute(permute(i.w) + i.z) + i.y) + i.x);\n\tvec4 j1 = permute(permute(permute(permute (\n\t\t\t\t\ti.w + vec4(i1.w, i2.w, i3.w, 1.0))\n\t\t\t\t\t+ i.z + vec4(i1.z, i2.z, i3.z, 1.0))\n\t\t\t\t\t+ i.y + vec4(i1.y, i2.y, i3.y, 1.0))\n\t\t\t\t\t+ i.x + vec4(i1.x, i2.x, i3.x, 1.0));\n\n\tvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n\tvec4 p0 = grad4(j0, ip);\n\tvec4 p1 = grad4(j1.x, ip);\n\tvec4 p2 = grad4(j1.y, ip);\n\tvec4 p3 = grad4(j1.z, ip);\n\tvec4 p4 = grad4(j1.w, ip);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tp4 *= taylorInvSqrt(dot(p4, p4));\n\n\tvec3 m0 = max(0.6 - vec3(dot(x0, x0), dot(x1, x1), dot(x2, x2)), 0.0);\n\tvec2 m1 = max(0.6 - vec2(dot(x3, x3), dot(x4, x4)), 0.0);\n\tm0 = m0 * m0;\n\tm1 = m1 * m1;\n\treturn 49.0 * (dot(m0*m0, vec3(dot(p0, x0), dot(p1, x1), dot(p2, x2)))\n\t\t\t\t\t\t\t+ dot(m1*m1, vec2(dot(p3, x3), dot(p4, x4)))) ;\n}\n#endif\n";
return f});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){b.source("array",function(a,b,d){var l,n,e;if(b&&(Array.isArray(a)||a&&a.BYTES_PER_ELEMENT&&"length"in a))if(l=b.width,n=b.height,l&&n)if(l*n*4!==a.length){if(d)throw"Array length must be height x width x 4.";}else return this.width=l,this.height=n,void 0===b.flip&&(this.flip=!1),a instanceof Uint8Array||(e=new Uint8Array(a.length)),{render:function(b){var c;
if(this.dirty){if(e)for(c=0;c<e.length;c++)e[c]=a[c];b.bindTexture(b.TEXTURE_2D,this.texture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,this.flip);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,this.width,this.height,0,b.RGBA,b.UNSIGNED_BYTE,e||a);this.lastRenderTime=Date.now()/1E3;return!0}}};else if(d)throw"Height and width must be provided with an Array";},{title:"Array",description:"Array or Uint8Array"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,c=window.URL||window.webkitURL||window.mozURL||window.msURL;b.source("camera",function(d,l,n){function e(){p&&(p.pause(),p.src="",p.load());q&&q.stop&&q.stop();q=null}function g(){m||(p.videoWidth?(r.width=p.videoWidth,r.height=p.videoHeight,r.setReady()):
setTimeout(g,50))}var r=this,p,h,m=!1,q,f=0;if(n){if(!a)throw"Camera source type unavailable. Browser does not support getUserMedia";l={};if(d&&"object"===typeof d)for(h in d)d.hasOwnProperty(h)&&(l[h]=d[h]);l.video||(l.video=!0);p=document.createElement("video");a.call(navigator,l,function(a){q=a;m?e():(p.mozCaptureStream?p.mozSrcObject=q:p.src=c&&c.createObjectURL(q)||q,p.readyState?g():p.addEventListener("loadedmetadata",g,!1),p.play())},function(a){console.log("Unable to access video camera",
a)});return{deferTexture:!0,source:p,render:function(a){f=p.currentTime;a.bindTexture(a.TEXTURE_2D,this.texture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,this.flip);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,p),!0}catch(c){b.logger.error("Error rendering camera video source",c)}return!1},checkDirty:function(){return p.currentTime!==f},destroy:function(){m=!0;e()}}}},{compatible:function(){return!!a},title:"Camera"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){function a(a,b,c,e,g){a=new Uint8Array(a,b,g);c=new Uint8Array(c,e,g);a.set(c)}var c=/GDepth:Data="([\S]*)"/;b.source("depth",function(d,l,n){function e(){q||(r.width=m.naturalWidth,r.height=m.naturalHeight,r.setReady())}function g(d){var h=new Uint8Array(d),g=[],q="",l,n,p,r;if(255==h[0]&&216==h[1]){for(l=0;l<h.byteLength;l++)255===h[l]&&
225===h[l+1]&&(g.push(l),l++);g.push(h.byteLength);for(l=0;l<g.length-1;l++)255===h[g[l]]&&225===h[g[l]+1]&&(p=256*h[g[l]+2]+h[g[l]+3],r=79,r>p&&(r=0),p+=2,n=new ArrayBuffer(p-r),a(n,0,d,g[l]+r,p-r),n=String.fromCharCode.apply(null,new Uint8Array(n)),q+=n);d=c.exec(q);if(null===d)return b.logger.error("JPEG file does not include depth image."),!1;m||(m=document.createElement("img"));m.src="data:image/png;base64,"+d[1];m.complete&&m.naturalWidth?e():(m.addEventListener("load",e,!0),m.addEventListener("error",
function(a){b.logger.error("Error loading depth image.",a)},!0))}else return b.logger.error("Unable to load depth image. File is not a JPEG."),!1}var r=this,p,h,m,q=!1;if(n)return p="string"===typeof d?document.querySelector(d):d,p instanceof window.ArrayBuffer?g(d):l&&l.url?h=l.url:p&&p instanceof window.HTMLImageElement&&("IMG"===p.tagName||n)&&(h=p.src),h||"string"!==typeof d||(h=d),h&&(m=document.createElement("img"),d=new XMLHttpRequest,d.open("GET",h,!0),d.responseType="arraybuffer",d.onload=
function(){g(this.response)},d.send()),m?{deferTexture:!0,source:m,render:Object.getPrototypeOf(this).renderImageCanvas,destroy:function(){q=!0}}:!1},{title:"Depth Image"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){b.source("imagedata",function(a){if(a instanceof Object&&a.data&&a.width&&a.height&&a.width*a.height*4===a.data.length)return this.width=a.width,this.height=a.height,{render:function(b){if(this.dirty)return b.bindTexture(b.TEXTURE_2D,this.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,this.flip),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,
a),this.lastRenderTime=Date.now()/1E3,!0}}},{title:"ImageData",description:"2D Canvas ImageData"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously","three"],a):"object"===typeof exports?a(require("seriously"),require("three")):a(b.Seriously,b.THREE)})(this,function(b,a){b.source("three",function(b,d,l){function n(){var a=b.__webglTexture,d=e.gl;if(a&&d&&!e.initialized){if(!d.isTexture(a))throw Error("Failed to create Three.js source. WebGL texture is from a different context");e.texture=a;e.initialized=!0;e.allowRefresh=!0;e.setReady()}}var e=this,g=this.setDirty;if(a&&
b instanceof a.WebGLRenderTarget)return d=b.width,l=b.height,this.width=d,this.height=l,n(),this.initialized||(this.setDirty=function(){n();this.initialized&&(this.setDirty=g);g.call(this)}),{deferTexture:!this.initialized,render:function(a){this.lastRenderTime=Date.now()/1E3;this.dirty=!1;this.emit("render")}}},{title:"Three.js WebGLRenderTarget Source"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously","three"],a):"object"===typeof exports?a(require("seriously"),require("three")):a(b.Seriously,b.THREE)})(this,function(b,a){var c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),d=b.util.mat4;b.target("three",function(b,n){function e(){p&&r&&!g.initialized&&(g.initialized=!0,g.allowRefresh=!0,g.setReady())}var g=this,r,p;if(a&&b instanceof a.WebGLRenderTarget){if(g.gl)r=g.gl;else if(n)if(n.gl)r=n.gl;else if(n.canvas&&n.canvas.getContext){try{r=
n.canvas.getContext("webgl")}catch(h){}if(!r)try{r=n.canvas.getContext("experimental-webgl")}catch(m){}}if(!r)throw Error("Failed to create Three.js target. Missing WebGL context");this.ready=!1;this.width=b.width;this.height=b.height;if(b.__webglFramebuffer){if(!r.isFramebuffer(b.__webglFramebuffer))throw Error("Failed to create Three.js target. WebGL texture is from a different context");p=b.__webglFramebuffer;e()}else Object.defineProperty(b,"__webglFramebuffer",{configurable:!0,enumerable:!0,
get:function(){return p},set:function(a){a&&(p=a,e())}});this.setReady=function(){p&&this.source&&this.source.ready&&!this.ready&&(this.emit("ready"),this.ready=!0)};this.target=b;return{gl:r,resize:function(){this.width=b.width;this.height=b.height},render:function(a,f,e){var h,m,g;if(r&&this.dirty&&this.ready&&this.source&&(this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||
c:this.transformDirty&&(h=this.transform,d.copy(h,this.source.cumulativeMatrix||c),m=this.source.width/this.width,g=this.source.height/this.height,h[0]*=m,h[1]*=m,h[2]*=m,h[3]*=m,h[4]*=g,h[5]*=g,h[6]*=g,h[7]*=g,this.uniforms.transform=h,this.transformDirty=!1),a(f,e,this.uniforms,p,this),this.emit("render"),this.dirty=!1,b.onUpdate))b.onUpdate()},destroy:function(){Object.defineProperty(b,"__webglFramebuffer",{configurable:!0,enumerable:!0,value:p})}}}},{title:"THREE.js WebGLRenderTarget Target"})});(function(b,a){"function"===typeof define&&define.amd?define([],a):b.MediaLoader=a()})(this,function(){var b=/^[a-z\-]+/i,a={video:"video",audio:"audio",image:"img"};return function(c,d){function l(a){a.preventDefault();return!1}function n(e){var f,g;m&&0>m.indexOf(e.type)?d.error&&d.error(e.type):(g=(g=b.exec(e.type))&&g[0],"file"===h?c(e):"contents"!==h&&a[g]?(g=document.createElement(a[g]),g.src=URL.createObjectURL(e),c(g,e)):(f=new FileReader,f.onload=function(){c(f.result,e)},f.readAsArrayBuffer(e)))}
function e(a){a.preventDefault();a.dataTransfer.files.length&&n(a.dataTransfer.files[0]);return!1}function g(a){a.target.files.length&&n(a.target.files[0])}var r,p,h,m;"object"===typeof c&&(d=c,c=d.callback);if(!c)throw Error("MediaLoader does not work without a callback function");d||(d={});m=d.types||"video/webm video/mp4 video/ogg audio/ogg audio/mp3 image/jpeg image/png".split(" ");h=d.format;if(r=d.target?"string"===typeof r?document.querySelector(d.target):d.target:document.body)r.addEventListener("dragover",
l,!1),r.addEventListener("drop",e,!0);(p=d.input)&&"string"===typeof p&&(p=document.querySelector(p));p&&p.addEventListener("change",g,!1);this.destroy=function(){r&&(r.removeEventListener("dragover",l,!1),r.removeEventListener("drop",e,!0));p&&p.removeEventListener("change",g,!1)}}});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b,c){function d(a){var g={base:(b||"base")+"."+a,blend:(c||"blend")+"."+a};return function(a){return g[a]||a}}return"vec3("+a.replace(/blend|base/g,d("r"))+", "+a.replace(/blend|base/g,d("g"))+", "+a.replace(/blend|base/g,d("b"))+")"}var c={normal:"blend",lighten:"max(blend, base)",
darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",
saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:a("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))",
"blend","base"),colordodge:a("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:a("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:a("BlendLinearLightf(base, blend)"),vividlight:a("BlendVividLightf(base, blend)"),pinlight:a("BlendPinLightf(base, blend)"),hardmix:a("BlendHardMixf(base, blend)"),reflect:a("BlendReflectf(base, blend)"),glow:a("BlendReflectf(blend, base)")},d={normal:!0};b.plugin("accumulator",function(){var a={clear:!1},n,e=0;return{initialize:function(a,
c){a();n=[this.frameBuffer,new b.util.FrameBuffer(c,this.width,this.height)]},shader:function(a,b){var e=a.blendMode||"normal",e=e.toLowerCase();b.fragment=["precision mediump float;\nconst vec3 ZERO = vec3(0.0);\nconst vec3 ONE = vec3(1.0);\nconst vec3 HALF = vec3(0.5);\nconst vec3 TWO = vec3(2.0);\n#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)\n#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)\n#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)\n#define BlendLightenf(base, blend)\t\tmax(blend, base)\n#define BlendDarkenf(base, blend)\t\tmin(blend, base)\n#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))\n#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\nvec3 RGBToHSL(vec3 color) {\n\tvec3 hsl;\n\tfloat fmin = min(min(color.r, color.g), color.b);\n\tfloat fmax = max(max(color.r, color.g), color.b);\n\tfloat delta = fmax - fmin;\n\thsl.z = (fmax + fmin) / 2.0;\n\tif (delta == 0.0) {\n\t\thsl.x = 0.0;\n\t\thsl.y = 0.0;\n\t} else {\n\t\tif (hsl.z < 0.5)\n\t\t\thsl.y = delta / (fmax + fmin);\n\t\telse\n\t\t\thsl.y = delta / (2.0 - fmax - fmin);\n\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\n\t\tif (color.r == fmax )\n\t\t\thsl.x = deltaB - deltaG;\n\t\telse if (color.g == fmax)\n\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;\n\t\telse if (color.b == fmax)\n\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;\n\t\tif (hsl.x < 0.0)\n\t\t\thsl.x += 1.0;\n\t\telse if (hsl.x > 1.0)\n\t\t\thsl.x -= 1.0;\n\t}\n\treturn hsl;\n}\nfloat HueToRGB(float f1, float f2, float hue) {\n\tif (hue < 0.0)\n\t\thue += 1.0;\n\telse if (hue > 1.0)\n\t\thue -= 1.0;\n\tfloat res;\n\tif ((6.0 * hue) < 1.0)\n\t\tres = f1 + (f2 - f1) * 6.0 * hue;\n\telse if ((2.0 * hue) < 1.0)\n\t\tres = f2;\n\telse if ((3.0 * hue) < 2.0)\n\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\telse\n\t\tres = f1;\n\treturn res;\n}\nvec3 HSLToRGB(vec3 hsl) {\n\tvec3 rgb;\n\tif (hsl.y == 0.0)\n\t\trgb = vec3(hsl.z);\n\telse {\n\t\tfloat f2;\n\t\tif (hsl.z < 0.5)\n\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\telse\n\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\n\t\tfloat f1 = 2.0 * hsl.z - f2;\n\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));\n\t\trgb.g = HueToRGB(f1, f2, hsl.x);\n\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));\n\t}\n\treturn rgb;\n}\nvec3 BlendHue(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));\n}\nvec3 BlendSaturation(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));\n}\nvec3 BlendColor(vec3 base, vec3 blend) {\n\tvec3 blendHSL = RGBToHSL(blend);\n\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));\n}\nvec3 BlendLuminosity(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));\n}\nvec3 BlendLighterColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal > baseTotal ? blend : base;\n}\nvec3 BlendDarkerColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal < baseTotal ? blend : base;\n}",
"#define BlendFunction(base, blend) "+c[e],d[e]?"#define MIX_ALPHA":"","varying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D previous;\nuniform float opacity;\nuniform float blendGamma;\nvec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {\n\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);\n\treturn mix(base.rgb, blendedColor, opacity * blend.a);\n}\nvec4 linear(vec4 color, vec3 gamma) {\n\treturn vec4(pow(color.rgb, gamma), color.a);\n}\nvoid main(void) {\n\tvec3 exp = vec3(blendGamma);\n\tvec4 topPixel = linear(texture2D(source, vTexCoord), exp);\n\tvec4 bottomPixel = texture2D(previous, vTexCoord);\n\tif (topPixel.a == 0.0) {\n\t\tgl_FragColor = bottomPixel;\n\t} else {\n\t\tfloat alpha;\n#ifdef MIX_ALPHA\n\t\talpha = topPixel.a * opacity;\n\t\talpha = alpha + bottomPixel.a * (1.0 - alpha);\n#else\n\t\talpha = bottomPixel.a;\n#endif\n\t\tbottomPixel = linear(bottomPixel, exp);\n\t\tgl_FragColor = vec4(pow(BlendOpacity(bottomPixel, topPixel, opacity), 1.0 / exp), alpha);\n\t}\n}"].join("\n");
return b},resize:function(){n&&(n[0].resize(this.width,this.height),n[1].resize(this.width,this.height))},draw:function(b,c,d,h,m){this.uniforms.previous=this.frameBuffer.texture;e=(e+1)%2;this.frameBuffer=h=n[e];this.texture=h.texture;this.inputs.clear?m(this.baseShader,c,d,h.frameBuffer,null):m(b,c,d,h.frameBuffer,null,a)},destroy:function(){n&&(n[0].destroy(),n[1].destroy(),n.length=0)}}},{inPlace:!1,title:"Accumulator",description:"Draw on top of previous frame",inputs:{source:{type:"image",uniform:"source"},
clear:{type:"boolean",defaultValue:!1},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4},blendMode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen",
"Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight","Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight","Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor",
"Lighter Color"]]}}})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a,c;c=document.createElement("img");c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvAAAAAICAYAAACf+MsnAAAFY0lEQVR4Xu2Z644bOwyDN+//0NsOigEMQdRHyU6CFDnA+bHVWNaFojiTx8/Pz+/f/4/89/v7z9Xj8Tjib3XyTN9usFcMz8gt3h9zXf/O6nD/W1V7Vb9uXad+nHucZ9xenX7OqTHdSfmRXfmPsSn8xPMrllcfCkdVfHSe7Ned0/yp7jv2GPfqK+MCByc0zzvxKi5RPq8cuvE4+JrwpFM7N78K2yu+qb9kd3qV+ZjUx5n/+xnXP81ctW/UHQ5P3Gd360vxKf+n8dGpxXTeKu6h2ansFT6pvo5G2/FP99NsUf9d/xleInfetcj629m9cf9WOV5K+78R8ERGRLYO8VQiecd/1vwKEJV46JBJRzhRfXftVL/MTgM48UmL0l2OSmzs9kctAJfE4/1KkNFzbj8cjFHsJ/u460vhnPDfqddujJ27poLCWWBuHt0YKr/ki+yOKJnk5Z7pPLfLf4TZif+qvi7XuDWg+HbtNEe79ds9H7m1m2/3+YzLK5Hc9e/gYxdfNP+ZfdV9lT3usWn+9310/qiAdxa1O5gTEqVhoLudxVwVNPrvCqDp/ZX4d0Uk1Y7sbgyU4zooCk8nB3i9Y61V5wWpIjDlP+ZJsxPvmLxEOD2sntk5Pz1LBOb0L+sPfQGs6ksYpt7QAiHuUwtkgl+F3Qyf2YxTX53+Vdjfjc8VYIq7KT+abzof7ervZ8fX8d/Jyc3PmTcnRrrPEbyVTnD8T+Y38pH624mfNIr6muzO95S/sh1Gvog/XmW/a6N+scww43zgqLjcOX9cwFeESQK3Gpx32QggTlwk8Ei8OXfE4VMLeCLQiLBjfJM7VA069XefnZBGJz7Vr24dK3GwEoqLD7p/1+4IMWdRdxaMK9CmP4E62F7nm8S7s4B3BMCkBzQPVQ0IM06+2WLvzlDlI+NfF4d0ljiHuF/Zb/4m/4ojTgnA6f0qfiWA135P5l/NoFv/7txm+5ZyyOw0e1R/skd8ZKKwwnjXf9xLrkBV+2x3Pib9Vz3JOMaNL/KZ+oCkXhDUTLxEwLsC41OfI5DEYe9+mXfr0l2mJH5ISHTOUw2U8IjD5LyVUtxEmrvi4V5ejvijWNWicBbOyfsrYejkMMXmdIFEAZH19ASWnNyrPlBdKH+yU3y0gGjGKf4Mv51ft9zzKk83vul5qr9r7+CT9gHx2zvs0/yofpGX1AuC4svqhYJeJJydNZk/urcSxet91dfiUy94HX6oBHCHi5+F38svCeg1h+zZ6nyF5VUzVC8Q0X9LwE/IkMjmpJ3i27XvxuqQ0c4dp/JTfnb9T847AoNIW/nokIYrYKvnJvln/siPwtD0XAeTU+x0luEugWdLNeY4ecl260vxK8Efl3OnZi4uaZZIMBFeJ/hw6xrFvppvV1Q559d8MwwR50cskIBQ2KhE3y7/ZeddAUjxOr3diZ/8U3+I953z7uzR7Lj4rvjl9HxXvaHaOflSfSkf93y24xx94PpX89I5H2t9+fwK+KVzNOwdIeM+e905+ZqqRIj7pYHiU3FNFnBnkO+41EKige3cpX7GunwoARfjIwKrxNhEJFLfMrsbI+G/smfkojAa60vxPcNeCZCqhjSra6ydBaAWSFzaqnb01c4VEdVCWWPM7svstKDWuKrZpwUb7dVsOzPcxUeGdYdfdgV8Vr+Mv1R8Tn/iHcSNWR8jjjv9URzama9qbp0XlBP4y2Jw6u/E577AZTVz/BM/OfySzSjl79o73FRxaFdfuPG5/XE58PbXEvAT8UBn1HKuSIB8ThYwiZfJnd8z768Aib/3R/iN4J0VeMXcVwvynbl/735OBV6BKTfyT+e/T4/f7dP3uW8F3Aqs/PIHbWXeeeKjnSsAAAAASUVORK5CYII=";
a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("ascii",function(){function d(){p=f.height;r=f.width;h=Math.ceil(r/8);m=Math.ceil(p/8);q.resolution=f.uniforms.resolution;q.transform=a;n&&n.resize(h,m)}var l,n,e,g,r,p,h,m,q={},f=this;return{initialize:function(f){function p(){g.bindTexture(g.TEXTURE_2D,e);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);
g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,c);g.bindTexture(g.TEXTURE_2D,null)}var r=this;f();this.texture=this.frameBuffer.texture;g=this.gl;e=g.createTexture();c.naturalWidth?p():c.addEventListener("load",function(){p();r.setDirty()});q.letters=e;g.bindTexture(g.TEXTURE_2D,this.texture||this.frameBuffer&&this.frameBuffer.texture);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,
g.NEAREST);g.bindTexture(g.TEXTURE_2D,null);d();n=new b.util.FrameBuffer(g,h,m);g.bindTexture(g.TEXTURE_2D,n.texture);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);this.uniforms.transform=a;l=this.baseShader},commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D letters;\nuniform vec4 background;\nuniform vec2 resolution;\nconst vec3 lumcoeff = vec3(0.2125, 0.7154, 0.0721);\nconst vec2 fontSize = vec2(8.0, 8.0);\nvec4 lookup(float ascii) {\n\tvec2 pos = mod(vTexCoord * resolution, fontSize) / vec2(752.0, fontSize.x) + vec2(ascii, 0.0);\n\treturn texture2D(letters, pos);\n}\nvoid main(void) {\n\tvec4 sample = texture2D(source, vTexCoord);\n\tvec4 clamped = vec4(floor(sample.rgb * 8.0) / 8.0, sample.a);\n\tfloat luma = dot(sample.rgb,lumcoeff);\n\tfloat char = floor(luma * 94.0) / 94.0;\n\tgl_FragColor = mix(background, clamped, lookup(char).r);\n}";
return b},resize:d,draw:function(a,b,c,d,f){f(l,b,c,n.frameBuffer,!1,{width:h,height:m,blend:!1});q.source=n.texture;q.background=c.background;f(a,b,q,d)},destroy:function(){n&&n.destroy();g&&e&&g.deleteTexture(e)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},background:{type:"color",uniform:"background",defaultValue:[0,0,0,1]}},description:"Display image as ascii text in 8-bit color.",title:"Ascii Text"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("bleach-bypass",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nconst vec4 one = vec4(1.0);\nconst vec4 two = vec4(2.0);\nconst vec4 lumcoeff = vec4(0.2125,0.7154,0.0721,0.0);\nvec4 overlay(vec4 myInput, vec4 previousmix, vec4 amount) {\n\tfloat luminance = dot(previousmix,lumcoeff);\n\tfloat mixamount = clamp((luminance - 0.45) * 10.0, 0.0, 1.0);\n\tvec4 branch1 = two * previousmix * myInput;\n\tvec4 branch2 = one - (two * (one - previousmix) * (one - myInput));\n\tvec4 result = mix(branch1, branch2, vec4(mixamount) );\n\treturn mix(previousmix, result, amount);\n}\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec4 luma = vec4(vec3(dot(pixel,lumcoeff)), pixel.a);\n\tgl_FragColor = overlay(luma, pixel, vec4(amount));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:1,min:0,max:1}},title:"Bleach Bypass",categories:["film"],description:'Bleach Bypass film treatment\nhttp://en.wikipedia.org/wiki/Bleach_bypass\nsee: "Saving Private Ryan", "Minority Report"'})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b,c){function d(a){var h={base:(b||"base")+"."+a,blend:(c||"blend")+"."+a};return function(a){return h[a]||a}}return"vec3("+a.replace(/blend|base/g,d("r"))+", "+a.replace(/blend|base/g,d("g"))+", "+a.replace(/blend|base/g,d("b"))+")"}var c={normal:"blend",lighten:"max(blend, base)",
darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",
saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:a("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))",
"blend","base"),colordodge:a("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:a("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:a("BlendLinearLightf(base, blend)"),vividlight:a("BlendVividLightf(base, blend)"),pinlight:a("BlendPinLightf(base, blend)"),hardmix:a("BlendHardMixf(base, blend)"),reflect:a("BlendReflectf(base, blend)"),glow:a("BlendReflectf(blend, base)")},d={},l=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("blend",function(){function a(){var b=
p&&d[p.mode];b&&h&&(r.blendEquation=h[b[0]],r.srcRGB=h[b[1]],r.dstRGB=h[b[2]],r.srcAlpha=h[b[3]],r.dstAlpha=h[b[4]])}var b,g,r={clear:!1},p,h;this.resize=function(){var a,c;a=this.inputs.sizeMode;var d;d=this.inputs.bottom;var h=this.inputs.top;"bottom"===a||"top"===a?(c=this.inputs[a])?(a=c.width,c=c.height):c=a=1:d?h?(c="union"===a?Math.max:Math.min,a=c(d.width,h.width),c=c(d.height,h.height)):(a=d.width,c=d.height):h?(a=h.width,c=h.height):c=a=1;if(this.width!==a||this.height!==c)this.width=a,
this.height=c,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=c,this.frameBuffer&&this.frameBuffer.resize(a,c),this.emit("resize"),this.setDirty();this.uniforms.resBottom[0]=d&&d.width||1;this.uniforms.resBottom[1]=d&&d.height||1;this.uniforms.resTop[0]=h&&h.width||1;this.uniforms.resTop[1]=h&&h.height||1;b&&(d&&(g.resolution[0]=d.width,g.resolution[1]=d.height),h&&(b.resolution[0]=h.width,b.resolution[1]=h.height));for(d=0;d<this.targets.length;d++)this.targets[d].resize()};this.uniforms.resTop=
[1,1];this.uniforms.resBottom=[1,1];return{initialize:function(b){p=this.inputs;b();h=this.gl;a()},shader:function(a,h){var f=a.mode||"normal",f=f.toLowerCase();if(d[f])return b||(f=this.inputs.top,b={resolution:[f&&f.width||1,f&&f.height||1],targetRes:this.uniforms.resolution,source:f,transform:f&&f.cumulativeMatrix||l,opacity:this.inputs.opacity},f=this.inputs.bottom,g={resolution:[f&&f.width||1,f&&f.height||1],targetRes:this.uniforms.resolution,source:f,transform:f&&f.cumulativeMatrix||l,opacity:1}),
h.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 targetRes;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.xy *= resolution / targetRes;\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n",
h.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor.a *= opacity;\n}",h;g=b=null;h.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resBottom;\nuniform vec2 resTop;\nvarying vec2 texCoordBottom;\nvarying vec2 texCoordTop;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordBottom = adjusted / resBottom + HALF;\n\ttexCoordTop = adjusted / resTop + HALF;\n}";
h.fragment=["precision mediump float;\nconst vec3 ZERO = vec3(0.0);\nconst vec3 ONE = vec3(1.0);\nconst vec3 HALF = vec3(0.5);\nconst vec3 TWO = vec3(2.0);\n#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)\n#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)\n#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)\n#define BlendLightenf(base, blend)\t\tmax(blend, base)\n#define BlendDarkenf(base, blend)\t\tmin(blend, base)\n#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))\n#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\nvec3 RGBToHSL(vec3 color) {\n\tvec3 hsl;\n\tfloat fmin = min(min(color.r, color.g), color.b);\n\tfloat fmax = max(max(color.r, color.g), color.b);\n\tfloat delta = fmax - fmin;\n\thsl.z = (fmax + fmin) / 2.0;\n\tif (delta == 0.0) {\n\t\thsl.x = 0.0;\n\t\thsl.y = 0.0;\n\t} else {\n\t\tif (hsl.z < 0.5)\n\t\t\thsl.y = delta / (fmax + fmin);\n\t\telse\n\t\t\thsl.y = delta / (2.0 - fmax - fmin);\n\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\n\t\tif (color.r == fmax )\n\t\t\thsl.x = deltaB - deltaG;\n\t\telse if (color.g == fmax)\n\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;\n\t\telse if (color.b == fmax)\n\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;\n\t\tif (hsl.x < 0.0)\n\t\t\thsl.x += 1.0;\n\t\telse if (hsl.x > 1.0)\n\t\t\thsl.x -= 1.0;\n\t}\n\treturn hsl;\n}\nfloat HueToRGB(float f1, float f2, float hue) {\n\tif (hue < 0.0)\n\t\thue += 1.0;\n\telse if (hue > 1.0)\n\t\thue -= 1.0;\n\tfloat res;\n\tif ((6.0 * hue) < 1.0)\n\t\tres = f1 + (f2 - f1) * 6.0 * hue;\n\telse if ((2.0 * hue) < 1.0)\n\t\tres = f2;\n\telse if ((3.0 * hue) < 2.0)\n\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\telse\n\t\tres = f1;\n\treturn res;\n}\nvec3 HSLToRGB(vec3 hsl) {\n\tvec3 rgb;\n\tif (hsl.y == 0.0)\n\t\trgb = vec3(hsl.z);\n\telse {\n\t\tfloat f2;\n\t\tif (hsl.z < 0.5)\n\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\telse\n\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\n\t\tfloat f1 = 2.0 * hsl.z - f2;\n\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));\n\t\trgb.g = HueToRGB(f1, f2, hsl.x);\n\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));\n\t}\n\treturn rgb;\n}\nvec3 BlendHue(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));\n}\nvec3 BlendSaturation(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));\n}\nvec3 BlendColor(vec3 base, vec3 blend) {\n\tvec3 blendHSL = RGBToHSL(blend);\n\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));\n}\nvec3 BlendLuminosity(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));\n}\nvec3 BlendLighterColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal > baseTotal ? blend : base;\n}\nvec3 BlendDarkerColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal < baseTotal ? blend : base;\n}",
"#define BlendFunction(base, blend) "+c[f],"varying vec2 texCoordBottom;\nvarying vec2 texCoordTop;\nuniform sampler2D top;\nuniform sampler2D bottom;\nuniform float opacity;\nuniform float blendGamma;\nvec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {\n\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);\n\treturn mix(base.rgb, blendedColor, opacity * blend.a);\n}\nvec4 linear(vec4 color, vec3 gamma) {\n\treturn vec4(pow(color.rgb, gamma), color.a);\n}\nvoid main(void) {\n\tvec3 exp = vec3(blendGamma);\n\tvec4 topPixel = linear(texture2D(top, texCoordTop), exp);\n\tvec4 bottomPixel = texture2D(bottom, texCoordBottom);\n\tif (topPixel.a == 0.0) {\n\t\tgl_FragColor = bottomPixel;\n\t} else {\n\t\tbottomPixel = linear(bottomPixel, exp);\n\t\tgl_FragColor = vec4(pow(BlendOpacity(bottomPixel, topPixel, opacity), 1.0 / exp), bottomPixel.a);\n\t}\n}"].join("\n");
return h},draw:function(a,c,f,l,n){d[this.inputs.mode]?(this.inputs.bottom?n(a,c,g,l):(h.viewport(0,0,this.width,this.height),h.bindFramebuffer(h.FRAMEBUFFER,l),h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)),this.inputs.top&&this.inputs.opacity&&n(a,c,b,l,null,r)):n(a,c,f,l)},requires:function(a){return this.inputs.opacity||"top"!==a?!0:!1},inputs:{top:{type:"image",uniform:"top",update:function(){b&&(b.source=this.inputs.top,b.transform=this.inputs.top.cumulativeMatrix||l);
this.resize()}},bottom:{type:"image",uniform:"bottom",update:function(){g&&(g.source=this.inputs.bottom,g.transform=this.inputs.bottom.cumulativeMatrix||l);this.resize()}},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1,updateSources:!0,update:function(a){b&&(b.opacity=a)}},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4},sizeMode:{type:"enum",defaultValue:"bottom",options:["bottom","top","union","intersection"],update:function(){this.resize()}},mode:{type:"enum",
shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight","Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],
["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight","Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]],update:function(){a()}}}}},{inPlace:function(){return!!d[this.inputs.mode]},description:"Blend two layers",title:"Blend"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=[0.2,0.3,0.5,0.8,1],c=a.length-1,d=[1,0],l=[0,1],n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("blur",function(e){var g,r,p,h={amount:0,blendGamma:2,inputScale:1,resolution:[this.width,this.height],transform:n,direction:null};return{initialize:function(a){a();
if(a=this.gl)p=this.baseShader,g=new b.util.FrameBuffer(a,this.width,this.height),r=new b.util.FrameBuffer(a,this.width,this.height)},commonShader:!0,shader:function(a,b){var c=this.gl,c=10<=c.getParameter(c.MAX_VARYING_VECTORS)?"#define USE_VARYINGS":"";b.vertex=[c,"precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform vec2 direction;\nuniform float amount;\nuniform float inputScale;\nconst vec2 zero = vec2(0.0, 0.0);\nvarying vec2 vTexCoord;\n#ifdef USE_VARYINGS\nvec2 one;\nvec2 amount1;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 one;\nvarying vec2 amount1;\n#endif\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n\tone = vec2(1.0, 1.0) * inputScale;\n\tif (inputScale < 1.0) {\n\t\tone -= 1.0 / resolution;\n\t}\n\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));\n\tamount1 = direction * (inputScale * amount * 5.0 / resolution);\n#ifdef USE_VARYINGS\n\tvec2 amount2 = amount1 * 3.0;\n\tvec2 amount3 = amount1 * 6.0;\n\tvec2 amount4 = amount1 * 9.0;\n\tvec2 amount5 = -amount1;\n\tvec2 amount6 = amount5 * 3.0;\n\tvec2 amount7 = amount5 * 6.0;\n\tvec2 amount8 = amount5 * 9.0;\n\tvTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvTexCoord2 = max(zero, min(one, vTexCoord + amount2));\n\tvTexCoord3 = max(zero, min(one, vTexCoord + amount3));\n\tvTexCoord4 = max(zero, min(one, vTexCoord + amount4));\n\tvTexCoord5 = max(zero, min(one, vTexCoord + amount5));\n\tvTexCoord6 = max(zero, min(one, vTexCoord + amount6));\n\tvTexCoord7 = max(zero, min(one, vTexCoord + amount7));\n\tvTexCoord8 = max(zero, min(one, vTexCoord + amount8));\n#endif\n}"].join("\n");
b.fragment=[c,"precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float blendGamma;\n#ifdef USE_VARYINGS\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 amount1;\nvarying vec2 one;\nconst vec2 zero = vec2(0.0, 0.0);\n#endif\nvec3 exp;\nvec4 sample(sampler2D sampler, vec2 coord) {\n\tvec4 pixel = texture2D(sampler, coord);\n\tpixel.rgb = pow(pixel.rgb, exp);\n\treturn pixel;\n}\nvoid main(void) {\nexp = vec3(blendGamma);\n#ifndef USE_VARYINGS\n\tvec2 vTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvec2 vTexCoord2 = max(zero, min(one, vTexCoord + amount1 * 3.0));\n\tvec2 vTexCoord3 = max(zero, min(one, vTexCoord + amount1 * 6.0));\n\tvec2 vTexCoord4 = max(zero, min(one, vTexCoord + amount1 * 9.0));\n\tvec2 vTexCoord5 = max(zero, min(one, vTexCoord - amount1));\n\tvec2 vTexCoord6 = max(zero, min(one, vTexCoord - amount1 * 3.0));\n\tvec2 vTexCoord7 = max(zero, min(one, vTexCoord - amount1 * 6.0));\n\tvec2 vTexCoord8 = max(zero, min(one, vTexCoord - amount1 * 9.0));\n#endif\n\tgl_FragColor = sample(source, vTexCoord) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord1) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord2) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord3) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord4) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord5) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord6) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord7) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord8) / 9.0;\n\tgl_FragColor.rgb = pow(gl_FragColor.rgb, 1.0 / exp);\n}"].join("\n");
return b},draw:function(b,e,f,n,y){var v,B,M,G,fa={width:0,height:0,blend:!1},z=1;if(B=this.inputs.amount)if(0.01>=B)f.inputScale=1,f.direction=d,f.source=this.inputs.source.texture,y(b,e,f,g.frameBuffer),f.direction=l,f.source=g.texture,y(b,e,f,n);else for(h.amount=B,h.blendGamma=f.blendGamma,h.source=this.inputs.source.texture,f=0;f<a.length;f++)v=Math.min(1,a[f]/B),M=Math.floor(v*this.width),G=Math.floor(v*this.height),h.resolution[0]=M,h.resolution[1]=G,h.inputScale=z,z=v,fa.width=M,fa.height=
G,h.direction=d,y(b,e,h,g.frameBuffer,null,fa),h.inputScale=v,h.source=g.texture,h.direction=l,y(b,e,h,f===c?n:r.frameBuffer,null,fa),h.source=r.texture;else f.source=this.inputs.source.texture,y(p,e,f,n)},resize:function(){h.resolution[0]=this.width;h.resolution[1]=this.height;g&&(g.resize(this.width,this.height),r.resize(this.width,this.height))},destroy:function(){g&&(g.destroy(),r.destroy(),r=g=null);h=null}}},{inputs:{source:{type:"image",shaderDirty:!1},amount:{type:"number",uniform:"amount",
defaultValue:0.2,min:0,max:1},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4}},title:"Gaussian Blur"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("brightness-contrast",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float brightness;\nuniform float saturation;\nuniform float contrast;\nconst vec3 half3 = vec3(0.5);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 color = pixel.rgb * brightness;\n\tcolor = (color - half3) * contrast + half3;\n\tgl_FragColor = vec4(color, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},brightness:{type:"number",uniform:"brightness",defaultValue:1,min:0},contrast:{type:"number",uniform:"contrast",defaultValue:1,min:0}},title:"Brightness/Contrast",description:"Multiply brightness and contrast values. Works the same as CSS filters."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=["Red","Green","Blue","Alpha"],c={r:0,g:1,b:2,a:3,x:0,y:1,z:2,w:3};b.plugin("channels",function(){function d(a,b,d){"string"===typeof a?(b=a.charAt(0).toLowerCase(),b=c[b],void 0===b&&(b=-1),0>b&&(b=parseFloat(a))):b=a;return 0===b||1===b||2===b||3===b?b:p.inputs[d]}function l(){var a=
p.inputs,b,c,d,g;for(b=0;b<e.length;b++){d=e[b];g=r[b];g||(g=r[b]=[],p.uniforms["channels"+b]=g);for(c=0;16>c;c++)g[c]=0;g[a.red]=a.redSource===d?1:0;g[4+a.green]=a.greenSource===d?1:0;g[8+a.blue]=a.blueSource===d?1:0;g[12+a.alpha]=a.alphaSource===d?1:0}}function n(){function a(c){var d;d=b[c];d||(d=p.sources[c]=b[c]=b.source);c=e.indexOf(d);0>c&&(c=e.length,e.push(d),p.uniforms["source"+c]=d)}var b=p.inputs;e.length=0;a("redSource");a("greenSource");a("blueSource");a("alphaSource");p.resize();l()}
var e=[],g=[],r=[],p=this;this.resize=function(){var a,b;a=this.inputs.sizeMode;var c,d,g;if(e.length)if(1===e.length)g=e[0],a=g.width,b=g.height;else if("union"===a)for(c=b=a=0;c<e.length;c++)g=e[0],a=Math.max(a,g.width),b=Math.max(b,g.height);else if("intersection"===a)for(b=a=Infinity,c=0;c<e.length;c++)g=e[0],a=Math.min(a,g.width),b=Math.min(b,g.height);else(g=p.inputs[a+"Source"])?(a=g.width,b=g.height):b=a=1;else b=a=1;for(c=0;c<e.length;c++)g=e[c],(d=p.uniforms["resolution"+c])?(d[0]=g.width,
d[1]=g.height):p.uniforms["resolution"+c]=[g.width,g.height];if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b,this.frameBuffer&&this.frameBuffer.resize(a,b),this.emit("resize"),this.setDirty();for(c=0;c<this.targets.length;c++)this.targets[c].resize()};return{shader:function(){var a,c,d=c="",f="",l="";if(g[e.length])return g[e.length];for(a=0;a<e.length;a++)f+="varying vec2 vTexCoord"+a+";\n",c+="uniform sampler2D source"+a+
";\nuniform mat4 channels"+a+";\nuniform vec2 resolution"+a+";\n\n",l+="    vTexCoord"+a+" = (position.xy * resolution / resolution"+a+") * 0.5 + 0.5;\n",d+="    if (all(greaterThanEqual(vTexCoord"+a+", vec2(0.0))) && all(lessThan(vTexCoord"+a+", vec2(1.0)))) {\n        gl_FragColor += texture2D(source"+a+", vTexCoord"+a+") * channels"+a+";\n    }\n";a=["precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;",c,f,"void main(void) {",l,"\tgl_Position = position;\n}\n"].join("\n");
c=["precision mediump float;",f,c,"void main(void) {\n\tgl_FragColor = vec4(0.0);",d,"}"].join("\n");c=new b.util.ShaderProgram(this.gl,a,c);return g[e.length]=c},inputs:{sizeMode:{type:"enum",defaultValue:"red",options:"red green blue alpha union intersection".split(" "),update:function(){this.resize()}},source:{type:"image",update:n,shaderDirty:!0},redSource:{type:"image",update:n,shaderDirty:!0},greenSource:{type:"image",update:n,shaderDirty:!0},blueSource:{type:"image",update:n,shaderDirty:!0},
alphaSource:{type:"image",update:n,shaderDirty:!0},red:{type:"enum",options:a,validate:d,update:l,defaultValue:0},green:{type:"enum",options:a,validate:d,update:l,defaultValue:1},blue:{type:"enum",options:a,validate:d,update:l,defaultValue:2},alpha:{type:"enum",options:a,validate:d,update:l,defaultValue:3}}}},{inPlace:!1,title:"Channel Mapping"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("checkerboard",function(){function a(){b.resize()}var b=this;return{initialize:function(b){b();a()},shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform vec2 size;\nuniform vec2 anchor;\nvec2 pixelCoord;\nvarying vec2 vGridCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tpixelCoord = resolution * (texCoord - 0.5) / 2.0;\n\tvGridCoord = (pixelCoord - anchor) / size;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec2 vPixelCoord;\nvarying vec2 vGridCoord;\nuniform vec2 resolution;\nuniform vec2 anchor;\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\nvoid main(void) {\n\tvec2 modGridCoord = floor(mod(vGridCoord, 2.0));\n\tif (modGridCoord.x == modGridCoord.y) {\n\t\tgl_FragColor = color1;\n\t} else  {\n\t\tgl_FragColor = color2;\n\t}\n}";return b},inPlace:!0,inputs:{anchor:{type:"vector",uniform:"anchor",dimensions:2,defaultValue:[0,
0]},size:{type:"vector",uniform:"size",dimensions:2,defaultValue:[4,4]},color1:{type:"color",uniform:"color1",defaultValue:[1,1,1,1]},color2:{type:"color",uniform:"color2",defaultValue:[187/255,187/255,187/255,1]},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360}}}},{commonShader:!0,title:"Checkerboard",categories:["generator"]})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("chroma",{shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nuniform vec4 screen;\nuniform float balance;\nvarying float screenSat;\nvarying vec3 screenPrimary;\nvoid main(void) {\n\tfloat fmin = min(min(screen.r, screen.g), screen.b);\n\tfloat fmax = max(max(screen.r, screen.g), screen.b);\n\tfloat secondaryComponents;\n\tscreenPrimary = step(fmax, screen.rgb);\n\tsecondaryComponents = dot(1.0 - screenPrimary, screen.rgb);\n\tscreenSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n}";
b.fragment=[this.inputs.mask?"#define MASK":"","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 screen;\nuniform float screenWeight;\nuniform float balance;\nuniform float clipBlack;\nuniform float clipWhite;\nuniform bool mask;\nvarying float screenSat;\nvarying vec3 screenPrimary;\nvoid main(void) {\n\tfloat pixelSat, secondaryComponents;\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tfloat fmin = min(min(sourcePixel.r, sourcePixel.g), sourcePixel.b);\n\tfloat fmax = max(max(sourcePixel.r, sourcePixel.g), sourcePixel.b);\n\tvec3 pixelPrimary = step(fmax, sourcePixel.rgb);\n\tsecondaryComponents = dot(1.0 - pixelPrimary, sourcePixel.rgb);\n\tpixelSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\tfloat diffPrimary = dot(abs(pixelPrimary - screenPrimary), vec3(1.0));\n\tfloat solid = step(1.0, step(pixelSat, 0.1) + step(fmax, 0.1) + diffPrimary);\n\tfloat alpha = max(0.0, 1.0 - pixelSat / screenSat);\n\talpha = smoothstep(clipBlack, clipWhite, alpha);\n\tvec4 semiTransparentPixel = vec4((sourcePixel.rgb - (1.0 - alpha) * screen.rgb * screenWeight) / max(0.00001, alpha), alpha);\n\tvec4 pixel = mix(semiTransparentPixel, sourcePixel, solid);\n#ifdef MASK\n\tgl_FragColor = vec4(vec3(pixel.a), 1.0);\n#else\n\tgl_FragColor = pixel;\n#endif\n}"].join("\n");
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},screen:{type:"color",uniform:"screen",defaultValue:[66/255,195/255,31/255,1]},weight:{type:"number",uniform:"screenWeight",defaultValue:1,min:0},balance:{type:"number",uniform:"balance",defaultValue:1,min:0,max:1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},mask:{type:"boolean",defaultValue:!1,uniform:"mask",shaderDirty:!0}},title:"Chroma Key",
description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("color",function(){function a(){c.resize()}var c=this,d={width:1,height:1},l=!0;this.resize=function(){var a,b;this.inputs&&this.inputs.width?(a=this.inputs.width,b=this.inputs.height||a):this.inputs&&this.inputs.height?a=b=this.inputs.height:b=a=1;a=Math.floor(a);b=
Math.floor(b);if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)b=this.targets[a],b.resize(),b.setTransformDirty&&b.setTransformDirty()};return{initialize:function(c){this.frameBuffer=new b.util.FrameBuffer(this.gl,1,1);a();l=!0},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nvoid main(void) {\n\tgl_Position = position;\n}\n";b.fragment="precision mediump float;\n\nuniform vec4 color;\nvoid main(void) {\n\tgl_FragColor = color;\n}";
return b},draw:function(a,b,c,r,p){l&&(p(a,b,c,r,null,d),l=!1)},inPlace:!0,inputs:{color:{type:"color",uniform:"color",defaultValue:[0,0,0,1],update:function(){l=!0}},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360}}}},{title:"Color",description:"Generate color",categories:["generator"]})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("colorcomplements",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 guideColor;\nuniform float correlation;\nuniform float amount;\nuniform float concentration;\nfloat hueLerp(float h1, float h2, float v) {\n\tfloat d = abs(h1 - h2);\n\tif (d <= 0.5) {\n\t\treturn mix(h1, h2, v);\n\t} else if (h1 < h2) {\n\t\treturn fract(mix((h1 + 1.0), h2, v));\n\t} else {\n\t\treturn fract(mix(h1, (h2 + 1.0), v));\n\t}\n}\nvec3 rgbToHsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsvToRgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 hsvComplement(vec3 hsv) {\n\tvec3 compl = hsv;\n\tcompl.x = mod(compl.x - 0.5, 1.0);\n\treturn compl;\n}\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 hsv = rgbToHsv(pixel.rgb);\n\tvec3 hsvPole1 = rgbToHsv(guideColor.rgb);\n\tvec3 hsvPole2 = hsvPole1;\n\thsvPole2 = hsvComplement(hsvPole1);\n\tfloat dist1 = abs(hsv.x - hsvPole1.x);\n\tdist1 = dist1 > 0.5 ? 1.0 - dist1 : dist1;\n\tfloat dist2 = abs(hsv.x - hsvPole2.x);\n\tdist2 = dist2 > 0.5 ? 1.0 - dist2 : dist2;\n\tfloat descent = smoothstep(0.0, correlation, hsv.y);\n\tvec3 outputHsv = hsv;\n\tvec3 pole = dist1 < dist2 ? hsvPole1 : hsvPole2;\n\tfloat dist = min(dist1, dist2);\n\tfloat c = descent * amount * (1.0 - pow((dist * 2.0), 1.0 / concentration));\n\toutputHsv.x = hueLerp(hsv.x, pole.x, c);\n\toutputHsv.y = mix(hsv.y, pole.y, c);\n\tgl_FragColor = vec4(hsvToRgb(outputHsv), pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:0.8},concentration:{type:"number",uniform:"concentration",min:0.1,max:4,defaultValue:2},correlation:{type:"number",uniform:"correlation",min:0,max:1,defaultValue:0.5},guideColor:{type:"color",uniform:"guideColor",defaultValue:[1,0.5,0,1]}},title:"Color Complements",categories:["color"],description:"http://theabyssgazes.blogspot.com/2010/03/teal-and-orange-hollywood-please-stop.html"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("colorcube",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nuniform sampler2D source;\nuniform sampler2D colorCube;\nvarying vec2 vTexCoord;\nvec3 sampleAs3DTexture(sampler2D tex, vec3 coord, float size) {\n\tfloat sliceSize = 1.0 / size;\n\tfloat slicePixelSize = sliceSize / size;\n\tfloat sliceInnerSize = slicePixelSize * (size - 1.0);\n\tfloat zSlice0 = min(floor(coord.z * size), size - 1.0);\n\tfloat zSlice1 = min(zSlice0 + 1.0, size - 1.0);\n\tfloat xOffset = slicePixelSize * 0.5 + coord.x * sliceInnerSize;\n\tfloat s0 = xOffset + (zSlice0 * sliceSize);\n\tfloat s1 = xOffset + (zSlice1 * sliceSize);\n\tvec3 slice0Color = texture2D(tex, vec2(s0, 1.0 - coord.y)).rgb;\n\tvec3 slice1Color = texture2D(tex, vec2(s1, 1.0 - coord.y)).rgb;\n\tfloat zOffset = mod(coord.z * size, 1.0);\n\treturn mix(slice0Color, slice1Color, zOffset);\n}\nvoid main(void) {\n\tvec4 originalColor = texture2D(source, vTexCoord);\n\tvec3 color = sampleAs3DTexture(colorCube, originalColor.rgb, 8.0);\n\tgl_FragColor = vec4(color, originalColor.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},cube:{type:"image",uniform:"colorCube"}},title:"Color Cube",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("color-select",{shader:function(a,b,d){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float hueMin;\nuniform float hueMax;\nuniform float hueMinFalloff;\nuniform float hueMaxFalloff;\nuniform float saturationMin;\nuniform float saturationMax;\nuniform float saturationMinFalloff;\nuniform float saturationMaxFalloff;\nuniform float lightnessMin;\nuniform float lightnessMax;\nuniform float lightnessMinFalloff;\nuniform float lightnessMaxFalloff;\nvarying vec2 vTexCoord;\nvarying vec4 adjustedHueRange;\nvarying vec4 saturationRange;\nvarying vec4 lightnessRange;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tfloat hueOffset = hueMin - hueMinFalloff;\n\tadjustedHueRange = mod(vec4(hueOffset, hueMin - hueOffset, hueMax - hueOffset, hueMax + hueMaxFalloff - hueOffset), 360.0);\n\tif (hueMin != hueMax) {\n\t\tif (adjustedHueRange.z == 0.0) {\n\t\t\tadjustedHueRange.z = 360.0;\n\t\t\tadjustedHueRange.w += 360.0;\n\t\t} else if (adjustedHueRange.w == 0.0) {\n\t\t\tadjustedHueRange.w += 360.0;\n\t\t}\n\t}\n\tsaturationRange = vec4(saturationMin - saturationMinFalloff, saturationMin, saturationMax, saturationMax + saturationMaxFalloff );\n\tlightnessRange = vec4(lightnessMin - lightnessMinFalloff, lightnessMin, lightnessMax, lightnessMax + lightnessMaxFalloff );\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform bool mask;\nvarying vec4 adjustedHueRange;\nvarying vec4 saturationRange;\nvarying vec4 lightnessRange;\nvec3 calcHSL(vec3 c) {\n\tfloat minColor = min(c.r, min(c.g, c.b));\n\tfloat maxColor = max(c.r, max(c.g, c.b));\n\tfloat delta = maxColor - minColor;\n\tvec3 hsl = vec3(0.0, 0.0, (maxColor + minColor) / 2.0);\n\tif (delta > 0.0) {\n\t\tif (hsl.z < 0.5) {\n\t\t\thsl.y = delta / (maxColor + minColor);\n\t\t} else {\n\t\t\thsl.y = delta / (2.0 - maxColor - minColor);\n\t\t}\n\t\tif (c.r == maxColor) {\n\t\t\thsl.x = (c.g - c.b) / delta;\n\t\t} else if (c.g == maxColor) {\n\t\t\thsl.x = 2.0 + (c.b - c.r) / delta;\n\t\t} else {\n\t\t\thsl.x = 4.0 + (c.r - c.g) / delta;\n\t\t}\n\t\thsl.x = hsl.x * 360.0 / 6.0;\n\t\tif (hsl.x < 0.0) {\n\t\t\thsl.x += 360.0;\n\t\t} else {\n\t\t\thsl.x = mod(hsl.x, 360.0);\n\t\t}\n\t}\n\treturn hsl;\n}\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tvec3 hsl = calcHSL(color.rgb);\n\tfloat adjustedHue = mod(hsl.x - adjustedHueRange.x, 360.0);\n\tfloat maskValue;\n\tif (adjustedHue < adjustedHueRange.y) {\n\t\tmaskValue = smoothstep(0.0, adjustedHueRange.y, adjustedHue);\n\t} else if (adjustedHue < adjustedHueRange.z) {\n\t\tmaskValue = 1.0;\n\t} else {\n\t\tmaskValue = 1.0 - smoothstep(adjustedHueRange.z, adjustedHueRange.w, adjustedHue);\n\t}\n\tif (maskValue > 0.0) {\n\t\tif (hsl.y < saturationRange.y) {\n\t\t\tmaskValue = min(maskValue, smoothstep(saturationRange.x, saturationRange.y, hsl.y));\n\t\t} else {\n\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(saturationRange.z, saturationRange.w, hsl.y));\n\t\t}\n\t}\n\tif (maskValue > 0.0) {\n\t\tif (hsl.z < lightnessRange.y) {\n\t\t\tmaskValue = min(maskValue, smoothstep(lightnessRange.x, lightnessRange.z, hsl.y));\n\t\t} else {\n\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(lightnessRange.z, lightnessRange.w, hsl.z));\n\t\t}\n\t}\n\tif (mask) {\n\t\tgl_FragColor = vec4(maskValue, maskValue, maskValue, 1.0);\n\t} else {\n\t\tcolor.a = min(color.a, maskValue);\n\t\tgl_FragColor = color;\n\t}\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hueMin:{type:"number",uniform:"hueMin",defaultValue:0},hueMax:{type:"number",uniform:"hueMax",defaultValue:360},hueMinFalloff:{type:"number",uniform:"hueMinFalloff",defaultValue:0,min:0},hueMaxFalloff:{type:"number",uniform:"hueMaxFalloff",defaultValue:0,min:0},saturationMin:{type:"number",uniform:"saturationMin",defaultValue:0,min:0,max:1},saturationMax:{type:"number",uniform:"saturationMax",defaultValue:1,min:0,max:1},saturationMinFalloff:{type:"number",
uniform:"saturationMinFalloff",defaultValue:0,min:0},saturationMaxFalloff:{type:"number",uniform:"saturationMaxFalloff",defaultValue:0,min:0},lightnessMin:{type:"number",uniform:"lightnessMin",defaultValue:0,min:0,max:1},lightnessMax:{type:"number",uniform:"lightnessMax",defaultValue:1,min:0,max:1},lightnessMinFalloff:{type:"number",uniform:"lightnessMinFalloff",defaultValue:0,min:0},lightnessMaxFalloff:{type:"number",uniform:"lightnessMaxFalloff",defaultValue:0,min:0},mask:{type:"boolean",defaultValue:!1,
uniform:"mask"}},title:"Color Select",description:"Create a mask by hue, saturation and lightness range."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("crop",function(){function a(){var a=1,l=1;b.source?(a=b.source.width,l=b.source.height):b.sources&&b.sources.source&&(a=b.sources.source.width,l=b.sources.source.height);a=a-b.inputs.left-b.inputs.right;l=l-b.inputs.top-b.inputs.bottom;a=Math.max(1,Math.floor(a));l=
Math.max(1,Math.floor(l));if(b.width!==a||b.height!==l)b.width=a,b.height=l,b.uniforms.resolution[0]=a,b.uniforms.resolution[1]=l,b.frameBuffer&&b.frameBuffer.resize(b.width,b.height),b.emit("resize"),b.setDirty();for(l=0;l<b.targets.length;l++)a=b.targets[l],a.resize(),a.setTransformDirty&&a.setTransformDirty()}var b=this;b.resize=a;return{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float top;\nuniform float left;\nuniform float bottom;\nuniform float right;\nvarying vec2 vTexCoord;\nconst vec2 ZERO = vec2(0.0);\nconst vec2 ONE = vec2(1.0);\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 dim = resolution + vec2(right + left, bottom + top);\n\tvec2 scale = dim / resolution;\n\tvec2 offset = vec2(left, bottom) / resolution;\n\tvTexCoord = max(ZERO, (texCoord + offset) / scale);\n}\n";
return b},inputs:{source:{type:"image",uniform:"source",update:a},top:{type:"number",uniform:"top",min:0,step:1,update:a,defaultValue:0},left:{type:"number",uniform:"left",min:0,step:1,update:a,defaultValue:0},bottom:{type:"number",uniform:"bottom",min:0,step:1,update:a,defaultValue:0},right:{type:"number",uniform:"right",min:0,step:1,update:a,defaultValue:0}}}},{inPlace:!0,title:"Crop"})});(function(b,a){if("function"===typeof define&&define.amd)define(["seriously"],a);else if("object"===typeof exports)a(require("seriously"));else{var c=b.Seriously;c||(c={plugin:function(a,b){this[a]=b}});a(c)}})(this,function(b){b.plugin("daltonize",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec3 position;\nattribute vec2 texCoord;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tgl_Position = transform * vec4(position, 1.0);\n\tvTexCoord = vec2(texCoord.s, texCoord.t);\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float cbtype;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tif (cbtype == 0.0) {\n\t\tgl_FragColor = color;\n\t\treturn;\n\t}\n\tconst mat3 RGBLMS = mat3( \t\t17.8824, 43.5161, 4.11935,\t\t3.45565, 27.1554, 3.86714,\t\t0.0299566, 0.184309, 1.46709\t);\n\tvec3 LMS = color.rgb * RGBLMS;\n\tvec3 lms = vec3(0.0,0.0,0.0);\n\tif (cbtype < 0.33) {\n\t\tlms = vec3(\t\t\t\t(2.02344 * LMS.g) + (-2.52581 * LMS.b),\t\t\tLMS.g,\t\t\tLMS.b\t\t);\n\t}\n\tif (cbtype > 0.33 && cbtype < 0.66) {\n\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\t(0.494207 * LMS.r) + (1.24827 * LMS.b),\t\t\tLMS.b\t\t);\n\t}\n\tif (cbtype > 0.66) {\n\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\tLMS.g,\t\t\t(-0.395913 * LMS.r) + (0.801109 * LMS.g)\t\t);\n\t}\n\tconst mat3 LMSRGB = mat3(    \t\t0.0809444479, -0.130504409, 0.116721066,\t\t-0.0102485335, 0.0540193266, -0.113614708,\t\t-0.000365296938, -0.00412161469, 0.693511405\t);\n\tvec3 RGB = lms * LMSRGB;\n\tRGB.rgb = color.rgb - RGB.rgb;\n\tRGB.g = 0.7*RGB.r + RGB.g;\n\tRGB.b = 0.7*RGB.r + RGB.b;\n\tcolor.rgb = color.rgb + RGB.rgb;\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},type:{title:"Type",type:"enum",uniform:"cbtype",defaultValue:"0.2",options:[["0.0","Off"],["0.2","Protanope"],["0.6","Deuteranope"],["0.8","Tritanope"]]}},title:"Daltonize",description:"Add contrast to colours to assist CVD (colour-blind) users."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=[0.2,0.3,0.5,0.8],c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("directionblur",function(d){var l,n,e={amount:0,blendGamma:2,angle:0,inputScale:1,resolution:[this.width,this.height],transform:c,projection:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,
1])};return{initialize:function(a){a();(a=this.gl)&&(l=[new b.util.FrameBuffer(a,this.width,this.height),new b.util.FrameBuffer(a,this.width,this.height)])},commonShader:!0,shader:function(a,b){var c=this.gl,c=10<=c.getParameter(c.MAX_VARYING_VECTORS)?"#define USE_VARYINGS":"";n=this.baseShader;b.vertex=[c,"precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nuniform float angle;\nuniform float amount;\nuniform float inputScale;\nconst vec2 zero = vec2(0.0, 0.0);\n#ifdef USE_VARYINGS\nvec2 one;\nvec2 amount1;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 one;\nvarying vec2 amount1;\n#endif\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n\tone = vec2(1.0, 1.0) * inputScale;\n\tif (inputScale < 1.0) {\n\t\tone -= 1.0 / resolution;\n\t}\n\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));\n\tamount1 = vec2(cos(angle), sin(angle)) * amount * 5.0 / resolution;\n#ifdef USE_VARYINGS\n\tvec2 amount2 = amount1 * 3.0;\n\tvec2 amount3 = amount1 * 6.0;\n\tvec2 amount4 = amount1 * 9.0;\n\tvec2 amount5 = -amount1;\n\tvec2 amount6 = amount5 * 3.0;\n\tvec2 amount7 = amount5 * 6.0;\n\tvec2 amount8 = amount5 * 9.0;\n\tvTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvTexCoord2 = max(zero, min(one, vTexCoord + amount2));\n\tvTexCoord3 = max(zero, min(one, vTexCoord + amount3));\n\tvTexCoord4 = max(zero, min(one, vTexCoord + amount4));\n\tvTexCoord5 = max(zero, min(one, vTexCoord + amount5));\n\tvTexCoord6 = max(zero, min(one, vTexCoord + amount6));\n\tvTexCoord7 = max(zero, min(one, vTexCoord + amount7));\n\tvTexCoord8 = max(zero, min(one, vTexCoord + amount8));\n#endif\n}"].join("\n");
b.fragment=[c,"precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float angle;\nuniform float amount;\nuniform float blendGamma;\n#ifdef USE_VARYINGS\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 amount1;\nvarying vec2 one;\nconst vec2 zero = vec2(0.0, 0.0);\n#endif\nvec3 exp;\nvec4 sample(sampler2D sampler, vec2 coord) {\n\tvec4 pixel = texture2D(sampler, coord);\n\tpixel.rgb = pow(pixel.rgb, exp);\n\treturn pixel;\n}\nvoid main(void) {\nexp = vec3(blendGamma);\n#ifndef USE_VARYINGS\n\tvec2 vTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvec2 vTexCoord2 = max(zero, min(one, vTexCoord + amount1 * 3.0));\n\tvec2 vTexCoord3 = max(zero, min(one, vTexCoord + amount1 * 6.0));\n\tvec2 vTexCoord4 = max(zero, min(one, vTexCoord + amount1 * 9.0));\n\tvec2 vTexCoord5 = max(zero, min(one, vTexCoord - amount1));\n\tvec2 vTexCoord6 = max(zero, min(one, vTexCoord - amount1 * 3.0));\n\tvec2 vTexCoord7 = max(zero, min(one, vTexCoord - amount1 * 6.0));\n\tvec2 vTexCoord8 = max(zero, min(one, vTexCoord - amount1 * 9.0));\n#endif\n\tgl_FragColor = sample(source, vTexCoord) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord1) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord2) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord3) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord4) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord5) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord6) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord7) / 9.0;\n\tgl_FragColor += sample(source, vTexCoord8) / 9.0;\n\tgl_FragColor.rgb = pow(gl_FragColor.rgb, 1.0 / exp);\n}"].join("\n");
return b},draw:function(b,c,d,h,m){var q,f,x,y,v,B={width:0,height:0,blend:!1},M=1;if(x=this.inputs.amount)if(0.01>=x)m(b,c,d,h);else{e.amount=x;e.angle=this.inputs.angle;e.projection[0]=this.height/this.width;for(d=0;d<a.length;d++)f=Math.min(1,a[d]/x),y=Math.floor(f*this.width),v=Math.floor(f*this.height),e.source=q?q.texture:this.inputs.source.texture,q=l[d%2],e.inputScale=M,M=f,B.width=y,B.height=v,m(b,c,e,q.frameBuffer,null,B);e.source=q.texture;e.inputScale=M;m(b,c,e,h)}else m(n,c,d,h)},resize:function(){e.resolution[0]=
this.width;e.resolution[1]=this.height;l&&(l[0].resize(this.width,this.height),l[1].resize(this.width,this.height))},destroy:function(){l&&(l[0].destroy(),l[1].destroy(),l=null);e=null}}},{inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:0.4,min:0,max:1},angle:{type:"number",uniform:"angle",defaultValue:0},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4}},title:"Directional Motion Blur"})});(function(b,a){"object"===typeof exports?a(require("seriously")):"function"===typeof define&&define.amd?define(["seriously"],a):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a={wrap:"pos = mod(pos, 1.0);",clamp:"pos = min(max(pos, 0.0), 1.0);",ignore:"pos = texCoordSource;",color:"gl_FragColor = color;\n\treturn;"},c={none:[0,0,0,0],red:[1,0,0,0],green:[0,1,0,0],blue:[0,0,1,0],alpha:[0,0,0,1],luma:[0.2125,0.7154,0.0721,0],lightness:[1/3,1/3,1/
3,0]};b.plugin("displacement",function(){this.uniforms.resMap=[1,1];this.uniforms.resSource=[1,1];this.uniforms.xVector=c.red;this.uniforms.yVector=c.green;return{shader:function(b,c){var n=a[b.fillMode];c.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resSource;\nuniform vec2 resMap;\nvarying vec2 texCoordSource;\nvarying vec2 texCoordMap;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordSource = adjusted / resSource + HALF;\n\ttexCoordMap = adjusted / resMap + HALF;\n}";
c.fragment=["precision mediump float;\n\nvarying vec2 texCoordSource;\nvarying vec2 texCoordMap;\nuniform sampler2D source;\nuniform sampler2D map;\nuniform float amount;\nuniform float offset;\nuniform vec2 mapScale;\nuniform vec4 color;\nuniform vec4 xVector;\nuniform vec4 yVector;\nvoid main(void) {\n\tvec4 mapPixel = texture2D(map, texCoordMap);\n\tvec2 mapVector = vec2(dot(mapPixel, xVector), dot(mapPixel, yVector));\n\tvec2 pos = texCoordSource + (mapVector.xy - offset) * mapScale * amount;\n\tif (pos.x < 0.0 || pos.x > 1.0 || pos.y < 0.0 || pos.y > 1.0) {",
"\t\t"+n,"\t}\n\tgl_FragColor = texture2D(source, pos);\n}"].join("\n");return c},requires:function(a){return this.inputs.mapScale||"map"!==a?!0:!1},resize:function(){var a=this.inputs.source,b=this.inputs.map;a?(this.uniforms.resSource[0]=a.width,this.uniforms.resSource[1]=a.height):(this.uniforms.resSource[0]=1,this.uniforms.resSource[1]=1);b?(this.uniforms.resMap[0]=b.width,this.uniforms.resMap[1]=b.height):(this.uniforms.resMap[0]=1,this.uniforms.resMap[1]=1)}}},{inputs:{source:{type:"image",
uniform:"source"},map:{type:"image",uniform:"map"},xChannel:{type:"enum",defaultValue:"red",options:"red green blue alpha luma lightness none".split(" "),update:function(a){this.uniforms.xVector=c[a]}},yChannel:{type:"enum",defaultValue:"green",options:"red green blue alpha luma lightness none".split(" "),update:function(a){this.uniforms.yVector=c[a]}},fillMode:{type:"enum",shaderDirty:!0,defaultValue:"color",options:["color","wrap","clamp","ignore"]},color:{type:"color",uniform:"color",defaultValue:[0,
0,0,0]},offset:{type:"number",uniform:"offset",defaultValue:0.5},mapScale:{type:"vector",dimensions:2,uniform:"mapScale",defaultValue:[1,1],updateSources:!0},amount:{type:"number",uniform:"amount",defaultValue:1}},title:"Displacement Map",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("dither",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\n#define mod4(a) (a >= 4 ? a - 4 : a)\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nconst mat4 dither = mat4(1.0, 33.0, 9.0, 41.0,49.0, 17.0, 57.0, 25.0,13.0, 45.0, 5.0, 37.0,61.0, 29.0, 53.0, 21.0);\nfloat find_closest(int x, int y, float c0) {\n\tfloat limit = 0.0;\n\tint x4 = mod4(x);\n\tint y4 = mod4(y);\n\tfor (int i = 0; i < 4; i++) {\n\t\tif (i == x4) {\n\t\t\tfor (int j = 0; j < 4; j++) {\n\t\t\t\tif (j == y4) {\n\t\t\t\t\tlimit = dither[i][j];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (x < 4) {\n\t\tif (y >= 4) {\n\t\t\tlimit += 3.0;\n\t\t}\n\t} else {\n\t\tif (y >= 4) {\n\t\t\tlimit += 1.0;\n\t\t} else {\n\t\t\tlimit += 2.0;\n\t\t}\n\t}\n\tlimit /= 65.0;\n\treturn c0 < limit ? 0.0 : 1.0;\n}\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec2 coord = vTexCoord * resolution;\n\tint x = int(mod(coord.x, 8.0));\n\tint y = int(mod(coord.y, 8.0));\n\tpixel.r = find_closest(x, y, pixel.r);\n\tpixel.g = find_closest(x, y, pixel.g);\n\tpixel.b = find_closest(x, y, pixel.b);\n\tgl_FragColor = pixel;\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"}},title:"Dither"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b){var c;for(c=0;c<b.length;c++)b[c]*=a;return b}var c=Math.sqrt,d,l=[],n,e,g;n=[a(1/(2*c(2)),[1,c(2),1,0,0,0,-1,-c(2),-1]),a(1/(2*c(2)),[1,0,-1,c(2),0,-c(2),1,0,-1]),a(1/(2*c(2)),[0,-1,c(2),1,0,-1,-c(2),1,0]),a(1/(2*c(2)),[c(2),-1,0,-1,0,1,0,1,-c(2)]),a(0.5,[0,1,
0,-1,0,-1,0,1,0]),a(0.5,[-1,0,1,0,0,0,1,0,-1]),a(1/6,[1,-2,1,-2,4,-2,1,-2,1]),a(1/6,[-2,1,-2,1,4,1,-2,1,-2]),a(1/3,[1,1,1,1,1,1,1,1,1])];for(c=0;c<n.length;c++)for(d=0;d<n[c].length;d++)l.push(n[c][d]);e=new Float32Array(l);g=new Float32Array([1,2,1,0,0,0,-1,-2,-1,1,0,-1,2,0,-2,1,0,-1]);b.plugin("edge",{initialize:function(a){a();this.uniforms.pixelWidth=1/this.width;this.uniforms.pixelHeight=1/this.height;this.uniforms.G="sobel"===this.inputs.mode?g:e},shader:function(a,b){b.fragment=["sobel"===
a.mode?"#define N_MATRICES 2\n#define SOBEL\n":"#define N_MATRICES 9\n","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float pixelWidth;\nuniform float pixelHeight;\nuniform mat3 G[9];\nvoid main(void) {\n\tmat3 I;\n\tfloat dp3, cnv[9];\n\tvec3 tc;\n\tfloat fi = 0.0, fj = 0.0;\n\tfor (int i = 0; i < 3; i++) {\n\t\tfj = 0.0;\n\t\tfor (int j = 0; j < 3; j++) {\n\t\t\tI[i][j] = length( texture2D(source, vTexCoord + vec2((fi - 1.0) * pixelWidth, (fj - 1.0) * pixelHeight)).rgb );\n\t\t\tfj += 1.0;\n\t\t};\n\t\tfi += 1.0;\n\t};\n\tfor (int i = 0; i < N_MATRICES; i++) {\n\t\tdp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n\t\tcnv[i] = dp3 * dp3;\n\t};\n#ifdef SOBEL\n\ttc = vec3(0.5 * sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));\n#else\n\tfloat M = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]);\n\tfloat S = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]) + (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + cnv[8];\n\ttc = vec3(sqrt(M/S));\n#endif\n\tgl_FragColor = vec4(tc, 1.0);\n}"].join("\n");
return b},resize:function(){this.uniforms.pixelWidth=1/this.width;this.uniforms.pixelHeight=1/this.height},inputs:{source:{type:"image",uniform:"source"},mode:{type:"enum",shaderDirty:!0,defaultValue:"sobel",options:[["sobel","Sobel"],["frei-chen","Frei-Chen"]],update:function(){this.uniforms.G="sobel"===this.inputs.mode?g:e}}},description:"Edge Detect",title:"Edge Detect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("emboss",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 offset = 1.0 / resolution;\n\tvTexCoord1 = texCoord - offset;\n\tvTexCoord2 = texCoord + offset;\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nuniform sampler2D source;\nuniform float amount;\nconst vec3 average = vec3(1.0 / 3.0);\nvoid main (void)  {\n\tvec4 pixel = vec4(0.5, 0.5, 0.5, 1.0);\n\tpixel -= texture2D(source, vTexCoord1) * amount;\n\tpixel += texture2D(source, vTexCoord2) * amount;\n\tpixel.rgb = vec3(dot(pixel.rgb, average));\n\tgl_FragColor = pixel;\n}";return b},inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",
defaultValue:1,min:-85,max:85}},title:"Emboss",categories:[],description:"Emboss"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("exposure",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float exposure;\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(pow(2.0, exposure) * pixel.rgb, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},exposure:{type:"number",uniform:"exposure",defaultValue:1,min:-8,max:8}},title:"Exposure",categories:["film"],description:"Exposure control"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("fader",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 color;\nuniform float amount;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor = mix(gl_FragColor, color, amount);\n}";
return b},requires:function(a,b){return 1>b.amount},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},color:{type:"color",uniform:"color",defaultValue:[0,0,0,1]},amount:{type:"number",uniform:"amount",defaultValue:0.5,min:0,max:1}},title:"Fader",description:"Fade image to a color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("falsecolor",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nuniform vec4 black;\nuniform vec4 white;\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luminance = dot(pixel.rgb, luma);\n\tvec4 result = mix(black, white, luminance);\n\tgl_FragColor = vec4(result.rgb, pixel.a * result.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},black:{type:"color",uniform:"black",defaultValue:[0,0,0.5,1]},white:{type:"color",uniform:"white",defaultValue:[1,0,0,1]}},title:"False Color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("filmgrain",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform float time;\nuniform float amount;\nuniform bool colored;\nfloat timer;\nconst float permTexUnit = 1.0/256.0;\nconst float permTexUnitHalf = 0.5/256.0;\nvec4 rnm(in vec2 tc) {\n\tfloat noise = sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;\n\tfloat noiseR = fract(noise)*2.0-1.0;\n\tfloat noiseG = fract(noise*1.2154)*2.0-1.0; \n\tfloat noiseB = fract(noise*1.3453)*2.0-1.0;\n\tfloat noiseA = fract(noise*1.3647)*2.0-1.0;\n\t\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\nfloat fade(in float t) {\n\treturn t*t*t*(t*(t*6.0-15.0)+10.0);\n}\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = permTexUnit*floor(p)+permTexUnitHalf;\n\tvec3 pf = fract(p);\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3 grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3 grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;\n\tvec3 grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3 grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\tfloat perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;\n\tvec3 grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3 grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\tfloat perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;\n\tvec3 grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3 grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\treturn n_xyz;\n}\nvoid main(void) {\n\ttimer = mod(time, 10000.0) / 10000.0;\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 noise = vec3(pnoise3D(vec3(vTexCoord * resolution, timer + 0.0)));\n\tif (colored) {\n\t\tnoise.g = pnoise3D(vec3(vTexCoord * resolution, timer + 1.0));\n\t\tnoise.b = pnoise3D(vec3(vTexCoord * resolution, timer + 2.0));\n\t}\n\tgl_FragColor = vec4(pixel.rgb + noise * amount, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",uniform:"time"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:0.03},colored:{type:"boolean",uniform:"colored",defaultValue:!1}},title:"Film Grain",description:"Don't over-do it."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("freeze",{draw:function(a,b,d,l,n){this.inputs.frozen||n(a,b,d,l)},requires:function(){return!this.inputs.frozen},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},frozen:{type:"boolean",defaultValue:!1,updateSources:!0}},title:"Freeze",description:"Freeze Frame"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("fxaa",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordNW;\nvarying vec2 vTexCoordNE;\nvarying vec2 vTexCoordSW;\nvarying vec2 vTexCoordSE;\nconst vec2 diag = vec2(1.0, -1.0);\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tvec2 invRes = 1.0 / resolution;\n\tvTexCoordNW = texCoord - invRes;\n\tvTexCoordNE = texCoord + invRes * diag;\n\tvTexCoordSW = texCoord - invRes * diag;\n\tvTexCoordSE = texCoord + invRes;\n}\n";
b.fragment="precision mediump float;\n#define FXAA_REDUCE_MIN (1.0 / 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordNW;\nvarying vec2 vTexCoordNE;\nvarying vec2 vTexCoordSW;\nvarying vec2 vTexCoordSE;\nuniform vec2 resolution;\nuniform sampler2D source;\nconst vec3 luma = vec3(0.299, 0.587, 0.114);\nvoid main(void) {\n\tvec4 original = texture2D(source, vTexCoord);\n\tvec3 rgbNW = texture2D(source, vTexCoordNW).rgb;\n\tvec3 rgbNE = texture2D(source, vTexCoordNE).rgb;\n\tvec3 rgbSW = texture2D(source, vTexCoordSW).rgb;\n\tvec3 rgbSE = texture2D(source, vTexCoordSE).rgb;\n\tfloat lumaNW = dot(rgbNW, luma);\n\tfloat lumaNE = dot(rgbNE, luma);\n\tfloat lumaSW = dot(rgbSW, luma);\n\tfloat lumaSE = dot(rgbSE, luma);\n\tfloat lumaM = dot(original.rgb, luma);\n\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * 0.25 * FXAA_REDUCE_MUL, FXAA_REDUCE_MIN);\n\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n\tdir = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX), dir * rcpDirMin)) / resolution;\n\tvec3 rgbA = 0.5 * (\n\t\ttexture2D(source, vTexCoord + dir * (1.0 / 3.0 - 0.5)).rgb +\n\t\ttexture2D(source, vTexCoord + dir * (2.0 / 3.0 - 0.5)).rgb);\n\tvec3 rgbB = rgbA * 0.5 + 0.25 * (\n\t\ttexture2D(source, vTexCoord - dir * 0.5).rgb +\n\t\ttexture2D(source, vTexCoord + dir * 0.5).rgb);\n\tfloat lumaB = dot(rgbB, luma);\n\tif (lumaB < lumaMin || lumaB > lumaMax) {\n\t\tgl_FragColor = vec4(rgbA, original.a);\n\t} else {\n\t\tgl_FragColor = vec4(rgbB, original.a);\n\t}\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"FXAA",description:"Fast approximate anti-aliasing"})});(function(b,a){"object"===typeof exports?a(require("seriously")):"function"===typeof define&&define.amd?define(["seriously"],a):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("gradientwipe",function(){this.uniforms.resGradient=[1,1];this.uniforms.resSource=[1,1];return{shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resSource;\nuniform vec2 resGradient;\nvarying vec2 texCoordSource;\nvarying vec2 texCoordGradient;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordSource = adjusted / resSource + HALF;\n\ttexCoordGradient = adjusted / resGradient + HALF;\n}";
b.fragment="precision mediump float;\n\nvarying vec2 texCoordSource;\nvarying vec2 texCoordGradient;\nuniform sampler2D source;\nuniform sampler2D gradient;\nuniform float transition;\nuniform float smoothness;\nuniform bool invert;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main(void) {\n\tfloat gradientVal = 1.0 - dot(texture2D(gradient, texCoordGradient).rgb, lumcoeff);\n\tif (invert) {\n\t\tgradientVal = 1.0 - gradientVal;\n\t}\n\tfloat amount = 1.0 - transition;\n\tfloat mn = (amount - smoothness * (1.0 - amount));\n\tfloat mx = (amount + smoothness * amount);\n\tif (gradientVal <= mn) {\n\t\tgl_FragColor = texture2D(source, texCoordSource);\n\t\treturn;\n\t}\n\tif (gradientVal >= mx) {\n\t\tgl_FragColor = vec4(0.0);\n\t\treturn;\n\t}\n\tfloat alpha = mix(1.0, 0.0, smoothstep(mn, mx, gradientVal));\n\tvec4 pixel = texture2D(source, texCoordSource);\n\tgl_FragColor = vec4(pixel.rgb, pixel.a * alpha);\n}";
return b},draw:function(a,b,d,l,n){0>=d.transition?n(this.baseShader,b,d,l):1<=d.transition?(a=this.gl,a.viewport(0,0,this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,l),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):n(a,b,d,l)},inPlace:!1,requires:function(a,b){return"source"===a&&1<=b.transition||"gradient"===a&&(0>=b.transition||1<=b.transition)?!1:!0},resize:function(){var a=this.inputs.source,b=this.inputs.gradient;a?(this.uniforms.resSource[0]=a.width,this.uniforms.resSource[1]=
a.height):(this.uniforms.resSource[0]=1,this.uniforms.resSource[1]=1);b?(this.uniforms.resGradient[0]=b.width,this.uniforms.resGradient[1]=b.height):(this.uniforms.resGradient[0]=1,this.uniforms.resGradient[1]=1)}}},{inputs:{source:{type:"image",uniform:"source"},gradient:{type:"image",uniform:"gradient"},transition:{type:"number",uniform:"transition",defaultValue:0},invert:{type:"boolean",uniform:"invert",defaultValue:!1},smoothness:{type:"number",uniform:"smoothness",defaultValue:0,min:0,max:1}},
title:"Gradient Wipe"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("hex",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform vec2 center;\nuniform float size;\nvoid main(void) {\n\tvec2 aspect = normalize(resolution);\n\tvec2 tex = (vTexCoord * aspect - center) / size;\n\ttex.y /= 0.866025404;\n\ttex.x -= tex.y * 0.5;\n\tvec2 a;\n\tif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n\t\ta = vec2(floor(tex.x), floor(tex.y));\n\t} else {\n\t\ta = vec2(ceil(tex.x), ceil(tex.y));\n\t}\n\tvec2 b = vec2(ceil(tex.x), floor(tex.y));\n\tvec2 c = vec2(floor(tex.x), ceil(tex.y));\n\tvec3 tex3 = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n\tvec3 a3 = vec3(a.x, a.y, 1.0 - a.x - a.y);\n\tvec3 b3 = vec3(b.x, b.y, 1.0 - b.x - b.y);\n\tvec3 c3 = vec3(c.x, c.y, 1.0 - c.x - c.y);\n\tfloat alen =length(tex3 - a3);\n\tfloat blen =length(tex3 - b3);\n\tfloat clen =length(tex3 - c3);\n\tvec2 choice;\n\tif (alen < blen) {\n\t\tif (alen < clen) {\n\t\t\tchoice = a;\n\t\t} else {\n\t\t\tchoice = c;\n\t\t}\n\t} else {\n\t\tif (blen < clen) {\n\t\t\tchoice = b;\n\t\t} else {\n\t\t\tchoice = c;\n\t\t}\n\t}\n\tchoice.x += choice.y * 0.5;\n\tchoice.y *= 0.866025404;\n\tchoice *= size / aspect;\n\tgl_FragColor = texture2D(source, choice + center / aspect);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},size:{type:"number",uniform:"size",min:0,max:0.4,defaultValue:0.01},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0,0]}},title:"Hex",description:"Hexagonal Pixelate"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("highlights-shadows",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float shadows;\nuniform float highlights;\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luminance = dot(pixel.rgb, luma);\n\tfloat shadow = clamp((pow(luminance, 1.0 / (shadows + 1.0)) + (-0.76) * pow(luminance, 2.0 / (shadows + 1.0))) - luminance, 0.0, 1.0);\n\tfloat highlight = clamp((1.0 - (pow(1.0 - luminance, 1.0 / (2.0 - highlights)) + (-0.8) * pow(1.0 - luminance, 2.0 / (2.0 - highlights)))) - luminance, -1.0, 0.0);\n\tvec3 rgb = (luminance + shadow + highlight) * (pixel.rgb / vec3(luminance));\n\tgl_FragColor = vec4(rgb, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},highlights:{type:"number",uniform:"highlights",min:0,max:1,defaultValue:1},shadows:{type:"number",uniform:"shadows",min:0,max:1,defaultValue:0}},title:"Highlights/Shadows",description:"Darken highlights, lighten shadows"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("hue-saturation",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 transform;\nuniform float hue;\nuniform float saturation;\nvarying vec2 vTexCoord;\nvarying vec3 weights;\nvoid main(void) {\n\tfloat angle = hue * 3.14159265358979323846264;\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\tweights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec3 weights;\nuniform sampler2D source;\nuniform float hue;\nuniform float saturation;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tfloat len = length(color.rgb);\n\tcolor.rgb = vec3(dot(color.rgb, weights.xyz), dot(color.rgb, weights.zxy), dot(color.rgb, weights.yzx) );\n\tvec3 adjustment = (color.r + color.g + color.b) / 3.0 - color.rgb;\n\tif (saturation > 0.0) {\n\t\tadjustment *= (1.0 - 1.0 / (1.0 - saturation));\n\t} else {\n\t\tadjustment *= (-saturation);\n\t}\n\tcolor.rgb += adjustment;\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hue:{type:"number",uniform:"hue",defaultValue:0.4,min:-1,max:1},saturation:{type:"number",uniform:"saturation",defaultValue:0,min:-1,max:1}},title:"Hue/Saturation",description:"Rotate hue and multiply saturation."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("invert",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(1.0 - gl_FragColor.rgb, gl_FragColor.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Invert",description:"Invert image color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("kaleidoscope",{commonShader:!0,shader:function(a,b){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float segments;\nuniform float offset;","const float PI = "+Math.PI+";","const float TAU = 2.0 * PI;\nvoid main(void) {\n\tif (segments == 0.0) {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n\t} else {\n\t\tvec2 centered = vTexCoord - 0.5;\n\t\tfloat r = length(centered);\n\t\tfloat theta = atan(centered.y, centered.x);\n\t\ttheta = mod(theta, TAU / segments);\n\t\ttheta = abs(theta - PI / segments);\n\t\tvec2 newCoords = r * vec2(cos(theta), sin(theta)) + 0.5;\n\t\tgl_FragColor = texture2D(source, mod(newCoords - offset, 1.0));\n\t}\n}"].join("\n");
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},segments:{type:"number",uniform:"segments",defaultValue:6},offset:{type:"number",uniform:"offset",defaultValue:0}},title:"Kaleidoscope"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),c=/\d+/;b.plugin("layers",function(b){function l(){e.resize()}var n,e=this,g={clear:!1},r;"number"===typeof b&&2<=b?n=b:(n=b&&b.count||4,n=Math.max(2,n));r={sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection"],
update:function(){this.resize()}}};for(b=0;b<n;b++)r.sizeMode.options.push(b.toString()),r.sizeMode.options.push("source"+b),r["source"+b]={type:"image",update:l},r["opacity"+b]={type:"number",defaultValue:1,min:0,max:1,updateSources:!0};this.uniforms.layerResolution=[1,1];this.resize=function(){var a,b;a=this.inputs.sizeMode;var d,e;if("union"===a)for(d=b=a=0;d<n;d++){if(e=this.inputs["source"+d])a=Math.max(a,e.width),b=Math.max(b,e.height)}else if("intersection"===a)for(b=a=Infinity,d=0;d<n;d++){if(e=
this.inputs["source"+d])a=Math.min(a,e.width),b=Math.min(b,e.height)}else if(b=a=1,d=n-1,(e=c.exec(this.inputs.sizeMode))&&(d=Math.min(parseInt(e[0],10),d)),e=this.inputs["source"+d])a=e.width,b=e.height;if(this.width!==a||this.height!==b)for(this.width=a,this.height=b,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b,this.frameBuffer&&this.frameBuffer.resize(a,b),this.emit("resize"),this.setDirty(),d=0;d<this.targets.length;d++)this.targets[d].resize()};return{initialize:function(a){var b=
this.gl;a();g.blendEquation=b.FUNC_ADD;g.srcRGB=b.SRC_ALPHA;g.dstRGB=b.ONE_MINUS_SRC_ALPHA;g.srcAlpha=b.SRC_ALPHA;g.dstAlpha=b.DST_ALPHA},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 layerResolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * layerResolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / layerResolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (layerResolution.x / layerResolution.y);\n\tgl_Position.xy *= layerResolution / resolution;\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float opacity;\nvoid main(void) {\n\tif (any(lessThan(vTexCoord, vec2(0.0))) || any(greaterThanEqual(vTexCoord, vec2(1.0)))) {\n\t\tgl_FragColor = vec4(0.0);\n\t} else {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n\t\tgl_FragColor *= opacity;\n\t}\n}";return b},requires:function(a,b){var d,e=n;(d=c.exec(this.inputs.sizeMode))&&(e=parseInt(d[0],10));return e>=n?!1:!(!b[a]||!b["opacity"+e])},draw:function(b,
c,d,e,f){var l,r,v;l=this.gl;l.viewport(0,0,this.width,this.height);l.bindFramebuffer(l.FRAMEBUFFER,e);l.clearColor(0,0,0,0);l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT);for(l=0;l<n;l++)v=this.inputs["source"+l],r=this.inputs["opacity"+l],v&&r&&(d.opacity=r,d.layerResolution[0]=v.width,d.layerResolution[1]=v.height,d.source=v,d.transform=v.cumulativeMatrix||a,f(b,c,d,e,null,g))},inputs:r}},{inPlace:!0,description:"Multiple layers",title:"Layers"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("linear-transfer",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 slope;\nuniform vec4 intercept;\nconst vec3 half3 = vec3(0.5);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = pixel * slope + intercept;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},slope:{type:"vector",dimensions:4,uniform:"slope",defaultValue:[1,1,1,1]},intercept:{type:"vector",uniform:"intercept",dimensions:4,defaultValue:[0,0,0,0]}},title:"Linear Transfer",description:"For each color channel: [slope] * [value] + [intercept]"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("lumakey",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float threshold;\nuniform float clipBlack;\nuniform float clipWhite;\nuniform bool invert;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luma = dot(pixel.rgb,lumcoeff);\n\tfloat alpha = 1.0 - smoothstep(clipBlack, clipWhite, luma);\n\tif (invert) alpha = 1.0 - alpha;\n\tgl_FragColor = vec4(pixel.rgb, min(pixel.a, alpha) );\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0.9,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},invert:{type:"boolean",uniform:"invert",defaultValue:!1}},title:"Luma Key",categories:["key"],description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("mirror",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nuniform vec2 resolution;\nuniform sampler2D source;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vec2(0.5 - abs(0.5 - vTexCoord.x), vTexCoord.y));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Mirror",description:"Shader Mirror Effect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("nightvision",{commonShader:!0,shader:function(a,b,d){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float time;\nuniform float luminanceThreshold;\nuniform float amplification;\nuniform vec3 nightVisionColor;",d.shader.makeNoise,
"void main(void) {\n\tvec3 noise = vec3(makeNoise(vTexCoord.x, vTexCoord.y, time), makeNoise(vTexCoord.x, vTexCoord.y, time * 200.0 + 1.0), makeNoise(vTexCoord.x, vTexCoord.y, time * 100.0 + 3.0));\n\tvec4 pixel = texture2D(source, vTexCoord + noise.xy * 0.0025);\n\tfloat luminance = dot(vec3(0.299, 0.587, 0.114), pixel.rgb);\n\tpixel.rgb *= step(luminanceThreshold, luminance) * amplification;\n\tgl_FragColor = vec4( (pixel.rgb + noise * 0.1) * nightVisionColor, pixel.a);\n}"].join("\n");return b},
inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",uniform:"time",defaultValue:0},luminanceThreshold:{type:"number",uniform:"luminanceThreshold",defaultValue:0.1,min:0,max:1},amplification:{type:"number",uniform:"amplification",defaultValue:1.4,min:0},color:{type:"color",uniform:"nightVisionColor",defaultValue:[0.1,0.95,0.2]}},title:"Night Vision",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("noise",{shader:function(a,b,d){d=["precision mediump float;","#define Blend(base, blend, funcf)\t\tvec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))","#define BlendOverlayf(base, blend) (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))",
"#define BlendOverlay(base, blend)\t\tBlend(base, blend, BlendOverlayf)","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","uniform float amount;","uniform float time;",d.shader.noiseHelpers,d.shader.snoise3d,d.shader.random,"void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat r = random(vec2(time * vTexCoord.xy));","\tfloat noise = snoise(vec3(vTexCoord * (1024.4 + r * 512.0), time)) * 0.5;"];a.overlay?(d.push("\tvec3 overlay = BlendOverlay(pixel.rgb, vec3(noise));"),
d.push("\tpixel.rgb = mix(pixel.rgb, overlay, amount);")):d.push("\tpixel.rgb += noise * amount;");d.push("\tgl_FragColor = pixel;}");b.fragment=d.join("\n");return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},overlay:{type:"boolean",shaderDirty:!0,defaultValue:!0},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:1},time:{type:"number",uniform:"time",defaultValue:0,step:1}},title:"Noise",description:"Add noise"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("panorama",function(){function a(){b.resize()}var b=this;this.resize=function(){var a=this.width,l=this.height,n=b.inputs.source;this.source?(a=this.source.width,l=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,l=this.sources.source.height):
l=a=1;b.inputs.width?(a=b.inputs.width,b.inputs.height?l=b.inputs.height:n&&(l=a*n.height/n.width)):b.inputs.height&&(l=b.inputs.height,n&&(a=l*n.width/n.height));a=Math.floor(a);l=Math.floor(l);n&&(this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=l);if(this.width!==a||this.height!==l)this.width=a,this.height=l,this.frameBuffer&&this.frameBuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)this.targets[a].resize()};return{shader:function(a,
b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D source;\nuniform float fov;\nuniform float yaw;\nuniform float pitch;\nconst float M_PI = 3.141592653589793238462643;\nconst float M_TWOPI = 6.283185307179586476925286;\nmat3 rotationMatrix(vec2 euler) {\n\tvec2 se = sin(euler);\n\tvec2 ce = cos(euler);\n\treturn mat3(ce.x, 0, -se.x, 0, 1, 0, se.x, 0, ce.x) * \n\t\t\tmat3(1, 0, 0, 0, ce.y, -se.y, 0, se.y, ce.y);\n}\nvec3 toCartesian( vec2 st ) {\n\treturn normalize(vec3(st.x, st.y, 0.5 / tan(0.5 * radians(fov))));\n}\nvec2 toSpherical(vec3 cartesianCoord) {\n\tvec2 st = vec2(\n\t\tatan(cartesianCoord.x, cartesianCoord.z),\n\t\tacos(cartesianCoord.y)\n\t);\n\tif(st.x < 0.0)\n\t\tst.x += M_TWOPI;\n\treturn st;\n}\nvoid main(void) {\n\tvec2 sphericalCoord = gl_FragCoord.xy / resolution - vec2(0.5);\n\tsphericalCoord.y *= -resolution.y / resolution.x;\n\tvec3 cartesianCoord = rotationMatrix(radians(vec2(yaw + 180., -pitch))) * toCartesian(sphericalCoord);\n\tgl_FragColor = texture2D(source, toSpherical( cartesianCoord )/vec2(M_TWOPI, M_PI));\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360},yaw:{type:"number",uniform:"yaw",min:0,max:360,defaultValue:0},fov:{type:"number",uniform:"fov",min:0,max:180,defaultValue:80},pitch:{type:"number",uniform:"pitch",min:-90,max:90,defaultValue:0}}}},{commonShader:!0,title:"Panorama"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("pixelate",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform vec2 pixelSize;\nvoid main(void) {\n\tvec2 delta = pixelSize / resolution;\n\tgl_FragColor = texture2D(source, delta * floor(vTexCoord / delta));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},pixelSize:{type:"vector",dimensions:2,defaultValue:[8,8],min:0,uniform:"pixelSize"}},title:"Pixelate"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("polar",{commonShader:!0,shader:function(a,b){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float angle;","const float PI = "+Math.PI+";","void main(void) {\n\tvec2 norm = (1.0 - vTexCoord) * 2.0 - 1.0;\n\tfloat theta = mod(PI + atan(norm.x, norm.y) - angle * (PI / 180.0), PI * 2.0);\n\tvec2 polar = vec2(theta / (2.0 * PI), length(norm));\n\tgl_FragColor = texture2D(source, polar);\n}"].join("\n");
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},angle:{type:"number",uniform:"angle",defaultValue:0}},title:"Polar Coordinates",description:"Convert cartesian to polar coordinates"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),c=b.util.mat4;b.plugin("repeat",function(){function b(){e.resize()}var l={clear:!1},n=new Float32Array(16),e=this;this.resize=function(){var a=this.width,b=this.height,c=e.inputs.source;this.source?(a=this.source.width,
b=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,b=this.sources.source.height):b=a=1;e.inputs.width?(a=e.inputs.width,e.inputs.height?b=e.inputs.height:c&&(b=a*c.height/c.width)):e.inputs.height&&(b=e.inputs.height,c&&(a=b*c.width/c.height));a=Math.floor(a);b=Math.floor(b);c&&(this.uniforms.resolution[0]=c.width,this.uniforms.resolution[1]=c.height);if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.uniforms.targetRes[0]=this.width,this.uniforms.targetRes[1]=
this.height,this.frameBuffer&&this.frameBuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)this.targets[a].resize()};this.uniforms.targetRes=[1,1];return{initialize:function(a){a();this.uniforms.transform=n},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 targetRes;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.xy *= resolution / targetRes;\n\tvTexCoord = texCoord;\n}\n";
return b},draw:function(b,d,e,h,m){var n;n=this.inputs.source;var f=this.inputs.transform,x=f&&f.cumulativeMatrix,y=this.inputs.repeat,v=this.gl;x&&f.transformed?c.copy(e.transform,n&&n.cumulativeMatrix||a):y=Math.min(y,1);v.viewport(0,0,this.width,this.height);v.bindFramebuffer(v.FRAMEBUFFER,h);v.clearColor(0,0,0,0);v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT);for(n=y-1;0<=n;n--)m(b,d,e,h,null,l),n&&c.multiply(e.transform,x,e.transform)},inputs:{source:{type:"image",uniform:"source",update:function(){b();
this.uniforms.transform=n}},transform:{type:"image"},repeat:{type:"number",step:1,min:0,defaultValue:8},width:{type:"number",min:0,step:1,update:b,defaultValue:0},height:{type:"number",min:0,step:1,update:b,defaultValue:0}}}},{inPlace:!0,description:"Draw image multiple times, transforming each time",title:"Repeat"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("ripple",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float wave;\nuniform float distortion;\nuniform vec2 center;\nvoid main(void) {\n\tfloat scalar = abs(1.0 - abs(distance(vTexCoord, center)));\n\tfloat sinOffset = sin(wave / scalar);\n\tsinOffset = clamp(sinOffset, 0.0, 1.0);\n\tfloat sinSign = cos(wave / scalar);\n\tsinOffset = sinOffset * distortion / 32.0;\n\tgl_FragColor = texture2D(source, vTexCoord + sinOffset * sinSign);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},wave:{type:"number",uniform:"wave",defaultValue:Math.PI/0.75},distortion:{type:"number",uniform:"distortion",defaultValue:1},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0.5,0.5]}},title:"Ripple Distortion",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("scanlines",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float lines;\nuniform float width;\nuniform float intensity;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat darken = 2.0 * abs( fract(vTexCoord.y * lines / 2.0) - 0.5);\n\tdarken = clamp(darken - width + 0.5, 0.0, 1.0);\n\tdarken = 1.0 - ((1.0 - darken) * intensity);\n\tgl_FragColor = vec4(pixel.rgb * darken, 1.0);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},lines:{type:"number",uniform:"lines",defaultValue:60},size:{type:"number",uniform:"size",defaultValue:0.2,min:0,max:1},intensity:{type:"number",uniform:"intensity",defaultValue:0.1,min:0,max:1}},title:"Scan Lines",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=/\d+/;b.plugin("select",function(b){function d(){e.resize()}function l(){var a;a=e.inputs["source"+e.inputs.active];e.texture=a&&a.texture;d()}var n,e=this,g;"number"===typeof b&&2<=b?n=b:(n=b&&b.count||4,n=Math.max(2,n));g={active:{type:"number",step:1,min:0,max:n-1,defaultValue:0,
update:l,updateSources:!0},sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection","active"],update:d}};for(b=0;b<n;b++)g.sizeMode.options.push(b.toString()),g.sizeMode.options.push("source"+b),g["source"+b]={type:"image",update:l};this.uniforms.layerResolution=[1,1];this.resize=function(){var b,c;b=this.inputs.sizeMode;var d,e,g;if("union"===b)for(d=c=b=0;d<n;d++){if(g=this.inputs["source"+d])b=Math.max(b,g.width),c=Math.max(c,g.height)}else if("intersection"===b)for(c=b=Infinity,
d=0;d<n;d++){if(g=this.inputs["source"+d])b=Math.min(b,g.width),c=Math.min(c,g.height)}else if("active"===b)d=this.inputs.active,g=this.inputs["source"+d],b=Math.max(1,g&&g.width||1),c=Math.max(1,g&&g.height||1);else for(c=b=1,e=n-1,(d=a.exec(this.inputs.sizeMode))&&(e=Math.min(parseInt(d[0],10),e)),d=0;d<=e;d++)if(g=this.inputs["source"+d]){b=g.width;c=g.height;break}if(this.width!==b||this.height!==c)this.width=b,this.height=c,this.emit("resize"),this.setDirty();for(d=0;d<this.targets.length;d++)this.targets[d].resize()};
return{initialize:function(){this.initialized=!0;this.shaderDirty=!1},requires:function(a){return!(!this.inputs[a]||a!=="source"+this.inputs.active)},draw:function(){var a;a=e.inputs["source"+e.inputs.active];e.texture=a&&a.texture},inputs:g}},{title:"Select",description:"Select a single source image from a list of source nodes.",inPlace:!1,commonShader:!0})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("sepia",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\nconst mat4 coeff = mat4(0.393, 0.349, 0.272, 1.0,0.796, 0.686, 0.534, 1.0, 0.189, 0.168, 0.131, 1.0, 0.0, 0.0, 0.0, 1.0 );\nvoid main(void) {\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tgl_FragColor = coeff * sourcePixel;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Sepia",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("simplex",function(){function a(){b.resize()}var b=this;return{shader:function(a,b,c){function e(a){return 0===a-Math.floor(a)?a+".0":a}var g=1,r=1,p=0;b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform float amount;\nuniform vec2 noiseScale;\nuniform vec2 noiseOffset;\nuniform float time;\nuniform vec4 black;\nuniform vec4 white;",
c.shader.noiseHelpers,c.shader.snoise3d,"void main(void) {\n\tfloat total = 0.0;\n\tvec3 pos = vec3(vTexCoord.xy * noiseScale + noiseOffset, time);"].join("\n");for(c=0;c<a.octaves;c++)g=Math.pow(2,c),r=Math.pow(a.persistence,c),p+=r,b.fragment+="\ttotal += snoise(pos * "+e(g)+") * "+e(r)+";\n";b.fragment+=["\ttotal *= amount / "+e(p)+";","\ttotal = (total + 1.0)/ 2.0;\n\tgl_FragColor = mix(black, white, total);\n}"].join("\n");return b},inputs:{noiseScale:{type:"vector",dimensions:2,uniform:"noiseScale",
defaultValue:[1,1]},noiseOffset:{type:"vector",dimensions:2,uniform:"noiseOffset",defaultValue:[0,0]},octaves:{type:"number",shaderDirty:!0,min:1,max:8,step:1,defaultValue:1},persistence:{type:"number",defaultValue:0.5,min:0,max:0.5},amount:{type:"number",uniform:"amount",min:0,defaultValue:1},time:{type:"number",uniform:"time",defaultValue:0},width:{type:"number",min:0,step:1,update:a,defaultValue:0},height:{type:"number",min:0,step:1,update:a,defaultValue:0},black:{type:"color",uniform:"black",
defaultValue:[0,0,0,1]},white:{type:"color",uniform:"white",defaultValue:[1,1,1,1]}}}},{title:"Simplex Noise",description:"Generate Simplex Noise"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("sketch",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nfloat res = resolution.x;\nfloat n0 = 97.0 / res;\nfloat n1 = 15.0 / res;\nfloat n2 = 97.0 / res;\nfloat n3 = 9.7 / res;\nfloat total = n2 + ( 4.0 * n0 ) + ( 4.0 * n1 );\nconst vec3 div3 = vec3(1.0 / 3.0);\nvoid main(void) {\n\tfloat offset, temp1, temp2;\n\tvec4 m, p0, p1, p2, p3, p4, p5, p6, p7, p8;\n\toffset = n3;\n\tp0=texture2D(source,vTexCoord);\n\tp1=texture2D(source,vTexCoord+vec2(-offset,-offset));\n\tp2=texture2D(source,vTexCoord+vec2( offset,-offset));\n\tp3=texture2D(source,vTexCoord+vec2( offset, offset));\n\tp4=texture2D(source,vTexCoord+vec2(-offset, offset));\n\toffset=n3*2.0;\n\tp5=texture2D(source,vTexCoord+vec2(-offset,-offset));\n\tp6=texture2D(source,vTexCoord+vec2( offset,-offset));\n\tp7=texture2D(source,vTexCoord+vec2( offset, offset));\n\tp8=texture2D(source,vTexCoord+vec2(-offset, offset));\n\tm = (p0 * n2 + (p1 + p2 + p3 + p4) * n0 + (p5 + p6 + p7 + p8) * n1) / total;\n\ttemp1 = dot(p0.rgb, div3);\n\ttemp2 = dot(m.rgb, div3);\n\tif (temp2 <= 0.0005) {\n\t\tgl_FragColor = vec4( 1.0, 1.0, 1.0, p0.a);\n\t} else {\n\t\tgl_FragColor = vec4( vec3(min(temp1 / temp2, 1.0)), p0.a);\n\t}\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Sketch",description:"Pencil/charcoal sketch"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("split",function(){var a,b=[1,1],d=[1,1];this.resize=function(){var a,n;a=this.inputs.sizeMode;var e;e=this.inputs.sourceA;var g=this.inputs.sourceB;"a"===a||"b"===a?(n="a"===a?e:g)?(a=n.width,n=n.height):n=a=1:e?g?(n="union"===a?Math.max:Math.min,a=n(e.width,g.width),
n=n(e.height,g.height)):(a=e.width,n=e.height):g?(a=g.width,n=g.height):n=a=1;if(this.width!==a||this.height!==n)this.width=a,this.height=n,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=n,this.frameBuffer&&this.frameBuffer.resize(a,n),this.emit("resize"),this.setDirty();e&&(b[0]=e.width,b[1]=e.height);g&&(d[0]=g.width,d[1]=g.height);for(e=0;e<this.targets.length;e++)this.targets[e].resize()};return{initialize:function(l){l();this.uniforms.resolutionA=b;this.uniforms.resolutionB=d;a=this.baseShader},
commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\nuniform mat4 projection;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nuniform float angle;\nvarying float c;\nvarying float s;\nvarying float t;\nvoid main(void) {\n   c = cos(angle);\n   s = sin(angle);\n\tt = abs(c + s);\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 adjustedTexCoord = (texCoord - 0.5) * resolution;\n\tvTexCoordA = adjustedTexCoord / resolutionA + 0.5;\n\tvTexCoordB = adjustedTexCoord / resolutionB + 0.5;\n\tvTexCoord = texCoord;\n}";
b.fragment="precision mediump float;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying float c;\nvarying float s;\nvarying float t;\nuniform sampler2D sourceA;\nuniform sampler2D sourceB;\nuniform float split;\nuniform float angle;\nuniform float fuzzy;\nuniform float blendGamma;\nvec4 textureLookup(sampler2D tex, vec2 texCoord, vec3 exp) {\n\tif (any(lessThan(texCoord, vec2(0.0))) || any(greaterThan(texCoord, vec2(1.0)))) {\n\t\treturn vec4(0.0);\n\t} else {\n\t\tvec4 pixel = texture2D(tex, texCoord);\n\t\tpixel.rgb = pow(pixel.rgb, exp);\n\t\treturn pixel;\n\t}\n}\nvoid main(void) {\n\tvec3 exp = vec3(blendGamma);\n\tvec4 pixel1 = textureLookup(sourceA, vTexCoordA, exp);\n\tvec4 pixel2 = textureLookup(sourceB, vTexCoordB, exp);\n\tfloat mn = (split - fuzzy * (1.0 - split));\n\tfloat mx = (split + fuzzy * split);;\n\tvec2 coords = vTexCoord - vec2(0.5);\n\tcoords = vec2(coords.x * c - coords.y * s, coords.x * s + coords.y * c);\n\tfloat scale = max(abs(c - s), abs(s + c));\n\tcoords /= scale;\n\tcoords += vec2(0.5);\n\tfloat x = coords.x;\n\tgl_FragColor = mix(pixel2, pixel1, smoothstep(mn, mx, x));\n\tgl_FragColor.rgb = pow(gl_FragColor.rgb, 1.0 / exp);\n}";
return b},draw:function(b,c,d,g,r){1<=d.split?(d.source=d.sourceB,r(a,c,d,g)):0>=d.split?(d.source=d.sourceA,r(a,c,d,g)):r(b,c,d,g)},inPlace:!1,requires:function(a,b){return"sourceA"===a&&1<=b.split||"sourceB"===a&&0>=b.split?!1:!0}}},{inputs:{sourceA:{type:"image",uniform:"sourceA",shaderDirty:!1,update:function(){this.resize()}},sourceB:{type:"image",uniform:"sourceB",shaderDirty:!1,update:function(){this.resize()}},sizeMode:{type:"enum",defaultValue:"a",options:["a","b","union","intersection"],
update:function(){this.resize()}},split:{type:"number",uniform:"split",defaultValue:0.5,min:0,max:1,updateSources:!0},angle:{type:"number",uniform:"angle",defaultValue:0},fuzzy:{type:"number",uniform:"fuzzy",defaultValue:0,min:0,max:1},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4}},description:"Split screen or wipe",title:"Split"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("throttle",function(){var a=0;return{draw:function(b,d,l,n,e){this.inputs.frameRate&&Date.now()-a>=1E3/this.inputs.frameRate&&(e(b,d,l,n),a=Date.now())},requires:function(b,d){return d.frameRate&&Date.now()-a>=1E3/d.frameRate?!0:!1}}},{inPlace:!0,commonShader:!0,title:"Throttle",
description:"Throttle frame rate",inputs:{source:{type:"image",uniform:"source"},frameRate:{type:"number",uniform:"opacity",defaultValue:15,min:0}}})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("temperature",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float temperature;\nvarying vec2 vTexCoord;\nvarying vec3 tempFactor;\nconst vec3 luma = vec3(0.2125,0.7154,0.0721);\nvec3 temperatureRGB(float t) {\n\tfloat temp = t / 100.0;\n\tvec3 color = vec3(1.0);\n\tif (temp < 66.0) {\n\t\tcolor.g = 0.3900815787690196 * log(temp) - 0.6318414437886275;\n\t\tcolor.b = 0.543206789110196 * log(temp - 10.0) - 1.19625408914;\n\t} else {\n\t\tcolor.r = 1.292936186062745 * pow(temp - 60.0, -0.1332047592);\n\t\tcolor.g = 1.129890860895294 * pow(temp - 60.0, -0.0755148492);\n\t}\n\treturn color;\n}\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tvec3 tempColor = temperatureRGB(temperature);\n\ttempFactor = dot(tempColor, luma) / tempColor;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec3 tempFactor;\nuniform sampler2D source;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(pixel.rgb * tempFactor, pixel.a);\n}";return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},temperature:{type:"number",uniform:"temperature",defaultValue:6500,min:3E3,max:25E3}},title:"Color Temperature",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("tone",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main(void) {\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tvec3 sceneColor = light.rgb * sourcePixel.rgb;\n\tvec3 gray = vec3(dot(lumcoeff, sceneColor));\n\tvec3 muted = mix(sceneColor, gray, desat);\n\tvec3 tonedColor = mix(dark.rgb, light.rgb, gray);\n\tgl_FragColor = vec4(mix(muted, tonedColor, toned), sourcePixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},light:{type:"color",uniform:"light",defaultValue:[1,0.9,0.5,1]},dark:{type:"color",uniform:"dark",defaultValue:[0.2,0.05,0,1]},toned:{type:"number",uniform:"toned",defaultValue:1,minimumRange:0,maximumRange:1},desat:{type:"number",uniform:"desat",defaultValue:0.5,minimumRange:0,maximumRange:1}},title:"Tone",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("tvglitch",function(){var a,c,d,l,n,e;return{initialize:function(c){var r,p,h,m;e=this.gl;a=this.height;m=[];p=0.3-0.02;h=0.8-0.2;for(r=0;20>r;r++)m.push(2*Math.random()-1),m.push(Math.random()*h+0.2),m.push(Math.random()*p+0.02),m.push(0.2*Math.random());d=e.createBuffer();
e.bindBuffer(e.ARRAY_BUFFER,d);e.bufferData(e.ARRAY_BUFFER,new Float32Array(m),e.STATIC_DRAW);d.itemSize=4;d.numItems=20;l=new b.util.ShaderProgram(e,"precision mediump float;\nattribute vec4 particle;\nuniform float time;\nuniform float height;\nvarying float intensity;\nvoid main(void) {\n\tfloat y = particle.x + time * particle.y;\n\ty = fract((y + 1.0) / 2.0) * 4.0 - 2.0;\n\tintensity = particle.w;\n\tgl_Position = vec4(0.0, -y , 1.0, 2.0);\n\tgl_PointSize = height * particle.z;\n}","precision mediump float;\nvarying float intensity;\nvoid main(void) {\n\tgl_FragColor = vec4(1.0);\n\tgl_FragColor.a = 2.0 * intensity * (1.0 - abs(gl_PointCoord.y - 0.5));\n}");
n=new b.util.FrameBuffer(e,1,Math.max(1,this.height/2));c()},commonShader:!0,shader:function(a,c){c.fragment=["precision mediump float;\n#define HardLight(top, bottom)  (1.0 - 2.0 * (1.0 - top) * (1.0 - bottom))\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D particles;\nuniform float time;\nuniform float scanlines;\nuniform float lineSync;\nuniform float lineHeight;\nuniform float distortion;\nuniform float vsync;\nuniform float bars;\nuniform float frameSharpness;\nuniform float frameShape;\nuniform float frameLimit;\nuniform vec4 frameColor;",
b.util.shader.noiseHelpers+b.util.shader.snoise2d+"void main(void) {","\tvec2 texCoord = vTexCoord;\n\tfloat drandom = snoise(vec2(time * 10.0, texCoord.y /lineHeight));\n\tfloat distortAmount = distortion * (drandom - 0.25) * 0.5;\n\tvec4 particleOffset = texture2D(particles, vec2(0.0, texCoord.y));\n\tdistortAmount -= lineSync * (2.0 * particleOffset.a - 0.5);\n\ttexCoord.x -= distortAmount;\n\ttexCoord.x = mod(texCoord.x, 1.0);\n\tfloat roll;\n\tif (vsync != 0.0) {\n\t\troll = fract(time / vsync);\n\t\ttexCoord.y = mod(texCoord.y - roll, 1.0);\n\t}\n\tvec4 pixel = texture2D(source, texCoord);\n\tfloat barsAmount = particleOffset.r;\n\tif (barsAmount > 0.0) {\n\t\tpixel = vec4(pixel.r + bars * barsAmount,pixel.g + bars * barsAmount,pixel.b + bars * barsAmount,pixel.a);\n\t}\n\tif (mod(texCoord.y / lineHeight, 2.0) < 1.0 ) {\n\t\tpixel.rgb *= (1.0 - scanlines);\n\t}\n\tfloat f = (1.0 - gl_FragCoord.x * gl_FragCoord.x) * (1.0 - gl_FragCoord.y * gl_FragCoord.y);\n\tfloat frame = clamp( frameSharpness * (pow(f, frameShape) - frameLimit), 0.0, 1.0);\n\tgl_FragColor = mix(frameColor, pixel, frame);\n}"].join("\n");
return c},resize:function(){n&&n.resize(1,Math.max(1,this.height/2))},draw:function(b,r,p,h,m){var q=c!==this.inputs.time,f;a!==this.height&&(a=this.height,q=!0);p.lineHeight=1/this.height;this.inputs.verticalSync?(f=0.2/this.inputs.verticalSync,p.vsync=f):(f=1,p.vsync=0);p.time=this.inputs.time%(1E3*f);p.distortion=Math.random()*this.inputs.distortion;q&&(this.inputs.lineSync||this.inputs.bars)&&(l.use(),e.viewport(0,0,1,this.height/2),e.bindFramebuffer(e.FRAMEBUFFER,n.frameBuffer),e.clear(e.COLOR_BUFFER_BIT|
e.DEPTH_BUFFER_BIT),e.enableVertexAttribArray(l.location.particle),e.bindBuffer(e.ARRAY_BUFFER,d),e.vertexAttribPointer(l.location.particle,d.itemSize,e.FLOAT,!1,0,0),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),l.time.set(p.time*this.inputs.barsRate),l.height.set(this.height),e.drawArrays(e.POINTS,0,20),c=this.inputs.time);p.particles=n.texture;m(b,r,p,h)},destroy:function(){d=null;n&&(n.destroy(),n=null)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",
defaultValue:0},distortion:{type:"number",defaultValue:0.1,min:0,max:1},verticalSync:{type:"number",defaultValue:0.1,min:0,max:1},lineSync:{type:"number",uniform:"lineSync",defaultValue:0.2,min:0,max:1},scanlines:{type:"number",uniform:"scanlines",defaultValue:0.3,min:0,max:1},bars:{type:"number",uniform:"bars",defaultValue:0,min:0,max:1},barsRate:{type:"number",defaultValue:1},frameShape:{type:"number",uniform:"frameShape",min:0,max:2,defaultValue:0.27},frameLimit:{type:"number",uniform:"frameLimit",
min:-1,max:1,defaultValue:0.34},frameSharpness:{type:"number",uniform:"frameSharpness",min:0,max:40,defaultValue:8.4},frameColor:{type:"color",uniform:"frameColor",defaultValue:[0,0,0,1]}},title:"TV Glitch"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("vibrance",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tfloat average = (color.r + color.g + color.b) / 3.0;\n\tfloat mx = max(color.r, max(color.g, color.b));\n\tfloat amt = (mx - average) * (-3.0 * amount);\n\tcolor.rgb = mix(color.rgb, vec3(mx), amt);\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:0,min:-1,max:1}},title:"Vibrance",description:"Non-peaking saturation effect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("vignette",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec2 pos = vTexCoord.xy - 0.5;\n\tfloat vignette = 1.0 - (dot(pos, pos) * amount);\n\tgl_FragColor = vec4(pixel.rgb * vignette, pixel.a);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:1,min:0}},title:"Vignette",description:"Vignette"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("whitebalance",function(){function c(c,d){var h,y,v;if(n!==c||e!==d)if(n=c,e=d,y=Math.ceil(Math.log(Math.max(d,c))/r),h=Math.pow(2,y),h>m&&(y=Math.ceil(Math.log(m)/r),h=m),y++,g!==h){for(g=h;l.length>y;)l.pop().fb.destroy();
for(;l.length<y;)v=l.length,h=Math.pow(2,v),l.push({fb:new b.util.FrameBuffer(p.gl,h,h),opts:{width:h,height:h},uniforms:{level:l.length,offset:0.25/h,transform:a,projection:a,resolution:[h,h]}}),v&&(l[v-1].uniforms.source=l[v].fb.texture)}}var d,l=[],n,e,g,r=Math.log(2),p=this,h,m;return{initialize:function(a){h=this.gl;m=h.getParameter(h.MAX_TEXTURE_SIZE);this.inputs.auto&&c(this.width,this.height);a()},shader:function(a,c){var e=a.auto;e&&!d&&(d=new b.util.ShaderProgram(this.gl,c.vertex,"precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float offset;\nuniform int level;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord - vec2(offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(offset, -offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(-offset, offset));\n\tpixel /= 4.0;\n\tgl_FragColor = pixel;\n}"));
c.fragment=[e?"#define AUTO":"","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\n#ifdef AUTO\nuniform sampler2D whiteSource;\n#else\nuniform vec4 white;\n#endif\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n#ifdef AUTO\n\tvec4 white = texture2D(whiteSource, vTexCoord);\n#endif\n\tvec3 target = vec3(dot(white.rgb, luma));\n\tpixel.rgb = pixel.rgb * target / white.rgb;\n\tgl_FragColor = pixel;\n}"].join("\n");
return c},resize:function(){this.gl&&this.inputs.auto&&c(this.width,this.height)},draw:function(a,b,c,e,g){var h,m;if(this.inputs.auto){h=l.length-1;for(l[h].uniforms.source=c.source;0<=h;)m=l[h],g(d,b,m.uniforms,m.fb.frameBuffer,null,m.opts),h--;c.whiteSource=l[0].fb.texture}g(a,b,c,e)},destroy:function(){for(;l.length;)l.pop().destroy()},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},white:{type:"color",uniform:"white",defaultValue:[1,1,1]},auto:{type:"boolean",shaderDirty:!0,
defaultValue:!0}}}},{title:"White Balance"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){function a(){var a;if(!q){r=new Uint8Array(256);p=new Uint8Array(512);h=new Uint8Array(512);m=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);for(a=0;256>a;a++)r[a]=256*g();for(a=0;512>a;a++)p[a]=r[a&255],h[a]=p[a]%12;q=!0}}function c(a,b){var c=0,d=0,g=0,l=(a+b)*n,q=Math.floor(a+l),
r=Math.floor(b+l),l=(q+r)*e,z=a-(q-l),H=b-(r-l),u=z>H?1:0,C=(u+1)%2,A=z-u+e,T=H-C+e,l=z-1+2*e,F=H-1+2*e,q=q&255,r=r&255,J=0.5-z*z-H*H,D;0<=J&&(D=3*h[q+p[r]],J*=J,c=J*J*(m[D]*z+m[D+1]*H));z=0.5-A*A-T*T;0<=z&&(D=3*h[q+u+p[r+C]],z*=z,d=z*z*(m[D]*A+m[D+1]*T));z=0.5-l*l-F*F;0<=z&&(D=3*h[q+1+p[r+1]],z*=z,g=z*z*(m[D]*l+m[D+1]*F));return 70*(c+d+g)}var d=b.util.mat4,l=Math.PI,n=0.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,g=Math.random,r,p,h,m,q=!1;b.transform("camerashake",function(){function b(a,c,d){var e=
g.width,f=g.height,h=1,m,n,p,q,r;if(d-=l*Math.floor(d/l))q=Math.sin(d),r=Math.sqrt(1-q*q),m=e/2,n=f/2,d=Math.abs(m*r-n*q),h=Math.abs(m*q+n*r),m=-m,p=Math.abs(m*r-n*q),m=Math.abs(m*q+n*r),h=2*Math.max(d/e,p/e,h/f,m/f);return h*=Math.max((2*Math.abs(a)+e)/e,(2*Math.abs(c)+f)/f)}function e(){var a=g.matrix,x,F,J,D,U;F=0;var P,E=1,S=E=0;J=x=0;var N,O,da,aa,ka;if(n||p||r){J=m*q;for(P=0;P<h;P++)D=Math.pow(2,P),U=Math.pow(0.5,P),F+=U,r&&(x+=c(J*D,7*D)*U),n&&(E+=c(J*D,11*D)*U),p&&(S+=c(J*D,13*D)*U);x*=r/
F;E*=n/F;S*=p/F;J=x*l/180;d.identity(a);F=E;D=S;a[12]=a[0]*F+a[4]*D+a[12];a[13]=a[1]*F+a[5]*D+a[13];a[14]=a[2]*F+a[6]*D+a[14];a[15]=a[3]*F+a[7]*D+a[15];x&&(x=Math.sin(J),F=Math.cos(J),D=a[0],U=a[1],P=a[2],N=a[3],O=a[4],da=a[5],aa=a[6],ka=a[7],a[0]=D*F+O*x,a[1]=U*F+da*x,a[2]=P*F+aa*x,a[3]=N*F+ka*x,a[4]=O*F-D*x,a[5]=da*F-U*x,a[6]=aa*F-P*x,a[7]=ka*F-N*x);u&&(1===H?E=C:(E=b(E,S,J),E=H*C+(1-H)*E),1!==E&&(a[0]*=E,a[1]*=E,a[2]*=E,a[3]*=E,a[4]*=E,a[5]*=E,a[6]*=E,a[7]*=E));g.transformed=!0}else g.transformed=
!1}var g=this,h=1,m=0,n=0,p=0,q=1,r=0,H=0,u=!0,C=1;a();return{resize:e,inputs:{time:{get:function(){return m},set:function(a){if(a===m)return!1;m=a;e();return!0},type:"number"},frequency:{get:function(){return q},set:function(a){if(a===q)return!1;q=a;e();return!0},type:"number"},octaves:{get:function(){return h},set:function(a){a=Math.max(1,a);if(a===h)return!1;h=a;e();return!0},type:"number"},rotation:{get:function(){return r},set:function(a){if(a===r)return!1;r=a;C=b(n,p,r*l/180);e();return!0},
type:"number"},amplitudeX:{get:function(){return n},set:function(a){a=Math.max(0,a);if(a===n)return!1;n=a;C=b(n,p,r*l/180);e();return!0},type:"number"},amplitudeY:{get:function(){return p},set:function(a){a=Math.max(0,a);if(a===p)return!1;p=a;C=b(n,p,r*l/180);e();return!0},type:"number"},autoScale:{get:function(){return u},set:function(a){a=!!a;if(a===u)return!1;u=a;e();return!0},type:"boolean"},preScale:{get:function(){return H},set:function(a){a=Math.max(0,Math.min(1,a));if(a===H)return!1;H=a;e();
return!0},type:"number"}}}},{title:"Camera Shake"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){var a=b.util.mat4;b.transform("3d",function(b){function d(){function b(a,c,d){u[12]=u[0]*a+u[4]*c+u[8]*d+u[12];u[13]=u[1]*a+u[5]*c+u[9]*d+u[13];u[14]=u[2]*a+u[6]*c+u[10]*d+u[14];u[15]=u[3]*a+u[7]*c+u[11]*d+u[15]}function c(){var a;y&&(a=-(n?y*Math.PI/180:y),C=Math.sin(a),A=Math.cos(a),U=u[4],P=u[5],E=u[6],S=u[7],N=u[8],O=u[9],da=u[10],aa=
u[11],u[4]=U*A+N*C,u[5]=P*A+O*C,u[6]=E*A+da*C,u[7]=S*A+aa*C,u[8]=N*A-U*C,u[9]=O*A-P*C,u[10]=da*A-E*C,u[11]=aa*A-S*C)}function d(){var a;v&&(a=-(n?v*Math.PI/180:v),C=Math.sin(a),A=Math.cos(a),T=u[0],F=u[1],J=u[2],D=u[3],N=u[8],O=u[9],da=u[10],aa=u[11],u[0]=T*A-N*C,u[1]=F*A-O*C,u[2]=J*A-da*C,u[3]=D*A-aa*C,u[8]=T*C+N*A,u[9]=F*C+O*A,u[10]=J*C+da*A,u[11]=D*C+aa*A)}function H(){var a;B&&(a=-(n?B*Math.PI/180:B),C=Math.sin(a),A=Math.cos(a),T=u[0],F=u[1],J=u[2],D=u[3],U=u[4],P=u[5],E=u[6],S=u[7],u[0]=T*A+
U*C,u[1]=F*A+P*C,u[2]=J*A+E*C,u[3]=D*A+S*C,u[4]=U*A-T*C,u[5]=P*A-F*C,u[6]=E*A-J*C,u[7]=S*A-D*C)}var u=l.matrix,C,A,T,F,J,D,U,P,E,S,N,O,da,aa;q||f||x||y||v||B||1!==p||1!==h||1!==m?(a.identity(u),b(q+e,f+g,x+r),"XYZ"===M?(c(),d(),H()):"XZY"===M?(c(),H(),d()):"YXZ"===M?(d(),c(),H()):"YZX"===M?(d(),H(),c()):"ZXY"===M?(H(),c(),d()):(H(),d(),c()),1!==p&&(u[0]*=p,u[1]*=p,u[2]*=p,u[3]*=p),1!==h&&(u[4]*=h,u[5]*=h,u[6]*=h,u[7]*=h),1!==m&&(u[8]*=m,u[9]*=m,u[10]*=m,u[11]*=m),b(-e,-g,-r),l.transformed=!0):l.transformed=
!1}var l=this,n=!(b&&b.radians),e=0,g=0,r=0,p=1,h=1,m=1,q=0,f=0,x=0,y=0,v=0,B=0,M="XYZ";return{inputs:{reset:{method:function(){r=g=e=0;m=h=p=1;B=v=y=x=f=q=0;return l.transformed?(l.transformed=!1,!0):!1}},translate:{method:function(a,b,c){isNaN(a)&&(a=q);isNaN(b)&&(b=f);isNaN(c)&&(c=x);if(a===q&&b===f&&c===x)return!1;q=a;f=b;x=c;d();return!0},type:["number","number","number"]},translateX:{get:function(){return q},set:function(a){if(a===q)return!1;q=a;d();return!0},type:"number"},translateY:{get:function(){return f},
set:function(a){if(a===f)return!1;f=a;d();return!0},type:"number"},translateZ:{get:function(){return x},set:function(a){if(a===x)return!1;x=a;d();return!0},type:"number"},rotationOrder:{get:function(){return M},set:function(a){if(a===M)return!1;M=a;d();return!0},type:"number"},rotationX:{get:function(){return y},set:function(a){if(a===y)return!1;y=a;d();return!0},type:"number"},rotationY:{get:function(){return v},set:function(a){if(a===v)return!1;v=a;d();return!0},type:"number"},rotationZ:{get:function(){return B},
set:function(a){if(a===B)return!1;B=a;d();return!0},type:"number"},center:{method:function(a,b,c){isNaN(a)&&(a=e);isNaN(b)&&(b=g);isNaN(c)&&(c=r);if(a===e&&b===g&&c===r)return!1;e=a;g=b;r=c;d();return!0},type:["number","number","number"]},centerX:{get:function(){return e},set:function(a){if(a===e)return!1;e=a;d();return!0},type:"number"},centerY:{get:function(){return g},set:function(a){if(a===g)return!1;g=a;d();return!0},type:"number"},centerZ:{get:function(){return r},set:function(a){if(a===r)return!1;
r=a;d();return!0},type:"number"},scale:{method:function(a,b,c){var e,f;e=isNaN(a)?p:a;isNaN(b)?!isNaN(a)&&isNaN(c)?f=a=e:a=h:a=b;isNaN(c)?void 0===f&&(f=m):f=c;if(e===p&&a===h&&f===m)return!1;p=e;h=a;m=f;d();return!0},type:["number","number","number"]},scaleX:{get:function(){return p},set:function(a){if(a===p)return!1;p=a;d();return!0},type:"number"},scaleY:{get:function(){return h},set:function(a){if(a===h)return!1;h=a;d();return!0},type:"number"},scaleZ:{get:function(){return m},set:function(a){if(a===
m)return!1;m=a;d();return!0},type:"number"}}}},{title:"3D Transform",description:"Translate, Rotate, Scale"})});
